import{c as ee,j as t,r as m,u as ze,H as Ue,L as De}from"./app-y8liD3eE.js";import{T as Ye,a as qe,b as He,A as Ke}from"./app-layout-C2XSx0Q6.js";import{d as Ne}from"./index-BDqSilVs.js";import{P as G}from"./pill-button-CAsbj6uo.js";import{b as Xe}from"./app-logo-icon-Co8Ro-4N.js";/* empty css            */import"./index-B1UqOh03.js";import"./index-_ydHQbnD.js";const Je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ge=Xe("CircleHelp",Je),Qe=r=>{const e=ee.c(14),{currentTitle:i,onConfirm:l,onCancel:s,confirmDisabled:a}=r,h=a===void 0?!1:a;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsx("h3",{className:"font-display text-2xl",children:"Закрепить другой период?"}),e[0]=d):d=e[0];const u=i?`Сейчас закреплён период ${i}. Закрепить этот вместо него?`:"Сейчас уже есть закреплённый период. Закрепить этот вместо него?";let c;e[1]!==u?(c=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:u}),e[1]=u,e[2]=c):c=e[2];let f;e[3]!==s?(f=t.jsx(G,{type:"button",onClick:s,className:"px-4 py-2",children:"Отмена"}),e[3]=s,e[4]=f):f=e[4];let p;e[5]!==h||e[6]!==l?(p=t.jsx(G,{type:"button",onClick:l,tone:"success",className:"px-4 py-2",disabled:h,children:"Закрепить"}),e[5]=h,e[6]=l,e[7]=p):p=e[7];let o;e[8]!==f||e[9]!==p?(o=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[f,p]}),e[8]=f,e[9]=p,e[10]=o):o=e[10];let x;return e[11]!==c||e[12]!==o?(x=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[d,c,o]})}),e[11]=c,e[12]=o,e[13]=x):x=e[13],x};function We(r){const e=ee.c(14),{text:i,ariaLabel:l}=r,[s,a]=m.useState(!1),[h,d]=m.useState(!1);let u,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(u=()=>{if(typeof window>"u")return;const S=window.matchMedia("(hover: none) and (pointer: coarse)"),k=()=>a(S.matches);return k(),S.addEventListener("change",k),()=>S.removeEventListener("change",k)},c=[],e[0]=u,e[1]=c):(u=e[0],c=e[1]),m.useEffect(u,c);const f=s?h:void 0,p=l??"Подсказка";let o;e[2]!==s?(o=()=>{s&&d(Ze)},e[2]=s,e[3]=o):o=e[3];let x;e[4]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(Ge,{className:"h-4 w-4"}),e[4]=x):x=e[4];let b;e[5]!==p||e[6]!==o?(b=t.jsx(Ye,{asChild:!0,children:t.jsx("button",{type:"button","aria-label":p,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:o,children:x})}),e[5]=p,e[6]=o,e[7]=b):b=e[7];let g;e[8]!==i?(g=t.jsx(qe,{className:"max-w-xs text-xs leading-relaxed",children:i}),e[8]=i,e[9]=g):g=e[9];let y;return e[10]!==f||e[11]!==b||e[12]!==g?(y=t.jsxs(He,{open:f,onOpenChange:d,children:[b,g]}),e[10]=f,e[11]=b,e[12]=g,e[13]=y):y=e[13],y}function Ze(r){return!r}const Z=r=>{const e=ee.c(9),{children:i,className:l,tooltipText:s,tooltipAriaLabel:a}=r,h=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${l??""}`;let d;e[0]!==i?(d=t.jsx("span",{children:i}),e[0]=i,e[1]=d):d=e[1];let u;e[2]!==a||e[3]!==s?(u=s?t.jsx("span",{className:"ml-2 inline-flex align-middle",children:t.jsx(We,{text:s,ariaLabel:a??"Дополнительная информация"})}):null,e[2]=a,e[3]=s,e[4]=u):u=e[4];let c;return e[5]!==h||e[6]!==d||e[7]!==u?(c=t.jsxs("div",{className:h,children:[d,u]}),e[5]=h,e[6]=d,e[7]=u,e[8]=c):c=e[8],c},ve=r=>{const e=ee.c(3),{children:i,className:l}=r,s=`font-display text-2xl ${l??""}`;let a;return e[0]!==i||e[1]!==s?(a=t.jsx("div",{className:s,children:i}),e[0]=i,e[1]=s,e[2]=a):a=e[2],a},et=r=>({"--delay":`${r}ms`}),tt={id:0,startDate:"",endDate:"",incomes:[],expenses:[],offIncomeExpenses:[],dailyExpenses:{},isPinned:!1},K=r=>`${Math.max(0,Math.round(r)).toLocaleString("ru-RU")} ₽`,xe=r=>{const e=Math.round(r);return e===0?"0 ₽":`${e>0?"+":"−"}${Math.abs(e).toLocaleString("ru-RU")} ₽`},re=r=>{const[e,i,l]=r.split("-").map(Number);return new Date(e,(i??1)-1,l??1)},pe=r=>{const e=re(r),i=String(e.getDate()).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0");return`${i}.${l}`},at=r=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(re(r)),st=(r,e)=>{const i=new Intl.DateTimeFormat("ru-RU",{month:"short"}),l=i.format(re(r)),s=i.format(re(e)),a=re(r).getFullYear(),h=re(e).getFullYear();return a===h?l===s?at(r):`${l}–${s} ${a}`:`${l} ${a} – ${s} ${h}`},nt=(r,e)=>{const i=re(r),s=re(e).getTime()-i.getTime(),a=Math.floor(s/(1e3*60*60*24));return Math.max(1,a+1)},ue=r=>{const e=r.replace(/\D/g,"");return e===""?"":Number(e)},Ee=r=>r.filter(e=>e.name.trim()==="").map(e=>e.id),Ie=r=>{const e=ee.c(3),{children:i,className:l}=r,s=`flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm ${l??""}`;let a;return e[0]!==i||e[1]!==s?(a=t.jsx("div",{className:s,children:i}),e[0]=i,e[1]=s,e[2]=a):a=e[2],a},de=r=>{const e=ee.c(3),{children:i,className:l}=r,s=`inline-flex items-center font-display tabular-nums leading-[0.9] ${l??""}`;let a;return e[0]!==i||e[1]!==s?(a=t.jsx("span",{className:s,children:i}),e[0]=i,e[1]=s,e[2]=a):a=e[2],a},he=r=>{const e=ee.c(3),{children:i,className:l}=r,s=`inline-flex items-center leading-[0.9] relative -top-[1px] text-black/50 dark:text-white/60 ${l??""}`;let a;return e[0]!==i||e[1]!==s?(a=t.jsx("span",{className:s,children:i}),e[0]=i,e[1]=s,e[2]=a):a=e[2],a},rt=r=>{const e=ee.c(24),{items:i,setItems:l,totalAmount:s,onAdd:a,onBlurField:h,invalidNameIds:d}=r;let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(Z,{children:"Приход"}),e[0]=u):u=e[0];let c;e[1]!==a?(c=t.jsxs("div",{className:"flex items-center justify-between",children:[u,t.jsx(G,{type:"button",onClick:a,children:"+ Строка"})]}),e[1]=a,e[2]=c):c=e[2];let f;e[3]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsxs("div",{className:"mt-3 hidden grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)] items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid",children:[t.jsx("span",{children:"Название"}),t.jsx("span",{className:"text-right",children:"Сумма"})]}),e[3]=f):f=e[3];let p;if(e[4]!==d||e[5]!==i||e[6]!==h||e[7]!==l){let S;e[9]!==d||e[10]!==h||e[11]!==l?(S=(k,q)=>t.jsxs("div",{className:"grid items-center gap-2 grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]",children:[t.jsx("input",{type:"text",placeholder:`Приход ${q+1}`,value:k.name,onChange:$=>l(N=>N.map(E=>E.id===k.id?{...E,name:$.target.value}:E)),onBlur:h,className:`rounded-lg border bg-white/90 px-3 py-2 text-xs dark:bg-white/10 sm:px-4 sm:text-sm ${d.includes(k.id)?"border-[#b0352b] dark:border-[#ff8b7c]":"border-black/10 dark:border-white/10"}`}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:k.amount,onChange:$=>{const N=$.target.value;l(E=>E.map(C=>C.id===k.id?{...C,amount:ue(N)}:C))},onFocus:()=>{k.amount===0&&l($=>$.map(N=>N.id===k.id?{...N,amount:""}:N))},onBlur:()=>{k.amount===""&&l($=>$.map(N=>N.id===k.id?{...N,amount:0}:N)),h()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"})]},k.id),e[9]=d,e[10]=h,e[11]=l,e[12]=S):S=e[12],p=i.map(S),e[4]=d,e[5]=i,e[6]=h,e[7]=l,e[8]=p}else p=e[8];let o;e[13]!==p?(o=t.jsx("div",{className:"mt-3 grid gap-2",children:p}),e[13]=p,e[14]=o):o=e[14];let x;e[15]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx("span",{children:"Итого прихода"}),e[15]=x):x=e[15];let b;e[16]!==s?(b=K(s),e[16]=s,e[17]=b):b=e[17];let g;e[18]!==b?(g=t.jsxs("div",{className:"mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]",children:[x,t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:b})]}),e[18]=b,e[19]=g):g=e[19];let y;return e[20]!==c||e[21]!==o||e[22]!==g?(y=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[c,f,o,g]}),e[20]=c,e[21]=o,e[22]=g,e[23]=y):y=e[23],y},it=r=>{const e=ee.c(65),{title:i,items:l,setItems:s,showDelete:a,onToggleDelete:h,totalLabel:d,totalPlanned:u,totalActual:c,totalDifference:f,idPrefix:p,onBlurField:o,onAfterDelete:x}=r;let b;e[0]!==i?(b=t.jsx(Z,{children:i}),e[0]=i,e[1]=b):b=e[1];let g;e[2]!==p||e[3]!==s?(g=t.jsx(G,{type:"button",onClick:()=>s(te=>[...te,{id:`${p}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),children:"+ Строка"}),e[2]=p,e[3]=s,e[4]=g):g=e[4];let y;e[5]!==h||e[6]!==a?(y=t.jsx(G,{type:"button",onClick:h,active:a,activeTone:"danger",children:"− Удаление"}),e[5]=h,e[6]=a,e[7]=y):y=e[7];let S;e[8]!==g||e[9]!==y?(S=t.jsxs("div",{className:"flex items-center gap-2",children:[g,y]}),e[8]=g,e[9]=y,e[10]=S):S=e[10];let k;e[11]!==b||e[12]!==S?(k=t.jsxs("div",{className:"flex items-center justify-between",children:[b,S]}),e[11]=b,e[12]=S,e[13]=k):k=e[13];const q=`mt-3 grid items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let $,N,E;e[14]===Symbol.for("react.memo_cache_sentinel")?($=t.jsxs("span",{children:[t.jsx("span",{className:"sm:hidden",children:"Название"}),t.jsx("span",{className:"hidden sm:inline",children:"Название"})]}),N=t.jsx("span",{className:"text-right",children:"План"}),E=t.jsx("span",{className:"text-right",children:"Факт"}),e[14]=$,e[15]=N,e[16]=E):($=e[14],N=e[15],E=e[16]);let C;e[17]===Symbol.for("react.memo_cache_sentinel")?(C=t.jsxs("span",{className:"text-right",children:[t.jsx("span",{className:"sm:hidden",children:"Разн"}),t.jsx("span",{className:"hidden sm:inline",children:"Разница"})]}),e[17]=C):C=e[17];let z;e[18]!==a?(z=a&&t.jsx("span",{className:"text-center",children:"—"}),e[18]=a,e[19]=z):z=e[19];let T;e[20]!==z||e[21]!==q?(T=t.jsxs("div",{className:q,children:[$,N,E,C,z]}),e[20]=z,e[21]=q,e[22]=T):T=e[22];let D;if(e[23]!==l||e[24]!==x||e[25]!==o||e[26]!==s||e[27]!==a){let te;e[29]!==x||e[30]!==o||e[31]!==s||e[32]!==a?(te=(_,ce)=>t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${ce+1}`,value:_.name,onChange:P=>s(j=>j.map(X=>X.id===_.id?{...X,name:P.target.value}:X)),onBlur:o,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:_.plannedAmount,onChange:P=>{const j=P.target.value;s(X=>X.map(J=>J.id===_.id?{...J,plannedAmount:ue(j),actualAmount:J.actualTouched?J.actualAmount:ue(j)}:J))},onFocus:()=>{_.plannedAmount===0&&s(P=>P.map(j=>j.id===_.id?{...j,plannedAmount:""}:j))},onBlur:()=>{_.plannedAmount===""&&s(P=>P.map(j=>j.id===_.id?{...j,plannedAmount:0}:j)),o()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:_.actualAmount,onChange:P=>{const j=P.target.value;s(X=>X.map(J=>J.id===_.id?{...J,actualAmount:ue(j),actualTouched:!0}:J))},onFocus:()=>{_.actualAmount===0&&s(P=>P.map(j=>j.id===_.id?{...j,actualAmount:""}:j))},onBlur:()=>{_.actualAmount===""&&s(P=>P.map(j=>j.id===_.id?{...j,actualAmount:0}:j)),o()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("div",{className:`flex min-h-[36px] items-center justify-end px-0 py-2 text-xs tabular-nums sm:min-h-[40px] sm:px-4 sm:text-sm ${_.plannedAmount-_.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":_.plannedAmount-_.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:xe(_.plannedAmount-_.actualAmount)}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(P=>P.filter(j=>j.id!==_.id)),x())},"aria-label":`Удалить трату ${ce+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},_.id),e[29]=x,e[30]=o,e[31]=s,e[32]=a,e[33]=te):te=e[33],D=l.map(te),e[23]=l,e[24]=x,e[25]=o,e[26]=s,e[27]=a,e[28]=D}else D=e[28];let O;e[34]!==D?(O=t.jsx("div",{className:"mt-3 grid gap-2",children:D}),e[34]=D,e[35]=O):O=e[35];const U=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let L;e[36]!==d?(L=t.jsx("span",{children:d}),e[36]=d,e[37]=L):L=e[37];let V;e[38]!==u?(V=K(u),e[38]=u,e[39]=V):V=e[39];let F;e[40]!==V?(F=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:V}),e[40]=V,e[41]=F):F=e[41];let I;e[42]!==c?(I=K(c),e[42]=c,e[43]=I):I=e[43];let Y;e[44]!==I?(Y=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:I}),e[44]=I,e[45]=Y):Y=e[45];const B=`text-right font-display text-sm tabular-nums ${f>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":f<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let A;e[46]!==f?(A=xe(f),e[46]=f,e[47]=A):A=e[47];let M;e[48]!==B||e[49]!==A?(M=t.jsx("span",{className:B,children:A}),e[48]=B,e[49]=A,e[50]=M):M=e[50];let H;e[51]!==a?(H=a&&t.jsx("span",{}),e[51]=a,e[52]=H):H=e[52];let Q;e[53]!==U||e[54]!==L||e[55]!==F||e[56]!==Y||e[57]!==M||e[58]!==H?(Q=t.jsxs("div",{className:U,children:[L,F,Y,M,H]}),e[53]=U,e[54]=L,e[55]=F,e[56]=Y,e[57]=M,e[58]=H,e[59]=Q):Q=e[59];let ae;return e[60]!==T||e[61]!==O||e[62]!==Q||e[63]!==k?(ae=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[k,T,O,Q]}),e[60]=T,e[61]=O,e[62]=Q,e[63]=k,e[64]=ae):ae=e[64],ae},lt=r=>{const e=ee.c(52),{title:i,items:l,setItems:s,showDelete:a,onToggleDelete:h,totalLabel:d,totalAmount:u,idPrefix:c,onBlurField:f,onAfterDelete:p}=r;let o;e[0]!==i?(o=t.jsx(Z,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:i}),e[0]=i,e[1]=o):o=e[1];let x;e[2]!==c||e[3]!==s?(x=t.jsx(G,{type:"button",onClick:()=>s(F=>[...F,{id:`${c}${Date.now()}`,name:"",amount:""}]),children:"+ Строка"}),e[2]=c,e[3]=s,e[4]=x):x=e[4];let b;e[5]!==h||e[6]!==a?(b=t.jsx(G,{type:"button",onClick:h,active:a,activeTone:"danger",children:"− Удаление"}),e[5]=h,e[6]=a,e[7]=b):b=e[7];let g;e[8]!==x||e[9]!==b?(g=t.jsxs("div",{className:"flex items-center gap-2",children:[x,b]}),e[8]=x,e[9]=b,e[10]=g):g=e[10];let y;e[11]!==o||e[12]!==g?(y=t.jsxs("div",{className:"flex items-center justify-between",children:[o,g]}),e[11]=o,e[12]=g,e[13]=y):y=e[13];const S=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let k,q;e[14]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx("span",{children:"Название"}),q=t.jsx("span",{className:"text-right",children:"Сумма"}),e[14]=k,e[15]=q):(k=e[14],q=e[15]);let $;e[16]!==a?($=a&&t.jsx("span",{className:"text-center",children:"—"}),e[16]=a,e[17]=$):$=e[17];let N;e[18]!==S||e[19]!==$?(N=t.jsxs("div",{className:S,children:[k,q,$]}),e[18]=S,e[19]=$,e[20]=N):N=e[20];let E;if(e[21]!==l||e[22]!==p||e[23]!==f||e[24]!==s||e[25]!==a){let F;e[27]!==p||e[28]!==f||e[29]!==s||e[30]!==a?(F=(I,Y)=>t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${Y+1}`,value:I.name,onChange:B=>s(A=>A.map(M=>M.id===I.id?{...M,name:B.target.value}:M)),onBlur:f,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:I.amount,onChange:B=>{const A=B.target.value;s(M=>M.map(H=>H.id===I.id?{...H,amount:ue(A)}:H))},onFocus:()=>{I.amount===0&&s(B=>B.map(A=>A.id===I.id?{...A,amount:""}:A))},onBlur:()=>{I.amount===""&&s(B=>B.map(A=>A.id===I.id?{...A,amount:0}:A)),f()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(B=>B.filter(A=>A.id!==I.id)),p())},"aria-label":`Удалить трату ${Y+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},I.id),e[27]=p,e[28]=f,e[29]=s,e[30]=a,e[31]=F):F=e[31],E=l.map(F),e[21]=l,e[22]=p,e[23]=f,e[24]=s,e[25]=a,e[26]=E}else E=e[26];let C;e[32]!==E?(C=t.jsx("div",{className:"mt-3 grid gap-2",children:E}),e[32]=E,e[33]=C):C=e[33];const z=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let T;e[34]!==d?(T=t.jsx("span",{children:d}),e[34]=d,e[35]=T):T=e[35];let D;e[36]!==u?(D=K(u),e[36]=u,e[37]=D):D=e[37];let O;e[38]!==D?(O=t.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:D}),e[38]=D,e[39]=O):O=e[39];let U;e[40]!==a?(U=a&&t.jsx("span",{}),e[40]=a,e[41]=U):U=e[41];let L;e[42]!==z||e[43]!==T||e[44]!==O||e[45]!==U?(L=t.jsxs("div",{className:z,children:[T,O,U]}),e[42]=z,e[43]=T,e[44]=O,e[45]=U,e[46]=L):L=e[46];let V;return e[47]!==N||e[48]!==C||e[49]!==L||e[50]!==y?(V=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[y,N,C,L]}),e[47]=N,e[48]=C,e[49]=L,e[50]=y,e[51]=V):V=e[51],V};function ht(){const{periodId:r}=ze().props,[e,i]=m.useState(tt),[l,s]=m.useState([]),[a,h]=m.useState(""),[d,u]=m.useState(""),[c,f]=m.useState([]),[p,o]=m.useState([]),[x,b]=m.useState({}),[g,y]=m.useState(!1),[S,k]=m.useState(!1),[q,$]=m.useState(!0),[N,E]=m.useState(null),[C,z]=m.useState(!1),[T,D]=m.useState(null),[O,U]=m.useState(!1),[L,V]=m.useState([]),[F,I]=m.useState(!1),[Y,B]=m.useState(!1),[A,M]=m.useState(!1),[H,Q]=m.useState(),ae=m.useRef(!1),[te,_]=m.useState(0),ce="Заполните названия прихода.",P=m.useMemo(()=>`period:${r}`,[r]),j=m.useRef(!1),X=m.useRef(!1),J=()=>typeof window>"u"?null:window.__periodCache?.[P]??null,be=n=>{if(typeof window>"u")return;const w=window;w.__periodCache||(w.__periodCache={}),w.__periodCache[P]=n},fe=(c??[]).reduce((n,w)=>n+(Number(w.plannedAmount)||0),0),_e=(c??[]).reduce((n,w)=>n+(Number(w.actualAmount)||0),0),ie=fe-_e,Ce=(p??[]).reduce((n,w)=>n+(Number(w.amount)||0),0),ge=(l??[]).reduce((n,w)=>n+(Number(w.amount)||0),0),oe=m.useMemo(()=>!a||!d?0:nt(a,d),[a,d]),me=m.useMemo(()=>Object.values(x).reduce((n,w)=>n+(w||0),0),[x]),we=Object.keys(x).length,Te=we>0?me/we:0,ke=m.useMemo(()=>!a||!d?"Период":`${pe(a)} — ${pe(d)}`,[a,d]),Pe=m.useMemo(()=>!a||!d?"":`${oe} дней · ${st(a,d)}`,[oe,a,d]),le=ge-fe,Me=oe>0?le/oe:0,Se=le+ie-me,je=Math.max(0,oe-we),Fe=je>0?Se/je:0,Be=[{title:"Dashboard",href:Ne().url},{title:ke,href:`/periods/${r}`}],Le=n=>!!(n&&n.id&&Array.isArray(n.incomes)&&Array.isArray(n.expenses)&&Array.isArray(n.offIncomeExpenses)),Re=async()=>{if(X.current)return;const n=J();if(!(Le(n)&&(i(n),s(n.incomes??[]),h(n.startDate??""),u(n.endDate??""),f(n.expenses??[]),o(n.offIncomeExpenses??[]),b(n.dailyExpenses??{}),$(!1),typeof navigator<"u"&&!navigator.onLine))&&!(j.current&&(!navigator.onLine||!n))){X.current=!0,$(!0),E(null);try{const w=await fetch(`/api/periods/${r}`);if(!w.ok)throw new Error("Не удалось загрузить период.");const v=(await w.json()).data,W={id:v.id,startDate:v.start_date,endDate:v.end_date,dailyExpenses:v.daily_expenses??{},isPinned:!!v.is_pinned,incomes:v.incomes.map(R=>({id:String(R.id),name:R.name,amount:R.amount})),expenses:v.expenses.map(R=>({id:String(R.id),name:R.name,plannedAmount:R.planned_amount,actualAmount:R.actual_amount,actualTouched:!1})),offIncomeExpenses:v.external_expenses.map(R=>({id:String(R.id),name:R.name,amount:R.amount}))};i(W),s(W.incomes),h(W.startDate),u(W.endDate),f(W.expenses),o(W.offIncomeExpenses),b(W.dailyExpenses),M(!1),Q(void 0),be(W),j.current=!0}catch(w){E(w instanceof Error?w.message:"Не удалось загрузить период.")}finally{$(!1),X.current=!1}}},se=async()=>{const n=Ee(l);if(n.length>0){V(n),D(ce);return}if(C){ae.current=!0;return}z(!0),D(null),U(!1);try{const w=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",ne=await fetch(`/api/periods/${r}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":w},body:JSON.stringify({start_date:a,end_date:d,daily_expenses:x,incomes:l.map(v=>({id:Number.isFinite(Number(v.id))?Number(v.id):void 0,name:v.name,amount:Number(v.amount)||0})),expenses:c.map(v=>({id:Number.isFinite(Number(v.id))?Number(v.id):void 0,name:v.name,planned_amount:Number(v.plannedAmount)||0,actual_amount:Number(v.actualAmount)||0})),external_expenses:p.map(v=>({id:Number.isFinite(Number(v.id))?Number(v.id):void 0,name:v.name,amount:Number(v.amount)||0}))})});if(ne.status===409)throw new Error("Период пересекается с существующим.");if(!ne.ok)throw new Error("Не удалось сохранить период.");U(!0),be({id:Number(r),startDate:a,endDate:d,incomes:l,expenses:c,offIncomeExpenses:p,dailyExpenses:x})}catch(w){D(w instanceof Error?w.message:"Не удалось сохранить период.")}finally{z(!1)}},Oe=()=>{s(n=>[...n,{id:`i${Date.now()}`,name:"",amount:""}]),se()},$e=()=>{_(n=>n+1)},Ve=async()=>{if(!F&&window.confirm("Удалить период?")){I(!0),D(null);try{const n=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch(`/api/periods/${r}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":n}})).ok)throw new Error("Не удалось удалить период.");window.location.href=Ne().url}catch(n){D(n instanceof Error?n.message:"Не удалось удалить период.")}finally{I(!1)}}},Ae=async(n=!1)=>{if(!Y){B(!0);try{const w=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",ne=await fetch(`/api/periods/${r}/pin`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":w},body:JSON.stringify({pinned:!e.isPinned,force:n})});if(ne.status===409){const ye=await ne.json();ye.pinned?Q(`${pe(ye.pinned.start_date)} — ${pe(ye.pinned.end_date)}`):Q(void 0),M(!0);return}if(!ne.ok)throw new Error("Не удалось изменить закрепление периода.");const W=(await ne.json()).data?.is_pinned??!e.isPinned,R={...e,isPinned:W};i(R),be(R),M(!1)}catch(w){D(w instanceof Error?w.message:"Не удалось изменить закрепление периода.")}finally{B(!1)}}};return m.useEffect(()=>{j.current=!1,Re()},[r]),m.useEffect(()=>{!C&&ae.current&&(ae.current=!1,se())},[C]),m.useEffect(()=>{te>0&&se()},[te]),m.useEffect(()=>{const n=Ee(l);V(n),n.length===0&&T===ce&&D(null)},[l,T]),t.jsxs(Ke,{breadcrumbs:Be,children:[t.jsx(Ue,{title:ke}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-3 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:ke}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:Pe})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(G,{type:"button",onClick:()=>Ae(!1),tone:e.isPinned?"danger":"success",disabled:Y,className:"px-4 py-2",children:e.isPinned?"Открепить":"Закрепить"}),t.jsx(G,{type:"button",onClick:Ve,disabled:F,tone:"danger",className:"px-4 py-2",children:"Удалить"}),t.jsx(De,{href:Ne(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] animate-reveal",style:et(120),children:[q&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),N&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:N}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none",children:[t.jsx(rt,{items:l,setItems:s,totalAmount:ge,onAdd:Oe,onBlurField:se,invalidNameIds:L}),t.jsx(it,{title:"Обязательные траты",items:c,setItems:f,showDelete:g,onToggleDelete:()=>y(n=>!n),totalLabel:"Итого обязательных",totalPlanned:fe,totalActual:_e,totalDifference:ie,idPrefix:"e",onBlurField:se,onAfterDelete:$e}),t.jsx(lt,{title:"Сторонние траты",items:p,setItems:o,showDelete:g,onToggleDelete:()=>y(n=>!n),totalLabel:"Итого сторонних",totalAmount:Ce,idPrefix:"o",onBlurField:se,onAfterDelete:$e})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none",children:[t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(Z,{children:"Дни периода"}),t.jsx(G,{type:"button",onClick:()=>k(n=>!n),active:S,activeTone:"success",children:S?"Готово":"Редактировать"})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:oe}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"})]}),S&&t.jsxs("div",{className:"mt-3 grid gap-2 grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:a,onChange:n=>h(n.target.value),onBlur:se,max:d,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:d,onChange:n=>u(n.target.value),onBlur:se,min:a,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]})]})]}),t.jsx(De,{href:`/periods/${r}/daily`,prefetch:!0,className:"group rounded-lg border border-[#1e7b4f]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(30,123,79,0.55)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(30,123,79,0.65)] dark:border-[#7ce0b3]/30 dark:bg-white/10 dark:text-white",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(Z,{children:"Ежедневные траты"}),t.jsx(G,{as:"span",children:"Перейти к дневным значениям"})]})}),t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[t.jsx(Z,{children:"Планируемое среднее в день"}),t.jsx("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:"(Приход − обязательные) / дни"}),t.jsx(ve,{className:"mt-3",children:K(Me)}),t.jsxs("div",{className:"mt-4 grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("div",{className:"h-px w-full bg-black/10 dark:bg-white/10"}),t.jsx(Z,{children:"Планируемая сумма на период"}),t.jsxs(Ie,{children:[t.jsx(de,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:K(ge)}),t.jsx(he,{children:"−"}),t.jsx(de,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:K(fe)}),t.jsx(he,{children:"="}),t.jsx(de,{className:`${le>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,children:xe(le)})]}),t.jsx("div",{className:"text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Приход − план = сумма в период"})]})]}),t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[t.jsx(Z,{tooltipText:"Фактический остаток / количество незаполненных (непрошедших) дней",children:"Расчётное в день на оставшиеся дни"}),t.jsxs("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:["(",K(Se)," / ",je||0," д.)"]}),t.jsx(ve,{className:"mt-3",children:K(Fe)})]}),t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[t.jsx(Z,{tooltipText:"Планируемый остаток +/− фактическая разница − ежедневные траты за период.",tooltipAriaLabel:"Формула фактического остатка",children:"Фактический остаток"}),t.jsxs(Ie,{className:"mt-3",children:[t.jsx(de,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:K(le)}),t.jsx(de,{className:`${ie>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":ie<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:xe(ie).replace(/^([+−-])/,"$1 ")}),t.jsx(he,{children:"−"}),t.jsx(de,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:K(me)}),t.jsx(he,{children:"="}),t.jsx(de,{className:`${le+ie-me>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,children:xe(le+ie-me)})]}),t.jsx("div",{className:"mt-4 h-px w-full bg-black/10 dark:bg-white/10"}),t.jsx(Z,{className:"mt-4",children:"Фактическое среднее в день за период"}),t.jsx(ve,{className:"mt-2",children:K(Te)})]})]})]}),A&&t.jsx(Qe,{currentTitle:H,onCancel:()=>M(!1),onConfirm:()=>Ae(!0),confirmDisabled:Y}),T&&t.jsx("div",{className:"relative z-10 rounded-lg border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:T})]})]})}export{ht as default};
