import{c as de,j as t,u as ve,r as x,H as _e,L as me}from"./app-CejraSsK.js";import{T as Ae,a as Se,b as $e,A as De}from"./app-layout-DlfsBc8O.js";import{d as ce}from"./index-BDqSilVs.js";import{b as Ie}from"./app-logo-icon-D92xeSNN.js";/* empty css            */import"./index-v4dAW1_0.js";import"./index-BR22Mtl-.js";const Ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ce=Ie("CircleHelp",Ee);function pe(n){const e=de.c(8),{text:i,ariaLabel:l}=n,s=l??"Подсказка";let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(Ce,{className:"h-4 w-4"}),e[0]=a):a=e[0];let o;e[1]!==s?(o=t.jsx(Ae,{asChild:!0,children:t.jsx("button",{type:"button","aria-label":s,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",children:a})}),e[1]=s,e[2]=o):o=e[2];let d;e[3]!==i?(d=t.jsx(Se,{className:"max-w-xs text-xs leading-relaxed",children:i}),e[3]=i,e[4]=d):d=e[4];let y;return e[5]!==o||e[6]!==d?(y=t.jsxs($e,{children:[o,d]}),e[5]=o,e[6]=d,e[7]=y):y=e[7],y}const Te=n=>({"--delay":`${n}ms`}),Me={id:0,startDate:"",endDate:"",incomes:[],expenses:[],offIncomeExpenses:[],dailyExpenses:{}},Z=n=>`${Math.max(0,Math.round(n)).toLocaleString("ru-RU")} ₽`,ne=n=>{const e=Math.round(n);return e===0?"0 ₽":`${e>0?"+":"−"}${Math.abs(e).toLocaleString("ru-RU")} ₽`},re=n=>{const[e,i,l]=n.split("-").map(Number);return new Date(e,(i??1)-1,l??1)},ue=n=>{const e=re(n),i=String(e.getDate()).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0");return`${i}.${l}`},Fe=n=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(re(n)),Be=(n,e)=>{const i=new Intl.DateTimeFormat("ru-RU",{month:"short"}),l=i.format(re(n)),s=i.format(re(e)),a=re(n).getFullYear(),o=re(e).getFullYear();return a===o?l===s?Fe(n):`${l}–${s} ${a}`:`${l} ${a} – ${s} ${o}`},Le=(n,e)=>{const i=re(n),s=re(e).getTime()-i.getTime(),a=Math.floor(s/(1e3*60*60*24));return Math.max(1,a+1)},le=n=>{const e=n.replace(/\D/g,"");return e===""?"":Number(e)},be=n=>n.filter(e=>e.name.trim()==="").map(e=>e.id),Pe=n=>{const e=de.c(24),{items:i,setItems:l,totalAmount:s,onAdd:a,onBlurField:o,invalidNameIds:d}=n;let y;e[0]===Symbol.for("react.memo_cache_sentinel")?(y=t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Приход"}),e[0]=y):y=e[0];let _;e[1]!==a?(_=t.jsxs("div",{className:"flex items-center justify-between",children:[y,t.jsx("button",{type:"button",onClick:a,className:"rounded-full border border-black/10 px-3 py-1 text-xs text-[#6a5d52] dark:border-white/10 dark:text-white/70",children:"+ Строка"})]}),e[1]=a,e[2]=_):_=e[2];let N;e[3]===Symbol.for("react.memo_cache_sentinel")?(N=t.jsxs("div",{className:"mt-3 hidden grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)] items-center gap-3 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid",children:[t.jsx("span",{children:"Название"}),t.jsx("span",{className:"text-right",children:"Сумма"})]}),e[3]=N):N=e[3];let v;if(e[4]!==d||e[5]!==i||e[6]!==o||e[7]!==l){let j;e[9]!==d||e[10]!==o||e[11]!==l?(j=(m,T)=>t.jsxs("div",{className:"grid items-center gap-3 sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]",children:[t.jsx("input",{type:"text",placeholder:`Приход ${T+1}`,value:m.name,onChange:$=>l(f=>f.map(E=>E.id===m.id?{...E,name:$.target.value}:E)),onBlur:o,className:`rounded-2xl border bg-white/90 px-4 py-2 text-sm dark:bg-white/10 ${d.includes(m.id)?"border-[#b0352b] dark:border-[#ff8b7c]":"border-black/10 dark:border-white/10"}`}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:m.amount,onChange:$=>{const f=$.target.value;l(E=>E.map(D=>D.id===m.id?{...D,amount:le(f)}:D))},onFocus:()=>{m.amount===0&&l($=>$.map(f=>f.id===m.id?{...f,amount:""}:f))},onBlur:()=>{m.amount===""&&l($=>$.map(f=>f.id===m.id?{...f,amount:0}:f)),o()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums dark:border-white/10 dark:bg-white/10"})]},m.id),e[9]=d,e[10]=o,e[11]=l,e[12]=j):j=e[12],v=i.map(j),e[4]=d,e[5]=i,e[6]=o,e[7]=l,e[8]=v}else v=e[8];let u;e[13]!==v?(u=t.jsx("div",{className:"mt-3 grid gap-2",children:v}),e[13]=v,e[14]=u):u=e[14];let A;e[15]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsx("span",{children:"Итого прихода"}),e[15]=A):A=e[15];let g;e[16]!==s?(g=Z(s),e[16]=s,e[17]=g):g=e[17];let k;e[18]!==g?(k=t.jsxs("div",{className:"mt-3 grid items-center gap-3 rounded-2xl border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]",children:[A,t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:g})]}),e[18]=g,e[19]=k):k=e[19];let U;return e[20]!==_||e[21]!==u||e[22]!==k?(U=t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[_,N,u,k]}),e[20]=_,e[21]=u,e[22]=k,e[23]=U):U=e[23],U},Re=n=>{const e=de.c(65),{title:i,items:l,setItems:s,showDelete:a,onToggleDelete:o,totalLabel:d,totalPlanned:y,totalActual:_,totalDifference:N,idPrefix:v,onBlurField:u,onAfterDelete:A}=n;let g;e[0]!==i?(g=t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:i}),e[0]=i,e[1]=g):g=e[1];let k;e[2]!==v||e[3]!==s?(k=t.jsx("button",{type:"button",onClick:()=>s(W=>[...W,{id:`${v}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),className:"rounded-full border border-black/10 px-3 py-1 text-xs text-[#6a5d52] dark:border-white/10 dark:text-white/70",children:"+ Строка"}),e[2]=v,e[3]=s,e[4]=k):k=e[4];const U=`rounded-full border px-3 py-1 text-xs transition ${a?"border-[#b0352b]/40 text-[#b0352b] dark:border-[#ff8b7c]/40 dark:text-[#ff8b7c]":"border-black/10 text-[#6a5d52] dark:border-white/10 dark:text-white/70"}`;let j;e[5]!==o||e[6]!==U?(j=t.jsx("button",{type:"button",onClick:o,className:U,children:"− Удаление"}),e[5]=o,e[6]=U,e[7]=j):j=e[7];let m;e[8]!==k||e[9]!==j?(m=t.jsxs("div",{className:"flex items-center gap-2",children:[k,j]}),e[8]=k,e[9]=j,e[10]=m):m=e[10];let T;e[11]!==g||e[12]!==m?(T=t.jsxs("div",{className:"flex items-center justify-between",children:[g,m]}),e[11]=g,e[12]=m,e[13]=T):T=e[13];const $=`mt-3 hidden items-center gap-3 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let f,E,D,z;e[14]===Symbol.for("react.memo_cache_sentinel")?(D=t.jsx("span",{children:"Название"}),z=t.jsx("span",{className:"text-right",children:"План"}),f=t.jsx("span",{className:"text-right",children:"Факт"}),E=t.jsx("span",{className:"text-right",children:"Разница"}),e[14]=f,e[15]=E,e[16]=D,e[17]=z):(f=e[14],E=e[15],D=e[16],z=e[17]);let C;e[18]!==a?(C=a&&t.jsx("span",{className:"text-center",children:"—"}),e[18]=a,e[19]=C):C=e[19];let S;e[20]!==C||e[21]!==$?(S=t.jsxs("div",{className:$,children:[D,z,f,E,C]}),e[20]=C,e[21]=$,e[22]=S):S=e[22];let G;if(e[23]!==l||e[24]!==A||e[25]!==u||e[26]!==s||e[27]!==a){let W;e[29]!==A||e[30]!==u||e[31]!==s||e[32]!==a?(W=(b,ee)=>t.jsxs("div",{className:`grid items-center gap-3 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${ee+1}`,value:b.name,onChange:M=>s(c=>c.map(Y=>Y.id===b.id?{...Y,name:M.target.value}:Y)),onBlur:u,className:"rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm dark:border-white/10 dark:bg-white/10"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:b.plannedAmount,onChange:M=>{const c=M.target.value;s(Y=>Y.map(q=>q.id===b.id?{...q,plannedAmount:le(c),actualAmount:q.actualTouched?q.actualAmount:le(c)}:q))},onFocus:()=>{b.plannedAmount===0&&s(M=>M.map(c=>c.id===b.id?{...c,plannedAmount:""}:c))},onBlur:()=>{b.plannedAmount===""&&s(M=>M.map(c=>c.id===b.id?{...c,plannedAmount:0}:c)),u()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums dark:border-white/10 dark:bg-white/10"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:b.actualAmount,onChange:M=>{const c=M.target.value;s(Y=>Y.map(q=>q.id===b.id?{...q,actualAmount:le(c),actualTouched:!0}:q))},onFocus:()=>{b.actualAmount===0&&s(M=>M.map(c=>c.id===b.id?{...c,actualAmount:""}:c))},onBlur:()=>{b.actualAmount===""&&s(M=>M.map(c=>c.id===b.id?{...c,actualAmount:0}:c)),u()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums dark:border-white/10 dark:bg-white/10"}),t.jsx("div",{className:`flex min-h-[40px] items-center justify-end px-4 py-2 text-sm tabular-nums ${b.plannedAmount-b.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":b.plannedAmount-b.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:ne(b.plannedAmount-b.actualAmount)}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(M=>M.filter(c=>c.id!==b.id)),A())},"aria-label":`Удалить трату ${ee+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},b.id),e[29]=A,e[30]=u,e[31]=s,e[32]=a,e[33]=W):W=e[33],G=l.map(W),e[23]=l,e[24]=A,e[25]=u,e[26]=s,e[27]=a,e[28]=G}else G=e[28];let F;e[34]!==G?(F=t.jsx("div",{className:"mt-3 grid gap-2",children:G}),e[34]=G,e[35]=F):F=e[35];const K=`mt-3 grid items-center gap-3 rounded-2xl border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let B;e[36]!==d?(B=t.jsx("span",{children:d}),e[36]=d,e[37]=B):B=e[37];let L;e[38]!==y?(L=Z(y),e[38]=y,e[39]=L):L=e[39];let P;e[40]!==L?(P=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:L}),e[40]=L,e[41]=P):P=e[41];let V;e[42]!==_?(V=Z(_),e[42]=_,e[43]=V):V=e[43];let R;e[44]!==V?(R=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:V}),e[44]=V,e[45]=R):R=e[45];const O=`text-right font-display text-sm tabular-nums ${N>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":N<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let X;e[46]!==N?(X=ne(N),e[46]=N,e[47]=X):X=e[47];let I;e[48]!==O||e[49]!==X?(I=t.jsx("span",{className:O,children:X}),e[48]=O,e[49]=X,e[50]=I):I=e[50];let h;e[51]!==a?(h=a&&t.jsx("span",{}),e[51]=a,e[52]=h):h=e[52];let H;e[53]!==K||e[54]!==B||e[55]!==P||e[56]!==R||e[57]!==I||e[58]!==h?(H=t.jsxs("div",{className:K,children:[B,P,R,I,h]}),e[53]=K,e[54]=B,e[55]=P,e[56]=R,e[57]=I,e[58]=h,e[59]=H):H=e[59];let Q;return e[60]!==S||e[61]!==F||e[62]!==H||e[63]!==T?(Q=t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[T,S,F,H]}),e[60]=S,e[61]=F,e[62]=H,e[63]=T,e[64]=Q):Q=e[64],Q},Oe=n=>{const e=de.c(55),{title:i,items:l,setItems:s,showDelete:a,onToggleDelete:o,totalLabel:d,totalAmount:y,idPrefix:_,onBlurField:N,onAfterDelete:v}=n;let u;e[0]!==i?(u=t.jsx("span",{children:i}),e[0]=i,e[1]=u):u=e[1];let A;e[2]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsx(pe,{text:"Эти траты не учитываются в расчётах.",ariaLabel:"Сторонние траты"}),e[2]=A):A=e[2];let g;e[3]!==u?(g=t.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:[u,A]}),e[3]=u,e[4]=g):g=e[4];let k;e[5]!==_||e[6]!==s?(k=t.jsx("button",{type:"button",onClick:()=>s(R=>[...R,{id:`${_}${Date.now()}`,name:"",amount:""}]),className:"rounded-full border border-black/10 px-3 py-1 text-xs text-[#6a5d52] dark:border-white/10 dark:text-white/70",children:"+ Строка"}),e[5]=_,e[6]=s,e[7]=k):k=e[7];const U=`rounded-full border px-3 py-1 text-xs transition ${a?"border-[#b0352b]/40 text-[#b0352b] dark:border-[#ff8b7c]/40 dark:text-[#ff8b7c]":"border-black/10 text-[#6a5d52] dark:border-white/10 dark:text-white/70"}`;let j;e[8]!==o||e[9]!==U?(j=t.jsx("button",{type:"button",onClick:o,className:U,children:"− Удаление"}),e[8]=o,e[9]=U,e[10]=j):j=e[10];let m;e[11]!==k||e[12]!==j?(m=t.jsxs("div",{className:"flex items-center gap-2",children:[k,j]}),e[11]=k,e[12]=j,e[13]=m):m=e[13];let T;e[14]!==g||e[15]!==m?(T=t.jsxs("div",{className:"flex items-center justify-between",children:[g,m]}),e[14]=g,e[15]=m,e[16]=T):T=e[16];const $=`mt-3 hidden items-center gap-3 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]"}`;let f,E;e[17]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsx("span",{children:"Название"}),E=t.jsx("span",{className:"text-right",children:"Сумма"}),e[17]=f,e[18]=E):(f=e[17],E=e[18]);let D;e[19]!==a?(D=a&&t.jsx("span",{className:"text-center",children:"—"}),e[19]=a,e[20]=D):D=e[20];let z;e[21]!==D||e[22]!==$?(z=t.jsxs("div",{className:$,children:[f,E,D]}),e[21]=D,e[22]=$,e[23]=z):z=e[23];let C;if(e[24]!==l||e[25]!==v||e[26]!==N||e[27]!==s||e[28]!==a){let R;e[30]!==v||e[31]!==N||e[32]!==s||e[33]!==a?(R=(O,X)=>t.jsxs("div",{className:`grid items-center gap-3 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${X+1}`,value:O.name,onChange:I=>s(h=>h.map(H=>H.id===O.id?{...H,name:I.target.value}:H)),onBlur:N,className:"rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm dark:border-white/10 dark:bg-white/10"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:O.amount,onChange:I=>{const h=I.target.value;s(H=>H.map(Q=>Q.id===O.id?{...Q,amount:le(h)}:Q))},onFocus:()=>{O.amount===0&&s(I=>I.map(h=>h.id===O.id?{...h,amount:""}:h))},onBlur:()=>{O.amount===""&&s(I=>I.map(h=>h.id===O.id?{...h,amount:0}:h)),N()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]"}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(I=>I.filter(h=>h.id!==O.id)),v())},"aria-label":`Удалить трату ${X+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},O.id),e[30]=v,e[31]=N,e[32]=s,e[33]=a,e[34]=R):R=e[34],C=l.map(R),e[24]=l,e[25]=v,e[26]=N,e[27]=s,e[28]=a,e[29]=C}else C=e[29];let S;e[35]!==C?(S=t.jsx("div",{className:"mt-3 grid gap-2",children:C}),e[35]=C,e[36]=S):S=e[36];const G=`mt-3 grid items-center gap-3 rounded-2xl border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]"}`;let F;e[37]!==d?(F=t.jsx("span",{children:d}),e[37]=d,e[38]=F):F=e[38];let K;e[39]!==y?(K=Z(y),e[39]=y,e[40]=K):K=e[40];let B;e[41]!==K?(B=t.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:K}),e[41]=K,e[42]=B):B=e[42];let L;e[43]!==a?(L=a&&t.jsx("span",{}),e[43]=a,e[44]=L):L=e[44];let P;e[45]!==G||e[46]!==F||e[47]!==B||e[48]!==L?(P=t.jsxs("div",{className:G,children:[F,B,L]}),e[45]=G,e[46]=F,e[47]=B,e[48]=L,e[49]=P):P=e[49];let V;return e[50]!==z||e[51]!==S||e[52]!==P||e[53]!==T?(V=t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[T,z,S,P]}),e[50]=z,e[51]=S,e[52]=P,e[53]=T,e[54]=V):V=e[54],V};function Xe(){const{periodId:n}=ve().props,[e,i]=x.useState(Me),[l,s]=x.useState([]),[a,o]=x.useState(""),[d,y]=x.useState(""),[_,N]=x.useState([]),[v,u]=x.useState([]),[A,g]=x.useState({}),[k,U]=x.useState(!1),[j,m]=x.useState(!1),[T,$]=x.useState(!0),[f,E]=x.useState(null),[D,z]=x.useState(!1),[C,S]=x.useState(null),[G,F]=x.useState(!1),[K,B]=x.useState([]),[L,P]=x.useState(!1),V=x.useRef(!1),[R,O]=x.useState(0),X="Заполните названия прихода.",I=x.useMemo(()=>`period:${n}`,[n]),h=x.useRef(!1),H=()=>typeof window>"u"?null:window.__periodCache?.[I]??null,Q=r=>{if(typeof window>"u")return;const p=window;p.__periodCache||(p.__periodCache={}),p.__periodCache[I]=r},W=(_??[]).reduce((r,p)=>r+(Number(p.plannedAmount)||0),0),b=(_??[]).reduce((r,p)=>r+(Number(p.actualAmount)||0),0),ee=W-b,M=(v??[]).reduce((r,p)=>r+(Number(p.amount)||0),0),c=(l??[]).reduce((r,p)=>r+(Number(p.amount)||0),0),Y=x.useMemo(()=>!a||!d?0:Le(a,d),[a,d]),q=x.useMemo(()=>Object.values(A).reduce((r,p)=>r+(p||0),0),[A]),fe=Y>0?q/Y:0,ie=x.useMemo(()=>!a||!d?"Период":`${ue(a)} — ${ue(d)}`,[a,d]),he=x.useMemo(()=>!a||!d?"":`${Y} дней · ${Be(a,d)}`,[Y,a,d]),se=c-W,ge=Y>0?se/Y:0,ke=[{title:"Dashboard",href:ce().url},{title:ie,href:`/periods/${n}`}],we=r=>!!(r&&r.id&&Array.isArray(r.incomes)&&Array.isArray(r.expenses)&&Array.isArray(r.offIncomeExpenses)),je=async()=>{if(h.current)return;const r=H();if(we(r)){h.current=!0,i(r),s(r.incomes??[]),o(r.startDate??""),y(r.endDate??""),N(r.expenses??[]),u(r.offIncomeExpenses??[]),g(r.dailyExpenses??{}),$(!1);return}h.current=!0,$(!0),E(null);try{const p=await fetch(`/api/periods/${n}`);if(!p.ok)throw new Error("Не удалось загрузить период.");const w=(await p.json()).data,ae={id:w.id,startDate:w.start_date,endDate:w.end_date,dailyExpenses:w.daily_expenses??{},incomes:w.incomes.map(J=>({id:String(J.id),name:J.name,amount:J.amount})),expenses:w.expenses.map(J=>({id:String(J.id),name:J.name,plannedAmount:J.planned_amount,actualAmount:J.actual_amount,actualTouched:!1})),offIncomeExpenses:w.external_expenses.map(J=>({id:String(J.id),name:J.name,amount:J.amount}))};i(ae),s(ae.incomes),o(ae.startDate),y(ae.endDate),N(ae.expenses),u(ae.offIncomeExpenses),g(ae.dailyExpenses),Q(ae)}catch(p){E(p instanceof Error?p.message:"Не удалось загрузить период.")}finally{$(!1)}},te=async()=>{const r=be(l);if(r.length>0){B(r),S(X);return}if(D){V.current=!0;return}z(!0),S(null),F(!1);try{const p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",oe=await fetch(`/api/periods/${n}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({start_date:a,end_date:d,daily_expenses:A,incomes:l.map(w=>({id:Number.isFinite(Number(w.id))?Number(w.id):void 0,name:w.name,amount:Number(w.amount)||0})),expenses:_.map(w=>({id:Number.isFinite(Number(w.id))?Number(w.id):void 0,name:w.name,planned_amount:Number(w.plannedAmount)||0,actual_amount:Number(w.actualAmount)||0})),external_expenses:v.map(w=>({id:Number.isFinite(Number(w.id))?Number(w.id):void 0,name:w.name,amount:Number(w.amount)||0}))})});if(oe.status===409)throw new Error("Период пересекается с существующим.");if(!oe.ok)throw new Error("Не удалось сохранить период.");F(!0),Q({id:Number(n),startDate:a,endDate:d,incomes:l,expenses:_,offIncomeExpenses:v,dailyExpenses:A})}catch(p){S(p instanceof Error?p.message:"Не удалось сохранить период.")}finally{z(!1)}},ye=()=>{s(r=>[...r,{id:`i${Date.now()}`,name:"",amount:""}]),te()},xe=()=>{O(r=>r+1)},Ne=async()=>{if(!L&&window.confirm("Удалить период?")){P(!0),S(null);try{const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch(`/api/periods/${n}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":r}})).ok)throw new Error("Не удалось удалить период.");window.location.href=ce().url}catch(r){S(r instanceof Error?r.message:"Не удалось удалить период.")}finally{P(!1)}}};return x.useEffect(()=>{je()},[n]),x.useEffect(()=>{!D&&V.current&&(V.current=!1,te())},[D]),x.useEffect(()=>{R>0&&te()},[R]),x.useEffect(()=>{const r=be(l);B(r),r.length===0&&C===X&&S(null)},[l,C]),t.jsxs(De,{breadcrumbs:ke,children:[t.jsx(_e,{title:ie}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:ie}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:he})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{type:"button",onClick:Ne,disabled:L,className:"rounded-full border border-[#b0352b]/40 bg-white/80 px-4 py-2 text-xs text-[#b0352b] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 disabled:cursor-not-allowed disabled:opacity-70 dark:border-[#ff8b7c]/40 dark:bg-white/10 dark:text-[#ff8b7c]",children:"Удалить"}),t.jsx(me,{href:ce(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] animate-reveal",style:Te(120),children:[T&&t.jsx("div",{className:"col-span-full rounded-2xl border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),f&&t.jsx("div",{className:"col-span-full rounded-2xl border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:f}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none",children:[t.jsx(Pe,{items:l,setItems:s,totalAmount:c,onAdd:ye,onBlurField:te,invalidNameIds:K}),t.jsx(Re,{title:"Обязательные траты",items:_,setItems:N,showDelete:k,onToggleDelete:()=>U(r=>!r),totalLabel:"Итого обязательных",totalPlanned:W,totalActual:b,totalDifference:ee,idPrefix:"e",onBlurField:te,onAfterDelete:xe}),t.jsx(Oe,{title:"Сторонние траты",items:v,setItems:u,showDelete:k,onToggleDelete:()=>U(r=>!r),totalLabel:"Итого сторонних",totalAmount:M,idPrefix:"o",onBlurField:te,onAfterDelete:xe})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none",children:[t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Дни периода"}),t.jsx("button",{type:"button",onClick:()=>m(r=>!r),className:`rounded-full border px-3 py-1 text-xs transition ${j?"border-[#1e7b4f]/40 text-[#1e7b4f] dark:border-[#7ce0b3]/40 dark:text-[#7ce0b3]":"border-black/10 text-[#6a5d52] dark:border-white/10 dark:text-white/70"}`,children:j?"Готово":"Редактировать"})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:Y}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"})]}),j&&t.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:a,onChange:r=>o(r.target.value),onBlur:te,max:d,className:"rounded-2xl border border-black/10 bg-white/90 px-3 py-2 text-sm dark:border-white/10 dark:bg-white/10"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:d,onChange:r=>y(r.target.value),onBlur:te,min:a,className:"rounded-2xl border border-black/10 bg-white/90 px-3 py-2 text-sm dark:border-white/10 dark:bg-white/10"})]})]})]}),t.jsxs(me,{href:`/periods/${n}/daily`,prefetch:!0,className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Ежедневные траты"}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:"Перейти к дневным значениям"})]}),t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Планируемое среднее в день"}),t.jsx("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:"(Приход − обязательные) / дни"}),t.jsx("p",{className:"mt-3 font-display text-2xl",children:Z(ge)}),t.jsxs("div",{className:"mt-4 grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("div",{className:"h-px w-full bg-black/10 dark:bg-white/10"}),t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Планируемая сумма на период"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm font-semibold",children:[t.jsx("span",{className:"font-display tabular-nums text-[#1e7b4f] dark:text-[#7ce0b3]",children:Z(c)}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"−"}),t.jsx("span",{className:"font-display tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:Z(W)}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"="}),t.jsx("span",{className:`font-display tabular-nums ${se>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,children:ne(se)})]}),t.jsx("div",{className:"text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Приход − план = сумма в период"}),t.jsx("div",{className:"h-px w-full bg-black/10 dark:bg-white/10"}),t.jsxs("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:[t.jsx("span",{children:"Фактический остаток"}),t.jsx("span",{className:"ml-2 inline-flex align-middle",children:t.jsx(pe,{text:"Планируемый остаток +/− фактическая разница − ежедневные траты за период.",ariaLabel:"Формула фактического остатка"})})]}),t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-sm font-semibold",children:[t.jsx("span",{className:"font-display tabular-nums text-[#1e7b4f] dark:text-[#7ce0b3]",children:Z(se)}),t.jsx("span",{className:`font-display tabular-nums ${ee>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":ee<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:ne(ee).replace(/^([+−-])/,"$1 ")}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"−"}),t.jsx("span",{className:"font-display tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:Z(q)}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"="}),t.jsx("span",{className:`font-display tabular-nums ${se+ee-q>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,children:ne(se+ee-q)})]}),t.jsx("div",{clasтулsName:"h-px w-full bg-black/10 dark:bg-white/10"}),t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Фактическое среднее в день за период"}),t.jsx("div",{className:"mt-2 font-display text-2xl",children:Z(fe)})]})]})]})]}),C&&t.jsx("div",{className:"relative z-10 rounded-2xl border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:C})]})]})}export{Xe as default};
