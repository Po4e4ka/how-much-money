import{c as F,j as t,L as K,u as H,r as p,H as V}from"./app-y8liD3eE.js";import{A as X}from"./app-layout-C2XSx0Q6.js";import{d as J}from"./index-BDqSilVs.js";import{P as E}from"./pill-button-CAsbj6uo.js";/* empty css            */import"./app-logo-icon-Co8Ro-4N.js";import"./index-B1UqOh03.js";import"./index-_ydHQbnD.js";const G=s=>{const e=F.c(25),{href:a,title:r,subtitle:i,onClose:l,onConfirm:n,confirmDisabled:h}=s,m=h===void 0?!1:h;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsx("h3",{className:"font-display text-2xl",children:"Эти даты присутствуют в периоде"}),e[0]=d):d=e[0];let x;e[1]!==r?(x=t.jsx("h3",{className:"font-display text-xl",children:r}),e[1]=r,e[2]=x):x=e[2];let k;e[3]!==i?(k=t.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:i}),e[3]=i,e[4]=k):k=e[4];let f;e[5]!==x||e[6]!==k?(f=t.jsxs("div",{children:[x,k]}),e[5]=x,e[6]=k,e[7]=f):f=e[7];let b;e[8]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsx(E,{as:"span",className:"bg-white/80 text-[#1c1a17] dark:bg-white/10 dark:text-white",children:"Открыть период"}),e[8]=b):b=e[8];let y;e[9]!==f?(y=t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[f,b]}),e[9]=f,e[10]=y):y=e[10];let w;e[11]!==a||e[12]!==y?(w=t.jsx("div",{className:"mt-4",children:t.jsx(K,{href:a,className:"block w-full rounded-[28px] border border-black/10 bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10",children:y})}),e[11]=a,e[12]=y,e[13]=w):w=e[13];let g;e[14]!==l?(g=t.jsx(E,{type:"button",onClick:l,className:"px-4 py-2",children:"Отменить"}),e[14]=l,e[15]=g):g=e[15];let u;e[16]!==m||e[17]!==n?(u=t.jsx(E,{type:"button",onClick:n,className:"border-transparent bg-[#d87a4a] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] disabled:cursor-not-allowed disabled:opacity-70",disabled:m,children:"Подтвердить"}),e[16]=m,e[17]=n,e[18]=u):u=e[18];let _;e[19]!==u||e[20]!==g?(_=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[g,u]}),e[19]=u,e[20]=g,e[21]=_):_=e[21];let v;return e[22]!==_||e[23]!==w?(v=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[d,w,_]})}),e[22]=_,e[23]=w,e[24]=v):v=e[24],v},Q=s=>{const e=F.c(13),{href:a,title:r,subtitle:i}=s;let l;e[0]!==r?(l=t.jsx("h3",{className:"font-display text-xl",children:r}),e[0]=r,e[1]=l):l=e[1];let n;e[2]!==i?(n=t.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:i}),e[2]=i,e[3]=n):n=e[3];let h;e[4]!==l||e[5]!==n?(h=t.jsxs("div",{children:[l,n]}),e[4]=l,e[5]=n,e[6]=h):h=e[6];let m;e[7]===Symbol.for("react.memo_cache_sentinel")?(m=t.jsx(E,{as:"span",className:"bg-white/80 text-[#1c1a17] dark:bg-white/10 dark:text-white",children:"Открыть период"}),e[7]=m):m=e[7];let d;e[8]!==h?(d=t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h,m]}),e[8]=h,e[9]=d):d=e[9];let x;return e[10]!==a||e[11]!==d?(x=t.jsx(K,{href:a,prefetch:!0,className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10",children:d}),e[10]=a,e[11]=d,e[12]=x):x=e[12],x},U=s=>{const e=F.c(4),{items:a}=s;let r;e[0]!==a?(r=a.map(Z),e[0]=a,e[1]=r):r=e[1];let i;return e[2]!==r?(i=t.jsx("div",{className:"grid gap-4",children:r}),e[2]=r,e[3]=i):i=e[3],i};function Z(s){return t.jsx(Q,{href:`/periods/${s.id}`,title:s.title,subtitle:s.subtitle},s.id)}const ee=`
## Приложение обновилось!
___
## Что нового?

- исправления UI на странице с периодами при создании нового периода
- исправлено это окошко
- исправления UI страницы периода
- добавлен новый блок "рассчёт среднего на оставшиеся дни"
- поправлена цифра "Фактически среднее за период" - теперь считаются только заполненные дни

___
version: 0.1.2
`,te="Круто!",$=s=>s.split("**").map((a,r)=>r%2===1?t.jsx("strong",{children:a},r):a),se=s=>{const e=s.trim().split(`
`),a=[];let r=[];const i=()=>{r.length&&(a.push(t.jsx("ul",{className:"list-disc pl-5",children:r.map((l,n)=>t.jsx("li",{children:$(l)},n))},`list-${a.length}`)),r=[])};return e.forEach(l=>{const n=l.trim();if(!n){i();return}if(n.startsWith("- ")){r.push(n.slice(2));return}if(i(),n.startsWith("### ")){a.push(t.jsx("h4",{className:"text-lg font-semibold",children:$(n.slice(4))},`h4-${a.length}`));return}if(n.startsWith("## ")){a.push(t.jsx("h3",{className:"text-xl font-semibold",children:$(n.slice(3))},`h3-${a.length}`));return}if(n.startsWith("# ")){a.push(t.jsx("h2",{className:"text-2xl font-semibold",children:$(n.slice(2))},`h2-${a.length}`));return}a.push(t.jsx("p",{className:"text-sm text-[#6a5d52] dark:text-white/70",children:$(n)},`p-${a.length}`))}),i(),a},ae=s=>{const e=F.c(4),{onConfirm:a,confirmDisabled:r}=s,i=r===void 0?!1:r;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("div",{className:"space-y-4",children:se(ee)}),e[0]=l):l=e[0];let n;return e[1]!==i||e[2]!==a?(n=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[l,t.jsx("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:t.jsx(E,{type:"button",onClick:a,className:"border-transparent bg-[#d87a4a] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] disabled:cursor-not-allowed disabled:opacity-70",disabled:i,children:te})})]})}),e[1]=i,e[2]=a,e[3]=n):n=e[3],n},re=[{title:"Dashboard",href:J().url}],R=s=>({"--delay":`${s}ms`}),Y=s=>{const e=s?.trim()??"";return e?e.includes("T")?e.slice(0,10):e:""},j=s=>{const e=Y(s);if(!e)return new Date("invalid");const[a,r,i]=e.split("-").map(Number);return new Date(a,(r??1)-1,i??1)},S=s=>{const e=j(s);return Number.isFinite(e.getTime())},C=s=>{const e=Y(s);return e?Number(e.replaceAll("-","")):NaN},P=s=>{const e=j(s),a=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0");return`${a}.${r}`},ne=s=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(j(s)),W=(s,e)=>{const a=new Intl.DateTimeFormat("ru-RU",{month:"short"}),r=a.format(j(s)),i=a.format(j(e)),l=j(s).getFullYear(),n=j(e).getFullYear();return l===n?r===i?ne(s):`${r}–${i} ${l}`:`${r} ${l} – ${i} ${n}`},B=(s,e)=>{const a=j(s),i=j(e).getTime()-a.getTime(),l=Math.floor(i/(1e3*60*60*24));return Math.max(1,l+1)},z=s=>{const e=S(s.start_date)&&S(s.end_date),a=e?B(s.start_date,s.end_date):0;return{title:e?`${P(s.start_date)} — ${P(s.end_date)}`:"Период",subtitle:e?`${a} дней · ${W(s.start_date,s.end_date)}`:"Даты не заданы"}};function pe(){const{auth:s}=H().props,[e,a]=p.useState(""),[r,i]=p.useState(""),[l,n]=p.useState(!1),[h,m]=p.useState(null),[d,x]=p.useState(null),[k,f]=p.useState(!1),[b,y]=p.useState([]),[w,g]=p.useState(!0),[u,_]=p.useState(null),[v,I]=p.useState(s.user?.is_info_shown===!1);p.useEffect(()=>{I(s.user?.is_info_shown===!1)},[s.user]);const q=()=>{I(!1);const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";fetch("/api/user/info-shown",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o}}).catch(c=>{console.error(c)})},T=async()=>{g(!0),_(null);try{const o=await fetch("/api/periods");if(!o.ok)throw new Error("Не удалось загрузить периоды.");const c=await o.json();y(c.data??[])}catch(o){_(o instanceof Error?o.message:"Не удалось загрузить периоды.")}finally{g(!1)}};p.useEffect(()=>{T()},[]);const M=async(o=!1)=>{if(!e||!r){m("Укажите даты начала и конца периода.");return}if(!o){const c=C(e),N=C(r),D=b.find(L=>{const O=C(L.start_date),A=C(L.end_date);return!Number.isFinite(c)||!Number.isFinite(N)||!Number.isFinite(O)||!Number.isFinite(A)?!1:c<A&&N>O});if(D){x(D),f(!0);return}}n(!0),m(null);try{const c=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",N=await fetch("/api/periods",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":c},body:JSON.stringify({start_date:e,end_date:r,force:!!o})});if(N.status===409){const D=await N.json();if(D.overlap){x(D.overlap),f(!0);return}throw new Error("Период пересекается с существующим.")}if(!N.ok)throw new Error("Не удалось сохранить период.");a(""),i(""),x(null),f(!1),await T()}catch(c){m(c instanceof Error?c.message:"Не удалось сохранить период.")}finally{n(!1)}};return t.jsxs(X,{breadcrumbs:re,children:[t.jsx(V,{title:"Dashboard"}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsx("section",{className:"relative z-10 flex flex-wrap items-end justify-between gap-6",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Финансовый контур"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:"Периоды учета"}),t.jsx("p",{className:"mt-2 max-w-xl text-sm text-[#6a5d52] dark:text-white/70",children:"Добавьте новый период сверху и управляйте историей ниже. При клике откроется отдельная страница периода."})]})}),t.jsxs("section",{className:"relative z-10 rounded-[28px] border border-black/10 bg-white/85 p-6 shadow-[0_22px_44px_-28px_rgba(28,26,23,0.6)] backdrop-blur animate-reveal dark:border-white/10 dark:bg-white/10",style:R(120),children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Новый период"}),t.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Добавить диапазон дат"})]})}),t.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-[1fr_1fr_1fr]",children:[t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"С"}),t.jsx("input",{type:"date",value:e,onChange:o=>a(o.target.value),className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"По"}),t.jsx("input",{type:"date",value:r,onChange:o=>i(o.target.value),min:e||void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),t.jsx("div",{className:"flex flex-col justify-end",children:t.jsx("button",{className:"rounded-2xl bg-[#d87a4a] px-4 py-3 text-sm font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] transition hover:-translate-y-0.5 disabled:cursor-not-allowed disabled:opacity-70",type:"button",onClick:()=>M(!1),disabled:l,children:l?"Сохранение...":"Сохранить"})})]}),h&&t.jsx("p",{className:"mt-3 text-xs text-[#b0352b] dark:text-[#ff8b7c]",children:h})]}),t.jsxs("section",{className:"relative z-10 grid gap-4 animate-reveal",style:R(240),children:[b.some(o=>o.is_pinned)&&t.jsxs("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Закреплённый период"}),t.jsx("div",{className:"mt-4",children:(()=>{const o=b.find(N=>N.is_pinned);if(!o)return null;const c=z(o);return t.jsx(U,{items:[{id:o.id,title:c.title,subtitle:c.subtitle}]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"font-display text-2xl",children:"История периодов"}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"Сначала новые"})]}),t.jsxs("div",{className:"grid gap-4",children:[w&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем периоды..."}),u&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:u}),!w&&!u&&b.length===0&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Периодов пока нет. Создайте первый диапазон выше."}),!w&&!u&&t.jsx(U,{items:b.map(o=>{const c=z(o);return{id:o.id,title:c.title,subtitle:c.subtitle}})})]})]}),d&&t.jsx(G,{href:`/periods/${d.id}`,title:S(d.start_date)&&S(d.end_date)?`${P(d.start_date)} — ${P(d.end_date)}`:"Период",subtitle:S(d.start_date)&&S(d.end_date)?`${B(d.start_date,d.end_date)} дней · ${W(d.start_date,d.end_date)}`:"Даты не заданы",onClose:()=>{x(null),f(!1)},onConfirm:()=>M(!0),confirmDisabled:!k||l}),v&&t.jsx(ae,{onConfirm:q})]})]})}export{pe as default};
