import{c as G,j as t,r as y,L as Je,u as bt,H as gt}from"./app-DmI4XuDo.js";import{T as wt,a as yt,b as jt,A as kt}from"./app-layout-CdnNduTw.js";import{d as Me}from"./index-D48w0u2P.js";import{P as se,S as vt}from"./session-expired-modal-sijsbWXR.js";import{O as _t}from"./overlap-period-modal-g3K4b1Fd.js";import{b as Nt}from"./app-logo-icon-Dlz4YmZK.js";import{a as le,b as ge,t as be,d as St,e as He,h as Ct,i as Dt,j as Ve,k as $t,l as je}from"./period-calculations-B9aBpp78.js";import{d as Et}from"./animation-DULAtfne.js";import{c as Xe,b as pe,f as Ue,a as Ge}from"./date-C0FYGyP5.js";/* empty css            */import"./index-CqMOdGhm.js";import"./index-4SCCvfrP.js";const At=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],It=Nt("CircleHelp",At),Tt=i=>{const e=G.c(14),{currentTitle:n,onConfirm:d,onCancel:s,confirmDisabled:a}=i,l=a===void 0?!1:a;let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx("h3",{className:"font-display text-2xl",children:"Закрепить другой период?"}),e[0]=x):x=e[0];const o=n?`Сейчас закреплён период ${n}. Закрепить этот вместо него?`:"Сейчас уже есть закреплённый период. Закрепить этот вместо него?";let c;e[1]!==o?(c=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:o}),e[1]=o,e[2]=c):c=e[2];let r;e[3]!==s?(r=t.jsx(se,{type:"button",onClick:s,className:"px-4 py-2",children:"Отмена"}),e[3]=s,e[4]=r):r=e[4];let f;e[5]!==l||e[6]!==d?(f=t.jsx(se,{type:"button",onClick:d,tone:"success",className:"px-4 py-2",disabled:l,children:"Закрепить"}),e[5]=l,e[6]=d,e[7]=f):f=e[7];let m;e[8]!==r||e[9]!==f?(m=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[r,f]}),e[8]=r,e[9]=f,e[10]=m):m=e[10];let u;return e[11]!==c||e[12]!==m?(u=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[x,c,m]})}),e[11]=c,e[12]=m,e[13]=u):u=e[13],u},Pt=i=>{const e=G.c(10),{onConfirm:n,onCancel:d,confirmDisabled:s}=i,a=s===void 0?!1:s;let l,x;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("h3",{className:"font-display text-2xl",children:"Закрыть период?"}),x=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:"После закрытия период будет доступен только для просмотра. Редактировать данные больше нельзя."}),e[0]=l,e[1]=x):(l=e[0],x=e[1]);let o;e[2]!==d?(o=t.jsx(se,{type:"button",onClick:d,className:"px-4 py-2",children:"Отмена"}),e[2]=d,e[3]=o):o=e[3];let c;e[4]!==a||e[5]!==n?(c=t.jsx(se,{type:"button",onClick:n,tone:"success",className:"px-4 py-2",disabled:a,children:"Закрыть"}),e[4]=a,e[5]=n,e[6]=c):c=e[6];let r;return e[7]!==o||e[8]!==c?(r=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[l,x,t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[o,c]})]})}),e[7]=o,e[8]=c,e[9]=r):r=e[9],r};function Mt(i){const e=G.c(14),{text:n,ariaLabel:d}=i,[s,a]=y.useState(!1),[l,x]=y.useState(!1);let o,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=()=>{if(typeof window>"u")return;const v=window.matchMedia("(hover: none) and (pointer: coarse)"),j=()=>a(v.matches);return j(),v.addEventListener("change",j),()=>v.removeEventListener("change",j)},c=[],e[0]=o,e[1]=c):(o=e[0],c=e[1]),y.useEffect(o,c);const r=s?l:void 0,f=d??"Подсказка";let m;e[2]!==s?(m=()=>{s&&x(Ot)},e[2]=s,e[3]=m):m=e[3];let u;e[4]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(It,{className:"h-4 w-4"}),e[4]=u):u=e[4];let w;e[5]!==f||e[6]!==m?(w=t.jsx(wt,{asChild:!0,children:t.jsx("button",{type:"button","aria-label":f,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:m,children:u})}),e[5]=f,e[6]=m,e[7]=w):w=e[7];let p;e[8]!==n?(p=t.jsx(yt,{className:"max-w-xs text-xs leading-relaxed",children:n}),e[8]=n,e[9]=p):p=e[9];let g;return e[10]!==r||e[11]!==w||e[12]!==p?(g=t.jsxs(jt,{open:r,onOpenChange:x,children:[w,p]}),e[10]=r,e[11]=w,e[12]=p,e[13]=g):g=e[13],g}function Ot(i){return!i}const oe=i=>{const e=G.c(9),{children:n,className:d,tooltipText:s,tooltipAriaLabel:a}=i,l=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${d??""}`;let x;e[0]!==n?(x=t.jsx("span",{children:n}),e[0]=n,e[1]=x):x=e[1];let o;e[2]!==a||e[3]!==s?(o=s?t.jsx("span",{className:"ml-2 inline-flex align-middle",children:t.jsx(Mt,{text:s,ariaLabel:a??"Дополнительная информация"})}):null,e[2]=a,e[3]=s,e[4]=o):o=e[4];let c;return e[5]!==l||e[6]!==x||e[7]!==o?(c=t.jsxs("div",{className:l,children:[x,o]}),e[5]=l,e[6]=x,e[7]=o,e[8]=c):c=e[8],c},Ft=i=>{const e=G.c(3),{href:n}=i;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(oe,{children:"Ежедневные траты"}),t.jsx(se,{as:"span",children:"Перейти к дневным значениям"})]}),e[0]=d):d=e[0];let s;return e[1]!==n?(s=t.jsx(Je,{href:n,prefetch:!0,className:"group rounded-lg border border-[#1e7b4f]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(30,123,79,0.55)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(30,123,79,0.65)] dark:border-[#7ce0b3]/30 dark:bg-white/10 dark:text-white",children:d}),e[1]=n,e[2]=s):s=e[2],s},Bt=i=>{const e=G.c(26),{days:n,startDate:d,endDate:s,isEditing:a,readOnly:l,onToggleEditing:x,onStartDateChange:o,onEndDateChange:c,minStartDate:r,maxStartDate:f,minEndDate:m,maxEndDate:u}=i;let w;e[0]===Symbol.for("react.memo_cache_sentinel")?(w=t.jsx(oe,{children:"Дни периода"}),e[0]=w):w=e[0];const p=a?"Готово":"Редактировать";let g;e[1]!==a||e[2]!==x||e[3]!==l||e[4]!==p?(g=t.jsxs("div",{className:"flex items-center justify-between",children:[w,t.jsx(se,{type:"button",onClick:x,active:a,activeTone:"success",disabled:l,children:p})]}),e[1]=a,e[2]=x,e[3]=l,e[4]=p,e[5]=g):g=e[5];let v;e[6]!==n?(v=t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:n}),e[6]=n,e[7]=v):v=e[7];let j;e[8]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"}),e[8]=j):j=e[8];let k;e[9]!==v?(k=t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[v,j]}),e[9]=v,e[10]=k):k=e[10];let h;e[11]!==s||e[12]!==a||e[13]!==u||e[14]!==f||e[15]!==m||e[16]!==r||e[17]!==c||e[18]!==o||e[19]!==l||e[20]!==d?(h=a&&t.jsxs("div",{className:"mt-3 grid gap-2 grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:d,disabled:l,onChange:A=>o(A.target.value),min:r,max:f,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:s,disabled:l,onChange:A=>c(A.target.value),min:m,max:u,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]})]}),e[11]=s,e[12]=a,e[13]=u,e[14]=f,e[15]=m,e[16]=r,e[17]=c,e[18]=o,e[19]=l,e[20]=d,e[21]=h):h=e[21];let _;return e[22]!==g||e[23]!==k||e[24]!==h?(_=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[g,k,h]}),e[22]=g,e[23]=k,e[24]=h,e[25]=_):_=e[25],_},We=i=>{const e=G.c(2),{className:n}=i,d=`h-px w-full bg-black/10 dark:bg-white/10 ${n??""}`;let s;return e[0]!==d?(s=t.jsx("div",{className:d}),e[0]=d,e[1]=s):s=e[1],s},Fe=i=>{const e=G.c(3),{children:n,className:d}=i,s=`font-display text-2xl ${d??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("div",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},Qe=i=>{const e=G.c(3),{children:n,className:d}=i,s=`flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm ${d??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("div",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},fe=i=>{const e=G.c(3),{children:n,className:d}=i,s=`inline-flex items-center font-display tabular-nums leading-[0.9] ${d??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("span",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},ke=i=>{const e=G.c(3),{children:n,className:d}=i,s=`inline-flex items-center leading-[0.9] relative -top-[1px] text-black/50 dark:text-white/60 ${d??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("span",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},Lt=i=>{const e=G.c(36),{plannedPeriodSum:n,totalDifference:d,totalDailyExpenses:s,dailyActualAverage:a}=i;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx(oe,{tooltipText:"Планируемый остаток +/− фактическая разница − ежедневные траты за период.",tooltipAriaLabel:"Формула фактического остатка",children:"Фактический остаток"}),e[0]=l):l=e[0];let x;e[1]!==n?(x=le(n),e[1]=n,e[2]=x):x=e[2];let o;e[3]!==x?(o=t.jsx(fe,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:x}),e[3]=x,e[4]=o):o=e[4];const c=`${d>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":d<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let r;if(e[5]!==d){let M;e[7]===Symbol.for("react.memo_cache_sentinel")?(M=/^([+−-])/,e[7]=M):M=e[7],r=ge(d).replace(M,"$1 "),e[5]=d,e[6]=r}else r=e[6];let f;e[8]!==c||e[9]!==r?(f=t.jsx(fe,{className:c,children:r}),e[8]=c,e[9]=r,e[10]=f):f=e[10];let m;e[11]===Symbol.for("react.memo_cache_sentinel")?(m=t.jsx(ke,{children:"−"}),e[11]=m):m=e[11];let u;e[12]!==s?(u=le(s),e[12]=s,e[13]=u):u=e[13];let w;e[14]!==u?(w=t.jsx(fe,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:u}),e[14]=u,e[15]=w):w=e[15];let p;e[16]===Symbol.for("react.memo_cache_sentinel")?(p=t.jsx(ke,{children:"="}),e[16]=p):p=e[16];const g=`text-2xl ${n+d-s>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,v=n+d-s;let j;e[17]!==v?(j=ge(v),e[17]=v,e[18]=j):j=e[18];let k;e[19]!==g||e[20]!==j?(k=t.jsx(fe,{className:g,children:j}),e[19]=g,e[20]=j,e[21]=k):k=e[21];let h;e[22]!==k||e[23]!==o||e[24]!==f||e[25]!==w?(h=t.jsxs(Qe,{className:"mt-3",children:[o,f,m,w,p,k]}),e[22]=k,e[23]=o,e[24]=f,e[25]=w,e[26]=h):h=e[26];let _,A;e[27]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx(We,{className:"mt-4"}),A=t.jsx(oe,{className:"mt-4",children:"Фактическое среднее в день за период"}),e[27]=_,e[28]=A):(_=e[27],A=e[28]);let N;e[29]!==a?(N=le(a),e[29]=a,e[30]=N):N=e[30];let E;e[31]!==N?(E=t.jsx(Fe,{className:"mt-2",children:N}),e[31]=N,e[32]=E):E=e[32];let I;return e[33]!==h||e[34]!==E?(I=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[l,h,_,A,E]}),e[33]=h,e[34]=E,e[35]=I):I=e[35],I},Rt=i=>{const e=G.c(49),{value:n,placeholder:d,suggestions:s,disabled:a,onChange:l,onSelect:x,onBlur:o,header:c,className:r,containerClassName:f,inputClassName:m}=i,u=a===void 0?!1:a,w=c===void 0?"Подсказки":c,p=r===void 0?"":r,g=f===void 0?"":f,v=m===void 0?"":m,[j,k]=y.useState(!1),[h,_]=y.useState(0),A=y.useRef(null);let N,E;e[0]!==h||e[1]!==s.length?(N=()=>{h>=s.length&&s.length>0&&_(0)},E=[h,s.length],e[0]=h,e[1]=s.length,e[2]=N,e[3]=E):(N=e[2],E=e[3]),y.useEffect(N,E);let I;e:{if(!n){I="";break e}const C=s[h]??s[0];if(!C){I="";break e}if(!C.toLowerCase().startsWith(n.toLowerCase())){I="";break e}let $;e[4]!==C||e[5]!==n.length?($=C.slice(n.length),e[4]=C,e[5]=n.length,e[6]=$):$=e[6],I=$}const M=I;let K;e[7]!==x?(K=C=>{x(C),_(0),requestAnimationFrame(()=>A.current?.focus())},e[7]=x,e[8]=K):K=e[8];const P=K;let L;e[9]!==P||e[10]!==h||e[11]!==s?(L=C=>{if(C.key==="Escape"){C.preventDefault(),k(!1),A.current?.blur();return}if(C.key==="Tab"&&s.length>0){C.preventDefault();const re=C.shiftKey?-1:1,te=(h+re+s.length)%s.length;_(te);return}if(C.key!=="Enter"||(C.preventDefault(),s.length===0))return;const $=s[h]??s[0];$&&P($)},e[9]=P,e[10]=h,e[11]=s,e[12]=L):L=e[12];const O=L,F=j&&s.length>0&&!u,V=`relative ${p}`;let q;e[13]!==V?(q=V.trim(),e[13]=V,e[14]=q):q=e[14];const S=`relative flex items-center rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm ${g}`;let D;e[15]!==S?(D=S.trim(),e[15]=S,e[16]=D):D=e[16];let X;e[17]!==M||e[18]!==n?(X=M&&t.jsxs("span",{className:"pointer-events-none absolute left-3 top-1/2 z-10 -translate-y-1/2 text-[#6a5d52]/70 dark:text-white/40 sm:left-4",children:[t.jsx("span",{className:"invisible",children:n}),M]}),e[17]=M,e[18]=n,e[19]=X):X=e[19];let B;e[20]!==l?(B=C=>{l(C.target.value),_(0)},e[20]=l,e[21]=B):B=e[21];let R;e[22]===Symbol.for("react.memo_cache_sentinel")?(R=()=>{k(!0),_(0)},e[22]=R):R=e[22];let U;e[23]!==o?(U=()=>{k(!1),o()},e[23]=o,e[24]=U):U=e[24];const Q=`relative z-20 w-full bg-transparent text-xs outline-none placeholder:text-[#6a5d52]/60 disabled:cursor-not-allowed disabled:opacity-70 dark:text-white dark:placeholder:text-white/40 sm:text-sm ${v}`;let Y;e[25]!==Q?(Y=Q.trim(),e[25]=Q,e[26]=Y):Y=e[26];let ee;e[27]!==u||e[28]!==O||e[29]!==d||e[30]!==B||e[31]!==U||e[32]!==Y||e[33]!==n?(ee=t.jsx("input",{ref:A,type:"text",placeholder:d,value:n,disabled:u,onChange:B,onKeyDown:O,onFocus:R,onBlur:U,className:Y}),e[27]=u,e[28]=O,e[29]=d,e[30]=B,e[31]=U,e[32]=Y,e[33]=n,e[34]=ee):ee=e[34];let T;e[35]!==D||e[36]!==X||e[37]!==ee?(T=t.jsxs("div",{className:D,children:[X,ee]}),e[35]=D,e[36]=X,e[37]=ee,e[38]=T):T=e[38];let ne;e[39]!==P||e[40]!==w||e[41]!==h||e[42]!==F||e[43]!==s?(ne=F&&t.jsx("div",{className:"absolute left-0 right-0 z-30 mt-1",onMouseDown:zt,children:t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/95 p-2 text-xs shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] backdrop-blur dark:border-white/10 dark:bg-[#1f1b17]/95",children:[t.jsx("div",{className:"px-2 py-1 text-[10px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:w}),t.jsx("div",{className:"flex flex-wrap gap-2 px-2 pb-2",children:s.map((C,$)=>t.jsx("button",{type:"button",onClick:()=>P(C),onMouseEnter:()=>_($),className:["rounded-full border px-3 py-1 text-[11px] font-medium transition",$===h?"border-black/20 bg-black/10 text-[#1c1a17] dark:border-white/30 dark:bg-white/10 dark:text-white":"border-black/10 bg-black/5 text-[#1c1a17] hover:bg-black/10 dark:border-white/10 dark:bg-white/5 dark:text-white dark:hover:bg-white/10"].join(" "),children:C},C))})]})}),e[39]=P,e[40]=w,e[41]=h,e[42]=F,e[43]=s,e[44]=ne):ne=e[44];let de;return e[45]!==q||e[46]!==T||e[47]!==ne?(de=t.jsxs("div",{className:q,children:[T,ne]}),e[45]=q,e[46]=T,e[47]=ne,e[48]=de):de=e[48],de};function zt(i){return i.preventDefault()}const Ze=y.createContext(null),Oe=({periodId:i,type:e,viewerId:n,children:d})=>{const[s,a]=y.useState({previous:[],all:[]});y.useEffect(()=>{const x=new AbortController;return(async()=>{try{const c=new URLSearchParams({type:e});n&&c.set("viewer_id",n.toString());const r=await fetch(`/api/periods/${i}/expense-suggestions?${c.toString()}`,{signal:x.signal});if(!r.ok)throw new Error("Не удалось загрузить подсказки.");const f=await r.json();a({previous:f.data?.previous??[],all:f.data?.all??[]})}catch(c){if(c instanceof DOMException&&c.name==="AbortError")return}})(),()=>x.abort()},[i,e,n]);const l=y.useMemo(()=>s,[s]);return t.jsx(Ze.Provider,{value:l,children:d})},Kt=()=>{const i=G.c(2),e=y.useContext(Ze);let n;return i[0]!==e?(n=e??{previous:[],all:[]},i[0]=e,i[1]=n):n=i[1],n},qt=8,Be=i=>{const e=G.c(18),{value:n,placeholder:d,disabled:s,containerClassName:a,usedNames:l,onChange:x,onBlur:o}=i,c=s===void 0?!1:s;let r;e[0]!==l?(r=l===void 0?[]:l,e[0]=l,e[1]=r):r=e[1];const f=r,{previous:m,all:u}=Kt();let w;if(e[2]!==u||e[3]!==m||e[4]!==f||e[5]!==n){e:{const v=n.trim(),j=v.length>0?u:m;let k;e[7]!==f?(k=new Set(f.map(Ht).filter(Vt)),e[7]=f,e[8]=k):k=e[8];const h=k;if(j.length===0){let N;e[9]===Symbol.for("react.memo_cache_sentinel")?(N=[],e[9]=N):N=e[9],w=N;break e}const _=v.toLowerCase();w=j.filter(N=>{const E=N.toLowerCase();return h.has(E)?!1:_.length===0?!0:E.startsWith(_)}).slice(0,qt)}e[2]=u,e[3]=m,e[4]=f,e[5]=n,e[6]=w}else w=e[6];const p=w;let g;return e[10]!==a||e[11]!==c||e[12]!==o||e[13]!==x||e[14]!==d||e[15]!==p||e[16]!==n?(g=t.jsx(Rt,{value:n,placeholder:d,suggestions:p,disabled:c,onChange:x,onSelect:x,onBlur:o,header:"Подсказки",containerClassName:a}),e[10]=a,e[11]=c,e[12]=o,e[13]=x,e[14]=d,e[15]=p,e[16]=n,e[17]=g):g=e[17],g};function Ht(i){return i.trim().toLowerCase()}function Vt(i){return i.length>0}const Xt=i=>{const e=G.c(65),{title:n,items:d,setItems:s,showDelete:a,onToggleDelete:l,totalLabel:x,totalPlanned:o,totalActual:c,totalDifference:r,idPrefix:f,onBlurField:m,onAfterDelete:u,readOnly:w}=i,p=w===void 0?!1:w;let g;e[0]!==n?(g=t.jsx(oe,{children:n}),e[0]=n,e[1]=g):g=e[1];let v;e[2]!==f||e[3]!==s?(v=()=>s(T=>[...T,{id:`${f}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),e[2]=f,e[3]=s,e[4]=v):v=e[4];let j;e[5]!==p||e[6]!==v?(j=t.jsx(se,{type:"button",onClick:v,disabled:p,children:"+ Строка"}),e[5]=p,e[6]=v,e[7]=j):j=e[7];let k;e[8]!==l||e[9]!==p||e[10]!==a?(k=t.jsx(se,{type:"button",onClick:l,active:a,activeTone:"danger",disabled:p,children:"− Удаление"}),e[8]=l,e[9]=p,e[10]=a,e[11]=k):k=e[11];let h;e[12]!==j||e[13]!==k?(h=t.jsxs("div",{className:"flex items-center gap-2",children:[j,k]}),e[12]=j,e[13]=k,e[14]=h):h=e[14];let _;e[15]!==g||e[16]!==h?(_=t.jsxs("div",{className:"flex items-center justify-between",children:[g,h]}),e[15]=g,e[16]=h,e[17]=_):_=e[17];const A=`mt-3 grid items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let N,E,I;e[18]===Symbol.for("react.memo_cache_sentinel")?(I=t.jsxs("span",{children:[t.jsx("span",{className:"sm:hidden",children:"Название"}),t.jsx("span",{className:"hidden sm:inline",children:"Название"})]}),N=t.jsx("span",{className:"text-right",children:"План"}),E=t.jsx("span",{className:"text-right",children:"Факт"}),e[18]=N,e[19]=E,e[20]=I):(N=e[18],E=e[19],I=e[20]);let M;e[21]===Symbol.for("react.memo_cache_sentinel")?(M=t.jsxs("span",{className:"text-right",children:[t.jsx("span",{className:"sm:hidden",children:"Разн"}),t.jsx("span",{className:"hidden sm:inline",children:"Разница"})]}),e[21]=M):M=e[21];let K;e[22]!==a?(K=a&&t.jsx("span",{className:"text-center",children:"—"}),e[22]=a,e[23]=K):K=e[23];let P;e[24]!==K||e[25]!==A?(P=t.jsxs("div",{className:A,children:[I,N,E,M,K]}),e[24]=K,e[25]=A,e[26]=P):P=e[26];let L;e[27]!==d||e[28]!==u||e[29]!==m||e[30]!==p||e[31]!==s||e[32]!==a?(L=d.map((T,ne)=>{const de=d.filter(C=>C.id!==T.id).map(Ut);return t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(Be,{value:T.name,placeholder:`Трата ${ne+1}`,disabled:p,usedNames:de,onChange:C=>s($=>$.map(re=>re.id===T.id?{...re,name:C}:re)),onBlur:m}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:T.plannedAmount,disabled:p,onChange:C=>{const $=C.target.value;s(re=>re.map(te=>te.id===T.id?{...te,plannedAmount:be($),actualAmount:te.actualTouched?te.actualAmount:be($)}:te))},onFocus:()=>{T.plannedAmount===0&&s(C=>C.map($=>$.id===T.id?{...$,plannedAmount:""}:$))},onBlur:()=>{T.plannedAmount===""&&s(C=>C.map($=>$.id===T.id?{...$,plannedAmount:0}:$)),m()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:T.actualAmount,disabled:p,onChange:C=>{const $=C.target.value;s(re=>re.map(te=>te.id===T.id?{...te,actualAmount:be($),actualTouched:!0}:te))},onFocus:()=>{T.actualAmount===0&&s(C=>C.map($=>$.id===T.id?{...$,actualAmount:""}:$))},onBlur:()=>{T.actualAmount===""&&s(C=>C.map($=>$.id===T.id?{...$,actualAmount:0}:$)),m()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("div",{className:`flex min-h-[36px] items-center justify-end px-0 py-2 text-xs tabular-nums sm:min-h-[40px] sm:px-4 sm:text-sm ${T.plannedAmount-T.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":T.plannedAmount-T.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:ge(T.plannedAmount-T.actualAmount)}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(C=>C.filter($=>$.id!==T.id)),u())},"aria-label":`Удалить трату ${ne+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:p,children:"—"})]},T.id)}),e[27]=d,e[28]=u,e[29]=m,e[30]=p,e[31]=s,e[32]=a,e[33]=L):L=e[33];let O;e[34]!==L?(O=t.jsx("div",{className:"mt-3 grid gap-2",children:L}),e[34]=L,e[35]=O):O=e[35];const F=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let V;e[36]!==x?(V=t.jsx("span",{children:x}),e[36]=x,e[37]=V):V=e[37];let q;e[38]!==o?(q=le(o),e[38]=o,e[39]=q):q=e[39];let S;e[40]!==q?(S=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:q}),e[40]=q,e[41]=S):S=e[41];let D;e[42]!==c?(D=le(c),e[42]=c,e[43]=D):D=e[43];let X;e[44]!==D?(X=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:D}),e[44]=D,e[45]=X):X=e[45];const B=`text-right font-display text-sm tabular-nums ${r>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":r<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let R;e[46]!==r?(R=ge(r),e[46]=r,e[47]=R):R=e[47];let U;e[48]!==B||e[49]!==R?(U=t.jsx("span",{className:B,children:R}),e[48]=B,e[49]=R,e[50]=U):U=e[50];let Q;e[51]!==a?(Q=a&&t.jsx("span",{}),e[51]=a,e[52]=Q):Q=e[52];let Y;e[53]!==F||e[54]!==V||e[55]!==S||e[56]!==X||e[57]!==U||e[58]!==Q?(Y=t.jsxs("div",{className:F,children:[V,S,X,U,Q]}),e[53]=F,e[54]=V,e[55]=S,e[56]=X,e[57]=U,e[58]=Q,e[59]=Y):Y=e[59];let ee;return e[60]!==P||e[61]!==O||e[62]!==Y||e[63]!==_?(ee=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[_,P,O,Y]}),e[60]=P,e[61]=O,e[62]=Y,e[63]=_,e[64]=ee):ee=e[64],ee};function Ut(i){return i.name}const Gt=i=>{const e=G.c(44),{items:n,setItems:d,totalAmount:s,onAdd:a,showDelete:l,onToggleDelete:x,onBlurField:o,onAfterDelete:c,invalidNameIds:r,readOnly:f}=i,m=f===void 0?!1:f;let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(oe,{children:"Приход"}),e[0]=u):u=e[0];let w;e[1]!==a||e[2]!==m?(w=t.jsx(se,{type:"button",onClick:a,disabled:m,children:"+ Строка"}),e[1]=a,e[2]=m,e[3]=w):w=e[3];let p;e[4]!==x||e[5]!==m||e[6]!==l?(p=t.jsx(se,{type:"button",onClick:x,active:l,activeTone:"danger",disabled:m,children:"− Удаление"}),e[4]=x,e[5]=m,e[6]=l,e[7]=p):p=e[7];let g;e[8]!==w||e[9]!==p?(g=t.jsxs("div",{className:"flex items-center justify-between",children:[u,t.jsxs("div",{className:"flex items-center gap-2",children:[w,p]})]}),e[8]=w,e[9]=p,e[10]=g):g=e[10];const v=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let j,k;e[11]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx("span",{children:"Название"}),k=t.jsx("span",{className:"text-right",children:"Сумма"}),e[11]=j,e[12]=k):(j=e[11],k=e[12]);let h;e[13]!==l?(h=l&&t.jsx("span",{className:"text-center",children:"—"}),e[13]=l,e[14]=h):h=e[14];let _;e[15]!==v||e[16]!==h?(_=t.jsxs("div",{className:v,children:[j,k,h]}),e[15]=v,e[16]=h,e[17]=_):_=e[17];let A;e[18]!==r||e[19]!==n||e[20]!==c||e[21]!==o||e[22]!==m||e[23]!==d||e[24]!==l?(A=n.map((F,V)=>{const q=n.filter(S=>S.id!==F.id).map(Jt);return t.jsxs("div",{className:`grid items-center gap-2 ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(Be,{value:F.name,placeholder:`Приход ${V+1}`,disabled:m,usedNames:q,onChange:S=>d(D=>D.map(X=>X.id===F.id?{...X,name:S}:X)),onBlur:o,containerClassName:r.includes(F.id)?"border-[#b0352b] dark:border-[#ff8b7c]":""}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:F.amount,disabled:m,onChange:S=>{const D=S.target.value;d(X=>X.map(B=>B.id===F.id?{...B,amount:be(D)}:B))},onFocus:()=>{F.amount===0&&d(S=>S.map(D=>D.id===F.id?{...D,amount:""}:D))},onBlur:()=>{F.amount===""&&d(S=>S.map(D=>D.id===F.id?{...D,amount:0}:D)),o()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),l&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(d(S=>S.filter(D=>D.id!==F.id)),c())},"aria-label":`Удалить приход ${V+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:m,children:"—"})]},F.id)}),e[18]=r,e[19]=n,e[20]=c,e[21]=o,e[22]=m,e[23]=d,e[24]=l,e[25]=A):A=e[25];let N;e[26]!==A?(N=t.jsx("div",{className:"mt-3 grid gap-2",children:A}),e[26]=A,e[27]=N):N=e[27];const E=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let I;e[28]===Symbol.for("react.memo_cache_sentinel")?(I=t.jsx("span",{children:"Итого прихода"}),e[28]=I):I=e[28];let M;e[29]!==s?(M=le(s),e[29]=s,e[30]=M):M=e[30];let K;e[31]!==M?(K=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:M}),e[31]=M,e[32]=K):K=e[32];let P;e[33]!==l?(P=l&&t.jsx("span",{}),e[33]=l,e[34]=P):P=e[34];let L;e[35]!==E||e[36]!==K||e[37]!==P?(L=t.jsxs("div",{className:E,children:[I,K,P]}),e[35]=E,e[36]=K,e[37]=P,e[38]=L):L=e[38];let O;return e[39]!==_||e[40]!==N||e[41]!==L||e[42]!==g?(O=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[g,_,N,L]}),e[39]=_,e[40]=N,e[41]=L,e[42]=g,e[43]=O):O=e[43],O};function Jt(i){return i.name}const Wt=i=>{const e=G.c(52),{title:n,items:d,setItems:s,showDelete:a,onToggleDelete:l,totalLabel:x,totalAmount:o,idPrefix:c,onBlurField:r,onAfterDelete:f,readOnly:m}=i,u=m===void 0?!1:m;let w;e[0]!==n?(w=t.jsx(oe,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:n}),e[0]=n,e[1]=w):w=e[1];let p;e[2]!==c||e[3]!==s?(p=()=>s(S=>[...S,{id:`${c}${Date.now()}`,name:"",amount:""}]),e[2]=c,e[3]=s,e[4]=p):p=e[4];let g;e[5]!==u||e[6]!==p?(g=t.jsx(se,{type:"button",onClick:p,disabled:u,children:"+ Строка"}),e[5]=u,e[6]=p,e[7]=g):g=e[7];let v;e[8]!==l||e[9]!==u||e[10]!==a?(v=t.jsx(se,{type:"button",onClick:l,active:a,activeTone:"danger",disabled:u,children:"− Удаление"}),e[8]=l,e[9]=u,e[10]=a,e[11]=v):v=e[11];let j;e[12]!==g||e[13]!==v?(j=t.jsxs("div",{className:"flex items-center gap-2",children:[g,v]}),e[12]=g,e[13]=v,e[14]=j):j=e[14];let k;e[15]!==w||e[16]!==j?(k=t.jsxs("div",{className:"flex items-center justify-between",children:[w,j]}),e[15]=w,e[16]=j,e[17]=k):k=e[17];const h=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let _,A;e[18]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsx("span",{children:"Название"}),_=t.jsx("span",{className:"text-right",children:"Сумма"}),e[18]=_,e[19]=A):(_=e[18],A=e[19]);let N;e[20]!==a?(N=a&&t.jsx("span",{className:"text-center",children:"—"}),e[20]=a,e[21]=N):N=e[21];let E;e[22]!==N||e[23]!==h?(E=t.jsxs("div",{className:h,children:[A,_,N]}),e[22]=N,e[23]=h,e[24]=E):E=e[24];let I;e[25]!==d||e[26]!==f||e[27]!==r||e[28]!==u||e[29]!==s||e[30]!==a?(I=d.map((S,D)=>{const X=d.filter(B=>B.id!==S.id).map(Qt);return t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(Be,{value:S.name,placeholder:`Трата ${D+1}`,disabled:u,usedNames:X,onChange:B=>s(R=>R.map(U=>U.id===S.id?{...U,name:B}:U)),onBlur:r}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:S.amount,disabled:u,onChange:B=>{const R=B.target.value;s(U=>U.map(Q=>Q.id===S.id?{...Q,amount:be(R)}:Q))},onFocus:()=>{S.amount===0&&s(B=>B.map(R=>R.id===S.id?{...R,amount:""}:R))},onBlur:()=>{S.amount===""&&s(B=>B.map(R=>R.id===S.id?{...R,amount:0}:R)),r()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(B=>B.filter(R=>R.id!==S.id)),f())},"aria-label":`Удалить трату ${D+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:u,children:"—"})]},S.id)}),e[25]=d,e[26]=f,e[27]=r,e[28]=u,e[29]=s,e[30]=a,e[31]=I):I=e[31];let M;e[32]!==I?(M=t.jsx("div",{className:"mt-3 grid gap-2",children:I}),e[32]=I,e[33]=M):M=e[33];const K=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let P;e[34]!==x?(P=t.jsx("span",{children:x}),e[34]=x,e[35]=P):P=e[35];let L;e[36]!==o?(L=le(o),e[36]=o,e[37]=L):L=e[37];let O;e[38]!==L?(O=t.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:L}),e[38]=L,e[39]=O):O=e[39];let F;e[40]!==a?(F=a&&t.jsx("span",{}),e[40]=a,e[41]=F):F=e[41];let V;e[42]!==K||e[43]!==P||e[44]!==O||e[45]!==F?(V=t.jsxs("div",{className:K,children:[P,O,F]}),e[42]=K,e[43]=P,e[44]=O,e[45]=F,e[46]=V):V=e[46];let q;return e[47]!==E||e[48]!==M||e[49]!==V||e[50]!==k?(q=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[k,E,M,V]}),e[47]=E,e[48]=M,e[49]=V,e[50]=k,e[51]=q):q=e[51],q};function Qt(i){return i.name}const Zt=i=>{const e=G.c(35),{dailyAverage:n,days:d,totalIncome:s,totalPlannedExpenses:a,plannedPeriodSum:l}=i;let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(oe,{tooltipText:"Приход − план = сумма в период",children:"Планируемая сумма на период"}),e[0]=x):x=e[0];let o;e[1]!==s?(o=le(s),e[1]=s,e[2]=o):o=e[2];let c;e[3]!==o?(c=t.jsx(fe,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:o}),e[3]=o,e[4]=c):c=e[4];let r;e[5]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx(ke,{children:"−"}),e[5]=r):r=e[5];let f;e[6]!==a?(f=le(a),e[6]=a,e[7]=f):f=e[7];let m;e[8]!==f?(m=t.jsx(fe,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:f}),e[8]=f,e[9]=m):m=e[9];let u;e[10]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(ke,{children:"="}),e[10]=u):u=e[10];const w=`text-2xl ${l>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`;let p;e[11]!==l?(p=ge(l),e[11]=l,e[12]=p):p=e[12];let g;e[13]!==w||e[14]!==p?(g=t.jsx(fe,{className:w,children:p}),e[13]=w,e[14]=p,e[15]=g):g=e[15];let v;e[16]!==g||e[17]!==c||e[18]!==m?(v=t.jsxs("div",{className:"grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[x,t.jsxs(Qe,{children:[c,r,m,u,g]})]}),e[16]=g,e[17]=c,e[18]=m,e[19]=v):v=e[19];let j,k;e[20]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(We,{className:"mt-4"}),k=t.jsx(oe,{className:"mt-4",children:"Планируемое среднее в день"}),e[20]=j,e[21]=k):(j=e[20],k=e[21]);let h;e[22]!==l?(h=le(l),e[22]=l,e[23]=h):h=e[23];const _=d||0;let A;e[24]!==h||e[25]!==_?(A=t.jsxs("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:["(",h," / ",_," д.)"]}),e[24]=h,e[25]=_,e[26]=A):A=e[26];let N;e[27]!==n?(N=le(n),e[27]=n,e[28]=N):N=e[28];let E;e[29]!==N?(E=t.jsx(Fe,{className:"mt-3",children:N}),e[29]=N,e[30]=E):E=e[30];let I;return e[31]!==v||e[32]!==A||e[33]!==E?(I=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[v,j,k,A,E]}),e[31]=v,e[32]=A,e[33]=E,e[34]=I):I=e[34],I},Yt=i=>{const e=G.c(3),{children:n,className:d}=i,s=`mt-2 text-xs text-[#6a5d52] dark:text-white/60 ${d??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("p",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},es=i=>{const e=G.c(13),{actualRemaining:n,remainingDays:d,remainingDailyAverage:s}=i;let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(oe,{tooltipText:"Фактический остаток / количество незаполненных (непрошедших) дней",children:"Расчётное в день на оставшиеся дни"}),e[0]=a):a=e[0];let l;e[1]!==n?(l=le(n),e[1]=n,e[2]=l):l=e[2];const x=d||0;let o;e[3]!==l||e[4]!==x?(o=t.jsxs(Yt,{children:["(",l," / ",x," д.)"]}),e[3]=l,e[4]=x,e[5]=o):o=e[5];let c;e[6]!==s?(c=le(s),e[6]=s,e[7]=c):c=e[7];let r;e[8]!==c?(r=t.jsx(Fe,{className:"mt-3",children:c}),e[8]=c,e[9]=r):r=e[9];let f;return e[10]!==o||e[11]!==r?(f=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[a,o,r]}),e[10]=o,e[11]=r,e[12]=f):f=e[12],f},ts={id:0,startDate:"",endDate:"",incomes:[],expenses:[],offIncomeExpenses:[],dailyExpenses:{},isPinned:!1,isClosed:!1};function us(){const{periodId:i,viewerId:e,viewerName:n,viewerEmail:d,viewerMode:s}=bt().props,a=!!(e??s),[l,x]=y.useState(ts),[o,c]=y.useState([]),[r,f]=y.useState(""),[m,u]=y.useState(""),[w,p]=y.useState([]),[g,v]=y.useState([]),[j,k]=y.useState({}),[h,_]=y.useState(!1),[A,N]=y.useState(!1),[E,I]=y.useState(!0),[M,K]=y.useState(null),[P,L]=y.useState(!1),[O,F]=y.useState(null),[V,q]=y.useState(!1),[S,D]=y.useState(null),[X,B]=y.useState(!1),[R,U]=y.useState([]),[Q,Y]=y.useState(!1),[ee,T]=y.useState(!1),[ne,de]=y.useState(!1),[C,$]=y.useState(!1),[re,te]=y.useState(!1),[Ye,ve]=y.useState(!1),[et,_e]=y.useState(),Ne=y.useRef(!1),[Le,tt]=y.useState(0),Re="Заполните названия прихода.",ue=y.useRef(null),we=y.useRef(null),ze=y.useMemo(()=>`period:${e??"self"}:${i}`,[i,e]),ie=y.useMemo(()=>e?`viewer_id=${e}`:"",[e]),Se=y.useRef(!1),Ce=y.useRef(!1),st=()=>typeof window>"u"?null:window.__periodCache?.[ze]??null,ye=b=>{if(typeof window>"u")return;const H=window;H.__periodCache||(H.__periodCache={}),H.__periodCache[ze]=b},{totalPlanned:De,totalActual:at,totalDifference:$e}=St(w??[]),nt=He(g??[]),Ee=He(o??[]),he=y.useMemo(()=>!r||!m?0:Xe(r,m),[r,m]),Ae=y.useMemo(()=>Ct(j),[j]),Ie=y.useMemo(()=>Dt(r,m,j),[j,r,m]),lt=Ie>0?Ae/Ie:0,Te=y.useMemo(()=>!r||!m?"Период":`${pe(r)} — ${pe(m)}`,[r,m]),rt=y.useMemo(()=>!r||!m?"":`${he} дней · ${Ue(r,m)}`,[he,r,m]),{plannedPeriodSum:Ke,dailyAverage:it,actualRemaining:ot,remainingDays:dt,remainingDailyAverage:ct,isDailyComplete:mt}=$t({days:he,totalIncome:Ee,totalPlannedExpenses:De,totalDifference:$e,totalDailyExpenses:Ae,filledDays:Ie}),xe=l.isClosed||a;Me().url,`${i}`;const xt=b=>!!(b&&b.id&&Array.isArray(b.incomes)&&Array.isArray(b.expenses)&&Array.isArray(b.offIncomeExpenses)),ft=async()=>{if(Ce.current)return;const b=st();if(!(xt(b)&&(x({...b,isClosed:!!b.isClosed}),c(b.incomes??[]),f(b.startDate??""),u(b.endDate??""),p(b.expenses??[]),v(b.offIncomeExpenses??[]),k(b.dailyExpenses??{}),ue.current={startDate:b.startDate??"",endDate:b.endDate??""},I(!1),typeof navigator<"u"&&!navigator.onLine))&&!(Se.current&&(!navigator.onLine||!b))){Ce.current=!0,I(!0),K(null);try{const H=await fetch(`/api/periods/${i}${ie?`?${ie}`:""}`);if(!H.ok)throw new Error("Не удалось загрузить период.");const W=(await H.json()).data,Z={id:W.id,startDate:W.start_date,endDate:W.end_date,dailyExpenses:W.daily_expenses??{},isPinned:!!W.is_pinned,isClosed:!!W.is_closed,incomes:W.incomes.map(J=>({id:String(J.id),name:J.name,amount:J.amount})),expenses:W.expenses.map(J=>({id:String(J.id),name:J.name,plannedAmount:J.planned_amount,actualAmount:J.actual_amount,actualTouched:!1})),offIncomeExpenses:W.external_expenses.map(J=>({id:String(J.id),name:J.name,amount:J.amount}))};x(Z),c(Z.incomes),f(Z.startDate),u(Z.endDate),p(Z.expenses),v(Z.offIncomeExpenses),k(Z.dailyExpenses),$(!1),_e(void 0),ue.current={startDate:Z.startDate,endDate:Z.endDate},ye(Z),Se.current=!0}catch(H){K(H instanceof Error?H.message:"Не удалось загрузить период.")}finally{I(!1),Ce.current=!1}}},ce=async(b=!1,H)=>{if(xe)return;const ae=H?.startDate??r,W=H?.endDate??m,Z=Ve(o);if(Z.length>0){U(Z),D(Re);return}if(P){Ne.current=!0;return}L(!0),D(null),B(!1);try{const J=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",me=await fetch(`/api/periods/${i}${ie?`?${ie}`:""}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":J},body:JSON.stringify({start_date:ae,end_date:W,daily_expenses:j,force:b,incomes:o.filter(z=>z.name.trim()!=="").map(z=>({id:Number.isFinite(Number(z.id))?Number(z.id):void 0,name:z.name,amount:je(z.amount)})),expenses:w.filter(z=>z.name.trim()!=="").map(z=>({id:Number.isFinite(Number(z.id))?Number(z.id):void 0,name:z.name,planned_amount:je(z.plannedAmount),actual_amount:je(z.actualAmount)})),external_expenses:g.filter(z=>z.name.trim()!=="").map(z=>({id:Number.isFinite(Number(z.id))?Number(z.id):void 0,name:z.name,amount:je(z.amount)}))})});if(me.status===409){const z=await me.json();if(z.overlap){we.current={startDate:ae,endDate:W},F(z.overlap),q(!0),ue.current&&(f(ue.current.startDate),u(ue.current.endDate));return}throw new Error("Период пересекается с существующим.")}if(!me.ok){if(me.status===423){const z=await me.json();throw new Error(z.message??"Период закрыт и не редактируется.")}throw new Error("Не удалось сохранить период.")}f(ae),u(W),B(!0),F(null),q(!1),we.current=null,ue.current={startDate:ae,endDate:W},ye({id:Number(i),startDate:ae,endDate:W,incomes:o,expenses:w,offIncomeExpenses:g,dailyExpenses:j,isPinned:l.isPinned,isClosed:l.isClosed})}catch(J){D(J instanceof Error?J.message:"Не удалось сохранить период.")}finally{L(!1)}},ut=()=>{xe||(c(b=>[...b,{id:`i${Date.now()}`,name:"",amount:""}]),ce())},Pe=()=>{tt(b=>b+1)},pt=async()=>{if(!a&&!Q&&window.confirm("Удалить период?")){Y(!0),D(null);try{const b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch(`/api/periods/${i}${ie?`?${ie}`:""}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":b}})).ok)throw new Error("Не удалось удалить период.");window.location.href=e?`/shared/${e}`:Me().url}catch(b){D(b instanceof Error?b.message:"Не удалось удалить период.")}finally{Y(!1)}}},ht=async()=>{if(!(a||ne||l.isClosed)){de(!0),D(null);try{const b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",H=await fetch(`/api/periods/${i}/close${ie?`?${ie}`:""}`,{method:"POST",headers:{"X-CSRF-TOKEN":b}});if(H.status===419){ve(!0);return}if(!H.ok){const Z=await H.json();throw new Error(Z.message??"Не удалось закрыть период.")}const ae=await H.json(),W={...l,isClosed:ae.data?.is_closed??!0};x(W),te(!1),ye({id:Number(i),startDate:r,endDate:m,incomes:o,expenses:w,offIncomeExpenses:g,dailyExpenses:j,isPinned:l.isPinned,isClosed:W.isClosed})}catch(b){D(b instanceof Error?b.message:"Не удалось закрыть период.")}finally{de(!1)}}},qe=async(b=!1)=>{if(!(a||ee)){T(!0);try{const H=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",ae=await fetch(`/api/periods/${i}/pin${ie?`?${ie}`:""}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":H},body:JSON.stringify({pinned:!l.isPinned,force:b})});if(ae.status===419){ve(!0);return}if(ae.status===409){const me=await ae.json();me.pinned?_e(`${pe(me.pinned.start_date)} — ${pe(me.pinned.end_date)}`):_e(void 0),$(!0);return}if(!ae.ok)throw new Error("Не удалось изменить закрепление периода.");const Z=(await ae.json()).data?.is_pinned??!l.isPinned,J={...l,isPinned:Z};x(J),ye(J),$(!1)}catch(H){D(H instanceof Error?H.message:"Не удалось изменить закрепление периода.")}finally{T(!1)}}};return y.useEffect(()=>{Se.current=!1,ft()},[i,e]),y.useEffect(()=>{!P&&Ne.current&&(Ne.current=!1,ce())},[P]),y.useEffect(()=>{Le>0&&ce()},[Le]),y.useEffect(()=>{const b=Ve(o);U(b),b.length===0&&S===Re&&D(null)},[o,S]),t.jsxs(kt,{children:[t.jsx(gt,{title:Te}),t.jsxs("div",{className:`relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-3 font-body text-[#1c1a17] dark:text-[#f7f3ee]${l.isClosed?" bg-emerald-50/70 dark:bg-emerald-950/20":""}`,children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:Te}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:rt})]}),l.isClosed&&t.jsx("div",{className:"flex-1 text-center text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:"Период закрыт"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[!a&&!l.isClosed&&t.jsx(se,{type:"button",onClick:()=>qe(!1),tone:l.isPinned?"danger":"success",disabled:ee,className:"px-4 py-2",children:l.isPinned?"Открепить":"Закрепить"}),!a&&mt&&!l.isClosed&&t.jsx(se,{type:"button",onClick:()=>te(!0),disabled:ne,tone:"success",className:"px-4 py-2",children:"Закрыть период"}),!a&&t.jsx(se,{type:"button",onClick:pt,disabled:Q,tone:"danger",className:"px-4 py-2",children:"Удалить"}),t.jsx(Je,{href:e?`/shared/${e}`:Me(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),a&&t.jsxs("div",{className:"relative z-10 rounded-2xl border border-black/10 bg-white/70 px-4 py-3 text-sm text-[#1c1a17] shadow-[0_18px_36px_-26px_rgba(28,26,23,0.5)] dark:border-white/10 dark:bg-white/10 dark:text-white/80",children:["Просмотр периодов пользователя"," ",t.jsx("span",{className:"font-semibold",children:n||d||`#${e}`}),". Режим только чтение."]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] lg:items-start animate-reveal",style:Et(120),children:[E&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),M&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:M}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Oe,{periodId:i,type:"income",viewerId:e,children:t.jsx(Gt,{items:o,setItems:c,totalAmount:Ee,onAdd:ut,showDelete:h,onToggleDelete:()=>_(b=>!b),onBlurField:ce,onAfterDelete:Pe,invalidNameIds:R,readOnly:xe})}),t.jsx(Oe,{periodId:i,type:"mandatory",viewerId:e,children:t.jsx(Xt,{title:"Обязательные траты",items:w,setItems:p,showDelete:h,onToggleDelete:()=>_(b=>!b),totalLabel:"Итого обязательных",totalPlanned:De,totalActual:at,totalDifference:$e,idPrefix:"e",onBlurField:ce,onAfterDelete:Pe,readOnly:xe})}),t.jsx(Oe,{periodId:i,type:"external",viewerId:e,children:t.jsx(Wt,{title:"Сторонние траты",items:g,setItems:v,showDelete:h,onToggleDelete:()=>_(b=>!b),totalLabel:"Итого сторонних",totalAmount:nt,idPrefix:"o",onBlurField:ce,onAfterDelete:Pe,readOnly:xe})})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Bt,{days:he,startDate:r,endDate:m,isEditing:A,readOnly:xe,onToggleEditing:()=>N(b=>xe?b:!b),onStartDateChange:b=>{f(b),ce(!1,{startDate:b})},onEndDateChange:b=>{u(b),ce(!1,{endDate:b})},minStartDate:m?Ge(m,-3):void 0,maxStartDate:m,minEndDate:r,maxEndDate:r?Ge(r,3):void 0}),t.jsx(Ft,{href:e?`/shared/${e}/periods/${i}/daily`:`/periods/${i}/daily`}),t.jsx(Zt,{dailyAverage:it,days:he,totalIncome:Ee,totalPlannedExpenses:De,plannedPeriodSum:Ke}),t.jsx(es,{actualRemaining:ot,remainingDays:dt,remainingDailyAverage:ct}),t.jsx(Lt,{plannedPeriodSum:Ke,totalDifference:$e,totalDailyExpenses:Ae,dailyActualAverage:lt})]})]}),C&&t.jsx(Tt,{currentTitle:et,onCancel:()=>$(!1),onConfirm:()=>qe(!0),confirmDisabled:ee}),re&&t.jsx(Pt,{onCancel:()=>te(!1),onConfirm:ht,confirmDisabled:ne}),Ye&&t.jsx(vt,{onClose:()=>ve(!1),onReload:()=>window.location.reload()}),!a&&O&&t.jsx(_t,{href:`/periods/${O.id}`,title:`${pe(O.start_date)} — ${pe(O.end_date)}`,subtitle:`${Xe(O.start_date,O.end_date)} дней · ${Ue(O.start_date,O.end_date)}`,onClose:()=>{F(null),q(!1),we.current=null},onConfirm:()=>ce(!0,we.current??void 0),confirmDisabled:!V||P}),S&&t.jsx("div",{className:"relative z-10 rounded-lg border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:S})]})]})}export{us as default};
