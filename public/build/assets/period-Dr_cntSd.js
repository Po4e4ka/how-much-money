import{c as Q,j as t,L as ze,u as vt,r as g,H as Nt}from"./app-Co2WJCTd.js";import{A as St}from"./app-layout-BWJR1pMz.js";import{d as Be}from"./index-D48w0u2P.js";import{P as W}from"./pill-button-BF9KXfli.js";import{O as Dt}from"./overlap-period-modal-CaPMVF-x.js";import{B as ae,a as ve,b as tt,E as Le,O as $t}from"./off-income-block-DI074XIm.js";import{a as J,e as pe,t as ke,h as Qe,b as Ze,i as At,j as Ct,k as Ge,l as Et,d as fe}from"./period-calculations-BXSzTPPy.js";import{S as Pt}from"./session-expired-modal-C2-bvFmK.js";import{d as It}from"./animation-DULAtfne.js";import{c as We,b as ue,f as Ye,a as et}from"./date-C0FYGyP5.js";/* empty css            */import"./app-logo-icon-BIJslR1r.js";import"./index-ap9OcSvD.js";import"./index-DPEoTood.js";const Tt=m=>{const e=Q.c(14),{currentTitle:i,onConfirm:d,onCancel:a,confirmDisabled:s}=m,r=s===void 0?!1:s;let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsx("h3",{className:"font-display text-2xl",children:"Закрепить другой период?"}),e[0]=f):f=e[0];const x=i?`Сейчас закреплён период ${i}. Закрепить этот вместо него?`:"Сейчас уже есть закреплённый период. Закрепить этот вместо него?";let c;e[1]!==x?(c=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:x}),e[1]=x,e[2]=c):c=e[2];let n;e[3]!==a?(n=t.jsx(W,{type:"button",onClick:a,className:"px-4 py-2",children:"Отмена"}),e[3]=a,e[4]=n):n=e[4];let u;e[5]!==r||e[6]!==d?(u=t.jsx(W,{type:"button",onClick:d,tone:"success",className:"px-4 py-2",disabled:r,children:"Закрепить"}),e[5]=r,e[6]=d,e[7]=u):u=e[7];let l;e[8]!==n||e[9]!==u?(l=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[n,u]}),e[8]=n,e[9]=u,e[10]=l):l=e[10];let p;return e[11]!==c||e[12]!==l?(p=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[f,c,l]})}),e[11]=c,e[12]=l,e[13]=p):p=e[13],p},Ot=m=>{const e=Q.c(10),{onConfirm:i,onCancel:d,confirmDisabled:a}=m,s=a===void 0?!1:a;let r,f;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx("h3",{className:"font-display text-2xl",children:"Закрыть период?"}),f=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:"После закрытия период будет доступен только для просмотра. Редактировать данные больше нельзя."}),e[0]=r,e[1]=f):(r=e[0],f=e[1]);let x;e[2]!==d?(x=t.jsx(W,{type:"button",onClick:d,className:"px-4 py-2",children:"Отмена"}),e[2]=d,e[3]=x):x=e[3];let c;e[4]!==s||e[5]!==i?(c=t.jsx(W,{type:"button",onClick:i,tone:"success",className:"px-4 py-2",disabled:s,children:"Закрыть"}),e[4]=s,e[5]=i,e[6]=c):c=e[6];let n;return e[7]!==x||e[8]!==c?(n=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[r,f,t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[x,c]})]})}),e[7]=x,e[8]=c,e[9]=n):n=e[9],n},Rt=m=>{const e=Q.c(3),{href:i}=m;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(ae,{children:"Ежедневные траты"}),t.jsx(W,{as:"span",children:"Перейти к дневным значениям"})]}),e[0]=d):d=e[0];let a;return e[1]!==i?(a=t.jsx(ze,{href:i,prefetch:!0,className:"group rounded-lg border border-[#1e7b4f]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(30,123,79,0.55)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(30,123,79,0.65)] dark:border-[#7ce0b3]/30 dark:bg-white/10 dark:text-white",children:d}),e[1]=i,e[2]=a):a=e[2],a},Ft=m=>{const e=Q.c(26),{days:i,startDate:d,endDate:a,isEditing:s,readOnly:r,onToggleEditing:f,onStartDateChange:x,onEndDateChange:c,minStartDate:n,maxStartDate:u,minEndDate:l,maxEndDate:p}=m;let _;e[0]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx(ae,{children:"Дни периода"}),e[0]=_):_=e[0];const h=s?"Готово":"Редактировать";let b;e[1]!==s||e[2]!==f||e[3]!==r||e[4]!==h?(b=t.jsxs("div",{className:"flex items-center justify-between",children:[_,t.jsx(W,{type:"button",onClick:f,active:s,activeTone:"success",disabled:r,children:h})]}),e[1]=s,e[2]=f,e[3]=r,e[4]=h,e[5]=b):b=e[5];let j;e[6]!==i?(j=t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:i}),e[6]=i,e[7]=j):j=e[7];let y;e[8]===Symbol.for("react.memo_cache_sentinel")?(y=t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"}),e[8]=y):y=e[8];let w;e[9]!==j?(w=t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[j,y]}),e[9]=j,e[10]=w):w=e[10];let k;e[11]!==a||e[12]!==s||e[13]!==p||e[14]!==u||e[15]!==l||e[16]!==n||e[17]!==c||e[18]!==x||e[19]!==r||e[20]!==d?(k=s&&t.jsxs("div",{className:"mt-3 grid gap-2 grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:d,disabled:r,onChange:N=>x(N.target.value),min:n,max:u,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:a,disabled:r,onChange:N=>c(N.target.value),min:l,max:p,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]})]}),e[11]=a,e[12]=s,e[13]=p,e[14]=u,e[15]=l,e[16]=n,e[17]=c,e[18]=x,e[19]=r,e[20]=d,e[21]=k):k=e[21];let v;return e[22]!==b||e[23]!==w||e[24]!==k?(v=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[b,w,k]}),e[22]=b,e[23]=w,e[24]=k,e[25]=v):v=e[25],v},Ue=m=>{const e=Q.c(2),{className:i}=m,d=`h-px w-full bg-black/10 dark:bg-white/10 ${i??""}`;let a;return e[0]!==d?(a=t.jsx("div",{className:d}),e[0]=d,e[1]=a):a=e[1],a},st=m=>{const e=Q.c(3),{children:i,className:d}=m,a=`flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm ${d??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("div",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},oe=m=>{const e=Q.c(3),{children:i,className:d}=m,a=`inline-flex items-center font-display tabular-nums leading-[0.9] ${d??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("span",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},he=m=>{const e=Q.c(3),{children:i,className:d}=m,a=`inline-flex items-center leading-[0.9] relative -top-[1px] text-black/50 dark:text-white/60 ${d??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("span",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},Mt=m=>{const e=Q.c(46),{plannedPeriodSum:i,totalDifference:d,totalDailyExpenses:a,unforeseenOverrun:s,actualRemaining:r,unforeseenRemaining:f,dailyActualAverage:x}=m;let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(ae,{tooltipText:"Планируемый остаток +/− фактическая разница − ежедневные траты за период − перерасход непредвиденных (если есть).",tooltipAriaLabel:"Формула фактического остатка",children:"Фактический остаток"}),e[0]=c):c=e[0];let n;e[1]!==i?(n=J(i),e[1]=i,e[2]=n):n=e[2];let u;e[3]!==n?(u=t.jsx(oe,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:n}),e[3]=n,e[4]=u):u=e[4];const l=`${d>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":d<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let p;if(e[5]!==d){let D;e[7]===Symbol.for("react.memo_cache_sentinel")?(D=/^([+−-])/,e[7]=D):D=e[7],p=pe(d).replace(D,"$1 "),e[5]=d,e[6]=p}else p=e[6];let _;e[8]!==l||e[9]!==p?(_=t.jsx(oe,{className:l,children:p}),e[8]=l,e[9]=p,e[10]=_):_=e[10];let h;e[11]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsx(he,{children:"−"}),e[11]=h):h=e[11];let b;e[12]!==a?(b=J(a),e[12]=a,e[13]=b):b=e[13];let j;e[14]!==b?(j=t.jsx(oe,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:b}),e[14]=b,e[15]=j):j=e[15];let y;e[16]!==s?(y=s>0&&t.jsxs(t.Fragment,{children:[t.jsx(he,{children:"−"}),t.jsx(oe,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:J(s)})]}),e[16]=s,e[17]=y):y=e[17];let w;e[18]===Symbol.for("react.memo_cache_sentinel")?(w=t.jsx(he,{children:"="}),e[18]=w):w=e[18];const k=`text-2xl ${i+d-a-s>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`;let v;e[19]!==r?(v=pe(r),e[19]=r,e[20]=v):v=e[20];let N;e[21]!==k||e[22]!==v?(N=t.jsx(oe,{className:k,children:v}),e[21]=k,e[22]=v,e[23]=N):N=e[23];let I;e[24]!==y||e[25]!==N||e[26]!==u||e[27]!==_||e[28]!==j?(I=t.jsxs(st,{className:"mt-3",children:[u,_,h,j,y,w,N]}),e[24]=y,e[25]=N,e[26]=u,e[27]=_,e[28]=j,e[29]=I):I=e[29];let R,L;e[30]===Symbol.for("react.memo_cache_sentinel")?(R=t.jsx(Ue,{className:"mt-3"}),L=t.jsx(ae,{className:"mt-4",tooltipText:"Фактический остаток + остаток с непредвиденных.",tooltipAriaLabel:"Сумма остатков",children:"Остаток средств"}),e[30]=R,e[31]=L):(R=e[30],L=e[31]);const F=r+f;let $;e[32]!==F?($=pe(F),e[32]=F,e[33]=$):$=e[33];let A;e[34]!==$?(A=t.jsx(ve,{className:"mt-2 text-base text-[#1e7b4f] dark:text-[#7ce0b3]",children:$}),e[34]=$,e[35]=A):A=e[35];let E,K;e[36]===Symbol.for("react.memo_cache_sentinel")?(E=t.jsx(Ue,{className:"mt-4"}),K=t.jsx(ae,{className:"mt-4",children:"Фактическое среднее в день за период"}),e[36]=E,e[37]=K):(E=e[36],K=e[37]);let T;e[38]!==x?(T=J(x),e[38]=x,e[39]=T):T=e[39];let U;e[40]!==T?(U=t.jsx(ve,{className:"mt-2",children:T}),e[40]=T,e[41]=U):U=e[41];let X;return e[42]!==I||e[43]!==A||e[44]!==U?(X=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[c,I,R,L,A,E,K,U]}),e[42]=I,e[43]=A,e[44]=U,e[45]=X):X=e[45],X},Bt=m=>{const e=Q.c(65),{title:i,items:d,setItems:a,showDelete:s,onToggleDelete:r,totalLabel:f,totalPlanned:x,totalActual:c,totalDifference:n,idPrefix:u,onBlurField:l,onAfterDelete:p,readOnly:_}=m,h=_===void 0?!1:_;let b;e[0]!==i?(b=t.jsx(ae,{children:i}),e[0]=i,e[1]=b):b=e[1];let j;e[2]!==u||e[3]!==a?(j=()=>a(C=>[...C,{id:`${u}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),e[2]=u,e[3]=a,e[4]=j):j=e[4];let y;e[5]!==h||e[6]!==j?(y=t.jsx(W,{type:"button",onClick:j,disabled:h,children:"+ Строка"}),e[5]=h,e[6]=j,e[7]=y):y=e[7];let w;e[8]!==r||e[9]!==h||e[10]!==s?(w=t.jsx(W,{type:"button",onClick:r,active:s,activeTone:"danger",disabled:h,children:"− Удаление"}),e[8]=r,e[9]=h,e[10]=s,e[11]=w):w=e[11];let k;e[12]!==y||e[13]!==w?(k=t.jsxs("div",{className:"flex items-center gap-2",children:[y,w]}),e[12]=y,e[13]=w,e[14]=k):k=e[14];let v;e[15]!==b||e[16]!==k?(v=t.jsxs("div",{className:"flex items-center justify-between",children:[b,k]}),e[15]=b,e[16]=k,e[17]=v):v=e[17];const N=`mt-3 grid items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let I,R,L;e[18]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsxs("span",{children:[t.jsx("span",{className:"sm:hidden",children:"Название"}),t.jsx("span",{className:"hidden sm:inline",children:"Название"})]}),I=t.jsx("span",{className:"text-right",children:"План"}),R=t.jsx("span",{className:"text-right",children:"Факт"}),e[18]=I,e[19]=R,e[20]=L):(I=e[18],R=e[19],L=e[20]);let F;e[21]===Symbol.for("react.memo_cache_sentinel")?(F=t.jsxs("span",{className:"text-right",children:[t.jsx("span",{className:"sm:hidden",children:"Разн"}),t.jsx("span",{className:"hidden sm:inline",children:"Разница"})]}),e[21]=F):F=e[21];let $;e[22]!==s?($=s&&t.jsx("span",{className:"text-center",children:"—"}),e[22]=s,e[23]=$):$=e[23];let A;e[24]!==$||e[25]!==N?(A=t.jsxs("div",{className:N,children:[L,I,R,F,$]}),e[24]=$,e[25]=N,e[26]=A):A=e[26];let E;e[27]!==d||e[28]!==p||e[29]!==l||e[30]!==h||e[31]!==a||e[32]!==s?(E=d.map((C,be)=>{const ye=d.filter(z=>z.id!==C.id).map(Lt);return t.jsxs("div",{className:`grid items-center gap-2 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(tt,{value:C.name,placeholder:`Трата ${be+1}`,disabled:h,usedNames:ye,onChange:z=>a(P=>P.map(se=>se.id===C.id?{...se,name:z}:se)),onBlur:l}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:C.plannedAmount,disabled:h,onChange:z=>{const P=z.target.value;a(se=>se.map(Y=>Y.id===C.id?{...Y,plannedAmount:ke(P),actualAmount:Y.actualTouched?Y.actualAmount:ke(P)}:Y))},onFocus:()=>{C.plannedAmount===0&&a(z=>z.map(P=>P.id===C.id?{...P,plannedAmount:""}:P))},onBlur:()=>{C.plannedAmount===""&&a(z=>z.map(P=>P.id===C.id?{...P,plannedAmount:0}:P)),l()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:C.actualAmount,disabled:h,onChange:z=>{const P=z.target.value;a(se=>se.map(Y=>Y.id===C.id?{...Y,actualAmount:ke(P),actualTouched:!0}:Y))},onFocus:()=>{C.actualAmount===0&&a(z=>z.map(P=>P.id===C.id?{...P,actualAmount:""}:P))},onBlur:()=>{C.actualAmount===""&&a(z=>z.map(P=>P.id===C.id?{...P,actualAmount:0}:P)),l()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("div",{className:`flex min-h-[36px] items-center justify-end px-0 py-2 text-xs tabular-nums sm:min-h-[40px] sm:px-4 sm:text-sm ${C.plannedAmount-C.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":C.plannedAmount-C.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:pe(C.plannedAmount-C.actualAmount)}),s&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(a(z=>z.filter(P=>P.id!==C.id)),p())},"aria-label":`Удалить трату ${be+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:h,children:"—"})]},C.id)}),e[27]=d,e[28]=p,e[29]=l,e[30]=h,e[31]=a,e[32]=s,e[33]=E):E=e[33];let K;e[34]!==E?(K=t.jsx("div",{className:"mt-3 grid gap-2",children:E}),e[34]=E,e[35]=K):K=e[35];const T=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let U;e[36]!==f?(U=t.jsx("span",{children:f}),e[36]=f,e[37]=U):U=e[37];let X;e[38]!==x?(X=J(x),e[38]=x,e[39]=X):X=e[39];let D;e[40]!==X?(D=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:X}),e[40]=X,e[41]=D):D=e[41];let M;e[42]!==c?(M=J(c),e[42]=c,e[43]=M):M=e[43];let Z;e[44]!==M?(Z=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:M}),e[44]=M,e[45]=Z):Z=e[45];const ee=`text-right font-display text-sm tabular-nums ${n>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":n<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let te;e[46]!==n?(te=pe(n),e[46]=n,e[47]=te):te=e[47];let H;e[48]!==ee||e[49]!==te?(H=t.jsx("span",{className:ee,children:te}),e[48]=ee,e[49]=te,e[50]=H):H=e[50];let de;e[51]!==s?(de=s&&t.jsx("span",{}),e[51]=s,e[52]=de):de=e[52];let re;e[53]!==T||e[54]!==U||e[55]!==D||e[56]!==Z||e[57]!==H||e[58]!==de?(re=t.jsxs("div",{className:T,children:[U,D,Z,H,de]}),e[53]=T,e[54]=U,e[55]=D,e[56]=Z,e[57]=H,e[58]=de,e[59]=re):re=e[59];let me;return e[60]!==A||e[61]!==K||e[62]!==re||e[63]!==v?(me=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[v,A,K,re]}),e[60]=A,e[61]=K,e[62]=re,e[63]=v,e[64]=me):me=e[64],me};function Lt(m){return m.name}const Ut=m=>{const e=Q.c(44),{items:i,setItems:d,totalAmount:a,onAdd:s,showDelete:r,onToggleDelete:f,onBlurField:x,onAfterDelete:c,invalidNameIds:n,readOnly:u}=m,l=u===void 0?!1:u;let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=t.jsx(ae,{children:"Приход"}),e[0]=p):p=e[0];let _;e[1]!==s||e[2]!==l?(_=t.jsx(W,{type:"button",onClick:s,disabled:l,children:"+ Строка"}),e[1]=s,e[2]=l,e[3]=_):_=e[3];let h;e[4]!==f||e[5]!==l||e[6]!==r?(h=t.jsx(W,{type:"button",onClick:f,active:r,activeTone:"danger",disabled:l,children:"− Удаление"}),e[4]=f,e[5]=l,e[6]=r,e[7]=h):h=e[7];let b;e[8]!==_||e[9]!==h?(b=t.jsxs("div",{className:"flex items-center justify-between",children:[p,t.jsxs("div",{className:"flex items-center gap-2",children:[_,h]})]}),e[8]=_,e[9]=h,e[10]=b):b=e[10];const j=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${r?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let y,w;e[11]===Symbol.for("react.memo_cache_sentinel")?(y=t.jsx("span",{children:"Название"}),w=t.jsx("span",{className:"text-right",children:"Сумма"}),e[11]=y,e[12]=w):(y=e[11],w=e[12]);let k;e[13]!==r?(k=r&&t.jsx("span",{className:"text-center",children:"—"}),e[13]=r,e[14]=k):k=e[14];let v;e[15]!==j||e[16]!==k?(v=t.jsxs("div",{className:j,children:[y,w,k]}),e[15]=j,e[16]=k,e[17]=v):v=e[17];let N;e[18]!==n||e[19]!==i||e[20]!==c||e[21]!==x||e[22]!==l||e[23]!==d||e[24]!==r?(N=i.map((T,U)=>{const X=i.filter(D=>D.id!==T.id).map(zt);return t.jsxs("div",{className:`grid items-center gap-2 ${r?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(tt,{value:T.name,placeholder:`Приход ${U+1}`,disabled:l,usedNames:X,onChange:D=>d(M=>M.map(Z=>Z.id===T.id?{...Z,name:D}:Z)),onBlur:x,containerClassName:n.includes(T.id)?"border-[#b0352b] dark:border-[#ff8b7c]":""}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:T.amount,disabled:l,onChange:D=>{const M=D.target.value;d(Z=>Z.map(ee=>ee.id===T.id?{...ee,amount:ke(M)}:ee))},onFocus:()=>{T.amount===0&&d(D=>D.map(M=>M.id===T.id?{...M,amount:""}:M))},onBlur:()=>{T.amount===""&&d(D=>D.map(M=>M.id===T.id?{...M,amount:0}:M)),x()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),r&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(d(D=>D.filter(M=>M.id!==T.id)),c())},"aria-label":`Удалить приход ${U+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:l,children:"—"})]},T.id)}),e[18]=n,e[19]=i,e[20]=c,e[21]=x,e[22]=l,e[23]=d,e[24]=r,e[25]=N):N=e[25];let I;e[26]!==N?(I=t.jsx("div",{className:"mt-3 grid gap-2",children:N}),e[26]=N,e[27]=I):I=e[27];const R=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${r?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let L;e[28]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx("span",{children:"Итого прихода"}),e[28]=L):L=e[28];let F;e[29]!==a?(F=J(a),e[29]=a,e[30]=F):F=e[30];let $;e[31]!==F?($=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:F}),e[31]=F,e[32]=$):$=e[32];let A;e[33]!==r?(A=r&&t.jsx("span",{}),e[33]=r,e[34]=A):A=e[34];let E;e[35]!==R||e[36]!==$||e[37]!==A?(E=t.jsxs("div",{className:R,children:[L,$,A]}),e[35]=R,e[36]=$,e[37]=A,e[38]=E):E=e[38];let K;return e[39]!==v||e[40]!==I||e[41]!==E||e[42]!==b?(K=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[b,v,I,E]}),e[39]=v,e[40]=I,e[41]=E,e[42]=b,e[43]=K):K=e[43],K};function zt(m){return m.name}const qt=m=>{const e=Q.c(41),{dailyAverage:i,days:d,totalIncome:a,totalPlannedExpenses:s,totalUnforeseenAllocated:r,plannedPeriodSum:f}=m;let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(ae,{tooltipText:"Приход − план обязательных − выделено на непредвиденные = сумма в период",children:"Планируемая сумма на период"}),e[0]=x):x=e[0];let c;e[1]!==a?(c=J(a),e[1]=a,e[2]=c):c=e[2];let n;e[3]!==c?(n=t.jsx(oe,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:c}),e[3]=c,e[4]=n):n=e[4];let u;e[5]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(he,{children:"−"}),e[5]=u):u=e[5];let l;e[6]!==s?(l=J(s),e[6]=s,e[7]=l):l=e[7];let p;e[8]!==l?(p=t.jsx(oe,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:l}),e[8]=l,e[9]=p):p=e[9];let _;e[10]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx(he,{children:"−"}),e[10]=_):_=e[10];let h;e[11]!==r?(h=J(r),e[11]=r,e[12]=h):h=e[12];let b;e[13]!==h?(b=t.jsx(oe,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:h}),e[13]=h,e[14]=b):b=e[14];let j;e[15]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(he,{children:"="}),e[15]=j):j=e[15];const y=`text-2xl ${f>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`;let w;e[16]!==f?(w=pe(f),e[16]=f,e[17]=w):w=e[17];let k;e[18]!==y||e[19]!==w?(k=t.jsx(oe,{className:y,children:w}),e[18]=y,e[19]=w,e[20]=k):k=e[20];let v;e[21]!==k||e[22]!==n||e[23]!==p||e[24]!==b?(v=t.jsxs("div",{className:"grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[x,t.jsxs(st,{children:[n,u,p,_,b,j,k]})]}),e[21]=k,e[22]=n,e[23]=p,e[24]=b,e[25]=v):v=e[25];let N,I;e[26]===Symbol.for("react.memo_cache_sentinel")?(N=t.jsx(Ue,{className:"mt-4"}),I=t.jsx(ae,{className:"mt-4",children:"Планируемое среднее в день"}),e[26]=N,e[27]=I):(N=e[26],I=e[27]);let R;e[28]!==f?(R=J(f),e[28]=f,e[29]=R):R=e[29];const L=d||0;let F;e[30]!==R||e[31]!==L?(F=t.jsxs("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:["(",R," / ",L," д.)"]}),e[30]=R,e[31]=L,e[32]=F):F=e[32];let $;e[33]!==i?($=J(i),e[33]=i,e[34]=$):$=e[34];let A;e[35]!==$?(A=t.jsx(ve,{className:"mt-3",children:$}),e[35]=$,e[36]=A):A=e[36];let E;return e[37]!==v||e[38]!==F||e[39]!==A?(E=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[v,N,I,F,A]}),e[37]=v,e[38]=F,e[39]=A,e[40]=E):E=e[40],E},Kt=m=>{const e=Q.c(3),{children:i,className:d}=m,a=`mt-2 text-xs text-[#6a5d52] dark:text-white/60 ${d??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("p",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},Vt=m=>{const e=Q.c(13),{actualRemaining:i,remainingDays:d,remainingDailyAverage:a}=m;let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsx(ae,{tooltipText:"Фактический остаток / количество незаполненных (непрошедших) дней",children:"Расчётное в день на оставшиеся дни"}),e[0]=s):s=e[0];let r;e[1]!==i?(r=J(i),e[1]=i,e[2]=r):r=e[2];const f=d||0;let x;e[3]!==r||e[4]!==f?(x=t.jsxs(Kt,{children:["(",r," / ",f," д.)"]}),e[3]=r,e[4]=f,e[5]=x):x=e[5];let c;e[6]!==a?(c=J(a),e[6]=a,e[7]=c):c=e[7];let n;e[8]!==c?(n=t.jsx(ve,{className:"mt-3",children:c}),e[8]=c,e[9]=n):n=e[9];let u;return e[10]!==x||e[11]!==n?(u=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[s,x,n]}),e[10]=x,e[11]=n,e[12]=u):u=e[12],u},Xt=m=>{const e=Q.c(22),{href:i,allocated:d,spent:a}=m,s=d-a,r=Ht;let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(ae,{children:"Непредвиденные расходы"}),t.jsx(W,{as:"span",children:"Открыть"})]}),e[0]=f):f=e[0];let x;e[1]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx("div",{className:"uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Выделено"}),e[1]=x):x=e[1];let c;e[2]!==d?(c=J(d),e[2]=d,e[3]=c):c=e[3];let n;e[4]!==c?(n=t.jsxs("div",{children:[x,t.jsx("div",{className:"mt-1 font-display text-sm tabular-nums text-[#ffffff] dark:text-[#ffffff]",children:c})]}),e[4]=c,e[5]=n):n=e[5];let u;e[6]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx("div",{className:"uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Потрачено"}),e[6]=u):u=e[6];let l;e[7]!==a?(l=J(a),e[7]=a,e[8]=l):l=e[8];let p;e[9]!==l?(p=t.jsxs("div",{children:[u,t.jsx("div",{className:"mt-1 font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:l})]}),e[9]=l,e[10]=p):p=e[10];let _;e[11]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx("div",{className:"uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Разница"}),e[11]=_):_=e[11];const h=`mt-1 font-display text-sm tabular-nums ${s<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#1e7b4f] dark:text-[#7ce0b3]"}`,b=r(s);let j;e[12]!==b||e[13]!==h?(j=t.jsxs("div",{children:[_,t.jsx("div",{className:h,children:b})]}),e[12]=b,e[13]=h,e[14]=j):j=e[14];let y;e[15]!==j||e[16]!==n||e[17]!==p?(y=t.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[n,p,j]}),e[15]=j,e[16]=n,e[17]=p,e[18]=y):y=e[18];let w;return e[19]!==i||e[20]!==y?(w=t.jsxs(ze,{href:i,prefetch:!0,className:"group rounded-lg border border-[#b0352b]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(176,53,43,0.45)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(176,53,43,0.6)] dark:border-[#ff8b7c]/30 dark:bg-white/10 dark:text-white",children:[f,y]}),e[19]=i,e[20]=y,e[21]=w):w=e[21],w};function Ht(m){const e=Math.round(m),i=Math.abs(e).toLocaleString("ru-RU");return e<0?`−${i} ₽`:`+${i} ₽`}const Jt={id:0,startDate:"",endDate:"",incomes:[],expenses:[],unforeseenExpenses:[],unforeseenAllocated:0,offIncomeExpenses:[],dailyExpenses:{},isPinned:!1,isClosed:!1};function ds(){const{periodId:m,viewerId:e,viewerName:i,viewerEmail:d,viewerMode:a}=vt().props,s=!!(e??a),[r,f]=g.useState(Jt),[x,c]=g.useState([]),[n,u]=g.useState(""),[l,p]=g.useState(""),[_,h]=g.useState([]),[b,j]=g.useState([]),[y,w]=g.useState(0),[k,v]=g.useState([]),[N,I]=g.useState({}),[R,L]=g.useState(!1),[F,$]=g.useState(!1),[A,E]=g.useState(!0),[K,T]=g.useState(null),[U,X]=g.useState(!1),[D,M]=g.useState(null),[Z,ee]=g.useState(!1),[te,H]=g.useState(null),[de,re]=g.useState(!1),[me,C]=g.useState([]),[be,ye]=g.useState(!1),[z,P]=g.useState(!1),[se,Y]=g.useState(!1),[at,je]=g.useState(!1),[nt,Ne]=g.useState(!1),[rt,Se]=g.useState(!1),[lt,De]=g.useState(),$e=g.useRef(!1),[qe,it]=g.useState(0),Ke="Заполните названия прихода.",xe=g.useRef(null),we=g.useRef(null),Ve=g.useMemo(()=>`period:${e??"self"}:${m}`,[m,e]),ne=g.useMemo(()=>e?`viewer_id=${e}`:"",[e]),Ae=g.useRef(!1),Ce=g.useRef(!1),ot=()=>typeof window>"u"?null:window.__periodCache?.[Ve]??null,_e=o=>{if(typeof window>"u")return;const B=window;B.__periodCache||(B.__periodCache={}),B.__periodCache[Ve]=o},{totalPlanned:Ee,totalActual:dt,totalDifference:Pe}=Qe(_??[]),{totalActual:Ie}=Qe(b??[]),ct=Math.max(0,y-Ie),mt=Ze(k??[]),Te=Ze(x??[]),ge=g.useMemo(()=>!n||!l?0:We(n,l),[n,l]),Oe=g.useMemo(()=>At(N),[N]),Re=g.useMemo(()=>Ct(n,l,N),[N,n,l]),xt=Re>0?Oe/Re:0,Fe=g.useMemo(()=>!n||!l?"Период":`${ue(n)} — ${ue(l)}`,[n,l]),ft=g.useMemo(()=>!n||!l?"":`${ge} дней · ${Ye(n,l)}`,[ge,n,l]),{plannedPeriodSum:Xe,dailyAverage:ut,actualRemaining:He,unforeseenOverrun:pt,remainingDays:ht,remainingDailyAverage:bt,isDailyComplete:gt}=Et({days:ge,totalIncome:Te,totalPlannedExpenses:Ee,totalDifference:Pe,totalUnforeseenAllocated:y,totalUnforeseenSpent:Ie,totalDailyExpenses:Oe,filledDays:Re}),ce=r.isClosed||s;Be().url,`${m}`;const yt=o=>!!(o&&o.id&&Array.isArray(o.incomes)&&Array.isArray(o.expenses)&&Array.isArray(o.unforeseenExpenses)&&typeof o.unforeseenAllocated=="number"&&Array.isArray(o.offIncomeExpenses)),jt=async()=>{if(Ce.current)return;const o=ot();if(!(yt(o)&&(f({...o,isClosed:!!o.isClosed}),c(o.incomes??[]),u(o.startDate??""),p(o.endDate??""),h(o.expenses??[]),j(o.unforeseenExpenses??[]),w(o.unforeseenAllocated??0),v(o.offIncomeExpenses??[]),I(o.dailyExpenses??{}),xe.current={startDate:o.startDate??"",endDate:o.endDate??""},E(!1),typeof navigator<"u"&&!navigator.onLine))&&!(Ae.current&&(!navigator.onLine||!o))){Ce.current=!0,E(!0),T(null);try{const B=await fetch(`/api/periods/${m}${ne?`?${ne}`:""}`);if(!B.ok)throw new Error("Не удалось загрузить период.");const q=(await B.json()).data,V={id:q.id,startDate:q.start_date,endDate:q.end_date,dailyExpenses:q.daily_expenses??{},unforeseenAllocated:Number(q.unforeseen_allocated??0),isPinned:!!q.is_pinned,isClosed:!!q.is_closed,incomes:q.incomes.map(O=>({id:String(O.id),name:O.name,amount:O.amount})),expenses:q.expenses.map(O=>({id:String(O.id),name:O.name,plannedAmount:O.planned_amount,actualAmount:O.actual_amount,actualTouched:!1})),unforeseenExpenses:q.unforeseen_expenses.map(O=>({id:String(O.id),name:O.name,plannedAmount:O.planned_amount,actualAmount:O.actual_amount,actualTouched:!1})),offIncomeExpenses:q.external_expenses.map(O=>({id:String(O.id),name:O.name,amount:O.amount}))};f(V),c(V.incomes),u(V.startDate),p(V.endDate),h(V.expenses),j(V.unforeseenExpenses),w(V.unforeseenAllocated),v(V.offIncomeExpenses),I(V.dailyExpenses),je(!1),De(void 0),xe.current={startDate:V.startDate,endDate:V.endDate},_e(V),Ae.current=!0}catch(B){T(B instanceof Error?B.message:"Не удалось загрузить период.")}finally{E(!1),Ce.current=!1}}},le=async(o=!1,B)=>{if(ce)return;const G=B?.startDate??n,q=B?.endDate??l,V=Ge(x);if(V.length>0){C(V),H(Ke);return}if(U){$e.current=!0;return}X(!0),H(null),re(!1);try{const O=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",ie=await fetch(`/api/periods/${m}${ne?`?${ne}`:""}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":O},body:JSON.stringify({start_date:G,end_date:q,daily_expenses:N,unforeseen_allocated:y,force:o,incomes:x.filter(S=>S.name.trim()!=="").map(S=>({id:Number.isFinite(Number(S.id))?Number(S.id):void 0,name:S.name,amount:fe(S.amount)})),expenses:_.filter(S=>S.name.trim()!=="").map(S=>({id:Number.isFinite(Number(S.id))?Number(S.id):void 0,name:S.name,planned_amount:fe(S.plannedAmount),actual_amount:fe(S.actualAmount)})),unforeseen_expenses:b.filter(S=>S.name.trim()!=="").map(S=>({id:Number.isFinite(Number(S.id))?Number(S.id):void 0,name:S.name,planned_amount:fe(S.plannedAmount),actual_amount:fe(S.actualAmount)})),external_expenses:k.filter(S=>S.name.trim()!=="").map(S=>({id:Number.isFinite(Number(S.id))?Number(S.id):void 0,name:S.name,amount:fe(S.amount)}))})});if(ie.status===409){const S=await ie.json();if(S.overlap){we.current={startDate:G,endDate:q},M(S.overlap),ee(!0),xe.current&&(u(xe.current.startDate),p(xe.current.endDate));return}throw new Error("Период пересекается с существующим.")}if(!ie.ok){if(ie.status===423){const S=await ie.json();throw new Error(S.message??"Период закрыт и не редактируется.")}throw new Error("Не удалось сохранить период.")}u(G),p(q),re(!0),M(null),ee(!1),we.current=null,xe.current={startDate:G,endDate:q},_e({id:Number(m),startDate:G,endDate:q,incomes:x,expenses:_,unforeseenExpenses:b,unforeseenAllocated:y,offIncomeExpenses:k,dailyExpenses:N,isPinned:r.isPinned,isClosed:r.isClosed})}catch(O){H(O instanceof Error?O.message:"Не удалось сохранить период.")}finally{X(!1)}},wt=()=>{ce||(c(o=>[...o,{id:`i${Date.now()}`,name:"",amount:""}]),le())},Me=()=>{it(o=>o+1)},_t=async()=>{if(!s&&!be&&window.confirm("Удалить период?")){ye(!0),H(null);try{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch(`/api/periods/${m}${ne?`?${ne}`:""}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":o}})).ok)throw new Error("Не удалось удалить период.");window.location.href=e?`/shared/${e}`:Be().url}catch(o){H(o instanceof Error?o.message:"Не удалось удалить период.")}finally{ye(!1)}}},kt=async()=>{if(!(s||se||r.isClosed)){Y(!0),H(null);try{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",B=await fetch(`/api/periods/${m}/close${ne?`?${ne}`:""}`,{method:"POST",headers:{"X-CSRF-TOKEN":o}});if(B.status===419){Se(!0);return}if(!B.ok){const V=await B.json();throw new Error(V.message??"Не удалось закрыть период.")}const G=await B.json(),q={...r,isClosed:G.data?.is_closed??!0};f(q),Ne(!1),_e({id:Number(m),startDate:n,endDate:l,incomes:x,expenses:_,unforeseenExpenses:b,unforeseenAllocated:y,offIncomeExpenses:k,dailyExpenses:N,isPinned:r.isPinned,isClosed:q.isClosed})}catch(o){H(o instanceof Error?o.message:"Не удалось закрыть период.")}finally{Y(!1)}}},Je=async(o=!1)=>{if(!(s||z)){P(!0);try{const B=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",G=await fetch(`/api/periods/${m}/pin${ne?`?${ne}`:""}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":B},body:JSON.stringify({pinned:!r.isPinned,force:o})});if(G.status===419){Se(!0);return}if(G.status===409){const ie=await G.json();ie.pinned?De(`${ue(ie.pinned.start_date)} — ${ue(ie.pinned.end_date)}`):De(void 0),je(!0);return}if(!G.ok)throw new Error("Не удалось изменить закрепление периода.");const V=(await G.json()).data?.is_pinned??!r.isPinned,O={...r,isPinned:V};f(O),_e(O),je(!1)}catch(B){H(B instanceof Error?B.message:"Не удалось изменить закрепление периода.")}finally{P(!1)}}};return g.useEffect(()=>{Ae.current=!1,jt()},[m,e]),g.useEffect(()=>{!U&&$e.current&&($e.current=!1,le())},[U]),g.useEffect(()=>{qe>0&&le()},[qe]),g.useEffect(()=>{const o=Ge(x);C(o),o.length===0&&te===Ke&&H(null)},[x,te]),t.jsxs(St,{children:[t.jsx(Nt,{title:Fe}),t.jsxs("div",{className:`relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-3 font-body text-[#1c1a17] dark:text-[#f7f3ee]${r.isClosed?" bg-emerald-50/70 dark:bg-emerald-950/20":""}`,children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:Fe}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:ft})]}),r.isClosed&&t.jsx("div",{className:"flex-1 text-center text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:"Период закрыт"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[!s&&!r.isClosed&&t.jsx(W,{type:"button",onClick:()=>Je(!1),tone:r.isPinned?"danger":"success",disabled:z,className:"px-4 py-2",children:r.isPinned?"Открепить":"Закрепить"}),!s&&gt&&!r.isClosed&&t.jsx(W,{type:"button",onClick:()=>Ne(!0),disabled:se,tone:"success",className:"px-4 py-2",children:"Закрыть период"}),!s&&t.jsx(W,{type:"button",onClick:_t,disabled:be,tone:"danger",className:"px-4 py-2",children:"Удалить"}),t.jsx(ze,{href:e?`/shared/${e}`:Be(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),s&&t.jsxs("div",{className:"relative z-10 rounded-2xl border border-black/10 bg-white/70 px-4 py-3 text-sm text-[#1c1a17] shadow-[0_18px_36px_-26px_rgba(28,26,23,0.5)] dark:border-white/10 dark:bg-white/10 dark:text-white/80",children:["Просмотр периодов пользователя"," ",t.jsx("span",{className:"font-semibold",children:i||d||`#${e}`}),". Режим только чтение."]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] lg:items-start animate-reveal",style:It(120),children:[A&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),K&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:K}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Le,{periodId:m,type:"income",viewerId:e,children:t.jsx(Ut,{items:x,setItems:c,totalAmount:Te,onAdd:wt,showDelete:R,onToggleDelete:()=>L(o=>!o),onBlurField:le,onAfterDelete:Me,invalidNameIds:me,readOnly:ce})}),t.jsx(Le,{periodId:m,type:"mandatory",viewerId:e,children:t.jsx(Bt,{title:"Обязательные траты",items:_,setItems:h,showDelete:R,onToggleDelete:()=>L(o=>!o),totalLabel:"Итого обязательных",totalPlanned:Ee,totalActual:dt,totalDifference:Pe,idPrefix:"e",onBlurField:le,onAfterDelete:Me,readOnly:ce})}),t.jsx(Xt,{href:e?`/shared/${e}/periods/${m}/unforeseen`:`/periods/${m}/unforeseen`,allocated:y,spent:Ie}),t.jsx(Le,{periodId:m,type:"external",viewerId:e,children:t.jsx($t,{title:"Сторонние траты",items:k,setItems:v,showDelete:R,onToggleDelete:()=>L(o=>!o),totalLabel:"Итого сторонних",totalAmount:mt,idPrefix:"o",onBlurField:le,onAfterDelete:Me,readOnly:ce})})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Ft,{days:ge,startDate:n,endDate:l,isEditing:F,readOnly:ce,onToggleEditing:()=>$(o=>ce?o:!o),onStartDateChange:o=>{u(o),le(!1,{startDate:o})},onEndDateChange:o=>{p(o),le(!1,{endDate:o})},minStartDate:l?et(l,-3):void 0,maxStartDate:l,minEndDate:n,maxEndDate:n?et(n,3):void 0}),t.jsx(Rt,{href:e?`/shared/${e}/periods/${m}/daily`:`/periods/${m}/daily`}),t.jsx(qt,{dailyAverage:ut,days:ge,totalIncome:Te,totalPlannedExpenses:Ee,totalUnforeseenAllocated:y,plannedPeriodSum:Xe}),t.jsx(Vt,{actualRemaining:He,remainingDays:ht,remainingDailyAverage:bt}),t.jsx(Mt,{plannedPeriodSum:Xe,totalDifference:Pe,totalDailyExpenses:Oe,unforeseenOverrun:pt,actualRemaining:He,unforeseenRemaining:ct,dailyActualAverage:xt})]})]}),at&&t.jsx(Tt,{currentTitle:lt,onCancel:()=>je(!1),onConfirm:()=>Je(!0),confirmDisabled:z}),nt&&t.jsx(Ot,{onCancel:()=>Ne(!1),onConfirm:kt,confirmDisabled:se}),rt&&t.jsx(Pt,{onClose:()=>Se(!1),onReload:()=>window.location.reload()}),!s&&D&&t.jsx(Dt,{href:`/periods/${D.id}`,title:`${ue(D.start_date)} — ${ue(D.end_date)}`,subtitle:`${We(D.start_date,D.end_date)} дней · ${Ye(D.start_date,D.end_date)}`,onClose:()=>{M(null),ee(!1),we.current=null},onConfirm:()=>le(!0,we.current??void 0),confirmDisabled:!Z||U}),te&&t.jsx("div",{className:"relative z-10 rounded-lg border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:te})]})]})}export{ds as default};
