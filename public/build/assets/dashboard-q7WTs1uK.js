import{c as C,j as t,L as H,u as V,r as u,H as X}from"./app-DiBp4JLJ.js";import{A as J}from"./app-layout-By0QSF5T.js";import{d as G}from"./index-BDqSilVs.js";import{P as z,O as Q}from"./overlap-period-modal-CTOD496t.js";/* empty css            */import"./app-logo-icon-DcioA8SY.js";import"./index-DE4KSncy.js";import"./index-BmpTmqID.js";const Z=s=>{const e=Math.round(s);return e===0?"0 ₽":`${e>0?"+":"−"}${Math.abs(e).toLocaleString("ru-RU")} ₽`},ee=s=>{const e=C.c(21),{href:a,title:r,subtitle:i,isClosed:o,actualRemaining:n}=s,x=o===void 0?!1:o,g=`rounded-[28px] border bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:bg-white/10 ${x?"border-[#1e7b4f]/40 dark:border-[#7ce0b3]/40":"border-black/10 dark:border-white/10"}`;let d;e[0]!==r?(d=t.jsx("h3",{className:"font-display text-xl",children:r}),e[0]=r,e[1]=d):d=e[1];let m;e[2]!==i?(m=t.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:i}),e[2]=i,e[3]=m):m=e[3];let p;e[4]!==n||e[5]!==x?(p=x&&typeof n=="number"&&t.jsxs("p",{className:"mt-2 text-xs text-[#1e7b4f] dark:text-[#7ce0b3]",children:["Факт. остаток: ",Z(n)]}),e[4]=n,e[5]=x,e[6]=p):p=e[6];let f;e[7]!==d||e[8]!==m||e[9]!==p?(f=t.jsxs("div",{className:"min-w-[180px]",children:[d,m,p]}),e[7]=d,e[8]=m,e[9]=p,e[10]=f):f=e[10];let h;e[11]!==x?(h=x&&t.jsx("div",{className:"flex-1 text-center text-xs uppercase tracking-[0.2em] text-[#1e7b4f] dark:text-[#7ce0b3]",children:"Период закрыт"}),e[11]=x,e[12]=h):h=e[12];let k;e[13]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(z,{as:"span",className:"bg-white/80 text-[#1c1a17] dark:bg-white/10 dark:text-white",children:"Открыть период"}),e[13]=k):k=e[13];let b;e[14]!==f||e[15]!==h?(b=t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[f,h,k]}),e[14]=f,e[15]=h,e[16]=b):b=e[16];let j;return e[17]!==a||e[18]!==g||e[19]!==b?(j=t.jsx(H,{href:a,prefetch:!0,className:g,children:b}),e[17]=a,e[18]=g,e[19]=b,e[20]=j):j=e[20],j},L=s=>{const e=C.c(4),{items:a}=s;let r;e[0]!==a?(r=a.map(te),e[0]=a,e[1]=r):r=e[1];let i;return e[2]!==r?(i=t.jsx("div",{className:"grid gap-4",children:r}),e[2]=r,e[3]=i):i=e[3],i};function te(s){return t.jsx(ee,{href:`/periods/${s.id}`,title:s.title,subtitle:s.subtitle,isClosed:s.isClosed,actualRemaining:s.actualRemaining},s.id)}const se=`
## Приложение обновилось!
___
## Что нового?

- дабавлена фича закрытия периода
- максимальный диапозон не больше 3-х меяцев
- бновлены иконки

___
version: 0.1.3
`,ae="Круто!",v=s=>s.split("**").map((a,r)=>r%2===1?t.jsx("strong",{children:a},r):a),re=s=>{const e=s.trim().split(`
`),a=[];let r=[];const i=()=>{r.length&&(a.push(t.jsx("ul",{className:"list-disc pl-5",children:r.map((o,n)=>t.jsx("li",{children:v(o)},n))},`list-${a.length}`)),r=[])};return e.forEach(o=>{const n=o.trim();if(!n){i();return}if(n.startsWith("- ")){r.push(n.slice(2));return}if(i(),n.startsWith("### ")){a.push(t.jsx("h4",{className:"text-lg font-semibold",children:v(n.slice(4))},`h4-${a.length}`));return}if(n.startsWith("## ")){a.push(t.jsx("h3",{className:"text-xl font-semibold",children:v(n.slice(3))},`h3-${a.length}`));return}if(n.startsWith("# ")){a.push(t.jsx("h2",{className:"text-2xl font-semibold",children:v(n.slice(2))},`h2-${a.length}`));return}a.push(t.jsx("p",{className:"text-sm text-[#6a5d52] dark:text-white/70",children:v(n)},`p-${a.length}`))}),i(),a},ne=s=>{const e=C.c(4),{onConfirm:a,confirmDisabled:r}=s,i=r===void 0?!1:r;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=t.jsx("div",{className:"space-y-4",children:re(se)}),e[0]=o):o=e[0];let n;return e[1]!==i||e[2]!==a?(n=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[o,t.jsx("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:t.jsx(z,{type:"button",onClick:a,className:"border-transparent bg-[#d87a4a] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] disabled:cursor-not-allowed disabled:opacity-70",disabled:i,children:ae})})]})}),e[1]=i,e[2]=a,e[3]=n):n=e[3],n},ie=[{title:"Dashboard",href:G().url}],O=s=>({"--delay":`${s}ms`}),Y=s=>{const e=s?.trim()??"";return e?e.includes("T")?e.slice(0,10):e:""},w=s=>{const e=Y(s);if(!e)return new Date("invalid");const[a,r,i]=e.split("-").map(Number);return new Date(a,(r??1)-1,i??1)},y=s=>{const e=w(s);return Number.isFinite(e.getTime())},$=s=>{const e=Y(s);return e?Number(e.replaceAll("-","")):NaN},D=s=>{const e=w(s),a=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0");return`${a}.${r}`},le=s=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(w(s)),B=(s,e)=>{const a=new Intl.DateTimeFormat("ru-RU",{month:"short"}),r=a.format(w(s)),i=a.format(w(e)),o=w(s).getFullYear(),n=w(e).getFullYear();return o===n?r===i?le(s):`${r}–${i} ${o}`:`${r} ${o} – ${i} ${n}`},A=(s,e)=>{if(!s)return"";const[a,r,i]=s.split("-").map(Number);if(!a||!r||!i)return"";const o=r-1+e,n=a+Math.floor(o/12),x=(o%12+12)%12,g=new Date(n,x+1,0).getDate(),d=Math.min(i,g),m=String(x+1).padStart(2,"0"),p=String(d).padStart(2,"0");return`${n}-${m}-${p}`},K=(s,e)=>{const a=w(s),i=w(e).getTime()-a.getTime(),o=Math.floor(i/(1e3*60*60*24));return Math.max(1,o+1)},U=s=>{const e=y(s.start_date)&&y(s.end_date),a=e?K(s.start_date,s.end_date):0;return{title:e?`${D(s.start_date)} — ${D(s.end_date)}`:"Период",subtitle:e?`${a} дней · ${B(s.start_date,s.end_date)}`:"Даты не заданы"}};function pe(){const{auth:s}=V().props,[e,a]=u.useState(""),[r,i]=u.useState(""),[o,n]=u.useState(!1),[x,g]=u.useState(null),[d,m]=u.useState(null),[p,f]=u.useState(!1),[h,k]=u.useState([]),[b,j]=u.useState(!0),[S,E]=u.useState(null),[W,M]=u.useState(s.user?.is_info_shown===!1);u.useEffect(()=>{M(s.user?.is_info_shown===!1)},[s.user]);const q=()=>{M(!1);const l=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";fetch("/api/user/info-shown",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":l}}).catch(c=>{console.error(c)})},P=async()=>{j(!0),E(null);try{const l=await fetch("/api/periods");if(!l.ok)throw new Error("Не удалось загрузить периоды.");const c=await l.json();k(c.data??[])}catch(l){E(l instanceof Error?l.message:"Не удалось загрузить периоды.")}finally{j(!1)}};u.useEffect(()=>{P()},[]);const F=async(l=!1)=>{if(!e||!r){g("Укажите даты начала и конца периода.");return}if(!l){const c=$(e),_=$(r),N=h.find(T=>{const I=$(T.start_date),R=$(T.end_date);return!Number.isFinite(c)||!Number.isFinite(_)||!Number.isFinite(I)||!Number.isFinite(R)?!1:c<R&&_>I});if(N){m(N),f(!0);return}}n(!0),g(null);try{const c=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",_=await fetch("/api/periods",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":c},body:JSON.stringify({start_date:e,end_date:r,force:!!l})});if(_.status===409){const N=await _.json();if(N.overlap){m(N.overlap),f(!0);return}throw new Error("Период пересекается с существующим.")}if(!_.ok)throw new Error("Не удалось сохранить период.");a(""),i(""),m(null),f(!1),await P()}catch(c){g(c instanceof Error?c.message:"Не удалось сохранить период.")}finally{n(!1)}};return t.jsxs(J,{breadcrumbs:ie,children:[t.jsx(X,{title:"Dashboard"}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsx("section",{className:"relative z-10 flex flex-wrap items-end justify-between gap-6",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Финансовый контур"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:"Периоды учета"}),t.jsx("p",{className:"mt-2 max-w-xl text-sm text-[#6a5d52] dark:text-white/70",children:"Добавьте новый период сверху и управляйте историей ниже. При клике откроется отдельная страница периода."})]})}),t.jsxs("section",{className:"relative z-10 rounded-[28px] border border-black/10 bg-white/85 p-6 shadow-[0_22px_44px_-28px_rgba(28,26,23,0.6)] backdrop-blur animate-reveal dark:border-white/10 dark:bg-white/10",style:O(120),children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Новый период"}),t.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Добавить диапазон дат"})]})}),t.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-[1fr_1fr_1fr]",children:[t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"С"}),t.jsx("input",{type:"date",value:e,onChange:l=>a(l.target.value),min:r?A(r,-3):void 0,max:r||void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"По"}),t.jsx("input",{type:"date",value:r,onChange:l=>i(l.target.value),min:e||void 0,max:e?A(e,3):void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),t.jsx("div",{className:"flex flex-col justify-end",children:t.jsx("button",{className:"rounded-2xl bg-[#d87a4a] px-4 py-3 text-sm font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] transition hover:-translate-y-0.5 disabled:cursor-not-allowed disabled:opacity-70",type:"button",onClick:()=>F(!1),disabled:o,children:o?"Сохранение...":"Сохранить"})})]}),x&&t.jsx("p",{className:"mt-3 text-xs text-[#b0352b] dark:text-[#ff8b7c]",children:x})]}),t.jsxs("section",{className:"relative z-10 grid gap-4 animate-reveal",style:O(240),children:[h.some(l=>l.is_pinned)&&t.jsxs("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Закреплённый период"}),t.jsx("div",{className:"mt-4",children:(()=>{const l=h.find(_=>_.is_pinned);if(!l)return null;const c=U(l);return t.jsx(L,{items:[{id:l.id,title:c.title,subtitle:c.subtitle,isClosed:!!l.is_closed,actualRemaining:l.actual_remaining??null}]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"font-display text-2xl",children:"История периодов"}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"Сначала новые"})]}),t.jsxs("div",{className:"grid gap-4",children:[b&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем периоды..."}),S&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:S}),!b&&!S&&h.length===0&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Периодов пока нет. Создайте первый диапазон выше."}),!b&&!S&&t.jsx(L,{items:h.map(l=>{const c=U(l);return{id:l.id,title:c.title,subtitle:c.subtitle,isClosed:!!l.is_closed,actualRemaining:l.actual_remaining??null}})})]})]}),d&&t.jsx(Q,{href:`/periods/${d.id}`,title:y(d.start_date)&&y(d.end_date)?`${D(d.start_date)} — ${D(d.end_date)}`:"Период",subtitle:y(d.start_date)&&y(d.end_date)?`${K(d.start_date,d.end_date)} дней · ${B(d.start_date,d.end_date)}`:"Даты не заданы",onClose:()=>{m(null),f(!1)},onConfirm:()=>F(!0),confirmDisabled:!p||o}),W&&t.jsx(ne,{onConfirm:q})]})]})}export{pe as default};
