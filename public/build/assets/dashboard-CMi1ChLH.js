import{c as Y,j as e,u as Z,r as l,H as ee,a as S,i as R}from"./app-BjXvd9MZ.js";import{A as te}from"./app-layout-H1FX1yvC.js";import{d as se}from"./index-BNdu6nsP.js";import{O as ae}from"./overlap-period-modal-YuLTCluh.js";import{P as z}from"./period-list-ko3mehvk.js";import{S as re}from"./session-expired-modal-D0Bm9SAV.js";import{P as ie}from"./pill-button-Bhxpnh9Z.js";import{d as U}from"./animation-DULAtfne.js";import{a as H,i as p,c as K,f as V,b as j,d as _}from"./date-C0FYGyP5.js";/* empty css            */import"./createLucideIcon-WTV_5oX8.js";import"./index-Cj3JpBxv.js";import"./index-Qwg_DekB.js";import"./app-logo-icon-Cx-d8fIc.js";const de=`
## Приложение обновилось!
___
## Что нового?

- дабавлена фича закрытия периода
- максимальный диапозон не больше 3-х меяцев
- бновлены иконки

___
version: 0.1.3
`,ne="Круто!",f=d=>d.split("**").map((r,o)=>o%2===1?e.jsx("strong",{children:r},o):r),le=d=>{const s=d.trim().split(`
`),r=[];let o=[];const x=()=>{o.length&&(r.push(e.jsx("ul",{className:"list-disc pl-5",children:o.map((n,a)=>e.jsx("li",{children:f(n)},a))},`list-${r.length}`)),o=[])};return s.forEach(n=>{const a=n.trim();if(!a){x();return}if(a.startsWith("- ")){o.push(a.slice(2));return}if(x(),a.startsWith("### ")){r.push(e.jsx("h4",{className:"text-lg font-semibold",children:f(a.slice(4))},`h4-${r.length}`));return}if(a.startsWith("## ")){r.push(e.jsx("h3",{className:"text-xl font-semibold",children:f(a.slice(3))},`h3-${r.length}`));return}if(a.startsWith("# ")){r.push(e.jsx("h2",{className:"text-2xl font-semibold",children:f(a.slice(2))},`h2-${r.length}`));return}r.push(e.jsx("p",{className:"text-sm text-[#6a5d52] dark:text-white/70",children:f(a)},`p-${r.length}`))}),x(),r},oe=d=>{const s=Y.c(4),{onConfirm:r,confirmDisabled:o}=d,x=o===void 0?!1:o;let n;s[0]===Symbol.for("react.memo_cache_sentinel")?(n=e.jsx("div",{className:"space-y-4",children:le(de)}),s[0]=n):n=s[0];let a;return s[1]!==x||s[2]!==r?(a=e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:e.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[n,e.jsx("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:e.jsx(ie,{type:"button",onClick:r,className:"border-transparent bg-[#4e3f7f] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(78,63,127,0.85)] transition hover:bg-[#66529f] disabled:cursor-not-allowed disabled:opacity-70",disabled:x,children:ne})})]})}),s[1]=x,s[2]=r,s[3]=a):a=s[3],a},ce=[{title:"Dashboard",href:se().url}],W=d=>{const s=p(d.start_date)&&p(d.end_date),r=s?K(d.start_date,d.end_date):0;return{title:s?`${j(d.start_date)} — ${j(d.end_date)}`:"Период",subtitle:s?`${r} дней · ${V(d.start_date,d.end_date)}`:"Даты не заданы"}};function ye(){const{auth:d,viewerId:s,viewerName:r,viewerEmail:o,viewerMode:x}=Z().props,n=!!(s??x),[a,E]=l.useState(""),[h,$]=l.useState(""),[v,D]=l.useState(!1),[P,k]=l.useState(null),[c,b]=l.useState(null),[J,w]=l.useState(!1),[u,q]=l.useState([]),[N,C]=l.useState(!0),[g,I]=l.useState(null),[G,M]=l.useState(d.user?.is_info_shown===!1),[Q,y]=l.useState(!1);l.useEffect(()=>{M(d.user?.is_info_shown===!1)},[d.user]);const X=()=>{M(!1),S("/api/user/info-shown",{method:"POST",headers:{"Content-Type":"application/json"}}).catch(t=>{if(R(t)&&t.status===419){y(!0);return}console.error(t)})},F=async()=>{C(!0),I(null);try{const t=s?`?viewer_id=${s}`:"",i=await S(`/api/periods${t}`);q(i.data??[])}catch(t){I(t instanceof Error?t.message:"Не удалось загрузить периоды.")}finally{C(!1)}};l.useEffect(()=>{F()},[]);const O=async(t=!1)=>{if(!n){if(!a||!h){k("Укажите даты начала и конца периода.");return}if(!t){const i=_(a),m=_(h),L=u.find(A=>{const T=_(A.start_date),B=_(A.end_date);return!Number.isFinite(i)||!Number.isFinite(m)||!Number.isFinite(T)||!Number.isFinite(B)?!1:i<B&&m>T});if(L){b(L),w(!0);return}}D(!0),k(null);try{await S("/api/periods",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({start_date:a,end_date:h,force:!!t})}),E(""),$(""),b(null),w(!1),await F()}catch(i){if(R(i)){if(i.status===419){y(!0);return}if(i.status===409&&typeof i.data=="object"&&i.data){const m=i.data.overlap;if(m){b(m),w(!0);return}}}k(i instanceof Error?i.message:"Не удалось сохранить период.")}finally{D(!1)}}};return e.jsxs(te,{breadcrumbs:ce,children:[e.jsx(ee,{title:"Dashboard"}),e.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),e.jsx("section",{className:"relative z-10 flex flex-wrap items-end justify-between gap-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"mt-3 font-display text-3xl",children:"Периоды учета"}),e.jsx("p",{className:"mt-2 max-w-xl text-sm text-[#6a5d52] dark:text-white/70",children:n?"Режим просмотра. Создание и редактирование недоступны.":"Добавьте новый период сверху и управляйте историей ниже. При клике откроется отдельная страница периода."})]})}),n&&e.jsxs("div",{className:"relative z-10 rounded-[24px] border border-black/10 bg-white/70 px-5 py-3 text-sm text-[#1c1a17] shadow-[0_18px_36px_-26px_rgba(28,26,23,0.5)] dark:border-white/10 dark:bg-white/10 dark:text-white/80",children:["Просмотр периодов пользователя"," ",e.jsx("span",{className:"font-semibold",children:r||o||`#${s}`}),"."]}),!n&&e.jsxs("section",{className:"relative z-10 rounded-[28px] border border-black/10 bg-white/85 p-6 shadow-[0_22px_44px_-28px_rgba(28,26,23,0.6)] backdrop-blur animate-reveal dark:border-white/10 dark:bg-white/10",style:U(120),children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Новый период"}),e.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Добавить диапазон дат"})]})}),e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-[1fr_1fr_1fr]",children:[e.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[e.jsx("span",{children:"С"}),e.jsx("input",{type:"date",value:a,onChange:t=>E(t.target.value),min:h?H(h,-3):void 0,max:h||void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),e.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[e.jsx("span",{children:"По"}),e.jsx("input",{type:"date",value:h,onChange:t=>$(t.target.value),min:a||void 0,max:a?H(a,3):void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx("button",{className:"rounded-2xl bg-[#4e3f7f] px-4 py-3 text-sm font-semibold text-white shadow-[0_14px_28px_-18px_rgba(78,63,127,0.85)] transition hover:-translate-y-0.5 hover:bg-[#66529f] disabled:cursor-not-allowed disabled:opacity-70",type:"button",onClick:()=>O(!1),disabled:v,children:v?"Сохранение...":"Сохранить"})})]}),P&&e.jsx("p",{className:"mt-3 text-xs text-[#b0352b] dark:text-[#ff8b7c]",children:P})]}),e.jsxs("section",{className:"relative z-10 grid gap-4 animate-reveal",style:U(240),children:[u.some(t=>t.is_pinned)&&e.jsxs("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Закреплённый период"}),e.jsx("div",{className:"mt-4",children:(()=>{const t=u.find(m=>m.is_pinned);if(!t)return null;const i=W(t);return e.jsx(z,{items:[{id:t.id,title:i.title,subtitle:i.subtitle,isClosed:!!t.is_closed,actualRemaining:t.actual_remaining??null}],baseHref:s?`/shared/${s}/periods`:void 0})})()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-2xl",children:"История периодов"}),e.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"Сначала новые"})]}),e.jsxs("div",{className:"grid gap-4",children:[N&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем периоды..."}),g&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:g}),!N&&!g&&u.length===0&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Периодов пока нет. Создайте первый диапазон выше."}),!N&&!g&&e.jsx(z,{items:u.map(t=>{const i=W(t);return{id:t.id,title:i.title,subtitle:i.subtitle,isClosed:!!t.is_closed,actualRemaining:t.actual_remaining??null}}),baseHref:s?`/shared/${s}/periods`:void 0})]})]}),!n&&c&&e.jsx(ae,{href:`/periods/${c.id}`,title:p(c.start_date)&&p(c.end_date)?`${j(c.start_date)} — ${j(c.end_date)}`:"Период",subtitle:p(c.start_date)&&p(c.end_date)?`${K(c.start_date,c.end_date)} дней · ${V(c.start_date,c.end_date)}`:"Даты не заданы",onClose:()=>{b(null),w(!1)},onConfirm:()=>O(!0),confirmDisabled:!J||v}),G&&e.jsx(oe,{onConfirm:X}),Q&&e.jsx(re,{onClose:()=>y(!1),onReload:()=>window.location.reload()})]})]})}export{ye as default};
