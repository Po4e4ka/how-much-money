import{c as G,j as t,r as y,L as Xe,u as mt,H as xt}from"./app-BGS1jRRB.js";import{T as ft,a as ut,b as pt,A as ht}from"./app-layout-A3uNbGGB.js";import{d as Ae}from"./index-CYtoQFCC.js";import{P as se,S as bt,O as gt}from"./session-expired-modal-CeObebct.js";import{b as wt}from"./app-logo-icon-C7XSqThq.js";import{a as re,b as he,t as pe,d as yt,e as Re,h as jt,i as kt,j as ze,k as vt,l as ye}from"./period-calculations-B9aBpp78.js";import{d as _t}from"./animation-DULAtfne.js";import{c as Ke,b as fe,f as qe,a as He}from"./date-C0FYGyP5.js";/* empty css            */import"./index-CKypIsO3.js";import"./index-BdjROfYu.js";const Nt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],St=wt("CircleHelp",Nt),Ct=d=>{const e=G.c(14),{currentTitle:n,onConfirm:l,onCancel:s,confirmDisabled:a}=d,r=a===void 0?!1:a;let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx("h3",{className:"font-display text-2xl",children:"Закрепить другой период?"}),e[0]=i):i=e[0];const o=n?`Сейчас закреплён период ${n}. Закрепить этот вместо него?`:"Сейчас уже есть закреплённый период. Закрепить этот вместо него?";let c;e[1]!==o?(c=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:o}),e[1]=o,e[2]=c):c=e[2];let m;e[3]!==s?(m=t.jsx(se,{type:"button",onClick:s,className:"px-4 py-2",children:"Отмена"}),e[3]=s,e[4]=m):m=e[4];let u;e[5]!==r||e[6]!==l?(u=t.jsx(se,{type:"button",onClick:l,tone:"success",className:"px-4 py-2",disabled:r,children:"Закрепить"}),e[5]=r,e[6]=l,e[7]=u):u=e[7];let f;e[8]!==m||e[9]!==u?(f=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[m,u]}),e[8]=m,e[9]=u,e[10]=f):f=e[10];let x;return e[11]!==c||e[12]!==f?(x=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[i,c,f]})}),e[11]=c,e[12]=f,e[13]=x):x=e[13],x},Dt=d=>{const e=G.c(10),{onConfirm:n,onCancel:l,confirmDisabled:s}=d,a=s===void 0?!1:s;let r,i;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx("h3",{className:"font-display text-2xl",children:"Закрыть период?"}),i=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:"После закрытия период будет доступен только для просмотра. Редактировать данные больше нельзя."}),e[0]=r,e[1]=i):(r=e[0],i=e[1]);let o;e[2]!==l?(o=t.jsx(se,{type:"button",onClick:l,className:"px-4 py-2",children:"Отмена"}),e[2]=l,e[3]=o):o=e[3];let c;e[4]!==a||e[5]!==n?(c=t.jsx(se,{type:"button",onClick:n,tone:"success",className:"px-4 py-2",disabled:a,children:"Закрыть"}),e[4]=a,e[5]=n,e[6]=c):c=e[6];let m;return e[7]!==o||e[8]!==c?(m=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[r,i,t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[o,c]})]})}),e[7]=o,e[8]=c,e[9]=m):m=e[9],m};function Et(d){const e=G.c(14),{text:n,ariaLabel:l}=d,[s,a]=y.useState(!1),[r,i]=y.useState(!1);let o,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=()=>{if(typeof window>"u")return;const v=window.matchMedia("(hover: none) and (pointer: coarse)"),_=()=>a(v.matches);return _(),v.addEventListener("change",_),()=>v.removeEventListener("change",_)},c=[],e[0]=o,e[1]=c):(o=e[0],c=e[1]),y.useEffect(o,c);const m=s?r:void 0,u=l??"Подсказка";let f;e[2]!==s?(f=()=>{s&&i($t)},e[2]=s,e[3]=f):f=e[3];let x;e[4]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(St,{className:"h-4 w-4"}),e[4]=x):x=e[4];let w;e[5]!==u||e[6]!==f?(w=t.jsx(ft,{asChild:!0,children:t.jsx("button",{type:"button","aria-label":u,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:f,children:x})}),e[5]=u,e[6]=f,e[7]=w):w=e[7];let p;e[8]!==n?(p=t.jsx(ut,{className:"max-w-xs text-xs leading-relaxed",children:n}),e[8]=n,e[9]=p):p=e[9];let g;return e[10]!==m||e[11]!==w||e[12]!==p?(g=t.jsxs(pt,{open:m,onOpenChange:i,children:[w,p]}),e[10]=m,e[11]=w,e[12]=p,e[13]=g):g=e[13],g}function $t(d){return!d}const ie=d=>{const e=G.c(9),{children:n,className:l,tooltipText:s,tooltipAriaLabel:a}=d,r=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${l??""}`;let i;e[0]!==n?(i=t.jsx("span",{children:n}),e[0]=n,e[1]=i):i=e[1];let o;e[2]!==a||e[3]!==s?(o=s?t.jsx("span",{className:"ml-2 inline-flex align-middle",children:t.jsx(Et,{text:s,ariaLabel:a??"Дополнительная информация"})}):null,e[2]=a,e[3]=s,e[4]=o):o=e[4];let c;return e[5]!==r||e[6]!==i||e[7]!==o?(c=t.jsxs("div",{className:r,children:[i,o]}),e[5]=r,e[6]=i,e[7]=o,e[8]=c):c=e[8],c},At=d=>{const e=G.c(3),{href:n}=d;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(ie,{children:"Ежедневные траты"}),t.jsx(se,{as:"span",children:"Перейти к дневным значениям"})]}),e[0]=l):l=e[0];let s;return e[1]!==n?(s=t.jsx(Xe,{href:n,prefetch:!0,className:"group rounded-lg border border-[#1e7b4f]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(30,123,79,0.55)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(30,123,79,0.65)] dark:border-[#7ce0b3]/30 dark:bg-white/10 dark:text-white",children:l}),e[1]=n,e[2]=s):s=e[2],s},It=d=>{const e=G.c(26),{days:n,startDate:l,endDate:s,isEditing:a,readOnly:r,onToggleEditing:i,onStartDateChange:o,onEndDateChange:c,minStartDate:m,maxStartDate:u,minEndDate:f,maxEndDate:x}=d;let w;e[0]===Symbol.for("react.memo_cache_sentinel")?(w=t.jsx(ie,{children:"Дни периода"}),e[0]=w):w=e[0];const p=a?"Готово":"Редактировать";let g;e[1]!==a||e[2]!==i||e[3]!==r||e[4]!==p?(g=t.jsxs("div",{className:"flex items-center justify-between",children:[w,t.jsx(se,{type:"button",onClick:i,active:a,activeTone:"success",disabled:r,children:p})]}),e[1]=a,e[2]=i,e[3]=r,e[4]=p,e[5]=g):g=e[5];let v;e[6]!==n?(v=t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:n}),e[6]=n,e[7]=v):v=e[7];let _;e[8]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"}),e[8]=_):_=e[8];let k;e[9]!==v?(k=t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[v,_]}),e[9]=v,e[10]=k):k=e[10];let h;e[11]!==s||e[12]!==a||e[13]!==x||e[14]!==u||e[15]!==f||e[16]!==m||e[17]!==c||e[18]!==o||e[19]!==r||e[20]!==l?(h=a&&t.jsxs("div",{className:"mt-3 grid gap-2 grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:l,disabled:r,onChange:E=>o(E.target.value),min:m,max:u,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:s,disabled:r,onChange:E=>c(E.target.value),min:f,max:x,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]})]}),e[11]=s,e[12]=a,e[13]=x,e[14]=u,e[15]=f,e[16]=m,e[17]=c,e[18]=o,e[19]=r,e[20]=l,e[21]=h):h=e[21];let N;return e[22]!==g||e[23]!==k||e[24]!==h?(N=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[g,k,h]}),e[22]=g,e[23]=k,e[24]=h,e[25]=N):N=e[25],N},Ve=d=>{const e=G.c(2),{className:n}=d,l=`h-px w-full bg-black/10 dark:bg-white/10 ${n??""}`;let s;return e[0]!==l?(s=t.jsx("div",{className:l}),e[0]=l,e[1]=s):s=e[1],s},Te=d=>{const e=G.c(3),{children:n,className:l}=d,s=`font-display text-2xl ${l??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("div",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},Ue=d=>{const e=G.c(3),{children:n,className:l}=d,s=`flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm ${l??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("div",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},me=d=>{const e=G.c(3),{children:n,className:l}=d,s=`inline-flex items-center font-display tabular-nums leading-[0.9] ${l??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("span",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},je=d=>{const e=G.c(3),{children:n,className:l}=d,s=`inline-flex items-center leading-[0.9] relative -top-[1px] text-black/50 dark:text-white/60 ${l??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("span",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},Tt=d=>{const e=G.c(36),{plannedPeriodSum:n,totalDifference:l,totalDailyExpenses:s,dailyActualAverage:a}=d;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx(ie,{tooltipText:"Планируемый остаток +/− фактическая разница − ежедневные траты за период.",tooltipAriaLabel:"Формула фактического остатка",children:"Фактический остаток"}),e[0]=r):r=e[0];let i;e[1]!==n?(i=re(n),e[1]=n,e[2]=i):i=e[2];let o;e[3]!==i?(o=t.jsx(me,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:i}),e[3]=i,e[4]=o):o=e[4];const c=`${l>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":l<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let m;if(e[5]!==l){let P;e[7]===Symbol.for("react.memo_cache_sentinel")?(P=/^([+−-])/,e[7]=P):P=e[7],m=he(l).replace(P,"$1 "),e[5]=l,e[6]=m}else m=e[6];let u;e[8]!==c||e[9]!==m?(u=t.jsx(me,{className:c,children:m}),e[8]=c,e[9]=m,e[10]=u):u=e[10];let f;e[11]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsx(je,{children:"−"}),e[11]=f):f=e[11];let x;e[12]!==s?(x=re(s),e[12]=s,e[13]=x):x=e[13];let w;e[14]!==x?(w=t.jsx(me,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:x}),e[14]=x,e[15]=w):w=e[15];let p;e[16]===Symbol.for("react.memo_cache_sentinel")?(p=t.jsx(je,{children:"="}),e[16]=p):p=e[16];const g=`text-2xl ${n+l-s>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,v=n+l-s;let _;e[17]!==v?(_=he(v),e[17]=v,e[18]=_):_=e[18];let k;e[19]!==g||e[20]!==_?(k=t.jsx(me,{className:g,children:_}),e[19]=g,e[20]=_,e[21]=k):k=e[21];let h;e[22]!==k||e[23]!==o||e[24]!==u||e[25]!==w?(h=t.jsxs(Ue,{className:"mt-3",children:[o,u,f,w,p,k]}),e[22]=k,e[23]=o,e[24]=u,e[25]=w,e[26]=h):h=e[26];let N,E;e[27]===Symbol.for("react.memo_cache_sentinel")?(N=t.jsx(Ve,{className:"mt-4"}),E=t.jsx(ie,{className:"mt-4",children:"Фактическое среднее в день за период"}),e[27]=N,e[28]=E):(N=e[27],E=e[28]);let j;e[29]!==a?(j=re(a),e[29]=a,e[30]=j):j=e[30];let D;e[31]!==j?(D=t.jsx(Te,{className:"mt-2",children:j}),e[31]=j,e[32]=D):D=e[32];let C;return e[33]!==h||e[34]!==D?(C=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[r,h,N,E,D]}),e[33]=h,e[34]=D,e[35]=C):C=e[35],C},Pt=d=>{const e=G.c(49),{value:n,placeholder:l,suggestions:s,disabled:a,onChange:r,onSelect:i,onBlur:o,header:c,className:m,containerClassName:u,inputClassName:f}=d,x=a===void 0?!1:a,w=c===void 0?"Подсказки":c,p=m===void 0?"":m,g=u===void 0?"":u,v=f===void 0?"":f,[_,k]=y.useState(!1),[h,N]=y.useState(0),E=y.useRef(null);let j,D;e[0]!==h||e[1]!==s.length?(j=()=>{h>=s.length&&s.length>0&&N(0)},D=[h,s.length],e[0]=h,e[1]=s.length,e[2]=j,e[3]=D):(j=e[2],D=e[3]),y.useEffect(j,D);let C;e:{if(!n){C="";break e}const S=s[h]??s[0];if(!S){C="";break e}if(!S.toLowerCase().startsWith(n.toLowerCase())){C="";break e}let A;e[4]!==S||e[5]!==n.length?(A=S.slice(n.length),e[4]=S,e[5]=n.length,e[6]=A):A=e[6],C=A}const P=C;let K;e[7]!==i?(K=S=>{i(S),N(0),requestAnimationFrame(()=>E.current?.focus())},e[7]=i,e[8]=K):K=e[8];const F=K;let M;e[9]!==F||e[10]!==h||e[11]!==s?(M=S=>{if(S.key==="Escape"){S.preventDefault(),k(!1),E.current?.blur();return}if(S.key==="Tab"&&s.length>0){S.preventDefault();const le=S.shiftKey?-1:1,te=(h+le+s.length)%s.length;N(te);return}if(S.key!=="Enter"||(S.preventDefault(),s.length===0))return;const A=s[h]??s[0];A&&F(A)},e[9]=F,e[10]=h,e[11]=s,e[12]=M):M=e[12];const O=M,L=_&&s.length>0&&!x,H=`relative ${p}`;let U;e[13]!==H?(U=H.trim(),e[13]=H,e[14]=U):U=e[14];const $=`relative flex items-center rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm ${g}`;let T;e[15]!==$?(T=$.trim(),e[15]=$,e[16]=T):T=e[16];let q;e[17]!==P||e[18]!==n?(q=P&&t.jsxs("span",{className:"pointer-events-none absolute left-3 top-1/2 z-10 -translate-y-1/2 text-[#6a5d52]/70 dark:text-white/40 sm:left-4",children:[t.jsx("span",{className:"invisible",children:n}),P]}),e[17]=P,e[18]=n,e[19]=q):q=e[19];let B;e[20]!==r?(B=S=>{r(S.target.value),N(0)},e[20]=r,e[21]=B):B=e[21];let R;e[22]===Symbol.for("react.memo_cache_sentinel")?(R=()=>{k(!0),N(0)},e[22]=R):R=e[22];let X;e[23]!==o?(X=()=>{k(!1),o()},e[23]=o,e[24]=X):X=e[24];const Z=`relative z-20 w-full bg-transparent text-xs outline-none placeholder:text-[#6a5d52]/60 disabled:cursor-not-allowed disabled:opacity-70 dark:text-white dark:placeholder:text-white/40 sm:text-sm ${v}`;let ee;e[25]!==Z?(ee=Z.trim(),e[25]=Z,e[26]=ee):ee=e[26];let Y;e[27]!==x||e[28]!==O||e[29]!==l||e[30]!==B||e[31]!==X||e[32]!==ee||e[33]!==n?(Y=t.jsx("input",{ref:E,type:"text",placeholder:l,value:n,disabled:x,onChange:B,onKeyDown:O,onFocus:R,onBlur:X,className:ee}),e[27]=x,e[28]=O,e[29]=l,e[30]=B,e[31]=X,e[32]=ee,e[33]=n,e[34]=Y):Y=e[34];let I;e[35]!==T||e[36]!==q||e[37]!==Y?(I=t.jsxs("div",{className:T,children:[q,Y]}),e[35]=T,e[36]=q,e[37]=Y,e[38]=I):I=e[38];let ne;e[39]!==F||e[40]!==w||e[41]!==h||e[42]!==L||e[43]!==s?(ne=L&&t.jsx("div",{className:"absolute left-0 right-0 z-30 mt-1",onMouseDown:Ot,children:t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/95 p-2 text-xs shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] backdrop-blur dark:border-white/10 dark:bg-[#1f1b17]/95",children:[t.jsx("div",{className:"px-2 py-1 text-[10px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:w}),t.jsx("div",{className:"flex flex-wrap gap-2 px-2 pb-2",children:s.map((S,A)=>t.jsx("button",{type:"button",onClick:()=>F(S),onMouseEnter:()=>N(A),className:["rounded-full border px-3 py-1 text-[11px] font-medium transition",A===h?"border-black/20 bg-black/10 text-[#1c1a17] dark:border-white/30 dark:bg-white/10 dark:text-white":"border-black/10 bg-black/5 text-[#1c1a17] hover:bg-black/10 dark:border-white/10 dark:bg-white/5 dark:text-white dark:hover:bg-white/10"].join(" "),children:S},S))})]})}),e[39]=F,e[40]=w,e[41]=h,e[42]=L,e[43]=s,e[44]=ne):ne=e[44];let ce;return e[45]!==U||e[46]!==I||e[47]!==ne?(ce=t.jsxs("div",{className:U,children:[I,ne]}),e[45]=U,e[46]=I,e[47]=ne,e[48]=ce):ce=e[48],ce};function Ot(d){return d.preventDefault()}const Ge=y.createContext(null),Ie=({periodId:d,type:e,children:n})=>{const[l,s]=y.useState({previous:[],all:[]});y.useEffect(()=>{const r=new AbortController;return(async()=>{try{const o=new URLSearchParams({type:e}),c=await fetch(`/api/periods/${d}/expense-suggestions?${o.toString()}`,{signal:r.signal});if(!c.ok)throw new Error("Не удалось загрузить подсказки.");const m=await c.json();s({previous:m.data?.previous??[],all:m.data?.all??[]})}catch(o){if(o instanceof DOMException&&o.name==="AbortError")return}})(),()=>r.abort()},[d,e]);const a=y.useMemo(()=>l,[l]);return t.jsx(Ge.Provider,{value:a,children:n})},Ft=()=>{const d=G.c(2),e=y.useContext(Ge);let n;return d[0]!==e?(n=e??{previous:[],all:[]},d[0]=e,d[1]=n):n=d[1],n},Mt=8,Pe=d=>{const e=G.c(18),{value:n,placeholder:l,disabled:s,containerClassName:a,usedNames:r,onChange:i,onBlur:o}=d,c=s===void 0?!1:s;let m;e[0]!==r?(m=r===void 0?[]:r,e[0]=r,e[1]=m):m=e[1];const u=m,{previous:f,all:x}=Ft();let w;if(e[2]!==x||e[3]!==f||e[4]!==u||e[5]!==n){e:{const v=n.trim(),_=v.length>0?x:f;let k;e[7]!==u?(k=new Set(u.map(Bt).filter(Lt)),e[7]=u,e[8]=k):k=e[8];const h=k;if(_.length===0){let j;e[9]===Symbol.for("react.memo_cache_sentinel")?(j=[],e[9]=j):j=e[9],w=j;break e}const N=v.toLowerCase();w=_.filter(j=>{const D=j.toLowerCase();return h.has(D)?!1:N.length===0?!0:D.startsWith(N)}).slice(0,Mt)}e[2]=x,e[3]=f,e[4]=u,e[5]=n,e[6]=w}else w=e[6];const p=w;let g;return e[10]!==a||e[11]!==c||e[12]!==o||e[13]!==i||e[14]!==l||e[15]!==p||e[16]!==n?(g=t.jsx(Pt,{value:n,placeholder:l,suggestions:p,disabled:c,onChange:i,onSelect:i,onBlur:o,header:"Подсказки",containerClassName:a}),e[10]=a,e[11]=c,e[12]=o,e[13]=i,e[14]=l,e[15]=p,e[16]=n,e[17]=g):g=e[17],g};function Bt(d){return d.trim().toLowerCase()}function Lt(d){return d.length>0}const Rt=d=>{const e=G.c(65),{title:n,items:l,setItems:s,showDelete:a,onToggleDelete:r,totalLabel:i,totalPlanned:o,totalActual:c,totalDifference:m,idPrefix:u,onBlurField:f,onAfterDelete:x,readOnly:w}=d,p=w===void 0?!1:w;let g;e[0]!==n?(g=t.jsx(ie,{children:n}),e[0]=n,e[1]=g):g=e[1];let v;e[2]!==u||e[3]!==s?(v=()=>s(I=>[...I,{id:`${u}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),e[2]=u,e[3]=s,e[4]=v):v=e[4];let _;e[5]!==p||e[6]!==v?(_=t.jsx(se,{type:"button",onClick:v,disabled:p,children:"+ Строка"}),e[5]=p,e[6]=v,e[7]=_):_=e[7];let k;e[8]!==r||e[9]!==p||e[10]!==a?(k=t.jsx(se,{type:"button",onClick:r,active:a,activeTone:"danger",disabled:p,children:"− Удаление"}),e[8]=r,e[9]=p,e[10]=a,e[11]=k):k=e[11];let h;e[12]!==_||e[13]!==k?(h=t.jsxs("div",{className:"flex items-center gap-2",children:[_,k]}),e[12]=_,e[13]=k,e[14]=h):h=e[14];let N;e[15]!==g||e[16]!==h?(N=t.jsxs("div",{className:"flex items-center justify-between",children:[g,h]}),e[15]=g,e[16]=h,e[17]=N):N=e[17];const E=`mt-3 grid items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let j,D,C;e[18]===Symbol.for("react.memo_cache_sentinel")?(C=t.jsxs("span",{children:[t.jsx("span",{className:"sm:hidden",children:"Название"}),t.jsx("span",{className:"hidden sm:inline",children:"Название"})]}),j=t.jsx("span",{className:"text-right",children:"План"}),D=t.jsx("span",{className:"text-right",children:"Факт"}),e[18]=j,e[19]=D,e[20]=C):(j=e[18],D=e[19],C=e[20]);let P;e[21]===Symbol.for("react.memo_cache_sentinel")?(P=t.jsxs("span",{className:"text-right",children:[t.jsx("span",{className:"sm:hidden",children:"Разн"}),t.jsx("span",{className:"hidden sm:inline",children:"Разница"})]}),e[21]=P):P=e[21];let K;e[22]!==a?(K=a&&t.jsx("span",{className:"text-center",children:"—"}),e[22]=a,e[23]=K):K=e[23];let F;e[24]!==K||e[25]!==E?(F=t.jsxs("div",{className:E,children:[C,j,D,P,K]}),e[24]=K,e[25]=E,e[26]=F):F=e[26];let M;e[27]!==l||e[28]!==x||e[29]!==f||e[30]!==p||e[31]!==s||e[32]!==a?(M=l.map((I,ne)=>{const ce=l.filter(S=>S.id!==I.id).map(zt);return t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(Pe,{value:I.name,placeholder:`Трата ${ne+1}`,disabled:p,usedNames:ce,onChange:S=>s(A=>A.map(le=>le.id===I.id?{...le,name:S}:le)),onBlur:f}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:I.plannedAmount,disabled:p,onChange:S=>{const A=S.target.value;s(le=>le.map(te=>te.id===I.id?{...te,plannedAmount:pe(A),actualAmount:te.actualTouched?te.actualAmount:pe(A)}:te))},onFocus:()=>{I.plannedAmount===0&&s(S=>S.map(A=>A.id===I.id?{...A,plannedAmount:""}:A))},onBlur:()=>{I.plannedAmount===""&&s(S=>S.map(A=>A.id===I.id?{...A,plannedAmount:0}:A)),f()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:I.actualAmount,disabled:p,onChange:S=>{const A=S.target.value;s(le=>le.map(te=>te.id===I.id?{...te,actualAmount:pe(A),actualTouched:!0}:te))},onFocus:()=>{I.actualAmount===0&&s(S=>S.map(A=>A.id===I.id?{...A,actualAmount:""}:A))},onBlur:()=>{I.actualAmount===""&&s(S=>S.map(A=>A.id===I.id?{...A,actualAmount:0}:A)),f()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("div",{className:`flex min-h-[36px] items-center justify-end px-0 py-2 text-xs tabular-nums sm:min-h-[40px] sm:px-4 sm:text-sm ${I.plannedAmount-I.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":I.plannedAmount-I.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:he(I.plannedAmount-I.actualAmount)}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(S=>S.filter(A=>A.id!==I.id)),x())},"aria-label":`Удалить трату ${ne+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:p,children:"—"})]},I.id)}),e[27]=l,e[28]=x,e[29]=f,e[30]=p,e[31]=s,e[32]=a,e[33]=M):M=e[33];let O;e[34]!==M?(O=t.jsx("div",{className:"mt-3 grid gap-2",children:M}),e[34]=M,e[35]=O):O=e[35];const L=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let H;e[36]!==i?(H=t.jsx("span",{children:i}),e[36]=i,e[37]=H):H=e[37];let U;e[38]!==o?(U=re(o),e[38]=o,e[39]=U):U=e[39];let $;e[40]!==U?($=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:U}),e[40]=U,e[41]=$):$=e[41];let T;e[42]!==c?(T=re(c),e[42]=c,e[43]=T):T=e[43];let q;e[44]!==T?(q=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:T}),e[44]=T,e[45]=q):q=e[45];const B=`text-right font-display text-sm tabular-nums ${m>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":m<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let R;e[46]!==m?(R=he(m),e[46]=m,e[47]=R):R=e[47];let X;e[48]!==B||e[49]!==R?(X=t.jsx("span",{className:B,children:R}),e[48]=B,e[49]=R,e[50]=X):X=e[50];let Z;e[51]!==a?(Z=a&&t.jsx("span",{}),e[51]=a,e[52]=Z):Z=e[52];let ee;e[53]!==L||e[54]!==H||e[55]!==$||e[56]!==q||e[57]!==X||e[58]!==Z?(ee=t.jsxs("div",{className:L,children:[H,$,q,X,Z]}),e[53]=L,e[54]=H,e[55]=$,e[56]=q,e[57]=X,e[58]=Z,e[59]=ee):ee=e[59];let Y;return e[60]!==F||e[61]!==O||e[62]!==ee||e[63]!==N?(Y=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[N,F,O,ee]}),e[60]=F,e[61]=O,e[62]=ee,e[63]=N,e[64]=Y):Y=e[64],Y};function zt(d){return d.name}const Kt=d=>{const e=G.c(44),{items:n,setItems:l,totalAmount:s,onAdd:a,showDelete:r,onToggleDelete:i,onBlurField:o,onAfterDelete:c,invalidNameIds:m,readOnly:u}=d,f=u===void 0?!1:u;let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(ie,{children:"Приход"}),e[0]=x):x=e[0];let w;e[1]!==a||e[2]!==f?(w=t.jsx(se,{type:"button",onClick:a,disabled:f,children:"+ Строка"}),e[1]=a,e[2]=f,e[3]=w):w=e[3];let p;e[4]!==i||e[5]!==f||e[6]!==r?(p=t.jsx(se,{type:"button",onClick:i,active:r,activeTone:"danger",disabled:f,children:"− Удаление"}),e[4]=i,e[5]=f,e[6]=r,e[7]=p):p=e[7];let g;e[8]!==w||e[9]!==p?(g=t.jsxs("div",{className:"flex items-center justify-between",children:[x,t.jsxs("div",{className:"flex items-center gap-2",children:[w,p]})]}),e[8]=w,e[9]=p,e[10]=g):g=e[10];const v=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${r?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let _,k;e[11]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx("span",{children:"Название"}),k=t.jsx("span",{className:"text-right",children:"Сумма"}),e[11]=_,e[12]=k):(_=e[11],k=e[12]);let h;e[13]!==r?(h=r&&t.jsx("span",{className:"text-center",children:"—"}),e[13]=r,e[14]=h):h=e[14];let N;e[15]!==v||e[16]!==h?(N=t.jsxs("div",{className:v,children:[_,k,h]}),e[15]=v,e[16]=h,e[17]=N):N=e[17];let E;e[18]!==m||e[19]!==n||e[20]!==c||e[21]!==o||e[22]!==f||e[23]!==l||e[24]!==r?(E=n.map((L,H)=>{const U=n.filter($=>$.id!==L.id).map(qt);return t.jsxs("div",{className:`grid items-center gap-2 ${r?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(Pe,{value:L.name,placeholder:`Приход ${H+1}`,disabled:f,usedNames:U,onChange:$=>l(T=>T.map(q=>q.id===L.id?{...q,name:$}:q)),onBlur:o,containerClassName:m.includes(L.id)?"border-[#b0352b] dark:border-[#ff8b7c]":""}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:L.amount,disabled:f,onChange:$=>{const T=$.target.value;l(q=>q.map(B=>B.id===L.id?{...B,amount:pe(T)}:B))},onFocus:()=>{L.amount===0&&l($=>$.map(T=>T.id===L.id?{...T,amount:""}:T))},onBlur:()=>{L.amount===""&&l($=>$.map(T=>T.id===L.id?{...T,amount:0}:T)),o()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),r&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(l($=>$.filter(T=>T.id!==L.id)),c())},"aria-label":`Удалить приход ${H+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:f,children:"—"})]},L.id)}),e[18]=m,e[19]=n,e[20]=c,e[21]=o,e[22]=f,e[23]=l,e[24]=r,e[25]=E):E=e[25];let j;e[26]!==E?(j=t.jsx("div",{className:"mt-3 grid gap-2",children:E}),e[26]=E,e[27]=j):j=e[27];const D=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${r?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let C;e[28]===Symbol.for("react.memo_cache_sentinel")?(C=t.jsx("span",{children:"Итого прихода"}),e[28]=C):C=e[28];let P;e[29]!==s?(P=re(s),e[29]=s,e[30]=P):P=e[30];let K;e[31]!==P?(K=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:P}),e[31]=P,e[32]=K):K=e[32];let F;e[33]!==r?(F=r&&t.jsx("span",{}),e[33]=r,e[34]=F):F=e[34];let M;e[35]!==D||e[36]!==K||e[37]!==F?(M=t.jsxs("div",{className:D,children:[C,K,F]}),e[35]=D,e[36]=K,e[37]=F,e[38]=M):M=e[38];let O;return e[39]!==N||e[40]!==j||e[41]!==M||e[42]!==g?(O=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[g,N,j,M]}),e[39]=N,e[40]=j,e[41]=M,e[42]=g,e[43]=O):O=e[43],O};function qt(d){return d.name}const Ht=d=>{const e=G.c(52),{title:n,items:l,setItems:s,showDelete:a,onToggleDelete:r,totalLabel:i,totalAmount:o,idPrefix:c,onBlurField:m,onAfterDelete:u,readOnly:f}=d,x=f===void 0?!1:f;let w;e[0]!==n?(w=t.jsx(ie,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:n}),e[0]=n,e[1]=w):w=e[1];let p;e[2]!==c||e[3]!==s?(p=()=>s($=>[...$,{id:`${c}${Date.now()}`,name:"",amount:""}]),e[2]=c,e[3]=s,e[4]=p):p=e[4];let g;e[5]!==x||e[6]!==p?(g=t.jsx(se,{type:"button",onClick:p,disabled:x,children:"+ Строка"}),e[5]=x,e[6]=p,e[7]=g):g=e[7];let v;e[8]!==r||e[9]!==x||e[10]!==a?(v=t.jsx(se,{type:"button",onClick:r,active:a,activeTone:"danger",disabled:x,children:"− Удаление"}),e[8]=r,e[9]=x,e[10]=a,e[11]=v):v=e[11];let _;e[12]!==g||e[13]!==v?(_=t.jsxs("div",{className:"flex items-center gap-2",children:[g,v]}),e[12]=g,e[13]=v,e[14]=_):_=e[14];let k;e[15]!==w||e[16]!==_?(k=t.jsxs("div",{className:"flex items-center justify-between",children:[w,_]}),e[15]=w,e[16]=_,e[17]=k):k=e[17];const h=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let N,E;e[18]===Symbol.for("react.memo_cache_sentinel")?(E=t.jsx("span",{children:"Название"}),N=t.jsx("span",{className:"text-right",children:"Сумма"}),e[18]=N,e[19]=E):(N=e[18],E=e[19]);let j;e[20]!==a?(j=a&&t.jsx("span",{className:"text-center",children:"—"}),e[20]=a,e[21]=j):j=e[21];let D;e[22]!==j||e[23]!==h?(D=t.jsxs("div",{className:h,children:[E,N,j]}),e[22]=j,e[23]=h,e[24]=D):D=e[24];let C;e[25]!==l||e[26]!==u||e[27]!==m||e[28]!==x||e[29]!==s||e[30]!==a?(C=l.map(($,T)=>{const q=l.filter(B=>B.id!==$.id).map(Xt);return t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(Pe,{value:$.name,placeholder:`Трата ${T+1}`,disabled:x,usedNames:q,onChange:B=>s(R=>R.map(X=>X.id===$.id?{...X,name:B}:X)),onBlur:m}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:$.amount,disabled:x,onChange:B=>{const R=B.target.value;s(X=>X.map(Z=>Z.id===$.id?{...Z,amount:pe(R)}:Z))},onFocus:()=>{$.amount===0&&s(B=>B.map(R=>R.id===$.id?{...R,amount:""}:R))},onBlur:()=>{$.amount===""&&s(B=>B.map(R=>R.id===$.id?{...R,amount:0}:R)),m()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(B=>B.filter(R=>R.id!==$.id)),u())},"aria-label":`Удалить трату ${T+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:x,children:"—"})]},$.id)}),e[25]=l,e[26]=u,e[27]=m,e[28]=x,e[29]=s,e[30]=a,e[31]=C):C=e[31];let P;e[32]!==C?(P=t.jsx("div",{className:"mt-3 grid gap-2",children:C}),e[32]=C,e[33]=P):P=e[33];const K=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let F;e[34]!==i?(F=t.jsx("span",{children:i}),e[34]=i,e[35]=F):F=e[35];let M;e[36]!==o?(M=re(o),e[36]=o,e[37]=M):M=e[37];let O;e[38]!==M?(O=t.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:M}),e[38]=M,e[39]=O):O=e[39];let L;e[40]!==a?(L=a&&t.jsx("span",{}),e[40]=a,e[41]=L):L=e[41];let H;e[42]!==K||e[43]!==F||e[44]!==O||e[45]!==L?(H=t.jsxs("div",{className:K,children:[F,O,L]}),e[42]=K,e[43]=F,e[44]=O,e[45]=L,e[46]=H):H=e[46];let U;return e[47]!==D||e[48]!==P||e[49]!==H||e[50]!==k?(U=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[k,D,P,H]}),e[47]=D,e[48]=P,e[49]=H,e[50]=k,e[51]=U):U=e[51],U};function Xt(d){return d.name}const Vt=d=>{const e=G.c(35),{dailyAverage:n,days:l,totalIncome:s,totalPlannedExpenses:a,plannedPeriodSum:r}=d;let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(ie,{tooltipText:"Приход − план = сумма в период",children:"Планируемая сумма на период"}),e[0]=i):i=e[0];let o;e[1]!==s?(o=re(s),e[1]=s,e[2]=o):o=e[2];let c;e[3]!==o?(c=t.jsx(me,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:o}),e[3]=o,e[4]=c):c=e[4];let m;e[5]===Symbol.for("react.memo_cache_sentinel")?(m=t.jsx(je,{children:"−"}),e[5]=m):m=e[5];let u;e[6]!==a?(u=re(a),e[6]=a,e[7]=u):u=e[7];let f;e[8]!==u?(f=t.jsx(me,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:u}),e[8]=u,e[9]=f):f=e[9];let x;e[10]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(je,{children:"="}),e[10]=x):x=e[10];const w=`text-2xl ${r>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`;let p;e[11]!==r?(p=he(r),e[11]=r,e[12]=p):p=e[12];let g;e[13]!==w||e[14]!==p?(g=t.jsx(me,{className:w,children:p}),e[13]=w,e[14]=p,e[15]=g):g=e[15];let v;e[16]!==g||e[17]!==c||e[18]!==f?(v=t.jsxs("div",{className:"grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[i,t.jsxs(Ue,{children:[c,m,f,x,g]})]}),e[16]=g,e[17]=c,e[18]=f,e[19]=v):v=e[19];let _,k;e[20]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx(Ve,{className:"mt-4"}),k=t.jsx(ie,{className:"mt-4",children:"Планируемое среднее в день"}),e[20]=_,e[21]=k):(_=e[20],k=e[21]);let h;e[22]!==r?(h=re(r),e[22]=r,e[23]=h):h=e[23];const N=l||0;let E;e[24]!==h||e[25]!==N?(E=t.jsxs("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:["(",h," / ",N," д.)"]}),e[24]=h,e[25]=N,e[26]=E):E=e[26];let j;e[27]!==n?(j=re(n),e[27]=n,e[28]=j):j=e[28];let D;e[29]!==j?(D=t.jsx(Te,{className:"mt-3",children:j}),e[29]=j,e[30]=D):D=e[30];let C;return e[31]!==v||e[32]!==E||e[33]!==D?(C=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[v,_,k,E,D]}),e[31]=v,e[32]=E,e[33]=D,e[34]=C):C=e[34],C},Ut=d=>{const e=G.c(3),{children:n,className:l}=d,s=`mt-2 text-xs text-[#6a5d52] dark:text-white/60 ${l??""}`;let a;return e[0]!==n||e[1]!==s?(a=t.jsx("p",{className:s,children:n}),e[0]=n,e[1]=s,e[2]=a):a=e[2],a},Gt=d=>{const e=G.c(13),{actualRemaining:n,remainingDays:l,remainingDailyAverage:s}=d;let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(ie,{tooltipText:"Фактический остаток / количество незаполненных (непрошедших) дней",children:"Расчётное в день на оставшиеся дни"}),e[0]=a):a=e[0];let r;e[1]!==n?(r=re(n),e[1]=n,e[2]=r):r=e[2];const i=l||0;let o;e[3]!==r||e[4]!==i?(o=t.jsxs(Ut,{children:["(",r," / ",i," д.)"]}),e[3]=r,e[4]=i,e[5]=o):o=e[5];let c;e[6]!==s?(c=re(s),e[6]=s,e[7]=c):c=e[7];let m;e[8]!==c?(m=t.jsx(Te,{className:"mt-3",children:c}),e[8]=c,e[9]=m):m=e[9];let u;return e[10]!==o||e[11]!==m?(u=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[a,o,m]}),e[10]=o,e[11]=m,e[12]=u):u=e[12],u},Jt={id:0,startDate:"",endDate:"",incomes:[],expenses:[],offIncomeExpenses:[],dailyExpenses:{},isPinned:!1,isClosed:!1};function is(){const{periodId:d}=mt().props,[e,n]=y.useState(Jt),[l,s]=y.useState([]),[a,r]=y.useState(""),[i,o]=y.useState(""),[c,m]=y.useState([]),[u,f]=y.useState([]),[x,w]=y.useState({}),[p,g]=y.useState(!1),[v,_]=y.useState(!1),[k,h]=y.useState(!0),[N,E]=y.useState(null),[j,D]=y.useState(!1),[C,P]=y.useState(null),[K,F]=y.useState(!1),[M,O]=y.useState(null),[L,H]=y.useState(!1),[U,$]=y.useState([]),[T,q]=y.useState(!1),[B,R]=y.useState(!1),[X,Z]=y.useState(!1),[ee,Y]=y.useState(!1),[I,ne]=y.useState(!1),[ce,S]=y.useState(!1),[A,le]=y.useState(),te=y.useRef(!1),[Oe,Je]=y.useState(0),Fe="Заполните названия прихода.",xe=y.useRef(null),be=y.useRef(null),Me=y.useMemo(()=>`period:${d}`,[d]),ke=y.useRef(!1),ve=y.useRef(!1),We=()=>typeof window>"u"?null:window.__periodCache?.[Me]??null,ge=b=>{if(typeof window>"u")return;const V=window;V.__periodCache||(V.__periodCache={}),V.__periodCache[Me]=b},{totalPlanned:_e,totalActual:Ze,totalDifference:Ne}=yt(c??[]),Qe=Re(u??[]),Se=Re(l??[]),ue=y.useMemo(()=>!a||!i?0:Ke(a,i),[a,i]),Ce=y.useMemo(()=>jt(x),[x]),De=y.useMemo(()=>kt(a,i,x),[x,a,i]),Ye=De>0?Ce/De:0,Ee=y.useMemo(()=>!a||!i?"Период":`${fe(a)} — ${fe(i)}`,[a,i]),et=y.useMemo(()=>!a||!i?"":`${ue} дней · ${qe(a,i)}`,[ue,a,i]),{plannedPeriodSum:Be,dailyAverage:tt,actualRemaining:st,remainingDays:at,remainingDailyAverage:nt,isDailyComplete:lt}=vt({days:ue,totalIncome:Se,totalPlannedExpenses:_e,totalDifference:Ne,totalDailyExpenses:Ce,filledDays:De}),we=e.isClosed;Ae().url,`${d}`;const rt=b=>!!(b&&b.id&&Array.isArray(b.incomes)&&Array.isArray(b.expenses)&&Array.isArray(b.offIncomeExpenses)),it=async()=>{if(ve.current)return;const b=We();if(!(rt(b)&&(n({...b,isClosed:!!b.isClosed}),s(b.incomes??[]),r(b.startDate??""),o(b.endDate??""),m(b.expenses??[]),f(b.offIncomeExpenses??[]),w(b.dailyExpenses??{}),xe.current={startDate:b.startDate??"",endDate:b.endDate??""},h(!1),typeof navigator<"u"&&!navigator.onLine))&&!(ke.current&&(!navigator.onLine||!b))){ve.current=!0,h(!0),E(null);try{const V=await fetch(`/api/periods/${d}`);if(!V.ok)throw new Error("Не удалось загрузить период.");const W=(await V.json()).data,Q={id:W.id,startDate:W.start_date,endDate:W.end_date,dailyExpenses:W.daily_expenses??{},isPinned:!!W.is_pinned,isClosed:!!W.is_closed,incomes:W.incomes.map(J=>({id:String(J.id),name:J.name,amount:J.amount})),expenses:W.expenses.map(J=>({id:String(J.id),name:J.name,plannedAmount:J.planned_amount,actualAmount:J.actual_amount,actualTouched:!1})),offIncomeExpenses:W.external_expenses.map(J=>({id:String(J.id),name:J.name,amount:J.amount}))};n(Q),s(Q.incomes),r(Q.startDate),o(Q.endDate),m(Q.expenses),f(Q.offIncomeExpenses),w(Q.dailyExpenses),Y(!1),le(void 0),xe.current={startDate:Q.startDate,endDate:Q.endDate},ge(Q),ke.current=!0}catch(V){E(V instanceof Error?V.message:"Не удалось загрузить период.")}finally{h(!1),ve.current=!1}}},oe=async(b=!1,V)=>{if(e.isClosed)return;const ae=V?.startDate??a,W=V?.endDate??i,Q=ze(l);if(Q.length>0){$(Q),O(Fe);return}if(j){te.current=!0;return}D(!0),O(null),H(!1);try{const J=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",de=await fetch(`/api/periods/${d}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":J},body:JSON.stringify({start_date:ae,end_date:W,daily_expenses:x,force:b,incomes:l.filter(z=>z.name.trim()!=="").map(z=>({id:Number.isFinite(Number(z.id))?Number(z.id):void 0,name:z.name,amount:ye(z.amount)})),expenses:c.filter(z=>z.name.trim()!=="").map(z=>({id:Number.isFinite(Number(z.id))?Number(z.id):void 0,name:z.name,planned_amount:ye(z.plannedAmount),actual_amount:ye(z.actualAmount)})),external_expenses:u.filter(z=>z.name.trim()!=="").map(z=>({id:Number.isFinite(Number(z.id))?Number(z.id):void 0,name:z.name,amount:ye(z.amount)}))})});if(de.status===409){const z=await de.json();if(z.overlap){be.current={startDate:ae,endDate:W},P(z.overlap),F(!0),xe.current&&(r(xe.current.startDate),o(xe.current.endDate));return}throw new Error("Период пересекается с существующим.")}if(!de.ok){if(de.status===423){const z=await de.json();throw new Error(z.message??"Период закрыт и не редактируется.")}throw new Error("Не удалось сохранить период.")}r(ae),o(W),H(!0),P(null),F(!1),be.current=null,xe.current={startDate:ae,endDate:W},ge({id:Number(d),startDate:ae,endDate:W,incomes:l,expenses:c,offIncomeExpenses:u,dailyExpenses:x,isPinned:e.isPinned,isClosed:e.isClosed})}catch(J){O(J instanceof Error?J.message:"Не удалось сохранить период.")}finally{D(!1)}},ot=()=>{e.isClosed||(s(b=>[...b,{id:`i${Date.now()}`,name:"",amount:""}]),oe())},$e=()=>{Je(b=>b+1)},dt=async()=>{if(!T&&window.confirm("Удалить период?")){q(!0),O(null);try{const b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch(`/api/periods/${d}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":b}})).ok)throw new Error("Не удалось удалить период.");window.location.href=Ae().url}catch(b){O(b instanceof Error?b.message:"Не удалось удалить период.")}finally{q(!1)}}},ct=async()=>{if(!(X||e.isClosed)){Z(!0),O(null);try{const b=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",V=await fetch(`/api/periods/${d}/close`,{method:"POST",headers:{"X-CSRF-TOKEN":b}});if(V.status===419){S(!0);return}if(!V.ok){const Q=await V.json();throw new Error(Q.message??"Не удалось закрыть период.")}const ae=await V.json(),W={...e,isClosed:ae.data?.is_closed??!0};n(W),ne(!1),ge({id:Number(d),startDate:a,endDate:i,incomes:l,expenses:c,offIncomeExpenses:u,dailyExpenses:x,isPinned:e.isPinned,isClosed:W.isClosed})}catch(b){O(b instanceof Error?b.message:"Не удалось закрыть период.")}finally{Z(!1)}}},Le=async(b=!1)=>{if(!B){R(!0);try{const V=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",ae=await fetch(`/api/periods/${d}/pin`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":V},body:JSON.stringify({pinned:!e.isPinned,force:b})});if(ae.status===419){S(!0);return}if(ae.status===409){const de=await ae.json();de.pinned?le(`${fe(de.pinned.start_date)} — ${fe(de.pinned.end_date)}`):le(void 0),Y(!0);return}if(!ae.ok)throw new Error("Не удалось изменить закрепление периода.");const Q=(await ae.json()).data?.is_pinned??!e.isPinned,J={...e,isPinned:Q};n(J),ge(J),Y(!1)}catch(V){O(V instanceof Error?V.message:"Не удалось изменить закрепление периода.")}finally{R(!1)}}};return y.useEffect(()=>{ke.current=!1,it()},[d]),y.useEffect(()=>{!j&&te.current&&(te.current=!1,oe())},[j]),y.useEffect(()=>{Oe>0&&oe()},[Oe]),y.useEffect(()=>{const b=ze(l);$(b),b.length===0&&M===Fe&&O(null)},[l,M]),t.jsxs(ht,{children:[t.jsx(xt,{title:Ee}),t.jsxs("div",{className:`relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-3 font-body text-[#1c1a17] dark:text-[#f7f3ee]${e.isClosed?" bg-emerald-50/70 dark:bg-emerald-950/20":""}`,children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:Ee}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:et})]}),e.isClosed&&t.jsx("div",{className:"flex-1 text-center text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:"Период закрыт"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[!e.isClosed&&t.jsx(se,{type:"button",onClick:()=>Le(!1),tone:e.isPinned?"danger":"success",disabled:B,className:"px-4 py-2",children:e.isPinned?"Открепить":"Закрепить"}),lt&&!e.isClosed&&t.jsx(se,{type:"button",onClick:()=>ne(!0),disabled:X,tone:"success",className:"px-4 py-2",children:"Закрыть период"}),t.jsx(se,{type:"button",onClick:dt,disabled:T,tone:"danger",className:"px-4 py-2",children:"Удалить"}),t.jsx(Xe,{href:Ae(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] lg:items-start animate-reveal",style:_t(120),children:[k&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),N&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:N}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Ie,{periodId:d,type:"income",children:t.jsx(Kt,{items:l,setItems:s,totalAmount:Se,onAdd:ot,showDelete:p,onToggleDelete:()=>g(b=>!b),onBlurField:oe,onAfterDelete:$e,invalidNameIds:U,readOnly:we})}),t.jsx(Ie,{periodId:d,type:"mandatory",children:t.jsx(Rt,{title:"Обязательные траты",items:c,setItems:m,showDelete:p,onToggleDelete:()=>g(b=>!b),totalLabel:"Итого обязательных",totalPlanned:_e,totalActual:Ze,totalDifference:Ne,idPrefix:"e",onBlurField:oe,onAfterDelete:$e,readOnly:we})}),t.jsx(Ie,{periodId:d,type:"external",children:t.jsx(Ht,{title:"Сторонние траты",items:u,setItems:f,showDelete:p,onToggleDelete:()=>g(b=>!b),totalLabel:"Итого сторонних",totalAmount:Qe,idPrefix:"o",onBlurField:oe,onAfterDelete:$e,readOnly:we})})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(It,{days:ue,startDate:a,endDate:i,isEditing:v,readOnly:we,onToggleEditing:()=>_(b=>!b),onStartDateChange:b=>{r(b),oe(!1,{startDate:b})},onEndDateChange:b=>{o(b),oe(!1,{endDate:b})},minStartDate:i?He(i,-3):void 0,maxStartDate:i,minEndDate:a,maxEndDate:a?He(a,3):void 0}),t.jsx(At,{href:`/periods/${d}/daily`}),t.jsx(Vt,{dailyAverage:tt,days:ue,totalIncome:Se,totalPlannedExpenses:_e,plannedPeriodSum:Be}),t.jsx(Gt,{actualRemaining:st,remainingDays:at,remainingDailyAverage:nt}),t.jsx(Tt,{plannedPeriodSum:Be,totalDifference:Ne,totalDailyExpenses:Ce,dailyActualAverage:Ye})]})]}),ee&&t.jsx(Ct,{currentTitle:A,onCancel:()=>Y(!1),onConfirm:()=>Le(!0),confirmDisabled:B}),I&&t.jsx(Dt,{onCancel:()=>ne(!1),onConfirm:ct,confirmDisabled:X}),ce&&t.jsx(bt,{onClose:()=>S(!1),onReload:()=>window.location.reload()}),C&&t.jsx(gt,{href:`/periods/${C.id}`,title:`${fe(C.start_date)} — ${fe(C.end_date)}`,subtitle:`${Ke(C.start_date,C.end_date)} дней · ${qe(C.start_date,C.end_date)}`,onClose:()=>{P(null),F(!1),be.current=null},onConfirm:()=>oe(!0,be.current??void 0),confirmDisabled:!K||j}),M&&t.jsx("div",{className:"relative z-10 rounded-lg border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:M})]})]})}export{is as default};
