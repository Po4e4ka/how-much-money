import{c as W,j as s,r as L,a as te}from"./app-BjXvd9MZ.js";import{T as se,a as le,b as ae}from"./app-layout-H1FX1yvC.js";import{b as ne}from"./createLucideIcon-WTV_5oX8.js";import{P as Y}from"./pill-button-Bhxpnh9Z.js";import{t as re,a as ie}from"./period-calculations-BKNJ4Fv5.js";const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ce=ne("CircleHelp",oe),Se=n=>{const e=W.c(3),{children:l,className:d}=n,t=`font-display text-2xl ${d??""}`;let a;return e[0]!==l||e[1]!==t?(a=s.jsx("div",{className:t,children:l}),e[0]=l,e[1]=t,e[2]=a):a=e[2],a};function de(n){const e=W.c(14),{text:l,ariaLabel:d}=n,[t,a]=L.useState(!1),[x,i]=L.useState(!1);let r,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=()=>{if(typeof window>"u")return;const y=window.matchMedia("(hover: none) and (pointer: coarse)"),N=()=>a(y.matches);return N(),y.addEventListener("change",N),()=>y.removeEventListener("change",N)},c=[],e[0]=r,e[1]=c):(r=e[0],c=e[1]),L.useEffect(r,c);const k=t?x:void 0,f=d??"Подсказка";let b;e[2]!==t?(b=()=>{t&&i(fe)},e[2]=t,e[3]=b):b=e[3];let v;e[4]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx(ce,{className:"h-4 w-4"}),e[4]=v):v=e[4];let h;e[5]!==f||e[6]!==b?(h=s.jsx(se,{asChild:!0,children:s.jsx("button",{type:"button","aria-label":f,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:b,children:v})}),e[5]=f,e[6]=b,e[7]=h):h=e[7];let o;e[8]!==l?(o=s.jsx(le,{className:"max-w-xs text-xs leading-relaxed",children:l}),e[8]=l,e[9]=o):o=e[9];let w;return e[10]!==k||e[11]!==h||e[12]!==o?(w=s.jsxs(ae,{open:k,onOpenChange:i,children:[h,o]}),e[10]=k,e[11]=h,e[12]=o,e[13]=w):w=e[13],w}function fe(n){return!n}const ue=n=>{const e=W.c(9),{children:l,className:d,tooltipText:t,tooltipAriaLabel:a}=n,x=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${d??""}`;let i;e[0]!==l?(i=s.jsx("span",{children:l}),e[0]=l,e[1]=i):i=e[1];let r;e[2]!==a||e[3]!==t?(r=t?s.jsx("span",{className:"ml-2 inline-flex align-middle",children:s.jsx(de,{text:t,ariaLabel:a??"Дополнительная информация"})}):null,e[2]=a,e[3]=t,e[4]=r):r=e[4];let c;return e[5]!==x||e[6]!==i||e[7]!==r?(c=s.jsxs("div",{className:x,children:[i,r]}),e[5]=x,e[6]=i,e[7]=r,e[8]=c):c=e[8],c},me=n=>{const e=W.c(49),{value:l,placeholder:d,suggestions:t,disabled:a,onChange:x,onSelect:i,onBlur:r,header:c,className:k,containerClassName:f,inputClassName:b}=n,v=a===void 0?!1:a,h=c===void 0?"Подсказки":c,o=k===void 0?"":k,w=f===void 0?"":f,y=b===void 0?"":b,[N,C]=L.useState(!1),[u,j]=L.useState(0),I=L.useRef(null);let S,D;e[0]!==u||e[1]!==t.length?(S=()=>{u>=t.length&&t.length>0&&j(0)},D=[u,t.length],e[0]=u,e[1]=t.length,e[2]=S,e[3]=D):(S=e[2],D=e[3]),L.useEffect(S,D);let F;e:{if(!l){F="";break e}const m=t[u]??t[0];if(!m){F="";break e}if(!m.toLowerCase().startsWith(l.toLowerCase())){F="";break e}let V;e[4]!==m||e[5]!==l.length?(V=m.slice(l.length),e[4]=m,e[5]=l.length,e[6]=V):V=e[6],F=V}const M=F;let A;e[7]!==i?(A=m=>{i(m),j(0),requestAnimationFrame(()=>I.current?.focus())},e[7]=i,e[8]=A):A=e[8];const $=A;let O;e[9]!==$||e[10]!==u||e[11]!==t?(O=m=>{if(m.key==="Escape"){m.preventDefault(),C(!1),I.current?.blur();return}if(m.key==="Tab"&&t.length>0){m.preventDefault();const Z=m.shiftKey?-1:1,ee=(u+Z+t.length)%t.length;j(ee);return}if(m.key!=="Enter"||(m.preventDefault(),t.length===0))return;const V=t[u]??t[0];V&&$(V)},e[9]=$,e[10]=u,e[11]=t,e[12]=O):O=e[12];const G=O,P=N&&t.length>0&&!v,z=`relative ${o}`;let E;e[13]!==z?(E=z.trim(),e[13]=z,e[14]=E):E=e[14];const H=`relative flex items-center rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm ${w}`;let T;e[15]!==H?(T=H.trim(),e[15]=H,e[16]=T):T=e[16];let R;e[17]!==M||e[18]!==l?(R=M&&s.jsxs("span",{className:"pointer-events-none absolute left-3 top-1/2 z-10 -translate-y-1/2 text-[#6a5d52]/70 dark:text-white/40 sm:left-4",children:[s.jsx("span",{className:"invisible",children:l}),M]}),e[17]=M,e[18]=l,e[19]=R):R=e[19];let p;e[20]!==x?(p=m=>{x(m.target.value),j(0)},e[20]=x,e[21]=p):p=e[21];let U;e[22]===Symbol.for("react.memo_cache_sentinel")?(U=()=>{C(!0),j(0)},e[22]=U):U=e[22];let q;e[23]!==r?(q=()=>{C(!1),r()},e[23]=r,e[24]=q):q=e[24];const _=`relative z-20 w-full bg-transparent text-xs outline-none placeholder:text-[#6a5d52]/60 disabled:cursor-not-allowed disabled:opacity-70 dark:text-white dark:placeholder:text-white/40 sm:text-sm ${y}`;let g;e[25]!==_?(g=_.trim(),e[25]=_,e[26]=g):g=e[26];let B;e[27]!==v||e[28]!==G||e[29]!==d||e[30]!==p||e[31]!==q||e[32]!==g||e[33]!==l?(B=s.jsx("input",{ref:I,type:"text",placeholder:d,value:l,disabled:v,onChange:p,onKeyDown:G,onFocus:U,onBlur:q,className:g}),e[27]=v,e[28]=G,e[29]=d,e[30]=p,e[31]=q,e[32]=g,e[33]=l,e[34]=B):B=e[34];let K;e[35]!==T||e[36]!==R||e[37]!==B?(K=s.jsxs("div",{className:T,children:[R,B]}),e[35]=T,e[36]=R,e[37]=B,e[38]=K):K=e[38];let X;e[39]!==$||e[40]!==h||e[41]!==u||e[42]!==P||e[43]!==t?(X=P&&s.jsx("div",{className:"absolute left-0 right-0 z-30 mt-1",onMouseDown:xe,children:s.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/95 p-2 text-xs shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] backdrop-blur dark:border-white/10 dark:bg-[#1f1b17]/95",children:[s.jsx("div",{className:"px-2 py-1 text-[10px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:h}),s.jsx("div",{className:"flex flex-wrap gap-2 px-2 pb-2",children:t.map((m,V)=>s.jsx("button",{type:"button",onClick:()=>$(m),onMouseEnter:()=>j(V),className:["rounded-full border px-3 py-1 text-[11px] font-medium transition",V===u?"border-black/20 bg-black/10 text-[#1c1a17] dark:border-white/30 dark:bg-white/10 dark:text-white":"border-black/10 bg-black/5 text-[#1c1a17] hover:bg-black/10 dark:border-white/10 dark:bg-white/5 dark:text-white dark:hover:bg-white/10"].join(" "),children:m},m))})]})}),e[39]=$,e[40]=h,e[41]=u,e[42]=P,e[43]=t,e[44]=X):X=e[44];let J;return e[45]!==E||e[46]!==K||e[47]!==X?(J=s.jsxs("div",{className:E,children:[K,X]}),e[45]=E,e[46]=K,e[47]=X,e[48]=J):J=e[48],J};function xe(n){return n.preventDefault()}const Q=L.createContext(null),_e=({periodId:n,type:e,viewerId:l,disabled:d=!1,children:t})=>{const[a,x]=L.useState({previous:[],all:[]}),i=L.useMemo(()=>({previous:[],all:[]}),[]);L.useEffect(()=>{if(d)return;const c=new AbortController;return(async()=>{try{const f=new URLSearchParams({type:e});l&&f.set("viewer_id",l.toString());const b=await te(`/api/periods/${n}/expense-suggestions?${f.toString()}`,{signal:c.signal});x({previous:b.data?.previous??[],all:b.data?.all??[]})}catch(f){if(f instanceof DOMException&&f.name==="AbortError")return}})(),()=>c.abort()},[n,e,l,d]);const r=L.useMemo(()=>a,[a]);return d?s.jsx(Q.Provider,{value:i,children:t}):s.jsx(Q.Provider,{value:r,children:t})},he=()=>{const n=W.c(2),e=L.useContext(Q);let l;return n[0]!==e?(l=e??{previous:[],all:[]},n[0]=e,n[1]=l):l=n[1],l},pe=8,ge=n=>{const e=W.c(18),{value:l,placeholder:d,disabled:t,containerClassName:a,usedNames:x,onChange:i,onBlur:r}=n,c=t===void 0?!1:t;let k;e[0]!==x?(k=x===void 0?[]:x,e[0]=x,e[1]=k):k=e[1];const f=k,{previous:b,all:v}=he();let h;if(e[2]!==v||e[3]!==b||e[4]!==f||e[5]!==l){e:{const y=l.trim(),N=y.length>0?v:b;let C;e[7]!==f?(C=new Set(f.map(be).filter(we)),e[7]=f,e[8]=C):C=e[8];const u=C;if(N.length===0){let S;e[9]===Symbol.for("react.memo_cache_sentinel")?(S=[],e[9]=S):S=e[9],h=S;break e}const j=y.toLowerCase();h=N.filter(S=>{const D=S.toLowerCase();return u.has(D)?!1:j.length===0?!0:D.startsWith(j)}).slice(0,pe)}e[2]=v,e[3]=b,e[4]=f,e[5]=l,e[6]=h}else h=e[6];const o=h;let w;return e[10]!==a||e[11]!==c||e[12]!==r||e[13]!==i||e[14]!==d||e[15]!==o||e[16]!==l?(w=s.jsx(me,{value:l,placeholder:d,suggestions:o,disabled:c,onChange:i,onSelect:i,onBlur:r,header:"Подсказки",containerClassName:a}),e[10]=a,e[11]=c,e[12]=r,e[13]=i,e[14]=d,e[15]=o,e[16]=l,e[17]=w):w=e[17],w};function be(n){return n.trim().toLowerCase()}function we(n){return n.length>0}const $e=n=>{const e=W.c(56),{title:l,items:d,setItems:t,showDelete:a,onToggleDelete:x,totalLabel:i,totalAmount:r,idPrefix:c,onBlurField:k,onAfterDelete:f,readOnly:b,containerRef:v,addRowTargetRef:h}=n,o=b===void 0?!1:b;let w;e[0]!==l?(w=s.jsx(ue,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:l}),e[0]=l,e[1]=w):w=e[1];let y;e[2]!==c||e[3]!==t?(y=()=>t(p=>[...p,{id:`${c}${Date.now()}`,name:"",amount:""}]),e[2]=c,e[3]=t,e[4]=y):y=e[4];let N;e[5]!==o||e[6]!==y?(N=s.jsx(Y,{type:"button",onClick:y,disabled:o,children:"+ Строка"}),e[5]=o,e[6]=y,e[7]=N):N=e[7];let C;e[8]!==h||e[9]!==N?(C=s.jsx("div",{ref:h,children:N}),e[8]=h,e[9]=N,e[10]=C):C=e[10];let u;e[11]!==x||e[12]!==o||e[13]!==a?(u=s.jsx(Y,{type:"button",onClick:x,active:a,activeTone:"danger",disabled:o,children:"− Удаление"}),e[11]=x,e[12]=o,e[13]=a,e[14]=u):u=e[14];let j;e[15]!==C||e[16]!==u?(j=s.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[C,u]}),e[15]=C,e[16]=u,e[17]=j):j=e[17];let I;e[18]!==w||e[19]!==j?(I=s.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[w,j]}),e[18]=w,e[19]=j,e[20]=I):I=e[20];const S=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let D,F;e[21]===Symbol.for("react.memo_cache_sentinel")?(D=s.jsx("span",{children:"Название"}),F=s.jsx("span",{className:"text-right",children:"Сумма"}),e[21]=D,e[22]=F):(D=e[21],F=e[22]);let M;e[23]!==a?(M=a&&s.jsx("span",{className:"text-center",children:"—"}),e[23]=a,e[24]=M):M=e[24];let A;e[25]!==M||e[26]!==S?(A=s.jsxs("div",{className:S,children:[D,F,M]}),e[25]=M,e[26]=S,e[27]=A):A=e[27];let $;e[28]!==d||e[29]!==f||e[30]!==k||e[31]!==o||e[32]!==t||e[33]!==a?($=d.map((p,U)=>{const q=d.filter(_=>_.id!==p.id).map(ke);return s.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)_auto]":"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)]"}`,children:[s.jsx("div",{className:"min-w-0",children:s.jsx(ge,{value:p.name,placeholder:`Трата ${U+1}`,disabled:o,usedNames:q,onChange:_=>t(g=>g.map(B=>B.id===p.id?{...B,name:_}:B)),onBlur:k})}),s.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:p.amount,disabled:o,onChange:_=>{const g=_.target.value;t(B=>B.map(K=>K.id===p.id?{...K,amount:re(g)}:K))},onFocus:()=>{p.amount===0&&t(_=>_.map(g=>g.id===p.id?{...g,amount:""}:g))},onBlur:()=>{p.amount===""&&t(_=>_.map(g=>g.id===p.id?{...g,amount:0}:g)),k()},className:"no-spin w-full rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),a&&s.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(t(_=>_.filter(g=>g.id!==p.id)),f())},"aria-label":`Удалить трату ${U+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:o,children:"—"})]},p.id)}),e[28]=d,e[29]=f,e[30]=k,e[31]=o,e[32]=t,e[33]=a,e[34]=$):$=e[34];let O;e[35]!==$?(O=s.jsx("div",{className:"mt-3 grid gap-2",children:$}),e[35]=$,e[36]=O):O=e[36];const G=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)_auto]":"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)]"}`;let P;e[37]!==i?(P=s.jsx("span",{children:i}),e[37]=i,e[38]=P):P=e[38];let z;e[39]!==r?(z=ie(r),e[39]=r,e[40]=z):z=e[40];let E;e[41]!==z?(E=s.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:z}),e[41]=z,e[42]=E):E=e[42];let H;e[43]!==a?(H=a&&s.jsx("span",{}),e[43]=a,e[44]=H):H=e[44];let T;e[45]!==G||e[46]!==P||e[47]!==E||e[48]!==H?(T=s.jsxs("div",{className:G,children:[P,E,H]}),e[45]=G,e[46]=P,e[47]=E,e[48]=H,e[49]=T):T=e[49];let R;return e[50]!==v||e[51]!==A||e[52]!==O||e[53]!==T||e[54]!==I?(R=s.jsxs("div",{ref:v,className:"w-full min-w-0 overflow-hidden rounded-lg border border-black/10 bg-white/80 px-4 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10 sm:px-5",children:[I,A,O,T]}),e[50]=v,e[51]=A,e[52]=O,e[53]=T,e[54]=I,e[55]=R):R=e[55],R};function ke(n){return n.name}export{ue as B,_e as E,$e as O,Se as a,ge as b};
