import{c as J,j as t,r as w,L as qe,u as rt,H as it}from"./app-Dzp51NVV.js";import{T as ot,a as dt,b as ct,A as mt}from"./app-layout-z44Wcmjn.js";import{d as Ae}from"./index-CYtoQFCC.js";import{P as W,O as xt}from"./overlap-period-modal-C5rVfv0S.js";import{b as ft}from"./app-logo-icon-B6PMVmBd.js";import{a as te,b as pe,t as ue,d as ut,e as Be,h as pt,i as ht,j as Me,k as bt,l as we}from"./period-calculations-B9aBpp78.js";import{d as gt}from"./animation-DULAtfne.js";import{c as Re,b as xe,f as Le,a as ze}from"./date-C0FYGyP5.js";/* empty css            */import"./index-CJj_ylFk.js";import"./index-CjX2JUid.js";const yt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],wt=ft("CircleHelp",yt),jt=h=>{const e=J.c(14),{currentTitle:n,onConfirm:r,onCancel:a,confirmDisabled:s}=h,l=s===void 0?!1:s;let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx("h3",{className:"font-display text-2xl",children:"Закрепить другой период?"}),e[0]=i):i=e[0];const o=n?`Сейчас закреплён период ${n}. Закрепить этот вместо него?`:"Сейчас уже есть закреплённый период. Закрепить этот вместо него?";let d;e[1]!==o?(d=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:o}),e[1]=o,e[2]=d):d=e[2];let c;e[3]!==a?(c=t.jsx(W,{type:"button",onClick:a,className:"px-4 py-2",children:"Отмена"}),e[3]=a,e[4]=c):c=e[4];let p;e[5]!==l||e[6]!==r?(p=t.jsx(W,{type:"button",onClick:r,tone:"success",className:"px-4 py-2",disabled:l,children:"Закрепить"}),e[5]=l,e[6]=r,e[7]=p):p=e[7];let m;e[8]!==c||e[9]!==p?(m=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[c,p]}),e[8]=c,e[9]=p,e[10]=m):m=e[10];let x;return e[11]!==d||e[12]!==m?(x=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[i,d,m]})}),e[11]=d,e[12]=m,e[13]=x):x=e[13],x},kt=h=>{const e=J.c(10),{onConfirm:n,onCancel:r,confirmDisabled:a}=h,s=a===void 0?!1:a;let l,i;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("h3",{className:"font-display text-2xl",children:"Закрыть период?"}),i=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:"После закрытия период будет доступен только для просмотра. Редактировать данные больше нельзя."}),e[0]=l,e[1]=i):(l=e[0],i=e[1]);let o;e[2]!==r?(o=t.jsx(W,{type:"button",onClick:r,className:"px-4 py-2",children:"Отмена"}),e[2]=r,e[3]=o):o=e[3];let d;e[4]!==s||e[5]!==n?(d=t.jsx(W,{type:"button",onClick:n,tone:"success",className:"px-4 py-2",disabled:s,children:"Закрыть"}),e[4]=s,e[5]=n,e[6]=d):d=e[6];let c;return e[7]!==o||e[8]!==d?(c=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[l,i,t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[o,d]})]})}),e[7]=o,e[8]=d,e[9]=c):c=e[9],c};function _t(h){const e=J.c(14),{text:n,ariaLabel:r}=h,[a,s]=w.useState(!1),[l,i]=w.useState(!1);let o,d;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=()=>{if(typeof window>"u")return;const j=window.matchMedia("(hover: none) and (pointer: coarse)"),k=()=>s(j.matches);return k(),j.addEventListener("change",k),()=>j.removeEventListener("change",k)},d=[],e[0]=o,e[1]=d):(o=e[0],d=e[1]),w.useEffect(o,d);const c=a?l:void 0,p=r??"Подсказка";let m;e[2]!==a?(m=()=>{a&&i(vt)},e[2]=a,e[3]=m):m=e[3];let x;e[4]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(wt,{className:"h-4 w-4"}),e[4]=x):x=e[4];let g;e[5]!==p||e[6]!==m?(g=t.jsx(ot,{asChild:!0,children:t.jsx("button",{type:"button","aria-label":p,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:m,children:x})}),e[5]=p,e[6]=m,e[7]=g):g=e[7];let u;e[8]!==n?(u=t.jsx(dt,{className:"max-w-xs text-xs leading-relaxed",children:n}),e[8]=n,e[9]=u):u=e[9];let b;return e[10]!==c||e[11]!==g||e[12]!==u?(b=t.jsxs(ct,{open:c,onOpenChange:i,children:[g,u]}),e[10]=c,e[11]=g,e[12]=u,e[13]=b):b=e[13],b}function vt(h){return!h}const ne=h=>{const e=J.c(9),{children:n,className:r,tooltipText:a,tooltipAriaLabel:s}=h,l=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${r??""}`;let i;e[0]!==n?(i=t.jsx("span",{children:n}),e[0]=n,e[1]=i):i=e[1];let o;e[2]!==s||e[3]!==a?(o=a?t.jsx("span",{className:"ml-2 inline-flex align-middle",children:t.jsx(_t,{text:a,ariaLabel:s??"Дополнительная информация"})}):null,e[2]=s,e[3]=a,e[4]=o):o=e[4];let d;return e[5]!==l||e[6]!==i||e[7]!==o?(d=t.jsxs("div",{className:l,children:[i,o]}),e[5]=l,e[6]=i,e[7]=o,e[8]=d):d=e[8],d},Nt=h=>{const e=J.c(3),{href:n}=h;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(ne,{children:"Ежедневные траты"}),t.jsx(W,{as:"span",children:"Перейти к дневным значениям"})]}),e[0]=r):r=e[0];let a;return e[1]!==n?(a=t.jsx(qe,{href:n,prefetch:!0,className:"group rounded-lg border border-[#1e7b4f]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(30,123,79,0.55)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(30,123,79,0.65)] dark:border-[#7ce0b3]/30 dark:bg-white/10 dark:text-white",children:r}),e[1]=n,e[2]=a):a=e[2],a},Dt=h=>{const e=J.c(26),{days:n,startDate:r,endDate:a,isEditing:s,readOnly:l,onToggleEditing:i,onStartDateChange:o,onEndDateChange:d,minStartDate:c,maxStartDate:p,minEndDate:m,maxEndDate:x}=h;let g;e[0]===Symbol.for("react.memo_cache_sentinel")?(g=t.jsx(ne,{children:"Дни периода"}),e[0]=g):g=e[0];const u=s?"Готово":"Редактировать";let b;e[1]!==s||e[2]!==i||e[3]!==l||e[4]!==u?(b=t.jsxs("div",{className:"flex items-center justify-between",children:[g,t.jsx(W,{type:"button",onClick:i,active:s,activeTone:"success",disabled:l,children:u})]}),e[1]=s,e[2]=i,e[3]=l,e[4]=u,e[5]=b):b=e[5];let j;e[6]!==n?(j=t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:n}),e[6]=n,e[7]=j):j=e[7];let k;e[8]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"}),e[8]=k):k=e[8];let _;e[9]!==j?(_=t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[j,k]}),e[9]=j,e[10]=_):_=e[10];let y;e[11]!==a||e[12]!==s||e[13]!==x||e[14]!==p||e[15]!==m||e[16]!==c||e[17]!==d||e[18]!==o||e[19]!==l||e[20]!==r?(y=s&&t.jsxs("div",{className:"mt-3 grid gap-2 grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:r,disabled:l,onChange:C=>o(C.target.value),min:c,max:p,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:a,disabled:l,onChange:C=>d(C.target.value),min:m,max:x,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]})]}),e[11]=a,e[12]=s,e[13]=x,e[14]=p,e[15]=m,e[16]=c,e[17]=d,e[18]=o,e[19]=l,e[20]=r,e[21]=y):y=e[21];let N;return e[22]!==b||e[23]!==_||e[24]!==y?(N=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[b,_,y]}),e[22]=b,e[23]=_,e[24]=y,e[25]=N):N=e[25],N},Ke=h=>{const e=J.c(2),{className:n}=h,r=`h-px w-full bg-black/10 dark:bg-white/10 ${n??""}`;let a;return e[0]!==r?(a=t.jsx("div",{className:r}),e[0]=r,e[1]=a):a=e[1],a},Te=h=>{const e=J.c(3),{children:n,className:r}=h,a=`font-display text-2xl ${r??""}`;let s;return e[0]!==n||e[1]!==a?(s=t.jsx("div",{className:a,children:n}),e[0]=n,e[1]=a,e[2]=s):s=e[2],s},He=h=>{const e=J.c(3),{children:n,className:r}=h,a=`flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm ${r??""}`;let s;return e[0]!==n||e[1]!==a?(s=t.jsx("div",{className:a,children:n}),e[0]=n,e[1]=a,e[2]=s):s=e[2],s},ce=h=>{const e=J.c(3),{children:n,className:r}=h,a=`inline-flex items-center font-display tabular-nums leading-[0.9] ${r??""}`;let s;return e[0]!==n||e[1]!==a?(s=t.jsx("span",{className:a,children:n}),e[0]=n,e[1]=a,e[2]=s):s=e[2],s},je=h=>{const e=J.c(3),{children:n,className:r}=h,a=`inline-flex items-center leading-[0.9] relative -top-[1px] text-black/50 dark:text-white/60 ${r??""}`;let s;return e[0]!==n||e[1]!==a?(s=t.jsx("span",{className:a,children:n}),e[0]=n,e[1]=a,e[2]=s):s=e[2],s},Ct=h=>{const e=J.c(36),{plannedPeriodSum:n,totalDifference:r,totalDailyExpenses:a,dailyActualAverage:s}=h;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx(ne,{tooltipText:"Планируемый остаток +/− фактическая разница − ежедневные траты за период.",tooltipAriaLabel:"Формула фактического остатка",children:"Фактический остаток"}),e[0]=l):l=e[0];let i;e[1]!==n?(i=te(n),e[1]=n,e[2]=i):i=e[2];let o;e[3]!==i?(o=t.jsx(ce,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:i}),e[3]=i,e[4]=o):o=e[4];const d=`${r>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":r<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let c;if(e[5]!==r){let I;e[7]===Symbol.for("react.memo_cache_sentinel")?(I=/^([+−-])/,e[7]=I):I=e[7],c=pe(r).replace(I,"$1 "),e[5]=r,e[6]=c}else c=e[6];let p;e[8]!==d||e[9]!==c?(p=t.jsx(ce,{className:d,children:c}),e[8]=d,e[9]=c,e[10]=p):p=e[10];let m;e[11]===Symbol.for("react.memo_cache_sentinel")?(m=t.jsx(je,{children:"−"}),e[11]=m):m=e[11];let x;e[12]!==a?(x=te(a),e[12]=a,e[13]=x):x=e[13];let g;e[14]!==x?(g=t.jsx(ce,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:x}),e[14]=x,e[15]=g):g=e[15];let u;e[16]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(je,{children:"="}),e[16]=u):u=e[16];const b=`text-2xl ${n+r-a>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,j=n+r-a;let k;e[17]!==j?(k=pe(j),e[17]=j,e[18]=k):k=e[18];let _;e[19]!==b||e[20]!==k?(_=t.jsx(ce,{className:b,children:k}),e[19]=b,e[20]=k,e[21]=_):_=e[21];let y;e[22]!==_||e[23]!==o||e[24]!==p||e[25]!==g?(y=t.jsxs(He,{className:"mt-3",children:[o,p,m,g,u,_]}),e[22]=_,e[23]=o,e[24]=p,e[25]=g,e[26]=y):y=e[26];let N,C;e[27]===Symbol.for("react.memo_cache_sentinel")?(N=t.jsx(Ke,{className:"mt-4"}),C=t.jsx(ne,{className:"mt-4",children:"Фактическое среднее в день за период"}),e[27]=N,e[28]=C):(N=e[27],C=e[28]);let v;e[29]!==s?(v=te(s),e[29]=s,e[30]=v):v=e[30];let $;e[31]!==v?($=t.jsx(Te,{className:"mt-2",children:v}),e[31]=v,e[32]=$):$=e[32];let D;return e[33]!==y||e[34]!==$?(D=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[l,y,N,C,$]}),e[33]=y,e[34]=$,e[35]=D):D=e[35],D},St=h=>{const e=J.c(71),{title:n,items:r,setItems:a,showDelete:s,onToggleDelete:l,totalLabel:i,totalPlanned:o,totalActual:d,totalDifference:c,idPrefix:p,onBlurField:m,onAfterDelete:x,readOnly:g}=h,u=g===void 0?!1:g;let b;e[0]!==n?(b=t.jsx(ne,{children:n}),e[0]=n,e[1]=b):b=e[1];let j;e[2]!==p||e[3]!==a?(j=()=>a(de=>[...de,{id:`${p}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),e[2]=p,e[3]=a,e[4]=j):j=e[4];let k;e[5]!==u||e[6]!==j?(k=t.jsx(W,{type:"button",onClick:j,disabled:u,children:"+ Строка"}),e[5]=u,e[6]=j,e[7]=k):k=e[7];let _;e[8]!==l||e[9]!==u||e[10]!==s?(_=t.jsx(W,{type:"button",onClick:l,active:s,activeTone:"danger",disabled:u,children:"− Удаление"}),e[8]=l,e[9]=u,e[10]=s,e[11]=_):_=e[11];let y;e[12]!==k||e[13]!==_?(y=t.jsxs("div",{className:"flex items-center gap-2",children:[k,_]}),e[12]=k,e[13]=_,e[14]=y):y=e[14];let N;e[15]!==b||e[16]!==y?(N=t.jsxs("div",{className:"flex items-center justify-between",children:[b,y]}),e[15]=b,e[16]=y,e[17]=N):N=e[17];const C=`mt-3 grid items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let v,$,D;e[18]===Symbol.for("react.memo_cache_sentinel")?(D=t.jsxs("span",{children:[t.jsx("span",{className:"sm:hidden",children:"Название"}),t.jsx("span",{className:"hidden sm:inline",children:"Название"})]}),v=t.jsx("span",{className:"text-right",children:"План"}),$=t.jsx("span",{className:"text-right",children:"Факт"}),e[18]=v,e[19]=$,e[20]=D):(v=e[18],$=e[19],D=e[20]);let I;e[21]===Symbol.for("react.memo_cache_sentinel")?(I=t.jsxs("span",{className:"text-right",children:[t.jsx("span",{className:"sm:hidden",children:"Разн"}),t.jsx("span",{className:"hidden sm:inline",children:"Разница"})]}),e[21]=I):I=e[21];let K;e[22]!==s?(K=s&&t.jsx("span",{className:"text-center",children:"—"}),e[22]=s,e[23]=K):K=e[23];let M;e[24]!==K||e[25]!==C?(M=t.jsxs("div",{className:C,children:[D,v,$,I,K]}),e[24]=K,e[25]=C,e[26]=M):M=e[26];let B;if(e[27]!==r||e[28]!==x||e[29]!==m||e[30]!==u||e[31]!==a||e[32]!==s){let de;e[34]!==x||e[35]!==m||e[36]!==u||e[37]!==a||e[38]!==s?(de=(O,he)=>t.jsxs("div",{className:`grid items-center gap-2 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${he+1}`,value:O.name,disabled:u,onChange:H=>a(T=>T.map(ae=>ae.id===O.id?{...ae,name:H.target.value}:ae)),onBlur:m,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:O.plannedAmount,disabled:u,onChange:H=>{const T=H.target.value;a(ae=>ae.map(se=>se.id===O.id?{...se,plannedAmount:ue(T),actualAmount:se.actualTouched?se.actualAmount:ue(T)}:se))},onFocus:()=>{O.plannedAmount===0&&a(H=>H.map(T=>T.id===O.id?{...T,plannedAmount:""}:T))},onBlur:()=>{O.plannedAmount===""&&a(H=>H.map(T=>T.id===O.id?{...T,plannedAmount:0}:T)),m()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:O.actualAmount,disabled:u,onChange:H=>{const T=H.target.value;a(ae=>ae.map(se=>se.id===O.id?{...se,actualAmount:ue(T),actualTouched:!0}:se))},onFocus:()=>{O.actualAmount===0&&a(H=>H.map(T=>T.id===O.id?{...T,actualAmount:""}:T))},onBlur:()=>{O.actualAmount===""&&a(H=>H.map(T=>T.id===O.id?{...T,actualAmount:0}:T)),m()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("div",{className:`flex min-h-[36px] items-center justify-end px-0 py-2 text-xs tabular-nums sm:min-h-[40px] sm:px-4 sm:text-sm ${O.plannedAmount-O.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":O.plannedAmount-O.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:pe(O.plannedAmount-O.actualAmount)}),s&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(a(H=>H.filter(T=>T.id!==O.id)),x())},"aria-label":`Удалить трату ${he+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:u,children:"—"})]},O.id),e[34]=x,e[35]=m,e[36]=u,e[37]=a,e[38]=s,e[39]=de):de=e[39],B=r.map(de),e[27]=r,e[28]=x,e[29]=m,e[30]=u,e[31]=a,e[32]=s,e[33]=B}else B=e[33];let E;e[40]!==B?(E=t.jsx("div",{className:"mt-3 grid gap-2",children:B}),e[40]=B,e[41]=E):E=e[41];const Z=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let A;e[42]!==i?(A=t.jsx("span",{children:i}),e[42]=i,e[43]=A):A=e[43];let G;e[44]!==o?(G=te(o),e[44]=o,e[45]=G):G=e[45];let P;e[46]!==G?(P=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:G}),e[46]=G,e[47]=P):P=e[47];let S;e[48]!==d?(S=te(d),e[48]=d,e[49]=S):S=e[49];let X;e[50]!==S?(X=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:S}),e[50]=S,e[51]=X):X=e[51];const z=`text-right font-display text-sm tabular-nums ${c>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":c<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let R;e[52]!==c?(R=pe(c),e[52]=c,e[53]=R):R=e[53];let Q;e[54]!==z||e[55]!==R?(Q=t.jsx("span",{className:z,children:R}),e[54]=z,e[55]=R,e[56]=Q):Q=e[56];let Y;e[57]!==s?(Y=s&&t.jsx("span",{}),e[57]=s,e[58]=Y):Y=e[58];let oe;e[59]!==Z||e[60]!==A||e[61]!==P||e[62]!==X||e[63]!==Q||e[64]!==Y?(oe=t.jsxs("div",{className:Z,children:[A,P,X,Q,Y]}),e[59]=Z,e[60]=A,e[61]=P,e[62]=X,e[63]=Q,e[64]=Y,e[65]=oe):oe=e[65];let le;return e[66]!==M||e[67]!==E||e[68]!==oe||e[69]!==N?(le=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[N,M,E,oe]}),e[66]=M,e[67]=E,e[68]=oe,e[69]=N,e[70]=le):le=e[70],le},$t=h=>{const e=J.c(51),{items:n,setItems:r,totalAmount:a,onAdd:s,showDelete:l,onToggleDelete:i,onBlurField:o,onAfterDelete:d,invalidNameIds:c,readOnly:p}=h,m=p===void 0?!1:p;let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(ne,{children:"Приход"}),e[0]=x):x=e[0];let g;e[1]!==s||e[2]!==m?(g=t.jsx(W,{type:"button",onClick:s,disabled:m,children:"+ Строка"}),e[1]=s,e[2]=m,e[3]=g):g=e[3];let u;e[4]!==i||e[5]!==m||e[6]!==l?(u=t.jsx(W,{type:"button",onClick:i,active:l,activeTone:"danger",disabled:m,children:"− Удаление"}),e[4]=i,e[5]=m,e[6]=l,e[7]=u):u=e[7];let b;e[8]!==g||e[9]!==u?(b=t.jsxs("div",{className:"flex items-center justify-between",children:[x,t.jsxs("div",{className:"flex items-center gap-2",children:[g,u]})]}),e[8]=g,e[9]=u,e[10]=b):b=e[10];const j=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let k,_;e[11]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx("span",{children:"Название"}),_=t.jsx("span",{className:"text-right",children:"Сумма"}),e[11]=k,e[12]=_):(k=e[11],_=e[12]);let y;e[13]!==l?(y=l&&t.jsx("span",{className:"text-center",children:"—"}),e[13]=l,e[14]=y):y=e[14];let N;e[15]!==j||e[16]!==y?(N=t.jsxs("div",{className:j,children:[k,_,y]}),e[15]=j,e[16]=y,e[17]=N):N=e[17];let C;if(e[18]!==c||e[19]!==n||e[20]!==d||e[21]!==o||e[22]!==m||e[23]!==r||e[24]!==l){let Z;e[26]!==c||e[27]!==d||e[28]!==o||e[29]!==m||e[30]!==r||e[31]!==l?(Z=(A,G)=>t.jsxs("div",{className:`grid items-center gap-2 ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Приход ${G+1}`,value:A.name,disabled:m,onChange:P=>r(S=>S.map(X=>X.id===A.id?{...X,name:P.target.value}:X)),onBlur:o,className:`rounded-lg border bg-white/90 px-3 py-2 text-xs dark:bg-white/10 sm:px-4 sm:text-sm ${c.includes(A.id)?"border-[#b0352b] dark:border-[#ff8b7c]":"border-black/10 dark:border-white/10"}`}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:A.amount,disabled:m,onChange:P=>{const S=P.target.value;r(X=>X.map(z=>z.id===A.id?{...z,amount:ue(S)}:z))},onFocus:()=>{A.amount===0&&r(P=>P.map(S=>S.id===A.id?{...S,amount:""}:S))},onBlur:()=>{A.amount===""&&r(P=>P.map(S=>S.id===A.id?{...S,amount:0}:S)),o()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),l&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(r(P=>P.filter(S=>S.id!==A.id)),d())},"aria-label":`Удалить приход ${G+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:m,children:"—"})]},A.id),e[26]=c,e[27]=d,e[28]=o,e[29]=m,e[30]=r,e[31]=l,e[32]=Z):Z=e[32],C=n.map(Z),e[18]=c,e[19]=n,e[20]=d,e[21]=o,e[22]=m,e[23]=r,e[24]=l,e[25]=C}else C=e[25];let v;e[33]!==C?(v=t.jsx("div",{className:"mt-3 grid gap-2",children:C}),e[33]=C,e[34]=v):v=e[34];const $=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let D;e[35]===Symbol.for("react.memo_cache_sentinel")?(D=t.jsx("span",{children:"Итого прихода"}),e[35]=D):D=e[35];let I;e[36]!==a?(I=te(a),e[36]=a,e[37]=I):I=e[37];let K;e[38]!==I?(K=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:I}),e[38]=I,e[39]=K):K=e[39];let M;e[40]!==l?(M=l&&t.jsx("span",{}),e[40]=l,e[41]=M):M=e[41];let B;e[42]!==$||e[43]!==K||e[44]!==M?(B=t.jsxs("div",{className:$,children:[D,K,M]}),e[42]=$,e[43]=K,e[44]=M,e[45]=B):B=e[45];let E;return e[46]!==N||e[47]!==v||e[48]!==B||e[49]!==b?(E=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[b,N,v,B]}),e[46]=N,e[47]=v,e[48]=B,e[49]=b,e[50]=E):E=e[50],E},Et=h=>{const e=J.c(58),{title:n,items:r,setItems:a,showDelete:s,onToggleDelete:l,totalLabel:i,totalAmount:o,idPrefix:d,onBlurField:c,onAfterDelete:p,readOnly:m}=h,x=m===void 0?!1:m;let g;e[0]!==n?(g=t.jsx(ne,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:n}),e[0]=n,e[1]=g):g=e[1];let u;e[2]!==d||e[3]!==a?(u=()=>a(P=>[...P,{id:`${d}${Date.now()}`,name:"",amount:""}]),e[2]=d,e[3]=a,e[4]=u):u=e[4];let b;e[5]!==x||e[6]!==u?(b=t.jsx(W,{type:"button",onClick:u,disabled:x,children:"+ Строка"}),e[5]=x,e[6]=u,e[7]=b):b=e[7];let j;e[8]!==l||e[9]!==x||e[10]!==s?(j=t.jsx(W,{type:"button",onClick:l,active:s,activeTone:"danger",disabled:x,children:"− Удаление"}),e[8]=l,e[9]=x,e[10]=s,e[11]=j):j=e[11];let k;e[12]!==b||e[13]!==j?(k=t.jsxs("div",{className:"flex items-center gap-2",children:[b,j]}),e[12]=b,e[13]=j,e[14]=k):k=e[14];let _;e[15]!==g||e[16]!==k?(_=t.jsxs("div",{className:"flex items-center justify-between",children:[g,k]}),e[15]=g,e[16]=k,e[17]=_):_=e[17];const y=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let N,C;e[18]===Symbol.for("react.memo_cache_sentinel")?(C=t.jsx("span",{children:"Название"}),N=t.jsx("span",{className:"text-right",children:"Сумма"}),e[18]=N,e[19]=C):(N=e[18],C=e[19]);let v;e[20]!==s?(v=s&&t.jsx("span",{className:"text-center",children:"—"}),e[20]=s,e[21]=v):v=e[21];let $;e[22]!==v||e[23]!==y?($=t.jsxs("div",{className:y,children:[C,N,v]}),e[22]=v,e[23]=y,e[24]=$):$=e[24];let D;if(e[25]!==r||e[26]!==p||e[27]!==c||e[28]!==x||e[29]!==a||e[30]!==s){let P;e[32]!==p||e[33]!==c||e[34]!==x||e[35]!==a||e[36]!==s?(P=(S,X)=>t.jsxs("div",{className:`grid items-center gap-2 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${X+1}`,value:S.name,disabled:x,onChange:z=>a(R=>R.map(Q=>Q.id===S.id?{...Q,name:z.target.value}:Q)),onBlur:c,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:S.amount,disabled:x,onChange:z=>{const R=z.target.value;a(Q=>Q.map(Y=>Y.id===S.id?{...Y,amount:ue(R)}:Y))},onFocus:()=>{S.amount===0&&a(z=>z.map(R=>R.id===S.id?{...R,amount:""}:R))},onBlur:()=>{S.amount===""&&a(z=>z.map(R=>R.id===S.id?{...R,amount:0}:R)),c()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),s&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(a(z=>z.filter(R=>R.id!==S.id)),p())},"aria-label":`Удалить трату ${X+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:x,children:"—"})]},S.id),e[32]=p,e[33]=c,e[34]=x,e[35]=a,e[36]=s,e[37]=P):P=e[37],D=r.map(P),e[25]=r,e[26]=p,e[27]=c,e[28]=x,e[29]=a,e[30]=s,e[31]=D}else D=e[31];let I;e[38]!==D?(I=t.jsx("div",{className:"mt-3 grid gap-2",children:D}),e[38]=D,e[39]=I):I=e[39];const K=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let M;e[40]!==i?(M=t.jsx("span",{children:i}),e[40]=i,e[41]=M):M=e[41];let B;e[42]!==o?(B=te(o),e[42]=o,e[43]=B):B=e[43];let E;e[44]!==B?(E=t.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:B}),e[44]=B,e[45]=E):E=e[45];let Z;e[46]!==s?(Z=s&&t.jsx("span",{}),e[46]=s,e[47]=Z):Z=e[47];let A;e[48]!==K||e[49]!==M||e[50]!==E||e[51]!==Z?(A=t.jsxs("div",{className:K,children:[M,E,Z]}),e[48]=K,e[49]=M,e[50]=E,e[51]=Z,e[52]=A):A=e[52];let G;return e[53]!==$||e[54]!==I||e[55]!==A||e[56]!==_?(G=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[_,$,I,A]}),e[53]=$,e[54]=I,e[55]=A,e[56]=_,e[57]=G):G=e[57],G},At=h=>{const e=J.c(35),{dailyAverage:n,days:r,totalIncome:a,totalPlannedExpenses:s,plannedPeriodSum:l}=h;let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx(ne,{tooltipText:"Приход − план = сумма в период",children:"Планируемая сумма на период"}),e[0]=i):i=e[0];let o;e[1]!==a?(o=te(a),e[1]=a,e[2]=o):o=e[2];let d;e[3]!==o?(d=t.jsx(ce,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:o}),e[3]=o,e[4]=d):d=e[4];let c;e[5]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(je,{children:"−"}),e[5]=c):c=e[5];let p;e[6]!==s?(p=te(s),e[6]=s,e[7]=p):p=e[7];let m;e[8]!==p?(m=t.jsx(ce,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:p}),e[8]=p,e[9]=m):m=e[9];let x;e[10]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(je,{children:"="}),e[10]=x):x=e[10];const g=`text-2xl ${l>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`;let u;e[11]!==l?(u=pe(l),e[11]=l,e[12]=u):u=e[12];let b;e[13]!==g||e[14]!==u?(b=t.jsx(ce,{className:g,children:u}),e[13]=g,e[14]=u,e[15]=b):b=e[15];let j;e[16]!==b||e[17]!==d||e[18]!==m?(j=t.jsxs("div",{className:"grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[i,t.jsxs(He,{children:[d,c,m,x,b]})]}),e[16]=b,e[17]=d,e[18]=m,e[19]=j):j=e[19];let k,_;e[20]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(Ke,{className:"mt-4"}),_=t.jsx(ne,{className:"mt-4",children:"Планируемое среднее в день"}),e[20]=k,e[21]=_):(k=e[20],_=e[21]);let y;e[22]!==l?(y=te(l),e[22]=l,e[23]=y):y=e[23];const N=r||0;let C;e[24]!==y||e[25]!==N?(C=t.jsxs("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:["(",y," / ",N," д.)"]}),e[24]=y,e[25]=N,e[26]=C):C=e[26];let v;e[27]!==n?(v=te(n),e[27]=n,e[28]=v):v=e[28];let $;e[29]!==v?($=t.jsx(Te,{className:"mt-3",children:v}),e[29]=v,e[30]=$):$=e[30];let D;return e[31]!==j||e[32]!==C||e[33]!==$?(D=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[j,k,_,C,$]}),e[31]=j,e[32]=C,e[33]=$,e[34]=D):D=e[34],D},Tt=h=>{const e=J.c(3),{children:n,className:r}=h,a=`mt-2 text-xs text-[#6a5d52] dark:text-white/60 ${r??""}`;let s;return e[0]!==n||e[1]!==a?(s=t.jsx("p",{className:a,children:n}),e[0]=n,e[1]=a,e[2]=s):s=e[2],s},It=h=>{const e=J.c(13),{actualRemaining:n,remainingDays:r,remainingDailyAverage:a}=h;let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsx(ne,{tooltipText:"Фактический остаток / количество незаполненных (непрошедших) дней",children:"Расчётное в день на оставшиеся дни"}),e[0]=s):s=e[0];let l;e[1]!==n?(l=te(n),e[1]=n,e[2]=l):l=e[2];const i=r||0;let o;e[3]!==l||e[4]!==i?(o=t.jsxs(Tt,{children:["(",l," / ",i," д.)"]}),e[3]=l,e[4]=i,e[5]=o):o=e[5];let d;e[6]!==a?(d=te(a),e[6]=a,e[7]=d):d=e[7];let c;e[8]!==d?(c=t.jsx(Te,{className:"mt-3",children:d}),e[8]=d,e[9]=c):c=e[9];let p;return e[10]!==o||e[11]!==c?(p=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[s,o,c]}),e[10]=o,e[11]=c,e[12]=p):p=e[12],p},Pt={id:0,startDate:"",endDate:"",incomes:[],expenses:[],offIncomeExpenses:[],dailyExpenses:{},isPinned:!1,isClosed:!1};function Xt(){const{periodId:h}=rt().props,[e,n]=w.useState(Pt),[r,a]=w.useState([]),[s,l]=w.useState(""),[i,o]=w.useState(""),[d,c]=w.useState([]),[p,m]=w.useState([]),[x,g]=w.useState({}),[u,b]=w.useState(!1),[j,k]=w.useState(!1),[_,y]=w.useState(!0),[N,C]=w.useState(null),[v,$]=w.useState(!1),[D,I]=w.useState(null),[K,M]=w.useState(!1),[B,E]=w.useState(null),[Z,A]=w.useState(!1),[G,P]=w.useState([]),[S,X]=w.useState(!1),[z,R]=w.useState(!1),[Q,Y]=w.useState(!1),[oe,le]=w.useState(!1),[de,O]=w.useState(!1),[he,H]=w.useState(),T=w.useRef(!1),[ae,se]=w.useState(0),Ie="Заполните названия прихода.",me=w.useRef(null),be=w.useRef(null),Pe=w.useMemo(()=>`period:${h}`,[h]),ke=w.useRef(!1),_e=w.useRef(!1),Ve=()=>typeof window>"u"?null:window.__periodCache?.[Pe]??null,ge=f=>{if(typeof window>"u")return;const L=window;L.__periodCache||(L.__periodCache={}),L.__periodCache[Pe]=f},{totalPlanned:ve,totalActual:Xe,totalDifference:Ne}=ut(d??[]),Je=Be(p??[]),De=Be(r??[]),fe=w.useMemo(()=>!s||!i?0:Re(s,i),[s,i]),Ce=w.useMemo(()=>pt(x),[x]),Se=w.useMemo(()=>ht(s,i,x),[x,s,i]),Ue=Se>0?Ce/Se:0,$e=w.useMemo(()=>!s||!i?"Период":`${xe(s)} — ${xe(i)}`,[s,i]),Ze=w.useMemo(()=>!s||!i?"":`${fe} дней · ${Le(s,i)}`,[fe,s,i]),{plannedPeriodSum:Oe,dailyAverage:Ge,actualRemaining:Qe,remainingDays:We,remainingDailyAverage:Ye,isDailyComplete:et}=bt({days:fe,totalIncome:De,totalPlannedExpenses:ve,totalDifference:Ne,totalDailyExpenses:Ce,filledDays:Se}),ye=e.isClosed;Ae().url,`${h}`;const tt=f=>!!(f&&f.id&&Array.isArray(f.incomes)&&Array.isArray(f.expenses)&&Array.isArray(f.offIncomeExpenses)),st=async()=>{if(_e.current)return;const f=Ve();if(!(tt(f)&&(n({...f,isClosed:!!f.isClosed}),a(f.incomes??[]),l(f.startDate??""),o(f.endDate??""),c(f.expenses??[]),m(f.offIncomeExpenses??[]),g(f.dailyExpenses??{}),me.current={startDate:f.startDate??"",endDate:f.endDate??""},y(!1),typeof navigator<"u"&&!navigator.onLine))&&!(ke.current&&(!navigator.onLine||!f))){_e.current=!0,y(!0),C(null);try{const L=await fetch(`/api/periods/${h}`);if(!L.ok)throw new Error("Не удалось загрузить период.");const V=(await L.json()).data,U={id:V.id,startDate:V.start_date,endDate:V.end_date,dailyExpenses:V.daily_expenses??{},isPinned:!!V.is_pinned,isClosed:!!V.is_closed,incomes:V.incomes.map(q=>({id:String(q.id),name:q.name,amount:q.amount})),expenses:V.expenses.map(q=>({id:String(q.id),name:q.name,plannedAmount:q.planned_amount,actualAmount:q.actual_amount,actualTouched:!1})),offIncomeExpenses:V.external_expenses.map(q=>({id:String(q.id),name:q.name,amount:q.amount}))};n(U),a(U.incomes),l(U.startDate),o(U.endDate),c(U.expenses),m(U.offIncomeExpenses),g(U.dailyExpenses),le(!1),H(void 0),me.current={startDate:U.startDate,endDate:U.endDate},ge(U),ke.current=!0}catch(L){C(L instanceof Error?L.message:"Не удалось загрузить период.")}finally{y(!1),_e.current=!1}}},re=async(f=!1,L)=>{if(e.isClosed)return;const ee=L?.startDate??s,V=L?.endDate??i,U=Me(r);if(U.length>0){P(U),E(Ie);return}if(v){T.current=!0;return}$(!0),E(null),A(!1);try{const q=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",ie=await fetch(`/api/periods/${h}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":q},body:JSON.stringify({start_date:ee,end_date:V,daily_expenses:x,force:f,incomes:r.filter(F=>F.name.trim()!=="").map(F=>({id:Number.isFinite(Number(F.id))?Number(F.id):void 0,name:F.name,amount:we(F.amount)})),expenses:d.filter(F=>F.name.trim()!=="").map(F=>({id:Number.isFinite(Number(F.id))?Number(F.id):void 0,name:F.name,planned_amount:we(F.plannedAmount),actual_amount:we(F.actualAmount)})),external_expenses:p.filter(F=>F.name.trim()!=="").map(F=>({id:Number.isFinite(Number(F.id))?Number(F.id):void 0,name:F.name,amount:we(F.amount)}))})});if(ie.status===409){const F=await ie.json();if(F.overlap){be.current={startDate:ee,endDate:V},I(F.overlap),M(!0),me.current&&(l(me.current.startDate),o(me.current.endDate));return}throw new Error("Период пересекается с существующим.")}if(!ie.ok){if(ie.status===423){const F=await ie.json();throw new Error(F.message??"Период закрыт и не редактируется.")}throw new Error("Не удалось сохранить период.")}l(ee),o(V),A(!0),I(null),M(!1),be.current=null,me.current={startDate:ee,endDate:V},ge({id:Number(h),startDate:ee,endDate:V,incomes:r,expenses:d,offIncomeExpenses:p,dailyExpenses:x,isPinned:e.isPinned,isClosed:e.isClosed})}catch(q){E(q instanceof Error?q.message:"Не удалось сохранить период.")}finally{$(!1)}},at=()=>{e.isClosed||(a(f=>[...f,{id:`i${Date.now()}`,name:"",amount:""}]),re())},Ee=()=>{se(f=>f+1)},nt=async()=>{if(!S&&window.confirm("Удалить период?")){X(!0),E(null);try{const f=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch(`/api/periods/${h}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":f}})).ok)throw new Error("Не удалось удалить период.");window.location.href=Ae().url}catch(f){E(f instanceof Error?f.message:"Не удалось удалить период.")}finally{X(!1)}}},lt=async()=>{if(!(Q||e.isClosed)){Y(!0),E(null);try{const f=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",L=await fetch(`/api/periods/${h}/close`,{method:"POST",headers:{"X-CSRF-TOKEN":f}});if(!L.ok){const U=await L.json();throw new Error(U.message??"Не удалось закрыть период.")}const ee=await L.json(),V={...e,isClosed:ee.data?.is_closed??!0};n(V),O(!1),ge({id:Number(h),startDate:s,endDate:i,incomes:r,expenses:d,offIncomeExpenses:p,dailyExpenses:x,isPinned:e.isPinned,isClosed:V.isClosed})}catch(f){E(f instanceof Error?f.message:"Не удалось закрыть период.")}finally{Y(!1)}}},Fe=async(f=!1)=>{if(!z){R(!0);try{const L=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",ee=await fetch(`/api/periods/${h}/pin`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":L},body:JSON.stringify({pinned:!e.isPinned,force:f})});if(ee.status===409){const ie=await ee.json();ie.pinned?H(`${xe(ie.pinned.start_date)} — ${xe(ie.pinned.end_date)}`):H(void 0),le(!0);return}if(!ee.ok)throw new Error("Не удалось изменить закрепление периода.");const U=(await ee.json()).data?.is_pinned??!e.isPinned,q={...e,isPinned:U};n(q),ge(q),le(!1)}catch(L){E(L instanceof Error?L.message:"Не удалось изменить закрепление периода.")}finally{R(!1)}}};return w.useEffect(()=>{ke.current=!1,st()},[h]),w.useEffect(()=>{!v&&T.current&&(T.current=!1,re())},[v]),w.useEffect(()=>{ae>0&&re()},[ae]),w.useEffect(()=>{const f=Me(r);P(f),f.length===0&&B===Ie&&E(null)},[r,B]),t.jsxs(mt,{children:[t.jsx(it,{title:$e}),t.jsxs("div",{className:`relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-3 font-body text-[#1c1a17] dark:text-[#f7f3ee]${e.isClosed?" bg-emerald-50/70 dark:bg-emerald-950/20":""}`,children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:$e}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:Ze})]}),e.isClosed&&t.jsx("div",{className:"flex-1 text-center text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:"Период закрыт"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[!e.isClosed&&t.jsx(W,{type:"button",onClick:()=>Fe(!1),tone:e.isPinned?"danger":"success",disabled:z,className:"px-4 py-2",children:e.isPinned?"Открепить":"Закрепить"}),et&&!e.isClosed&&t.jsx(W,{type:"button",onClick:()=>O(!0),disabled:Q,tone:"success",className:"px-4 py-2",children:"Закрыть период"}),t.jsx(W,{type:"button",onClick:nt,disabled:S,tone:"danger",className:"px-4 py-2",children:"Удалить"}),t.jsx(qe,{href:Ae(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] lg:items-start animate-reveal",style:gt(120),children:[_&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),N&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:N}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none lg:self-start",children:[t.jsx($t,{items:r,setItems:a,totalAmount:De,onAdd:at,showDelete:u,onToggleDelete:()=>b(f=>!f),onBlurField:re,onAfterDelete:Ee,invalidNameIds:G,readOnly:ye}),t.jsx(St,{title:"Обязательные траты",items:d,setItems:c,showDelete:u,onToggleDelete:()=>b(f=>!f),totalLabel:"Итого обязательных",totalPlanned:ve,totalActual:Xe,totalDifference:Ne,idPrefix:"e",onBlurField:re,onAfterDelete:Ee,readOnly:ye}),t.jsx(Et,{title:"Сторонние траты",items:p,setItems:m,showDelete:u,onToggleDelete:()=>b(f=>!f),totalLabel:"Итого сторонних",totalAmount:Je,idPrefix:"o",onBlurField:re,onAfterDelete:Ee,readOnly:ye})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Dt,{days:fe,startDate:s,endDate:i,isEditing:j,readOnly:ye,onToggleEditing:()=>k(f=>!f),onStartDateChange:f=>{l(f),re(!1,{startDate:f})},onEndDateChange:f=>{o(f),re(!1,{endDate:f})},minStartDate:i?ze(i,-3):void 0,maxStartDate:i,minEndDate:s,maxEndDate:s?ze(s,3):void 0}),t.jsx(Nt,{href:`/periods/${h}/daily`}),t.jsx(At,{dailyAverage:Ge,days:fe,totalIncome:De,totalPlannedExpenses:ve,plannedPeriodSum:Oe}),t.jsx(It,{actualRemaining:Qe,remainingDays:We,remainingDailyAverage:Ye}),t.jsx(Ct,{plannedPeriodSum:Oe,totalDifference:Ne,totalDailyExpenses:Ce,dailyActualAverage:Ue})]})]}),oe&&t.jsx(jt,{currentTitle:he,onCancel:()=>le(!1),onConfirm:()=>Fe(!0),confirmDisabled:z}),de&&t.jsx(kt,{onCancel:()=>O(!1),onConfirm:lt,confirmDisabled:Q}),D&&t.jsx(xt,{href:`/periods/${D.id}`,title:`${xe(D.start_date)} — ${xe(D.end_date)}`,subtitle:`${Re(D.start_date,D.end_date)} дней · ${Le(D.start_date,D.end_date)}`,onClose:()=>{I(null),M(!1),be.current=null},onConfirm:()=>re(!0,be.current??void 0),confirmDisabled:!K||v}),B&&t.jsx("div",{className:"relative z-10 rounded-lg border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:B})]})]})}export{Xt as default};
