import{c as G,j as l,r as D,a as te}from"./app-BFaXAPnN.js";import{T as se,a as le,b as ae}from"./app-layout-DZMWa7-H.js";import{e as ne}from"./index-Df2C-eH2.js";import{P as Q}from"./pill-button-DF0kvo2f.js";import{t as re,a as ie}from"./period-calculations-CUCDjb88.js";const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ce=ne("CircleHelp",oe),Se=n=>{const e=G.c(3),{children:s,className:f}=n,t=`font-display text-2xl ${f??""}`;let a;return e[0]!==s||e[1]!==t?(a=l.jsx("div",{className:t,children:s}),e[0]=s,e[1]=t,e[2]=a):a=e[2],a};function de(n){const e=G.c(14),{text:s,ariaLabel:f}=n,[t,a]=D.useState(!1),[m,i]=D.useState(!1);let c,r;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{if(typeof window>"u")return;const N=window.matchMedia("(hover: none) and (pointer: coarse)"),C=()=>a(N.matches);return C(),N.addEventListener("change",C),()=>N.removeEventListener("change",C)},r=[],e[0]=c,e[1]=r):(c=e[0],r=e[1]),D.useEffect(c,r);const x=t?m:void 0,j=f??"Подсказка";let y;e[2]!==t?(y=()=>{t&&i(ue)},e[2]=t,e[3]=y):y=e[3];let o;e[4]===Symbol.for("react.memo_cache_sentinel")?(o=l.jsx(ce,{className:"h-4 w-4"}),e[4]=o):o=e[4];let d;e[5]!==j||e[6]!==y?(d=l.jsx(se,{asChild:!0,children:l.jsx("button",{type:"button","aria-label":j,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:y,children:o})}),e[5]=j,e[6]=y,e[7]=d):d=e[7];let h;e[8]!==s?(h=l.jsx(le,{className:"max-w-xs text-xs leading-relaxed",children:s}),e[8]=s,e[9]=h):h=e[9];let p;return e[10]!==x||e[11]!==d||e[12]!==h?(p=l.jsxs(ae,{open:x,onOpenChange:i,children:[d,h]}),e[10]=x,e[11]=d,e[12]=h,e[13]=p):p=e[13],p}function ue(n){return!n}const fe=n=>{const e=G.c(9),{children:s,className:f,tooltipText:t,tooltipAriaLabel:a}=n,m=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${f??""}`;let i;e[0]!==s?(i=l.jsx("span",{children:s}),e[0]=s,e[1]=i):i=e[1];let c;e[2]!==a||e[3]!==t?(c=t?l.jsx("span",{className:"ml-2 inline-flex align-middle",children:l.jsx(de,{text:t,ariaLabel:a??"Дополнительная информация"})}):null,e[2]=a,e[3]=t,e[4]=c):c=e[4];let r;return e[5]!==m||e[6]!==i||e[7]!==c?(r=l.jsxs("div",{className:m,children:[i,c]}),e[5]=m,e[6]=i,e[7]=c,e[8]=r):r=e[8],r},me=n=>{const e=G.c(49),{value:s,placeholder:f,suggestions:t,disabled:a,onChange:m,onSelect:i,onBlur:c,header:r,className:x,containerClassName:j,inputClassName:y}=n,o=a===void 0?!1:a,d=r===void 0?"Подсказки":r,h=x===void 0?"":x,p=j===void 0?"":j,N=y===void 0?"":y,[C,S]=D.useState(!1),[g,_]=D.useState(0),R=D.useRef(null);let b,$;e[0]!==g||e[1]!==t.length?(b=()=>{g>=t.length&&t.length>0&&_(0)},$=[g,t.length],e[0]=g,e[1]=t.length,e[2]=b,e[3]=$):(b=e[2],$=e[3]),D.useEffect(b,$);let T;e:{if(!s){T="";break e}const u=t[g]??t[0];if(!u){T="";break e}if(!u.toLowerCase().startsWith(s.toLowerCase())){T="";break e}let P;e[4]!==u||e[5]!==s.length?(P=u.slice(s.length),e[4]=u,e[5]=s.length,e[6]=P):P=e[6],T=P}const B=T;let H;e[7]!==i?(H=u=>{i(u),_(0),requestAnimationFrame(()=>R.current?.focus())},e[7]=i,e[8]=H):H=e[8];const E=H;let I;e[9]!==E||e[10]!==g||e[11]!==t?(I=u=>{if(u.key==="Escape"){u.preventDefault(),S(!1),R.current?.blur();return}if(u.key==="Tab"&&t.length>0){u.preventDefault();const Z=u.shiftKey?-1:1,ee=(g+Z+t.length)%t.length;_(ee);return}if(u.key!=="Enter"||(u.preventDefault(),t.length===0))return;const P=t[g]??t[0];P&&E(P)},e[9]=E,e[10]=g,e[11]=t,e[12]=I):I=e[12];const M=I,O=C&&t.length>0&&!o,F=`relative ${h}`;let A;e[13]!==F?(A=F.trim(),e[13]=F,e[14]=A):A=e[14];const v=`relative flex items-center rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm ${p}`;let z;e[15]!==v?(z=v.trim(),e[15]=v,e[16]=z):z=e[16];let K;e[17]!==B||e[18]!==s?(K=B&&l.jsxs("span",{className:"pointer-events-none absolute left-3 top-1/2 z-10 -translate-y-1/2 text-[#6a5d52]/70 dark:text-white/40 sm:left-4",children:[l.jsx("span",{className:"invisible",children:s}),B]}),e[17]=B,e[18]=s,e[19]=K):K=e[19];let w;e[20]!==m?(w=u=>{m(u.target.value),_(0)},e[20]=m,e[21]=w):w=e[21];let k;e[22]===Symbol.for("react.memo_cache_sentinel")?(k=()=>{S(!0),_(0)},e[22]=k):k=e[22];let L;e[23]!==c?(L=()=>{S(!1),c()},e[23]=c,e[24]=L):L=e[24];const q=`relative z-20 w-full bg-transparent text-xs outline-none placeholder:text-[#6a5d52]/60 disabled:cursor-not-allowed disabled:opacity-70 dark:text-white dark:placeholder:text-white/40 sm:text-sm ${N}`;let U;e[25]!==q?(U=q.trim(),e[25]=q,e[26]=U):U=e[26];let V;e[27]!==o||e[28]!==M||e[29]!==f||e[30]!==w||e[31]!==L||e[32]!==U||e[33]!==s?(V=l.jsx("input",{ref:R,type:"text",placeholder:f,value:s,disabled:o,onChange:w,onKeyDown:M,onFocus:k,onBlur:L,className:U}),e[27]=o,e[28]=M,e[29]=f,e[30]=w,e[31]=L,e[32]=U,e[33]=s,e[34]=V):V=e[34];let W;e[35]!==z||e[36]!==K||e[37]!==V?(W=l.jsxs("div",{className:z,children:[K,V]}),e[35]=z,e[36]=K,e[37]=V,e[38]=W):W=e[38];let X;e[39]!==E||e[40]!==d||e[41]!==g||e[42]!==O||e[43]!==t?(X=O&&l.jsx("div",{className:"absolute left-0 right-0 z-30 mt-1",onMouseDown:xe,children:l.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/95 p-2 text-xs shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] backdrop-blur dark:border-white/10 dark:bg-[#1f1b17]/95",children:[l.jsx("div",{className:"px-2 py-1 text-[10px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:d}),l.jsx("div",{className:"flex flex-wrap gap-2 px-2 pb-2",children:t.map((u,P)=>l.jsx("button",{type:"button",onClick:()=>E(u),onMouseEnter:()=>_(P),className:["rounded-full border px-3 py-1 text-[11px] font-medium transition",P===g?"border-black/20 bg-black/10 text-[#1c1a17] dark:border-white/30 dark:bg-white/10 dark:text-white":"border-black/10 bg-black/5 text-[#1c1a17] hover:bg-black/10 dark:border-white/10 dark:bg-white/5 dark:text-white dark:hover:bg-white/10"].join(" "),children:u},u))})]})}),e[39]=E,e[40]=d,e[41]=g,e[42]=O,e[43]=t,e[44]=X):X=e[44];let J;return e[45]!==A||e[46]!==W||e[47]!==X?(J=l.jsxs("div",{className:A,children:[W,X]}),e[45]=A,e[46]=W,e[47]=X,e[48]=J):J=e[48],J};function xe(n){return n.preventDefault()}const Y=D.createContext(null),_e=({periodId:n,type:e,viewerId:s,children:f})=>{const[t,a]=D.useState({previous:[],all:[]});D.useEffect(()=>{const i=new AbortController;return(async()=>{try{const r=new URLSearchParams({type:e});s&&r.set("viewer_id",s.toString());const x=await te(`/api/periods/${n}/expense-suggestions?${r.toString()}`,{signal:i.signal});a({previous:x.data?.previous??[],all:x.data?.all??[]})}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return}})(),()=>i.abort()},[n,e,s]);const m=D.useMemo(()=>t,[t]);return l.jsx(Y.Provider,{value:m,children:f})},he=()=>{const n=G.c(2),e=D.useContext(Y);let s;return n[0]!==e?(s=e??{previous:[],all:[]},n[0]=e,n[1]=s):s=n[1],s},pe=8,ge=n=>{const e=G.c(18),{value:s,placeholder:f,disabled:t,containerClassName:a,usedNames:m,onChange:i,onBlur:c}=n,r=t===void 0?!1:t;let x;e[0]!==m?(x=m===void 0?[]:m,e[0]=m,e[1]=x):x=e[1];const j=x,{previous:y,all:o}=he();let d;if(e[2]!==o||e[3]!==y||e[4]!==j||e[5]!==s){e:{const N=s.trim(),C=N.length>0?o:y;let S;e[7]!==j?(S=new Set(j.map(be).filter(we)),e[7]=j,e[8]=S):S=e[8];const g=S;if(C.length===0){let b;e[9]===Symbol.for("react.memo_cache_sentinel")?(b=[],e[9]=b):b=e[9],d=b;break e}const _=N.toLowerCase();d=C.filter(b=>{const $=b.toLowerCase();return g.has($)?!1:_.length===0?!0:$.startsWith(_)}).slice(0,pe)}e[2]=o,e[3]=y,e[4]=j,e[5]=s,e[6]=d}else d=e[6];const h=d;let p;return e[10]!==a||e[11]!==r||e[12]!==c||e[13]!==i||e[14]!==f||e[15]!==h||e[16]!==s?(p=l.jsx(me,{value:s,placeholder:f,suggestions:h,disabled:r,onChange:i,onSelect:i,onBlur:c,header:"Подсказки",containerClassName:a}),e[10]=a,e[11]=r,e[12]=c,e[13]=i,e[14]=f,e[15]=h,e[16]=s,e[17]=p):p=e[17],p};function be(n){return n.trim().toLowerCase()}function we(n){return n.length>0}const $e=n=>{const e=G.c(52),{title:s,items:f,setItems:t,showDelete:a,onToggleDelete:m,totalLabel:i,totalAmount:c,idPrefix:r,onBlurField:x,onAfterDelete:j,readOnly:y}=n,o=y===void 0?!1:y;let d;e[0]!==s?(d=l.jsx(fe,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:s}),e[0]=s,e[1]=d):d=e[1];let h;e[2]!==r||e[3]!==t?(h=()=>t(v=>[...v,{id:`${r}${Date.now()}`,name:"",amount:""}]),e[2]=r,e[3]=t,e[4]=h):h=e[4];let p;e[5]!==o||e[6]!==h?(p=l.jsx(Q,{type:"button",onClick:h,disabled:o,children:"+ Строка"}),e[5]=o,e[6]=h,e[7]=p):p=e[7];let N;e[8]!==m||e[9]!==o||e[10]!==a?(N=l.jsx(Q,{type:"button",onClick:m,active:a,activeTone:"danger",disabled:o,children:"− Удаление"}),e[8]=m,e[9]=o,e[10]=a,e[11]=N):N=e[11];let C;e[12]!==p||e[13]!==N?(C=l.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[p,N]}),e[12]=p,e[13]=N,e[14]=C):C=e[14];let S;e[15]!==d||e[16]!==C?(S=l.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[d,C]}),e[15]=d,e[16]=C,e[17]=S):S=e[17];const g=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let _,R;e[18]===Symbol.for("react.memo_cache_sentinel")?(R=l.jsx("span",{children:"Название"}),_=l.jsx("span",{className:"text-right",children:"Сумма"}),e[18]=_,e[19]=R):(_=e[18],R=e[19]);let b;e[20]!==a?(b=a&&l.jsx("span",{className:"text-center",children:"—"}),e[20]=a,e[21]=b):b=e[21];let $;e[22]!==b||e[23]!==g?($=l.jsxs("div",{className:g,children:[R,_,b]}),e[22]=b,e[23]=g,e[24]=$):$=e[24];let T;e[25]!==f||e[26]!==j||e[27]!==x||e[28]!==o||e[29]!==t||e[30]!==a?(T=f.map((v,z)=>{const K=f.filter(w=>w.id!==v.id).map(ke);return l.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)_auto]":"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)]"}`,children:[l.jsx("div",{className:"min-w-0",children:l.jsx(ge,{value:v.name,placeholder:`Трата ${z+1}`,disabled:o,usedNames:K,onChange:w=>t(k=>k.map(L=>L.id===v.id?{...L,name:w}:L)),onBlur:x})}),l.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:v.amount,disabled:o,onChange:w=>{const k=w.target.value;t(L=>L.map(q=>q.id===v.id?{...q,amount:re(k)}:q))},onFocus:()=>{v.amount===0&&t(w=>w.map(k=>k.id===v.id?{...k,amount:""}:k))},onBlur:()=>{v.amount===""&&t(w=>w.map(k=>k.id===v.id?{...k,amount:0}:k)),x()},className:"no-spin w-full rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),a&&l.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(t(w=>w.filter(k=>k.id!==v.id)),j())},"aria-label":`Удалить трату ${z+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:o,children:"—"})]},v.id)}),e[25]=f,e[26]=j,e[27]=x,e[28]=o,e[29]=t,e[30]=a,e[31]=T):T=e[31];let B;e[32]!==T?(B=l.jsx("div",{className:"mt-3 grid gap-2",children:T}),e[32]=T,e[33]=B):B=e[33];const H=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)_auto]":"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)]"}`;let E;e[34]!==i?(E=l.jsx("span",{children:i}),e[34]=i,e[35]=E):E=e[35];let I;e[36]!==c?(I=ie(c),e[36]=c,e[37]=I):I=e[37];let M;e[38]!==I?(M=l.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:I}),e[38]=I,e[39]=M):M=e[39];let O;e[40]!==a?(O=a&&l.jsx("span",{}),e[40]=a,e[41]=O):O=e[41];let F;e[42]!==H||e[43]!==E||e[44]!==M||e[45]!==O?(F=l.jsxs("div",{className:H,children:[E,M,O]}),e[42]=H,e[43]=E,e[44]=M,e[45]=O,e[46]=F):F=e[46];let A;return e[47]!==$||e[48]!==B||e[49]!==F||e[50]!==S?(A=l.jsxs("div",{className:"w-full min-w-0 overflow-hidden rounded-lg border border-black/10 bg-white/80 px-4 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10 sm:px-5",children:[S,$,B,F]}),e[47]=$,e[48]=B,e[49]=F,e[50]=S,e[51]=A):A=e[51],A};function ke(n){return n.name}export{fe as B,_e as E,$e as O,Se as a,ge as b};
