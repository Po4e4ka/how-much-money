import{c as Z,j as t,L as ze,u as Nt,r as g,H as Dt,a as ge,i as ye}from"./app-BFaXAPnN.js";import{A as St}from"./app-layout-DZMWa7-H.js";import{d as Fe}from"./index-Df2C-eH2.js";import{P as W}from"./pill-button-DF0kvo2f.js";import{O as $t}from"./overlap-period-modal-D4JGPDZ6.js";import{B as se,a as Ne,b as st,E as Le,O as At}from"./off-income-block-BSE5mXsN.js";import{a as Q,e as fe,t as ve,h as Ge,b as We,i as Ct,j as Et,k as Xe,l as Pt,d as me}from"./period-calculations-CUCDjb88.js";import{S as It}from"./session-expired-modal-DsSDM7Mg.js";import{c as Ye,b as xe,f as et,a as tt,d as Tt}from"./date-ByBVlD4A.js";/* empty css            */import"./index-z7VGeFen.js";import"./index-8mPctj8f.js";import"./app-logo-icon-CuFaCK84.js";const Mt=m=>{const e=Z.c(14),{currentTitle:i,onConfirm:o,onCancel:a,confirmDisabled:s}=m,l=s===void 0?!1:s;let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsx("h3",{className:"font-display text-2xl",children:"Закрепить другой период?"}),e[0]=f):f=e[0];const x=i?`Сейчас закреплён период ${i}. Закрепить этот вместо него?`:"Сейчас уже есть закреплённый период. Закрепить этот вместо него?";let c;e[1]!==x?(c=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:x}),e[1]=x,e[2]=c):c=e[2];let n;e[3]!==a?(n=t.jsx(W,{type:"button",onClick:a,className:"px-4 py-2",children:"Отмена"}),e[3]=a,e[4]=n):n=e[4];let u;e[5]!==l||e[6]!==o?(u=t.jsx(W,{type:"button",onClick:o,tone:"success",className:"px-4 py-2",disabled:l,children:"Закрепить"}),e[5]=l,e[6]=o,e[7]=u):u=e[7];let r;e[8]!==n||e[9]!==u?(r=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[n,u]}),e[8]=n,e[9]=u,e[10]=r):r=e[10];let p;return e[11]!==c||e[12]!==r?(p=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[f,c,r]})}),e[11]=c,e[12]=r,e[13]=p):p=e[13],p},Ot=m=>{const e=Z.c(10),{onConfirm:i,onCancel:o,confirmDisabled:a}=m,s=a===void 0?!1:a;let l,f;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("h3",{className:"font-display text-2xl",children:"Закрыть период?"}),f=t.jsx("p",{className:"mt-3 text-sm text-[#6a5d52] dark:text-white/70",children:"После закрытия период будет доступен только для просмотра. Редактировать данные больше нельзя."}),e[0]=l,e[1]=f):(l=e[0],f=e[1]);let x;e[2]!==o?(x=t.jsx(W,{type:"button",onClick:o,className:"px-4 py-2",children:"Отмена"}),e[2]=o,e[3]=x):x=e[3];let c;e[4]!==s||e[5]!==i?(c=t.jsx(W,{type:"button",onClick:i,tone:"success",className:"px-4 py-2",disabled:s,children:"Закрыть"}),e[4]=s,e[5]=i,e[6]=c):c=e[6];let n;return e[7]!==x||e[8]!==c?(n=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-lg border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[l,f,t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[x,c]})]})}),e[7]=x,e[8]=c,e[9]=n):n=e[9],n},Bt=m=>{const e=Z.c(3),{href:i}=m;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(se,{children:"Ежедневные траты"}),t.jsx(W,{as:"span",children:"Перейти к дневным значениям"})]}),e[0]=o):o=e[0];let a;return e[1]!==i?(a=t.jsx(ze,{href:i,prefetch:!0,className:"group rounded-lg border border-[#1e7b4f]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(30,123,79,0.55)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(30,123,79,0.65)] dark:border-[#7ce0b3]/30 dark:bg-white/10 dark:text-white",children:o}),e[1]=i,e[2]=a):a=e[2],a},Rt=m=>{const e=Z.c(26),{days:i,startDate:o,endDate:a,isEditing:s,readOnly:l,onToggleEditing:f,onStartDateChange:x,onEndDateChange:c,minStartDate:n,maxStartDate:u,minEndDate:r,maxEndDate:p}=m;let k;e[0]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(se,{children:"Дни периода"}),e[0]=k):k=e[0];const h=s?"Готово":"Редактировать";let b;e[1]!==s||e[2]!==f||e[3]!==l||e[4]!==h?(b=t.jsxs("div",{className:"flex items-center justify-between",children:[k,t.jsx(W,{type:"button",onClick:f,active:s,activeTone:"success",disabled:l,children:h})]}),e[1]=s,e[2]=f,e[3]=l,e[4]=h,e[5]=b):b=e[5];let j;e[6]!==i?(j=t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:i}),e[6]=i,e[7]=j):j=e[7];let y;e[8]===Symbol.for("react.memo_cache_sentinel")?(y=t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"}),e[8]=y):y=e[8];let _;e[9]!==j?(_=t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[j,y]}),e[9]=j,e[10]=_):_=e[10];let v;e[11]!==a||e[12]!==s||e[13]!==p||e[14]!==u||e[15]!==r||e[16]!==n||e[17]!==c||e[18]!==x||e[19]!==l||e[20]!==o?(v=s&&t.jsxs("div",{className:"mt-3 grid gap-2 grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:o,disabled:l,onChange:D=>x(D.target.value),min:n,max:u,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:a,disabled:l,onChange:D=>c(D.target.value),min:r,max:p,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]})]}),e[11]=a,e[12]=s,e[13]=p,e[14]=u,e[15]=r,e[16]=n,e[17]=c,e[18]=x,e[19]=l,e[20]=o,e[21]=v):v=e[21];let N;return e[22]!==b||e[23]!==_||e[24]!==v?(N=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[b,_,v]}),e[22]=b,e[23]=_,e[24]=v,e[25]=N):N=e[25],N},Ue=m=>{const e=Z.c(2),{className:i}=m,o=`h-px w-full bg-black/10 dark:bg-white/10 ${i??""}`;let a;return e[0]!==o?(a=t.jsx("div",{className:o}),e[0]=o,e[1]=a):a=e[1],a},at=m=>{const e=Z.c(3),{children:i,className:o}=m,a=`flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm ${o??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("div",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},re=m=>{const e=Z.c(3),{children:i,className:o}=m,a=`inline-flex items-center font-display tabular-nums leading-[0.9] ${o??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("span",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},ue=m=>{const e=Z.c(3),{children:i,className:o}=m,a=`inline-flex items-center leading-[0.9] relative -top-[1px] text-black/50 dark:text-white/60 ${o??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("span",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},Ft=m=>{const e=Z.c(46),{plannedPeriodSum:i,totalDifference:o,totalDailyExpenses:a,unforeseenOverrun:s,actualRemaining:l,unforeseenRemaining:f,dailyActualAverage:x}=m;let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(se,{tooltipText:"Планируемый остаток +/− фактическая разница − ежедневные траты за период − перерасход непредвиденных (если есть).",tooltipAriaLabel:"Формула фактического остатка",children:"Фактический остаток"}),e[0]=c):c=e[0];let n;e[1]!==i?(n=Q(i),e[1]=i,e[2]=n):n=e[2];let u;e[3]!==n?(u=t.jsx(re,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:n}),e[3]=n,e[4]=u):u=e[4];const r=`${o>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":o<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let p;if(e[5]!==o){let S;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=/^([+−-])/,e[7]=S):S=e[7],p=fe(o).replace(S,"$1 "),e[5]=o,e[6]=p}else p=e[6];let k;e[8]!==r||e[9]!==p?(k=t.jsx(re,{className:r,children:p}),e[8]=r,e[9]=p,e[10]=k):k=e[10];let h;e[11]===Symbol.for("react.memo_cache_sentinel")?(h=t.jsx(ue,{children:"−"}),e[11]=h):h=e[11];let b;e[12]!==a?(b=Q(a),e[12]=a,e[13]=b):b=e[13];let j;e[14]!==b?(j=t.jsx(re,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:b}),e[14]=b,e[15]=j):j=e[15];let y;e[16]!==s?(y=s>0&&t.jsxs(t.Fragment,{children:[t.jsx(ue,{children:"−"}),t.jsx(re,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:Q(s)})]}),e[16]=s,e[17]=y):y=e[17];let _;e[18]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx(ue,{children:"="}),e[18]=_):_=e[18];const v=`text-2xl ${i+o-a-s>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`;let N;e[19]!==l?(N=fe(l),e[19]=l,e[20]=N):N=e[20];let D;e[21]!==v||e[22]!==N?(D=t.jsx(re,{className:v,children:N}),e[21]=v,e[22]=N,e[23]=D):D=e[23];let I;e[24]!==y||e[25]!==D||e[26]!==u||e[27]!==k||e[28]!==j?(I=t.jsxs(at,{className:"mt-3",children:[u,k,h,j,y,_,D]}),e[24]=y,e[25]=D,e[26]=u,e[27]=k,e[28]=j,e[29]=I):I=e[29];let M,L;e[30]===Symbol.for("react.memo_cache_sentinel")?(M=t.jsx(Ue,{className:"mt-3"}),L=t.jsx(se,{className:"mt-4",tooltipText:"Фактический остаток + остаток с непредвиденных.",tooltipAriaLabel:"Сумма остатков",children:"Остаток средств"}),e[30]=M,e[31]=L):(M=e[30],L=e[31]);const O=l+f;let $;e[32]!==O?($=fe(O),e[32]=O,e[33]=$):$=e[33];let A;e[34]!==$?(A=t.jsx(Ne,{className:"mt-2 text-base text-[#1e7b4f] dark:text-[#7ce0b3]",children:$}),e[34]=$,e[35]=A):A=e[35];let E,J;e[36]===Symbol.for("react.memo_cache_sentinel")?(E=t.jsx(Ue,{className:"mt-4"}),J=t.jsx(se,{className:"mt-4",children:"Фактическое среднее в день за период"}),e[36]=E,e[37]=J):(E=e[36],J=e[37]);let T;e[38]!==x?(T=Q(x),e[38]=x,e[39]=T):T=e[39];let U;e[40]!==T?(U=t.jsx(Ne,{className:"mt-2",children:T}),e[40]=T,e[41]=U):U=e[41];let q;return e[42]!==I||e[43]!==A||e[44]!==U?(q=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[c,I,M,L,A,E,J,U]}),e[42]=I,e[43]=A,e[44]=U,e[45]=q):q=e[45],q},Lt=m=>{const e=Z.c(65),{title:i,items:o,setItems:a,showDelete:s,onToggleDelete:l,totalLabel:f,totalPlanned:x,totalActual:c,totalDifference:n,idPrefix:u,onBlurField:r,onAfterDelete:p,readOnly:k}=m,h=k===void 0?!1:k;let b;e[0]!==i?(b=t.jsx(se,{children:i}),e[0]=i,e[1]=b):b=e[1];let j;e[2]!==u||e[3]!==a?(j=()=>a(C=>[...C,{id:`${u}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),e[2]=u,e[3]=a,e[4]=j):j=e[4];let y;e[5]!==h||e[6]!==j?(y=t.jsx(W,{type:"button",onClick:j,disabled:h,children:"+ Строка"}),e[5]=h,e[6]=j,e[7]=y):y=e[7];let _;e[8]!==l||e[9]!==h||e[10]!==s?(_=t.jsx(W,{type:"button",onClick:l,active:s,activeTone:"danger",disabled:h,children:"− Удаление"}),e[8]=l,e[9]=h,e[10]=s,e[11]=_):_=e[11];let v;e[12]!==y||e[13]!==_?(v=t.jsxs("div",{className:"flex items-center gap-2",children:[y,_]}),e[12]=y,e[13]=_,e[14]=v):v=e[14];let N;e[15]!==b||e[16]!==v?(N=t.jsxs("div",{className:"flex items-center justify-between",children:[b,v]}),e[15]=b,e[16]=v,e[17]=N):N=e[17];const D=`mt-3 grid items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let I,M,L;e[18]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsxs("span",{children:[t.jsx("span",{className:"sm:hidden",children:"Название"}),t.jsx("span",{className:"hidden sm:inline",children:"Название"})]}),I=t.jsx("span",{className:"text-right",children:"План"}),M=t.jsx("span",{className:"text-right",children:"Факт"}),e[18]=I,e[19]=M,e[20]=L):(I=e[18],M=e[19],L=e[20]);let O;e[21]===Symbol.for("react.memo_cache_sentinel")?(O=t.jsxs("span",{className:"text-right",children:[t.jsx("span",{className:"sm:hidden",children:"Разн"}),t.jsx("span",{className:"hidden sm:inline",children:"Разница"})]}),e[21]=O):O=e[21];let $;e[22]!==s?($=s&&t.jsx("span",{className:"text-center",children:"—"}),e[22]=s,e[23]=$):$=e[23];let A;e[24]!==$||e[25]!==D?(A=t.jsxs("div",{className:D,children:[L,I,M,O,$]}),e[24]=$,e[25]=D,e[26]=A):A=e[26];let E;e[27]!==o||e[28]!==p||e[29]!==r||e[30]!==h||e[31]!==a||e[32]!==s?(E=o.map((C,pe)=>{const je=o.filter(z=>z.id!==C.id).map(Ut);return t.jsxs("div",{className:`grid items-center gap-2 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(st,{value:C.name,placeholder:`Трата ${pe+1}`,disabled:h,usedNames:je,onChange:z=>a(P=>P.map(te=>te.id===C.id?{...te,name:z}:te)),onBlur:r}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:C.plannedAmount,disabled:h,onChange:z=>{const P=z.target.value;a(te=>te.map(X=>X.id===C.id?{...X,plannedAmount:ve(P),actualAmount:X.actualTouched?X.actualAmount:ve(P)}:X))},onFocus:()=>{C.plannedAmount===0&&a(z=>z.map(P=>P.id===C.id?{...P,plannedAmount:""}:P))},onBlur:()=>{C.plannedAmount===""&&a(z=>z.map(P=>P.id===C.id?{...P,plannedAmount:0}:P)),r()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:C.actualAmount,disabled:h,onChange:z=>{const P=z.target.value;a(te=>te.map(X=>X.id===C.id?{...X,actualAmount:ve(P),actualTouched:!0}:X))},onFocus:()=>{C.actualAmount===0&&a(z=>z.map(P=>P.id===C.id?{...P,actualAmount:""}:P))},onBlur:()=>{C.actualAmount===""&&a(z=>z.map(P=>P.id===C.id?{...P,actualAmount:0}:P)),r()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("div",{className:`flex min-h-[36px] items-center justify-end px-0 py-2 text-xs tabular-nums sm:min-h-[40px] sm:px-4 sm:text-sm ${C.plannedAmount-C.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":C.plannedAmount-C.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:fe(C.plannedAmount-C.actualAmount)}),s&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(a(z=>z.filter(P=>P.id!==C.id)),p())},"aria-label":`Удалить трату ${pe+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:h,children:"—"})]},C.id)}),e[27]=o,e[28]=p,e[29]=r,e[30]=h,e[31]=a,e[32]=s,e[33]=E):E=e[33];let J;e[34]!==E?(J=t.jsx("div",{className:"mt-3 grid gap-2",children:E}),e[34]=E,e[35]=J):J=e[35];const T=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${s?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let U;e[36]!==f?(U=t.jsx("span",{children:f}),e[36]=f,e[37]=U):U=e[37];let q;e[38]!==x?(q=Q(x),e[38]=x,e[39]=q):q=e[39];let S;e[40]!==q?(S=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:q}),e[40]=q,e[41]=S):S=e[41];let B;e[42]!==c?(B=Q(c),e[42]=c,e[43]=B):B=e[43];let G;e[44]!==B?(G=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:B}),e[44]=B,e[45]=G):G=e[45];const Y=`text-right font-display text-sm tabular-nums ${n>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":n<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let ee;e[46]!==n?(ee=fe(n),e[46]=n,e[47]=ee):ee=e[47];let K;e[48]!==Y||e[49]!==ee?(K=t.jsx("span",{className:Y,children:ee}),e[48]=Y,e[49]=ee,e[50]=K):K=e[50];let ie;e[51]!==s?(ie=s&&t.jsx("span",{}),e[51]=s,e[52]=ie):ie=e[52];let ne;e[53]!==T||e[54]!==U||e[55]!==S||e[56]!==G||e[57]!==K||e[58]!==ie?(ne=t.jsxs("div",{className:T,children:[U,S,G,K,ie]}),e[53]=T,e[54]=U,e[55]=S,e[56]=G,e[57]=K,e[58]=ie,e[59]=ne):ne=e[59];let oe;return e[60]!==A||e[61]!==J||e[62]!==ne||e[63]!==N?(oe=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[N,A,J,ne]}),e[60]=A,e[61]=J,e[62]=ne,e[63]=N,e[64]=oe):oe=e[64],oe};function Ut(m){return m.name}const zt=m=>{const e=Z.c(44),{items:i,setItems:o,totalAmount:a,onAdd:s,showDelete:l,onToggleDelete:f,onBlurField:x,onAfterDelete:c,invalidNameIds:n,readOnly:u}=m,r=u===void 0?!1:u;let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=t.jsx(se,{children:"Приход"}),e[0]=p):p=e[0];let k;e[1]!==s||e[2]!==r?(k=t.jsx(W,{type:"button",onClick:s,disabled:r,children:"+ Строка"}),e[1]=s,e[2]=r,e[3]=k):k=e[3];let h;e[4]!==f||e[5]!==r||e[6]!==l?(h=t.jsx(W,{type:"button",onClick:f,active:l,activeTone:"danger",disabled:r,children:"− Удаление"}),e[4]=f,e[5]=r,e[6]=l,e[7]=h):h=e[7];let b;e[8]!==k||e[9]!==h?(b=t.jsxs("div",{className:"flex items-center justify-between",children:[p,t.jsxs("div",{className:"flex items-center gap-2",children:[k,h]})]}),e[8]=k,e[9]=h,e[10]=b):b=e[10];const j=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let y,_;e[11]===Symbol.for("react.memo_cache_sentinel")?(y=t.jsx("span",{children:"Название"}),_=t.jsx("span",{className:"text-right",children:"Сумма"}),e[11]=y,e[12]=_):(y=e[11],_=e[12]);let v;e[13]!==l?(v=l&&t.jsx("span",{className:"text-center",children:"—"}),e[13]=l,e[14]=v):v=e[14];let N;e[15]!==j||e[16]!==v?(N=t.jsxs("div",{className:j,children:[y,_,v]}),e[15]=j,e[16]=v,e[17]=N):N=e[17];let D;e[18]!==n||e[19]!==i||e[20]!==c||e[21]!==x||e[22]!==r||e[23]!==o||e[24]!==l?(D=i.map((T,U)=>{const q=i.filter(S=>S.id!==T.id).map(Vt);return t.jsxs("div",{className:`grid items-center gap-2 ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx(st,{value:T.name,placeholder:`Приход ${U+1}`,disabled:r,usedNames:q,onChange:S=>o(B=>B.map(G=>G.id===T.id?{...G,name:S}:G)),onBlur:x,containerClassName:n.includes(T.id)?"border-[#b0352b] dark:border-[#ff8b7c]":""}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:T.amount,disabled:r,onChange:S=>{const B=S.target.value;o(G=>G.map(Y=>Y.id===T.id?{...Y,amount:ve(B)}:Y))},onFocus:()=>{T.amount===0&&o(S=>S.map(B=>B.id===T.id?{...B,amount:""}:B))},onBlur:()=>{T.amount===""&&o(S=>S.map(B=>B.id===T.id?{...B,amount:0}:B)),x()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),l&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(o(S=>S.filter(B=>B.id!==T.id)),c())},"aria-label":`Удалить приход ${U+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:r,children:"—"})]},T.id)}),e[18]=n,e[19]=i,e[20]=c,e[21]=x,e[22]=r,e[23]=o,e[24]=l,e[25]=D):D=e[25];let I;e[26]!==D?(I=t.jsx("div",{className:"mt-3 grid gap-2",children:D}),e[26]=D,e[27]=I):I=e[27];const M=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${l?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let L;e[28]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx("span",{children:"Итого прихода"}),e[28]=L):L=e[28];let O;e[29]!==a?(O=Q(a),e[29]=a,e[30]=O):O=e[30];let $;e[31]!==O?($=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:O}),e[31]=O,e[32]=$):$=e[32];let A;e[33]!==l?(A=l&&t.jsx("span",{}),e[33]=l,e[34]=A):A=e[34];let E;e[35]!==M||e[36]!==$||e[37]!==A?(E=t.jsxs("div",{className:M,children:[L,$,A]}),e[35]=M,e[36]=$,e[37]=A,e[38]=E):E=e[38];let J;return e[39]!==N||e[40]!==I||e[41]!==E||e[42]!==b?(J=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[b,N,I,E]}),e[39]=N,e[40]=I,e[41]=E,e[42]=b,e[43]=J):J=e[43],J};function Vt(m){return m.name}const Ht=m=>{const e=Z.c(41),{dailyAverage:i,days:o,totalIncome:a,totalPlannedExpenses:s,totalUnforeseenAllocated:l,plannedPeriodSum:f}=m;let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(se,{tooltipText:"Приход − план обязательных − выделено на непредвиденные = сумма в период",children:"Планируемая сумма на период"}),e[0]=x):x=e[0];let c;e[1]!==a?(c=Q(a),e[1]=a,e[2]=c):c=e[2];let n;e[3]!==c?(n=t.jsx(re,{className:"text-[#1e7b4f] dark:text-[#7ce0b3]",children:c}),e[3]=c,e[4]=n):n=e[4];let u;e[5]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(ue,{children:"−"}),e[5]=u):u=e[5];let r;e[6]!==s?(r=Q(s),e[6]=s,e[7]=r):r=e[7];let p;e[8]!==r?(p=t.jsx(re,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:r}),e[8]=r,e[9]=p):p=e[9];let k;e[10]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(ue,{children:"−"}),e[10]=k):k=e[10];let h;e[11]!==l?(h=Q(l),e[11]=l,e[12]=h):h=e[12];let b;e[13]!==h?(b=t.jsx(re,{className:"text-[#b0352b] dark:text-[#ff8b7c]",children:h}),e[13]=h,e[14]=b):b=e[14];let j;e[15]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(ue,{children:"="}),e[15]=j):j=e[15];const y=`text-2xl ${f>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`;let _;e[16]!==f?(_=fe(f),e[16]=f,e[17]=_):_=e[17];let v;e[18]!==y||e[19]!==_?(v=t.jsx(re,{className:y,children:_}),e[18]=y,e[19]=_,e[20]=v):v=e[20];let N;e[21]!==v||e[22]!==n||e[23]!==p||e[24]!==b?(N=t.jsxs("div",{className:"grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[x,t.jsxs(at,{children:[n,u,p,k,b,j,v]})]}),e[21]=v,e[22]=n,e[23]=p,e[24]=b,e[25]=N):N=e[25];let D,I;e[26]===Symbol.for("react.memo_cache_sentinel")?(D=t.jsx(Ue,{className:"mt-4"}),I=t.jsx(se,{className:"mt-4",children:"Планируемое среднее в день"}),e[26]=D,e[27]=I):(D=e[26],I=e[27]);let M;e[28]!==f?(M=Q(f),e[28]=f,e[29]=M):M=e[29];const L=o||0;let O;e[30]!==M||e[31]!==L?(O=t.jsxs("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:["(",M," / ",L," д.)"]}),e[30]=M,e[31]=L,e[32]=O):O=e[32];let $;e[33]!==i?($=Q(i),e[33]=i,e[34]=$):$=e[34];let A;e[35]!==$?(A=t.jsx(Ne,{className:"mt-3",children:$}),e[35]=$,e[36]=A):A=e[36];let E;return e[37]!==N||e[38]!==O||e[39]!==A?(E=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[N,D,I,O,A]}),e[37]=N,e[38]=O,e[39]=A,e[40]=E):E=e[40],E},Jt=m=>{const e=Z.c(3),{children:i,className:o}=m,a=`mt-2 text-xs text-[#6a5d52] dark:text-white/60 ${o??""}`;let s;return e[0]!==i||e[1]!==a?(s=t.jsx("p",{className:a,children:i}),e[0]=i,e[1]=a,e[2]=s):s=e[2],s},qt=m=>{const e=Z.c(13),{actualRemaining:i,remainingDays:o,remainingDailyAverage:a}=m;let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsx(se,{tooltipText:"Фактический остаток / количество незаполненных (непрошедших) дней",children:"Расчётное в день на оставшиеся дни"}),e[0]=s):s=e[0];let l;e[1]!==i?(l=Q(i),e[1]=i,e[2]=l):l=e[2];const f=o||0;let x;e[3]!==l||e[4]!==f?(x=t.jsxs(Jt,{children:["(",l," / ",f," д.)"]}),e[3]=l,e[4]=f,e[5]=x):x=e[5];let c;e[6]!==a?(c=Q(a),e[6]=a,e[7]=c):c=e[7];let n;e[8]!==c?(n=t.jsx(Ne,{className:"mt-3",children:c}),e[8]=c,e[9]=n):n=e[9];let u;return e[10]!==x||e[11]!==n?(u=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[s,x,n]}),e[10]=x,e[11]=n,e[12]=u):u=e[12],u},Kt=m=>{const e=Z.c(22),{href:i,allocated:o,spent:a}=m,s=o-a,l=Qt;let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(se,{children:"Непредвиденные расходы"}),t.jsx(W,{as:"span",children:"Открыть"})]}),e[0]=f):f=e[0];let x;e[1]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx("div",{className:"uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Выделено"}),e[1]=x):x=e[1];let c;e[2]!==o?(c=Q(o),e[2]=o,e[3]=c):c=e[3];let n;e[4]!==c?(n=t.jsxs("div",{children:[x,t.jsx("div",{className:"mt-1 font-display text-sm tabular-nums text-[#ffffff] dark:text-[#ffffff]",children:c})]}),e[4]=c,e[5]=n):n=e[5];let u;e[6]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx("div",{className:"uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Потрачено"}),e[6]=u):u=e[6];let r;e[7]!==a?(r=Q(a),e[7]=a,e[8]=r):r=e[8];let p;e[9]!==r?(p=t.jsxs("div",{children:[u,t.jsx("div",{className:"mt-1 font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:r})]}),e[9]=r,e[10]=p):p=e[10];let k;e[11]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx("div",{className:"uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Разница"}),e[11]=k):k=e[11];const h=`mt-1 font-display text-sm tabular-nums ${s<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#1e7b4f] dark:text-[#7ce0b3]"}`,b=l(s);let j;e[12]!==b||e[13]!==h?(j=t.jsxs("div",{children:[k,t.jsx("div",{className:h,children:b})]}),e[12]=b,e[13]=h,e[14]=j):j=e[14];let y;e[15]!==j||e[16]!==n||e[17]!==p?(y=t.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[n,p,j]}),e[15]=j,e[16]=n,e[17]=p,e[18]=y):y=e[18];let _;return e[19]!==i||e[20]!==y?(_=t.jsxs(ze,{href:i,prefetch:!0,className:"group rounded-lg border border-[#b0352b]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(176,53,43,0.45)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(176,53,43,0.6)] dark:border-[#ff8b7c]/30 dark:bg-white/10 dark:text-white",children:[f,y]}),e[19]=i,e[20]=y,e[21]=_):_=e[21],_};function Qt(m){const e=Math.round(m),i=Math.abs(e).toLocaleString("ru-RU");return e<0?`−${i} ₽`:`+${i} ₽`}const Zt={id:0,startDate:"",endDate:"",incomes:[],expenses:[],unforeseenExpenses:[],unforeseenAllocated:0,offIncomeExpenses:[],dailyExpenses:{},isPinned:!1,isClosed:!1};function os(){const{periodId:m,viewerId:e,viewerName:i,viewerEmail:o,viewerMode:a}=Nt().props,s=!!(e??a),[l,f]=g.useState(Zt),[x,c]=g.useState([]),[n,u]=g.useState(""),[r,p]=g.useState(""),[k,h]=g.useState([]),[b,j]=g.useState([]),[y,_]=g.useState(0),[v,N]=g.useState([]),[D,I]=g.useState({}),[M,L]=g.useState(!1),[O,$]=g.useState(!1),[A,E]=g.useState(!0),[J,T]=g.useState(null),[U,q]=g.useState(!1),[S,B]=g.useState(null),[G,Y]=g.useState(!1),[ee,K]=g.useState(null),[ie,ne]=g.useState(!1),[oe,C]=g.useState([]),[pe,je]=g.useState(!1),[z,P]=g.useState(!1),[te,X]=g.useState(!1),[nt,we]=g.useState(!1),[lt,De]=g.useState(!1),[rt,he]=g.useState(!1),[it,Se]=g.useState(),$e=g.useRef(!1),[Ve,dt]=g.useState(0),He="Заполните названия прихода.",ce=g.useRef(null),_e=g.useRef(null),Je=g.useMemo(()=>`period:${e??"self"}:${m}`,[m,e]),ae=g.useMemo(()=>e?`viewer_id=${e}`:"",[e]),Ae=g.useRef(!1),Ce=g.useRef(!1),ot=()=>typeof window>"u"?null:window.__periodCache?.[Je]??null,ke=d=>{if(typeof window>"u")return;const R=window;R.__periodCache||(R.__periodCache={}),R.__periodCache[Je]=d},{totalPlanned:Ee,totalActual:ct,totalDifference:Pe}=Ge(k??[]),{totalActual:Ie}=Ge(b??[]),mt=Math.max(0,y-Ie),xt=We(v??[]),Te=We(x??[]),be=g.useMemo(()=>!n||!r?0:Ye(n,r),[n,r]),Me=g.useMemo(()=>Ct(D),[D]),Oe=g.useMemo(()=>Et(n,r,D),[D,n,r]),ft=Oe>0?Me/Oe:0,Be=g.useMemo(()=>!n||!r?"Период":`${xe(n)} — ${xe(r)}`,[n,r]),ut=g.useMemo(()=>!n||!r?"":`${be} дней · ${et(n,r)}`,[be,n,r]),{plannedPeriodSum:qe,dailyAverage:pt,actualRemaining:Ke,unforeseenOverrun:ht,remainingDays:bt,remainingDailyAverage:gt,isDailyComplete:yt}=Pt({days:be,totalIncome:Te,totalPlannedExpenses:Ee,totalDifference:Pe,totalUnforeseenAllocated:y,totalUnforeseenSpent:Ie,totalDailyExpenses:Me,filledDays:Oe}),de=l.isClosed||s;Fe().url,`${m}`;const jt=d=>!!(d&&d.id&&Array.isArray(d.incomes)&&Array.isArray(d.expenses)&&Array.isArray(d.unforeseenExpenses)&&typeof d.unforeseenAllocated=="number"&&Array.isArray(d.offIncomeExpenses)),wt=async()=>{if(Ce.current)return;const d=ot();if(!(jt(d)&&(f({...d,isClosed:!!d.isClosed}),c(d.incomes??[]),u(d.startDate??""),p(d.endDate??""),h(d.expenses??[]),j(d.unforeseenExpenses??[]),_(d.unforeseenAllocated??0),N(d.offIncomeExpenses??[]),I(d.dailyExpenses??{}),ce.current={startDate:d.startDate??"",endDate:d.endDate??""},E(!1),typeof navigator<"u"&&!navigator.onLine))&&!(Ae.current&&(!navigator.onLine||!d))){Ce.current=!0,E(!0),T(null);try{const F=(await ge(`/api/periods/${m}${ae?`?${ae}`:""}`)).data,V={id:F.id,startDate:F.start_date,endDate:F.end_date,dailyExpenses:F.daily_expenses??{},unforeseenAllocated:Number(F.unforeseen_allocated??0),isPinned:!!F.is_pinned,isClosed:!!F.is_closed,incomes:F.incomes.map(H=>({id:String(H.id),name:H.name,amount:H.amount})),expenses:F.expenses.map(H=>({id:String(H.id),name:H.name,plannedAmount:H.planned_amount,actualAmount:H.actual_amount,actualTouched:!1})),unforeseenExpenses:F.unforeseen_expenses.map(H=>({id:String(H.id),name:H.name,plannedAmount:H.planned_amount,actualAmount:H.actual_amount,actualTouched:!1})),offIncomeExpenses:F.external_expenses.map(H=>({id:String(H.id),name:H.name,amount:H.amount}))};f(V),c(V.incomes),u(V.startDate),p(V.endDate),h(V.expenses),j(V.unforeseenExpenses),_(V.unforeseenAllocated),N(V.offIncomeExpenses),I(V.dailyExpenses),we(!1),Se(void 0),ce.current={startDate:V.startDate,endDate:V.endDate},ke(V),Ae.current=!0}catch(R){T(R instanceof Error?R.message:"Не удалось загрузить период.")}finally{E(!1),Ce.current=!1}}},le=async(d=!1,R)=>{if(de)return;const F=R?.startDate??n,V=R?.endDate??r,H=Xe(x);if(H.length>0){C(H),K(He);return}if(U){$e.current=!0;return}q(!0),K(null),ne(!1);try{await ge(`/api/periods/${m}${ae?`?${ae}`:""}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({start_date:F,end_date:V,daily_expenses:D,unforeseen_allocated:y,force:d,incomes:x.filter(w=>w.name.trim()!=="").map(w=>({id:Number.isFinite(Number(w.id))?Number(w.id):void 0,name:w.name,amount:me(w.amount)})),expenses:k.filter(w=>w.name.trim()!=="").map(w=>({id:Number.isFinite(Number(w.id))?Number(w.id):void 0,name:w.name,planned_amount:me(w.plannedAmount),actual_amount:me(w.actualAmount)})),unforeseen_expenses:b.filter(w=>w.name.trim()!=="").map(w=>({id:Number.isFinite(Number(w.id))?Number(w.id):void 0,name:w.name,planned_amount:me(w.plannedAmount),actual_amount:me(w.actualAmount)})),external_expenses:v.filter(w=>w.name.trim()!=="").map(w=>({id:Number.isFinite(Number(w.id))?Number(w.id):void 0,name:w.name,amount:me(w.amount)}))})}),u(F),p(V),ne(!0),B(null),Y(!1),_e.current=null,ce.current={startDate:F,endDate:V},ke({id:Number(m),startDate:F,endDate:V,incomes:x,expenses:k,unforeseenExpenses:b,unforeseenAllocated:y,offIncomeExpenses:v,dailyExpenses:D,isPinned:l.isPinned,isClosed:l.isClosed})}catch(w){if(ye(w)&&w.status===419){he(!0);return}if(ye(w)&&w.status===409&&w.data&&typeof w.data=="object"){const Ze=w.data.overlap;if(Ze){_e.current={startDate:F,endDate:V},B(Ze),Y(!0),ce.current&&(u(ce.current.startDate),p(ce.current.endDate));return}}K(w instanceof Error?w.message:"Не удалось сохранить период.")}finally{q(!1)}},_t=()=>{de||(c(d=>[...d,{id:`i${Date.now()}`,name:"",amount:""}]),le())},Re=()=>{dt(d=>d+1)},kt=async()=>{if(!s&&!pe&&window.confirm("Удалить период?")){je(!0),K(null);try{await ge(`/api/periods/${m}${ae?`?${ae}`:""}`,{method:"DELETE"}),window.location.href=e?`/shared/${e}`:Fe().url}catch(d){if(ye(d)&&d.status===419){he(!0);return}K(d instanceof Error?d.message:"Не удалось удалить период.")}finally{je(!1)}}},vt=async()=>{if(!(s||te||l.isClosed)){X(!0),K(null);try{const d=await ge(`/api/periods/${m}/close${ae?`?${ae}`:""}`,{method:"POST"}),R={...l,isClosed:d.data?.is_closed??!0};f(R),De(!1),ke({id:Number(m),startDate:n,endDate:r,incomes:x,expenses:k,unforeseenExpenses:b,unforeseenAllocated:y,offIncomeExpenses:v,dailyExpenses:D,isPinned:l.isPinned,isClosed:R.isClosed})}catch(d){if(ye(d)&&d.status===419){he(!0);return}K(d instanceof Error?d.message:"Не удалось закрыть период.")}finally{X(!1)}}},Qe=async(d=!1)=>{if(!(s||z)){P(!0);try{const F=(await ge(`/api/periods/${m}/pin${ae?`?${ae}`:""}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pinned:!l.isPinned,force:d})})).data?.is_pinned??!l.isPinned,V={...l,isPinned:F};f(V),ke(V),we(!1)}catch(R){if(ye(R)){if(R.status===419){he(!0);return}if(R.status===409&&R.data&&typeof R.data=="object"){const F=R.data.pinned;Se(F?`${xe(F.start_date)} — ${xe(F.end_date)}`:void 0),we(!0);return}}K(R instanceof Error?R.message:"Не удалось изменить закрепление периода.")}finally{P(!1)}}};return g.useEffect(()=>{Ae.current=!1,wt()},[m,e]),g.useEffect(()=>{!U&&$e.current&&($e.current=!1,le())},[U]),g.useEffect(()=>{Ve>0&&le()},[Ve]),g.useEffect(()=>{const d=Xe(x);C(d),d.length===0&&ee===He&&K(null)},[x,ee]),t.jsxs(St,{children:[t.jsx(Dt,{title:Be}),t.jsxs("div",{className:`relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-3 font-body text-[#1c1a17] dark:text-[#f7f3ee]${l.isClosed?" bg-emerald-50/70 dark:bg-emerald-950/20":""}`,children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:Be}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:ut})]}),l.isClosed&&t.jsx("div",{className:"flex-1 text-center text-sm font-semibold text-emerald-600 dark:text-emerald-300",children:"Период закрыт"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[!s&&!l.isClosed&&t.jsx(W,{type:"button",onClick:()=>Qe(!1),tone:l.isPinned?"danger":"success",disabled:z,className:"px-4 py-2",children:l.isPinned?"Открепить":"Закрепить"}),!s&&yt&&!l.isClosed&&t.jsx(W,{type:"button",onClick:()=>De(!0),disabled:te,tone:"success",className:"px-4 py-2",children:"Закрыть период"}),!s&&t.jsx(W,{type:"button",onClick:kt,disabled:pe,tone:"danger",className:"px-4 py-2",children:"Удалить"}),t.jsx(ze,{href:e?`/shared/${e}`:Fe(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),s&&t.jsxs("div",{className:"relative z-10 rounded-2xl border border-black/10 bg-white/70 px-4 py-3 text-sm text-[#1c1a17] shadow-[0_18px_36px_-26px_rgba(28,26,23,0.5)] dark:border-white/10 dark:bg-white/10 dark:text-white/80",children:["Просмотр периодов пользователя"," ",t.jsx("span",{className:"font-semibold",children:i||o||`#${e}`}),". Режим только чтение."]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] lg:items-start animate-reveal",style:Tt(120),children:[A&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),J&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:J}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Le,{periodId:m,type:"income",viewerId:e,children:t.jsx(zt,{items:x,setItems:c,totalAmount:Te,onAdd:_t,showDelete:M,onToggleDelete:()=>L(d=>!d),onBlurField:le,onAfterDelete:Re,invalidNameIds:oe,readOnly:de})}),t.jsx(Le,{periodId:m,type:"mandatory",viewerId:e,children:t.jsx(Lt,{title:"Обязательные траты",items:k,setItems:h,showDelete:M,onToggleDelete:()=>L(d=>!d),totalLabel:"Итого обязательных",totalPlanned:Ee,totalActual:ct,totalDifference:Pe,idPrefix:"e",onBlurField:le,onAfterDelete:Re,readOnly:de})}),t.jsx(Kt,{href:e?`/shared/${e}/periods/${m}/unforeseen`:`/periods/${m}/unforeseen`,allocated:y,spent:Ie}),t.jsx(Le,{periodId:m,type:"external",viewerId:e,children:t.jsx(At,{title:"Сторонние траты",items:v,setItems:N,showDelete:M,onToggleDelete:()=>L(d=>!d),totalLabel:"Итого сторонних",totalAmount:xt,idPrefix:"o",onBlurField:le,onAfterDelete:Re,readOnly:de})})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none lg:self-start",children:[t.jsx(Rt,{days:be,startDate:n,endDate:r,isEditing:O,readOnly:de,onToggleEditing:()=>$(d=>de?d:!d),onStartDateChange:d=>{u(d),le(!1,{startDate:d})},onEndDateChange:d=>{p(d),le(!1,{endDate:d})},minStartDate:r?tt(r,-3):void 0,maxStartDate:r,minEndDate:n,maxEndDate:n?tt(n,3):void 0}),t.jsx(Bt,{href:e?`/shared/${e}/periods/${m}/daily`:`/periods/${m}/daily`}),t.jsx(Ht,{dailyAverage:pt,days:be,totalIncome:Te,totalPlannedExpenses:Ee,totalUnforeseenAllocated:y,plannedPeriodSum:qe}),t.jsx(qt,{actualRemaining:Ke,remainingDays:bt,remainingDailyAverage:gt}),t.jsx(Ft,{plannedPeriodSum:qe,totalDifference:Pe,totalDailyExpenses:Me,unforeseenOverrun:ht,actualRemaining:Ke,unforeseenRemaining:mt,dailyActualAverage:ft})]})]}),nt&&t.jsx(Mt,{currentTitle:it,onCancel:()=>we(!1),onConfirm:()=>Qe(!0),confirmDisabled:z}),lt&&t.jsx(Ot,{onCancel:()=>De(!1),onConfirm:vt,confirmDisabled:te}),rt&&t.jsx(It,{onClose:()=>he(!1),onReload:()=>window.location.reload()}),!s&&S&&t.jsx($t,{href:`/periods/${S.id}`,title:`${xe(S.start_date)} — ${xe(S.end_date)}`,subtitle:`${Ye(S.start_date,S.end_date)} дней · ${et(S.start_date,S.end_date)}`,onClose:()=>{B(null),Y(!1),_e.current=null},onConfirm:()=>le(!0,_e.current??void 0),confirmDisabled:!G||U}),ee&&t.jsx("div",{className:"relative z-10 rounded-lg border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:ee})]})]})}export{os as default};
