import{r as s,j as e,H as Y}from"./app-BjXvd9MZ.js";import{i as M,a as Z,O as ee,m as te,b as ae,c as se,l as re}from"./onboarding-demo-banner-BDXBAO9f.js";import{O as de}from"./onboarding-tour-Dk0U5izO.js";import{O as ne}from"./overlap-period-modal-YuLTCluh.js";import{P as A}from"./period-list-ko3mehvk.js";import{a as H,i as o,c as K,f as V,b as f,d as b}from"./date-C0FYGyP5.js";/* empty css            */import"./index-BNdu6nsP.js";import"./pill-button-Bhxpnh9Z.js";const L=t=>{const i=o(t.start_date)&&o(t.end_date),r=i?K(t.start_date,t.end_date):0;return{title:i?`${f(t.start_date)} — ${f(t.end_date)}`:"Период",subtitle:i?`${r} дней · ${V(t.start_date,t.end_date)}`:"Даты не заданы"}},ie=t=>[...t].sort((i,r)=>{const x=new Date(i.start_date).getTime();return new Date(r.start_date).getTime()-x}),G=()=>ie(re().map(t=>({id:t.id,start_date:t.start_date,end_date:t.end_date,is_pinned:t.is_pinned,is_closed:t.is_closed,actual_remaining:t.actual_remaining})));function he(){const[t,i]=s.useState(""),[r,x]=s.useState(""),[u,j]=s.useState(!1),[k,h]=s.useState(null),[d,g]=s.useState(null),[q,w]=s.useState(!1),[c,N]=s.useState([]),[v,y]=s.useState(!0),[m,S]=s.useState(null),[C,J]=s.useState(()=>M()),[R,P]=s.useState(()=>M()&&!Z()),[Q,U]=s.useState(0),[p,W]=s.useState(null),D=s.useRef(null),I=s.useRef(null),O=s.useRef(null),_=s.useRef(null);s.useEffect(()=>{y(!0),S(null);try{N(G())}catch(a){S(a instanceof Error?a.message:"Не удалось загрузить периоды.")}finally{y(!1)}},[]);const $=async(a=!1)=>{if(!t||!r){h("Укажите даты начала и конца периода.");return}if(!a){const n=b(t),T=b(r),E=c.find(B=>{const z=b(B.start_date),F=b(B.end_date);return!Number.isFinite(n)||!Number.isFinite(T)||!Number.isFinite(z)||!Number.isFinite(F)?!1:n<F&&T>z});if(E){g(E),w(!0);return}}j(!0),h(null);try{const n=se(t,r);W(n.id),N(G()),i(""),x(""),g(null),w(!1)}catch(n){h(n instanceof Error?n.message:"Не удалось сохранить период.")}finally{j(!1)}},l=s.useMemo(()=>c.find(a=>a.is_pinned),[c]),X=s.useMemo(()=>[{stepId:"start-date",title:"Шаг 1",text:"Выберете старт периода",targetRef:D,placement:"top",nextCondition:!!t,autoAdvance:!0},{stepId:"end-date",title:"Шаг 2",text:"Теперь выберете дату окончания периода",targetRef:I,placement:"top",nextCondition:!!(t&&r),autoAdvance:!0},{stepId:"save",title:"Шаг 3",text:'Нажмите "Сохранить", чтобы завершить шаг онбординга',targetRef:O,placement:"top",nextCondition:!!p,autoAdvance:!0,hideNext:!0},{stepId:"open-created-period",title:"Шаг 4",text:"Нажмите на созданный период, чтобы открыть его",targetRef:_,placement:"top",captureClick:!0,hideNext:!0}],[t,r,p]);return e.jsxs("div",{className:"flex min-h-screen w-full flex-col",children:[e.jsx(Y,{title:"Onboarding"}),e.jsx(ee,{}),e.jsx("main",{className:"mx-auto flex h-full w-full max-w-7xl flex-1 flex-col gap-4 rounded-xl pt-16",children:e.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),e.jsx("section",{className:"relative z-10 flex flex-wrap items-end justify-between gap-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"mt-3 font-display text-3xl",children:"Периоды учета"}),e.jsx("p",{className:"mt-2 max-w-xl text-sm text-[#6a5d52] dark:text-white/70",children:"Добавьте новый период сверху и управляйте историей ниже. При клике откроется отдельная страница периода."})]})}),e.jsxs("section",{className:`relative rounded-[28px] border border-black/10 bg-white/85 p-6 shadow-[0_22px_44px_-28px_rgba(28,26,23,0.6)] backdrop-blur dark:border-white/10 dark:bg-white/10 ${R?"z-50":"z-10"}`,children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Новый период"}),e.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Добавить диапазон дат"})]})}),e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-[1fr_1fr_1fr]",children:[e.jsxs("label",{className:"relative z-[60] grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[e.jsx("span",{children:"С"}),e.jsx("input",{ref:D,type:"date",value:t,onChange:a=>i(a.target.value),min:r?H(r,-3):void 0,max:r||void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),e.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[e.jsx("span",{children:"По"}),e.jsx("input",{ref:I,type:"date",value:r,onChange:a=>x(a.target.value),min:t||void 0,max:t?H(t,3):void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx("button",{ref:O,className:"rounded-2xl bg-[#4e3f7f] px-4 py-3 text-sm font-semibold text-white shadow-[0_14px_28px_-18px_rgba(78,63,127,0.85)] transition hover:-translate-y-0.5 hover:bg-[#66529f] disabled:cursor-not-allowed disabled:opacity-70",type:"button",onClick:()=>{$(!1)},disabled:u,children:u?"Сохранение...":"Сохранить"})})]}),k&&e.jsx("p",{className:"mt-3 text-xs text-[#b0352b] dark:text-[#ff8b7c]",children:k})]}),e.jsxs("section",{className:"relative z-10 grid gap-4",children:[!!l&&e.jsxs("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Закреплённый период"}),e.jsx("div",{className:"mt-4",children:(()=>{if(!l)return null;const a=L(l);return e.jsx(A,{items:[{id:l.id,title:a.title,subtitle:a.subtitle,isClosed:!!l.is_closed,actualRemaining:l.actual_remaining??null,elementRef:l.id===p?_:void 0}],itemHref:n=>`/onboarding/periods/${n.id}`})})()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-2xl",children:"История периодов"}),e.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"Сначала новые"})]}),e.jsxs("div",{className:"grid gap-4",children:[v&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем периоды..."}),m&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:m}),!v&&!m&&c.length===0&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Периодов пока нет. Создайте первый диапазон выше."}),!v&&!m&&e.jsx(A,{items:c.map(a=>{const n=L(a);return{id:a.id,title:n.title,subtitle:n.subtitle,isClosed:!!a.is_closed,actualRemaining:a.actual_remaining??null,elementRef:a.id===p?_:void 0}}),itemHref:a=>`/onboarding/periods/${a.id}`})]})]}),d&&e.jsx(ne,{href:`/onboarding/periods/${d.id}`,title:o(d.start_date)&&o(d.end_date)?`${f(d.start_date)} — ${f(d.end_date)}`:"Период",subtitle:o(d.start_date)&&o(d.end_date)?`${K(d.start_date,d.end_date)} дней · ${V(d.start_date,d.end_date)}`:"Даты не заданы",onClose:()=>{g(null),w(!1)},onConfirm:()=>{$(!0)},confirmDisabled:!q||u})]})}),!C&&e.jsx("div",{className:"fixed inset-0 z-[95] flex items-center justify-center bg-black/62 p-6",children:e.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-[#b9a6ff]/50 bg-[#1b1227]/95 p-7 text-white shadow-[0_30px_70px_-35px_rgba(0,0,0,0.9)]",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-[#baa7ff]",children:"Онбординг"}),e.jsx("h2",{className:"mt-3 font-display text-3xl",children:"Пошаговая демо-инструкция"}),e.jsx("p",{className:"mt-3 text-sm text-white/80",children:"Вы пройдёте создание периода и открытие карточки периода. Подсказки будут вести по шагам, а данные сохраняются в рамках текущей сессии."}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{type:"button",className:"rounded-xl bg-[#7b67c5] px-5 py-3 text-sm font-semibold text-white transition hover:bg-[#8e79d8]",onClick:()=>{te(),J(!0),P(!0),U(a=>a+1)},children:"Начать"})})]})}),e.jsx(de,{open:C&&R,steps:X,onClose:()=>{ae(),P(!1)}},Q)]})}export{he as default};
