import{r as o,j as e,H as O,L as T}from"./app-CejraSsK.js";import{A as R}from"./app-layout-DlfsBc8O.js";import{d as Y}from"./index-BDqSilVs.js";/* empty css            */import"./app-logo-icon-D92xeSNN.js";import"./index-v4dAW1_0.js";import"./index-BR22Mtl-.js";const A=[{title:"Dashboard",href:Y().url}],C=t=>({"--delay":`${t}ms`}),L=t=>{const a=t?.trim()??"";return a?a.includes("T")?a.slice(0,10):a:""},c=t=>{const a=L(t);if(!a)return new Date("invalid");const[s,i,l]=a.split("-").map(Number);return new Date(s,(i??1)-1,l??1)},m=t=>{const a=c(t);return Number.isFinite(a.getTime())},k=t=>{const a=L(t);return a?Number(a.replaceAll("-","")):NaN},j=t=>{const a=c(t),s=String(a.getDate()).padStart(2,"0"),i=String(a.getMonth()+1).padStart(2,"0");return`${s}.${i}`},K=t=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(c(t)),M=(t,a)=>{const s=new Intl.DateTimeFormat("ru-RU",{month:"short"}),i=s.format(c(t)),l=s.format(c(a)),x=c(t).getFullYear(),p=c(a).getFullYear();return x===p?i===l?K(t):`${i}–${l} ${x}`:`${i} ${x} – ${l} ${p}`},P=(t,a)=>{const s=c(t),l=c(a).getTime()-s.getTime(),x=Math.floor(l/(1e3*60*60*24));return Math.max(1,x+1)};function G(){const[t,a]=o.useState(""),[s,i]=o.useState(""),[l,x]=o.useState(!1),[p,y]=o.useState(null),[n,u]=o.useState(null),[z,f]=o.useState(!1),[N,I]=o.useState([]),[v,_]=o.useState(!0),[w,D]=o.useState(null),S=async()=>{_(!0),D(null);try{const r=await fetch("/api/periods");if(!r.ok)throw new Error("Не удалось загрузить периоды.");const d=await r.json();I(d.data??[])}catch(r){D(r instanceof Error?r.message:"Не удалось загрузить периоды.")}finally{_(!1)}};o.useEffect(()=>{S()},[]);const $=async(r=!1)=>{if(!t||!s){y("Укажите даты начала и конца периода.");return}if(!r){const d=k(t),h=k(s),b=N.find(g=>{const E=k(g.start_date),F=k(g.end_date);return!Number.isFinite(d)||!Number.isFinite(h)||!Number.isFinite(E)||!Number.isFinite(F)?!1:d<F&&h>E});if(b){u(b),f(!0);return}}x(!0),y(null);try{const d=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",h=await fetch("/api/periods",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({start_date:t,end_date:s,force:!!r})});if(h.status===409){const b=await h.json();if(b.overlap){u(b.overlap),f(!0);return}throw new Error("Период пересекается с существующим.")}if(!h.ok)throw new Error("Не удалось сохранить период.");a(""),i(""),u(null),f(!1),await S()}catch(d){y(d instanceof Error?d.message:"Не удалось сохранить период.")}finally{x(!1)}};return e.jsxs(R,{breadcrumbs:A,children:[e.jsx(O,{title:"Dashboard"}),e.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),e.jsx("section",{className:"relative z-10 flex flex-wrap items-end justify-between gap-6",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Финансовый контур"}),e.jsx("h1",{className:"mt-3 font-display text-3xl",children:"Периоды учета"}),e.jsx("p",{className:"mt-2 max-w-xl text-sm text-[#6a5d52] dark:text-white/70",children:"Добавьте новый период сверху и управляйте историей ниже. При клике откроется отдельная страница периода."})]})}),e.jsxs("section",{className:"relative z-10 rounded-[28px] border border-black/10 bg-white/85 p-6 shadow-[0_22px_44px_-28px_rgba(28,26,23,0.6)] backdrop-blur animate-reveal dark:border-white/10 dark:bg-white/10",style:C(120),children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Новый период"}),e.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Добавить диапазон дат"})]})}),e.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-xs text-[#6a5d52] dark:text-white/70",children:["С",e.jsx("input",{type:"date",value:t,onChange:r=>a(r.target.value),className:"date-input rounded-2xl border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white"})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-xs text-[#6a5d52] dark:text-white/70",children:["По",e.jsx("input",{type:"date",value:s,onChange:r=>i(r.target.value),min:t||void 0,className:"date-input rounded-2xl border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white"})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx("button",{className:"rounded-2xl bg-[#d87a4a] px-4 py-3 text-sm font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] transition hover:-translate-y-0.5 disabled:cursor-not-allowed disabled:opacity-70",type:"button",onClick:()=>$(!1),disabled:l,children:l?"Сохранение...":"Сохранить"})})]}),p&&e.jsx("p",{className:"mt-3 text-xs text-[#b0352b] dark:text-[#ff8b7c]",children:p})]}),e.jsxs("section",{className:"relative z-10 grid gap-4 animate-reveal",style:C(240),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-2xl",children:"История периодов"}),e.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"Сначала новые"})]}),e.jsxs("div",{className:"grid gap-4",children:[v&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем периоды..."}),w&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:w}),!v&&!w&&N.length===0&&e.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Периодов пока нет. Создайте первый диапазон выше."}),!v&&!w&&N.map(r=>{const d=m(r.start_date)&&m(r.end_date),h=d?P(r.start_date,r.end_date):0,b=d?`${j(r.start_date)} — ${j(r.end_date)}`:"Период",g=d?`${h} дней · ${M(r.start_date,r.end_date)}`:"Даты не заданы";return e.jsx(T,{href:`/periods/${r.id}`,prefetch:!0,className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-xl",children:b}),e.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:g})]}),e.jsx("span",{className:"rounded-full border border-black/10 bg-white/80 px-3 py-1 text-xs text-[#1c1a17] dark:border-white/10 dark:bg-white/10 dark:text-white",children:"Открыть период"})]})},r.id)})]})]}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:e.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[e.jsx("h3",{className:"font-display text-2xl",children:"Эти даты присутствуют в периоде"}),e.jsx("div",{className:"mt-4",children:e.jsx(T,{href:`/periods/${n.id}`,className:"block w-full rounded-[28px] border border-black/10 bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-display text-xl",children:m(n.start_date)&&m(n.end_date)?`${j(n.start_date)} — ${j(n.end_date)}`:"Период"}),e.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:m(n.start_date)&&m(n.end_date)?`${P(n.start_date,n.end_date)} дней · ${M(n.start_date,n.end_date)}`:"Даты не заданы"})]}),e.jsx("span",{className:"rounded-full border border-black/10 bg-white/80 px-3 py-1 text-xs text-[#1c1a17] dark:border-white/10 dark:bg-white/10 dark:text-white",children:"Открыть период"})]})})}),e.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{u(null),f(!1)},className:"rounded-full border border-black/10 px-4 py-2 text-xs text-[#6a5d52] dark:border-white/10 dark:text-white/70",children:"Отменить"}),e.jsx("button",{type:"button",onClick:()=>$(!0),className:"rounded-full bg-[#d87a4a] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)]",disabled:!z||l,children:"Подтвердить"})]})]})})]})]})}export{G as default};
