import{c as de,r as c,j as t,u as _e,H as Ae,L as pe}from"./app-DxLzEfpI.js";import{T as Se,a as $e,b as De,A as Ee}from"./app-layout-Dip3KHOo.js";import{d as xe}from"./index-BDqSilVs.js";import{P as ae}from"./pill-button-mcuDmsN8.js";import{b as Ie}from"./app-logo-icon-BSweI8Mh.js";/* empty css            */import"./index-C0Ohjvuh.js";import"./index-BbteBINP.js";const Ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Te=Ie("CircleHelp",Ce);function Me(n){const e=de.c(14),{text:d,ariaLabel:l}=n,[s,a]=c.useState(!1),[h,i]=c.useState(!1);let p,m;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=()=>{if(typeof window>"u")return;const _=window.matchMedia("(hover: none) and (pointer: coarse)"),f=()=>a(_.matches);return f(),_.addEventListener("change",f),()=>_.removeEventListener("change",f)},m=[],e[0]=p,e[1]=m):(p=e[0],m=e[1]),c.useEffect(p,m);const y=s?h:void 0,N=l??"Подсказка";let o;e[2]!==s?(o=()=>{s&&i(Be)},e[2]=s,e[3]=o):o=e[3];let b;e[4]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsx(Te,{className:"h-4 w-4"}),e[4]=b):b=e[4];let x;e[5]!==N||e[6]!==o?(x=t.jsx(Se,{asChild:!0,children:t.jsx("button",{type:"button","aria-label":N,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:o,children:b})}),e[5]=N,e[6]=o,e[7]=x):x=e[7];let u;e[8]!==d?(u=t.jsx($e,{className:"max-w-xs text-xs leading-relaxed",children:d}),e[8]=d,e[9]=u):u=e[9];let w;return e[10]!==y||e[11]!==x||e[12]!==u?(w=t.jsxs(De,{open:y,onOpenChange:i,children:[x,u]}),e[10]=y,e[11]=x,e[12]=u,e[13]=w):w=e[13],w}function Be(n){return!n}const W=n=>{const e=de.c(9),{children:d,className:l,tooltipText:s,tooltipAriaLabel:a}=n,h=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${l??""}`;let i;e[0]!==d?(i=t.jsx("span",{children:d}),e[0]=d,e[1]=i):i=e[1];let p;e[2]!==a||e[3]!==s?(p=s?t.jsx("span",{className:"ml-2 inline-flex align-middle",children:t.jsx(Me,{text:s,ariaLabel:a??"Дополнительная информация"})}):null,e[2]=a,e[3]=s,e[4]=p):p=e[4];let m;return e[5]!==h||e[6]!==i||e[7]!==p?(m=t.jsxs("div",{className:h,children:[i,p]}),e[5]=h,e[6]=i,e[7]=p,e[8]=m):m=e[8],m},Fe=n=>({"--delay":`${n}ms`}),Le={id:0,startDate:"",endDate:"",incomes:[],expenses:[],offIncomeExpenses:[],dailyExpenses:{}},G=n=>`${Math.max(0,Math.round(n)).toLocaleString("ru-RU")} ₽`,le=n=>{const e=Math.round(n);return e===0?"0 ₽":`${e>0?"+":"−"}${Math.abs(e).toLocaleString("ru-RU")} ₽`},te=n=>{const[e,d,l]=n.split("-").map(Number);return new Date(e,(d??1)-1,l??1)},fe=n=>{const e=te(n),d=String(e.getDate()).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0");return`${d}.${l}`},Pe=n=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(te(n)),Re=(n,e)=>{const d=new Intl.DateTimeFormat("ru-RU",{month:"short"}),l=d.format(te(n)),s=d.format(te(e)),a=te(n).getFullYear(),h=te(e).getFullYear();return a===h?l===s?Pe(n):`${l}–${s} ${a}`:`${l} ${a} – ${s} ${h}`},Oe=(n,e)=>{const d=te(n),s=te(e).getTime()-d.getTime(),a=Math.floor(s/(1e3*60*60*24));return Math.max(1,a+1)},ie=n=>{const e=n.replace(/\D/g,"");return e===""?"":Number(e)},he=n=>n.filter(e=>e.name.trim()==="").map(e=>e.id),Ue=n=>{const e=de.c(24),{items:d,setItems:l,totalAmount:s,onAdd:a,onBlurField:h,invalidNameIds:i}=n;let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=t.jsx(W,{children:"Приход"}),e[0]=p):p=e[0];let m;e[1]!==a?(m=t.jsxs("div",{className:"flex items-center justify-between",children:[p,t.jsx(ae,{type:"button",onClick:a,children:"+ Строка"})]}),e[1]=a,e[2]=m):m=e[2];let y;e[3]===Symbol.for("react.memo_cache_sentinel")?(y=t.jsxs("div",{className:"mt-3 hidden grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)] items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid",children:[t.jsx("span",{children:"Название"}),t.jsx("span",{className:"text-right",children:"Сумма"})]}),e[3]=y):y=e[3];let N;if(e[4]!==i||e[5]!==d||e[6]!==h||e[7]!==l){let _;e[9]!==i||e[10]!==h||e[11]!==l?(_=(f,q)=>t.jsxs("div",{className:"grid items-center gap-2 grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]",children:[t.jsx("input",{type:"text",placeholder:`Приход ${q+1}`,value:f.name,onChange:A=>l(k=>k.map(E=>E.id===f.id?{...E,name:A.target.value}:E)),onBlur:h,className:`rounded-lg border bg-white/90 px-3 py-2 text-xs dark:bg-white/10 sm:px-4 sm:text-sm ${i.includes(f.id)?"border-[#b0352b] dark:border-[#ff8b7c]":"border-black/10 dark:border-white/10"}`}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:f.amount,onChange:A=>{const k=A.target.value;l(E=>E.map(T=>T.id===f.id?{...T,amount:ie(k)}:T))},onFocus:()=>{f.amount===0&&l(A=>A.map(k=>k.id===f.id?{...k,amount:""}:k))},onBlur:()=>{f.amount===""&&l(A=>A.map(k=>k.id===f.id?{...k,amount:0}:k)),h()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"})]},f.id),e[9]=i,e[10]=h,e[11]=l,e[12]=_):_=e[12],N=d.map(_),e[4]=i,e[5]=d,e[6]=h,e[7]=l,e[8]=N}else N=e[8];let o;e[13]!==N?(o=t.jsx("div",{className:"mt-3 grid gap-2",children:N}),e[13]=N,e[14]=o):o=e[14];let b;e[15]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsx("span",{children:"Итого прихода"}),e[15]=b):b=e[15];let x;e[16]!==s?(x=G(s),e[16]=s,e[17]=x):x=e[17];let u;e[18]!==x?(u=t.jsxs("div",{className:"mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]",children:[b,t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:x})]}),e[18]=x,e[19]=u):u=e[19];let w;return e[20]!==m||e[21]!==o||e[22]!==u?(w=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[m,y,o,u]}),e[20]=m,e[21]=o,e[22]=u,e[23]=w):w=e[23],w},Ve=n=>{const e=de.c(65),{title:d,items:l,setItems:s,showDelete:a,onToggleDelete:h,totalLabel:i,totalPlanned:p,totalActual:m,totalDifference:y,idPrefix:N,onBlurField:o,onAfterDelete:b}=n;let x;e[0]!==d?(x=t.jsx(W,{children:d}),e[0]=d,e[1]=x):x=e[1];let u;e[2]!==N||e[3]!==s?(u=t.jsx(ae,{type:"button",onClick:()=>s(Q=>[...Q,{id:`${N}${Date.now()}`,name:"",plannedAmount:"",actualAmount:"",actualTouched:!1}]),children:"+ Строка"}),e[2]=N,e[3]=s,e[4]=u):u=e[4];let w;e[5]!==h||e[6]!==a?(w=t.jsx(ae,{type:"button",onClick:h,active:a,activeTone:"danger",children:"− Удаление"}),e[5]=h,e[6]=a,e[7]=w):w=e[7];let _;e[8]!==u||e[9]!==w?(_=t.jsxs("div",{className:"flex items-center gap-2",children:[u,w]}),e[8]=u,e[9]=w,e[10]=_):_=e[10];let f;e[11]!==x||e[12]!==_?(f=t.jsxs("div",{className:"flex items-center justify-between",children:[x,_]}),e[11]=x,e[12]=_,e[13]=f):f=e[13];const q=`mt-3 grid items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let A,k,E;e[14]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsxs("span",{children:[t.jsx("span",{className:"sm:hidden",children:"Название"}),t.jsx("span",{className:"hidden sm:inline",children:"Название"})]}),k=t.jsx("span",{className:"text-right",children:"План"}),E=t.jsx("span",{className:"text-right",children:"Факт"}),e[14]=A,e[15]=k,e[16]=E):(A=e[14],k=e[15],E=e[16]);let T;e[17]===Symbol.for("react.memo_cache_sentinel")?(T=t.jsxs("span",{className:"text-right",children:[t.jsx("span",{className:"sm:hidden",children:"Разн"}),t.jsx("span",{className:"hidden sm:inline",children:"Разница"})]}),e[17]=T):T=e[17];let V;e[18]!==a?(V=a&&t.jsx("span",{className:"text-center",children:"—"}),e[18]=a,e[19]=V):V=e[19];let M;e[20]!==V||e[21]!==q?(M=t.jsxs("div",{className:q,children:[A,k,E,T,V]}),e[20]=V,e[21]=q,e[22]=M):M=e[22];let I;if(e[23]!==l||e[24]!==b||e[25]!==o||e[26]!==s||e[27]!==a){let Q;e[29]!==b||e[30]!==o||e[31]!==s||e[32]!==a?(Q=(g,ne)=>t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${ne+1}`,value:g.name,onChange:D=>s(j=>j.map(X=>X.id===g.id?{...X,name:D.target.value}:X)),onBlur:o,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:g.plannedAmount,onChange:D=>{const j=D.target.value;s(X=>X.map(B=>B.id===g.id?{...B,plannedAmount:ie(j),actualAmount:B.actualTouched?B.actualAmount:ie(j)}:B))},onFocus:()=>{g.plannedAmount===0&&s(D=>D.map(j=>j.id===g.id?{...j,plannedAmount:""}:j))},onBlur:()=>{g.plannedAmount===""&&s(D=>D.map(j=>j.id===g.id?{...j,plannedAmount:0}:j)),o()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:g.actualAmount,onChange:D=>{const j=D.target.value;s(X=>X.map(B=>B.id===g.id?{...B,actualAmount:ie(j),actualTouched:!0}:B))},onFocus:()=>{g.actualAmount===0&&s(D=>D.map(j=>j.id===g.id?{...j,actualAmount:""}:j))},onBlur:()=>{g.actualAmount===""&&s(D=>D.map(j=>j.id===g.id?{...j,actualAmount:0}:j)),o()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("div",{className:`flex min-h-[36px] items-center justify-end px-0 py-2 text-xs tabular-nums sm:min-h-[40px] sm:px-4 sm:text-sm ${g.plannedAmount-g.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":g.plannedAmount-g.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:le(g.plannedAmount-g.actualAmount)}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(D=>D.filter(j=>j.id!==g.id)),b())},"aria-label":`Удалить трату ${ne+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},g.id),e[29]=b,e[30]=o,e[31]=s,e[32]=a,e[33]=Q):Q=e[33],I=l.map(Q),e[23]=l,e[24]=b,e[25]=o,e[26]=s,e[27]=a,e[28]=I}else I=e[28];let O;e[34]!==I?(O=t.jsx("div",{className:"mt-3 grid gap-2",children:I}),e[34]=I,e[35]=O):O=e[35];const Y=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let P;e[36]!==i?(P=t.jsx("span",{children:i}),e[36]=i,e[37]=P):P=e[37];let U;e[38]!==p?(U=G(p),e[38]=p,e[39]=U):U=e[39];let F;e[40]!==U?(F=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:U}),e[40]=U,e[41]=F):F=e[41];let C;e[42]!==m?(C=G(m),e[42]=m,e[43]=C):C=e[43];let z;e[44]!==C?(z=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:C}),e[44]=C,e[45]=z):z=e[45];const L=`text-right font-display text-sm tabular-nums ${y>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":y<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let $;e[46]!==y?($=le(y),e[46]=y,e[47]=$):$=e[47];let R;e[48]!==L||e[49]!==$?(R=t.jsx("span",{className:L,children:$}),e[48]=L,e[49]=$,e[50]=R):R=e[50];let H;e[51]!==a?(H=a&&t.jsx("span",{}),e[51]=a,e[52]=H):H=e[52];let J;e[53]!==Y||e[54]!==P||e[55]!==F||e[56]!==z||e[57]!==R||e[58]!==H?(J=t.jsxs("div",{className:Y,children:[P,F,z,R,H]}),e[53]=Y,e[54]=P,e[55]=F,e[56]=z,e[57]=R,e[58]=H,e[59]=J):J=e[59];let se;return e[60]!==M||e[61]!==O||e[62]!==J||e[63]!==f?(se=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[f,M,O,J]}),e[60]=M,e[61]=O,e[62]=J,e[63]=f,e[64]=se):se=e[64],se},Ye=n=>{const e=de.c(52),{title:d,items:l,setItems:s,showDelete:a,onToggleDelete:h,totalLabel:i,totalAmount:p,idPrefix:m,onBlurField:y,onAfterDelete:N}=n;let o;e[0]!==d?(o=t.jsx(W,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:d}),e[0]=d,e[1]=o):o=e[1];let b;e[2]!==m||e[3]!==s?(b=t.jsx(ae,{type:"button",onClick:()=>s(F=>[...F,{id:`${m}${Date.now()}`,name:"",amount:""}]),children:"+ Строка"}),e[2]=m,e[3]=s,e[4]=b):b=e[4];let x;e[5]!==h||e[6]!==a?(x=t.jsx(ae,{type:"button",onClick:h,active:a,activeTone:"danger",children:"− Удаление"}),e[5]=h,e[6]=a,e[7]=x):x=e[7];let u;e[8]!==b||e[9]!==x?(u=t.jsxs("div",{className:"flex items-center gap-2",children:[b,x]}),e[8]=b,e[9]=x,e[10]=u):u=e[10];let w;e[11]!==o||e[12]!==u?(w=t.jsxs("div",{className:"flex items-center justify-between",children:[o,u]}),e[11]=o,e[12]=u,e[13]=w):w=e[13];const _=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let f,q;e[14]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsx("span",{children:"Название"}),q=t.jsx("span",{className:"text-right",children:"Сумма"}),e[14]=f,e[15]=q):(f=e[14],q=e[15]);let A;e[16]!==a?(A=a&&t.jsx("span",{className:"text-center",children:"—"}),e[16]=a,e[17]=A):A=e[17];let k;e[18]!==_||e[19]!==A?(k=t.jsxs("div",{className:_,children:[f,q,A]}),e[18]=_,e[19]=A,e[20]=k):k=e[20];let E;if(e[21]!==l||e[22]!==N||e[23]!==y||e[24]!==s||e[25]!==a){let F;e[27]!==N||e[28]!==y||e[29]!==s||e[30]!==a?(F=(C,z)=>t.jsxs("div",{className:`grid items-center gap-2 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${z+1}`,value:C.name,onChange:L=>s($=>$.map(R=>R.id===C.id?{...R,name:L.target.value}:R)),onBlur:y,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm"}),t.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:C.amount,onChange:L=>{const $=L.target.value;s(R=>R.map(H=>H.id===C.id?{...H,amount:ie($)}:H))},onFocus:()=>{C.amount===0&&s(L=>L.map($=>$.id===C.id?{...$,amount:""}:$))},onBlur:()=>{C.amount===""&&s(L=>L.map($=>$.id===C.id?{...$,amount:0}:$)),y()},className:"no-spin rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(s(L=>L.filter($=>$.id!==C.id)),N())},"aria-label":`Удалить трату ${z+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},C.id),e[27]=N,e[28]=y,e[29]=s,e[30]=a,e[31]=F):F=e[31],E=l.map(F),e[21]=l,e[22]=N,e[23]=y,e[24]=s,e[25]=a,e[26]=E}else E=e[26];let T;e[32]!==E?(T=t.jsx("div",{className:"mt-3 grid gap-2",children:E}),e[32]=E,e[33]=T):T=e[33];const V=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let M;e[34]!==i?(M=t.jsx("span",{children:i}),e[34]=i,e[35]=M):M=e[35];let I;e[36]!==p?(I=G(p),e[36]=p,e[37]=I):I=e[37];let O;e[38]!==I?(O=t.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:I}),e[38]=I,e[39]=O):O=e[39];let Y;e[40]!==a?(Y=a&&t.jsx("span",{}),e[40]=a,e[41]=Y):Y=e[41];let P;e[42]!==V||e[43]!==M||e[44]!==O||e[45]!==Y?(P=t.jsxs("div",{className:V,children:[M,O,Y]}),e[42]=V,e[43]=M,e[44]=O,e[45]=Y,e[46]=P):P=e[46];let U;return e[47]!==k||e[48]!==T||e[49]!==P||e[50]!==w?(U=t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[w,k,T,P]}),e[47]=k,e[48]=T,e[49]=P,e[50]=w,e[51]=U):U=e[51],U};function We(){const{periodId:n}=_e().props,[e,d]=c.useState(Le),[l,s]=c.useState([]),[a,h]=c.useState(""),[i,p]=c.useState(""),[m,y]=c.useState([]),[N,o]=c.useState([]),[b,x]=c.useState({}),[u,w]=c.useState(!1),[_,f]=c.useState(!1),[q,A]=c.useState(!0),[k,E]=c.useState(null),[T,V]=c.useState(!1),[M,I]=c.useState(null),[O,Y]=c.useState(!1),[P,U]=c.useState([]),[F,C]=c.useState(!1),z=c.useRef(!1),[L,$]=c.useState(0),R="Заполните названия прихода.",H=c.useMemo(()=>`period:${n}`,[n]),J=c.useRef(!1),se=()=>typeof window>"u"?null:window.__periodCache?.[H]??null,Q=r=>{if(typeof window>"u")return;const v=window;v.__periodCache||(v.__periodCache={}),v.__periodCache[H]=r},g=(m??[]).reduce((r,v)=>r+(Number(v.plannedAmount)||0),0),ne=(m??[]).reduce((r,v)=>r+(Number(v.actualAmount)||0),0),D=g-ne,j=(N??[]).reduce((r,v)=>r+(Number(v.amount)||0),0),X=(l??[]).reduce((r,v)=>r+(Number(v.amount)||0),0),B=c.useMemo(()=>!a||!i?0:Oe(a,i),[a,i]),oe=c.useMemo(()=>Object.values(b).reduce((r,v)=>r+(v||0),0),[b]),be=B>0?oe/B:0,ce=c.useMemo(()=>!a||!i?"Период":`${fe(a)} — ${fe(i)}`,[a,i]),ge=c.useMemo(()=>!a||!i?"":`${B} дней · ${Re(a,i)}`,[B,a,i]),re=X-g,we=B>0?re/B:0,ke=[{title:"Dashboard",href:xe().url},{title:ce,href:`/periods/${n}`}],je=r=>!!(r&&r.id&&Array.isArray(r.incomes)&&Array.isArray(r.expenses)&&Array.isArray(r.offIncomeExpenses)),ye=async()=>{if(J.current)return;const r=se();if(je(r)){J.current=!0,d(r),s(r.incomes??[]),h(r.startDate??""),p(r.endDate??""),y(r.expenses??[]),o(r.offIncomeExpenses??[]),x(r.dailyExpenses??{}),A(!1);return}J.current=!0,A(!0),E(null);try{const v=await fetch(`/api/periods/${n}`);if(!v.ok)throw new Error("Не удалось загрузить период.");const S=(await v.json()).data,ee={id:S.id,startDate:S.start_date,endDate:S.end_date,dailyExpenses:S.daily_expenses??{},incomes:S.incomes.map(K=>({id:String(K.id),name:K.name,amount:K.amount})),expenses:S.expenses.map(K=>({id:String(K.id),name:K.name,plannedAmount:K.planned_amount,actualAmount:K.actual_amount,actualTouched:!1})),offIncomeExpenses:S.external_expenses.map(K=>({id:String(K.id),name:K.name,amount:K.amount}))};d(ee),s(ee.incomes),h(ee.startDate),p(ee.endDate),y(ee.expenses),o(ee.offIncomeExpenses),x(ee.dailyExpenses),Q(ee)}catch(v){E(v instanceof Error?v.message:"Не удалось загрузить период.")}finally{A(!1)}},Z=async()=>{const r=he(l);if(r.length>0){U(r),I(R);return}if(T){z.current=!0;return}V(!0),I(null),Y(!1);try{const v=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",me=await fetch(`/api/periods/${n}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":v},body:JSON.stringify({start_date:a,end_date:i,daily_expenses:b,incomes:l.map(S=>({id:Number.isFinite(Number(S.id))?Number(S.id):void 0,name:S.name,amount:Number(S.amount)||0})),expenses:m.map(S=>({id:Number.isFinite(Number(S.id))?Number(S.id):void 0,name:S.name,planned_amount:Number(S.plannedAmount)||0,actual_amount:Number(S.actualAmount)||0})),external_expenses:N.map(S=>({id:Number.isFinite(Number(S.id))?Number(S.id):void 0,name:S.name,amount:Number(S.amount)||0}))})});if(me.status===409)throw new Error("Период пересекается с существующим.");if(!me.ok)throw new Error("Не удалось сохранить период.");Y(!0),Q({id:Number(n),startDate:a,endDate:i,incomes:l,expenses:m,offIncomeExpenses:N,dailyExpenses:b})}catch(v){I(v instanceof Error?v.message:"Не удалось сохранить период.")}finally{V(!1)}},Ne=()=>{s(r=>[...r,{id:`i${Date.now()}`,name:"",amount:""}]),Z()},ue=()=>{$(r=>r+1)},ve=async()=>{if(!F&&window.confirm("Удалить период?")){C(!0),I(null);try{const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch(`/api/periods/${n}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":r}})).ok)throw new Error("Не удалось удалить период.");window.location.href=xe().url}catch(r){I(r instanceof Error?r.message:"Не удалось удалить период.")}finally{C(!1)}}};return c.useEffect(()=>{ye()},[n]),c.useEffect(()=>{!T&&z.current&&(z.current=!1,Z())},[T]),c.useEffect(()=>{L>0&&Z()},[L]),c.useEffect(()=>{const r=he(l);U(r),r.length===0&&M===R&&I(null)},[l,M]),t.jsxs(Ee,{breadcrumbs:ke,children:[t.jsx(Ae,{title:ce}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-3 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:ce}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:ge})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{type:"button",onClick:ve,disabled:F,className:"rounded-full border border-[#b0352b]/40 bg-white/80 px-4 py-2 text-xs text-[#b0352b] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 disabled:cursor-not-allowed disabled:opacity-70 dark:border-[#ff8b7c]/40 dark:bg-white/10 dark:text-[#ff8b7c]",children:"Удалить"}),t.jsx(pe,{href:xe(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})]})]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] animate-reveal",style:Fe(120),children:[q&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),k&&t.jsx("div",{className:"col-span-full rounded-lg border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:k}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none",children:[t.jsx(Ue,{items:l,setItems:s,totalAmount:X,onAdd:Ne,onBlurField:Z,invalidNameIds:P}),t.jsx(Ve,{title:"Обязательные траты",items:m,setItems:y,showDelete:u,onToggleDelete:()=>w(r=>!r),totalLabel:"Итого обязательных",totalPlanned:g,totalActual:ne,totalDifference:D,idPrefix:"e",onBlurField:Z,onAfterDelete:ue}),t.jsx(Ye,{title:"Сторонние траты",items:N,setItems:o,showDelete:u,onToggleDelete:()=>w(r=>!r),totalLabel:"Итого сторонних",totalAmount:j,idPrefix:"o",onBlurField:Z,onAfterDelete:ue})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none",children:[t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(W,{children:"Дни периода"}),t.jsx(ae,{type:"button",onClick:()=>f(r=>!r),active:_,activeTone:"success",children:_?"Готово":"Редактировать"})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:B}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"})]}),_&&t.jsxs("div",{className:"mt-3 grid gap-2 grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:a,onChange:r=>h(r.target.value),onBlur:Z,max:i,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:i,onChange:r=>p(r.target.value),onBlur:Z,min:a,className:"rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:text-sm"})]})]})]}),t.jsx(pe,{href:`/periods/${n}/daily`,prefetch:!0,className:"group rounded-lg border border-[#1e7b4f]/30 bg-white/90 px-5 py-4 text-sm text-[#1c1a17] shadow-[0_24px_48px_-28px_rgba(30,123,79,0.55)] transition hover:-translate-y-0.5 hover:shadow-[0_28px_60px_-30px_rgba(30,123,79,0.65)] dark:border-[#7ce0b3]/30 dark:bg-white/10 dark:text-white",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsx(W,{children:"Ежедневные траты"}),t.jsx(ae,{as:"span",children:"Перейти к дневным значениям"})]})}),t.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/85 px-5 py-6 text-[#1c1a17] shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white dark:shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[t.jsx(W,{children:"Планируемое среднее в день"}),t.jsx("p",{className:"mt-2 text-xs text-[#6a5d52] dark:text-white/60",children:"(Приход − обязательные) / дни"}),t.jsx("p",{className:"mt-3 font-display text-2xl",children:G(we)}),t.jsxs("div",{className:"mt-4 grid gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("div",{className:"h-px w-full bg-black/10 dark:bg-white/10"}),t.jsx(W,{children:"Планируемая сумма на период"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm font-semibold",children:[t.jsx("span",{className:"font-display tabular-nums text-[#1e7b4f] dark:text-[#7ce0b3]",children:G(X)}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"−"}),t.jsx("span",{className:"font-display tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:G(g)}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"="}),t.jsx("span",{className:`font-display tabular-nums ${re>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,children:le(re)})]}),t.jsx("div",{className:"text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:"Приход − план = сумма в период"}),t.jsx("div",{className:"h-px w-full bg-black/10 dark:bg-white/10"}),t.jsx(W,{tooltipText:"Планируемый остаток +/− фактическая разница − ежедневные траты за период.",tooltipAriaLabel:"Формула фактического остатка",children:"Фактический остаток"}),t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-sm font-semibold",children:[t.jsx("span",{className:"font-display tabular-nums text-[#1e7b4f] dark:text-[#7ce0b3]",children:G(re)}),t.jsx("span",{className:`font-display tabular-nums ${D>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":D<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:le(D).replace(/^([+−-])/,"$1 ")}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"−"}),t.jsx("span",{className:"font-display tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:G(oe)}),t.jsx("span",{className:"text-black/50 dark:text-white/60",children:"="}),t.jsx("span",{className:`font-display tabular-nums ${re+D-oe>=0?"text-[#1e7b4f] dark:text-[#7ce0b3]":"text-[#b0352b] dark:text-[#ff8b7c]"}`,children:le(re+D-oe)})]}),t.jsx("div",{clasтулsName:"h-px w-full bg-black/10 dark:bg-white/10"}),t.jsx(W,{children:"Фактическое среднее в день за период"}),t.jsx("div",{className:"mt-2 font-display text-2xl",children:G(be)})]})]})]})]}),M&&t.jsx("div",{className:"relative z-10 rounded-lg border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:M})]})]})}export{We as default};
