import{c as F,j as t,L as K,u as B,r as f,H as q}from"./app-DxLzEfpI.js";import{A as H}from"./app-layout-Dip3KHOo.js";import{d as V}from"./index-BDqSilVs.js";import{P as E}from"./pill-button-mcuDmsN8.js";/* empty css            */import"./app-logo-icon-BSweI8Mh.js";import"./index-C0Ohjvuh.js";import"./index-BbteBINP.js";const X=a=>{const e=F.c(25),{href:s,title:r,subtitle:i,onClose:l,onConfirm:n,confirmDisabled:h}=a,m=h===void 0?!1:h;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=t.jsx("h3",{className:"font-display text-2xl",children:"Эти даты присутствуют в периоде"}),e[0]=o):o=e[0];let c;e[1]!==r?(c=t.jsx("h3",{className:"font-display text-xl",children:r}),e[1]=r,e[2]=c):c=e[2];let _;e[3]!==i?(_=t.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:i}),e[3]=i,e[4]=_):_=e[4];let p;e[5]!==c||e[6]!==_?(p=t.jsxs("div",{children:[c,_]}),e[5]=c,e[6]=_,e[7]=p):p=e[7];let k;e[8]===Symbol.for("react.memo_cache_sentinel")?(k=t.jsx(E,{as:"span",className:"bg-white/80 text-[#1c1a17] dark:bg-white/10 dark:text-white",children:"Открыть период"}),e[8]=k):k=e[8];let y;e[9]!==p?(y=t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[p,k]}),e[9]=p,e[10]=y):y=e[10];let b;e[11]!==s||e[12]!==y?(b=t.jsx("div",{className:"mt-4",children:t.jsx(K,{href:s,className:"block w-full rounded-[28px] border border-black/10 bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10",children:y})}),e[11]=s,e[12]=y,e[13]=b):b=e[13];let w;e[14]!==l?(w=t.jsx(E,{type:"button",onClick:l,className:"px-4 py-2",children:"Отменить"}),e[14]=l,e[15]=w):w=e[15];let u;e[16]!==m||e[17]!==n?(u=t.jsx(E,{type:"button",onClick:n,className:"border-transparent bg-[#d87a4a] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] disabled:cursor-not-allowed disabled:opacity-70",disabled:m,children:"Подтвердить"}),e[16]=m,e[17]=n,e[18]=u):u=e[18];let g;e[19]!==u||e[20]!==w?(g=t.jsxs("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:[w,u]}),e[19]=u,e[20]=w,e[21]=g):g=e[21];let v;return e[22]!==g||e[23]!==b?(v=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[o,b,g]})}),e[22]=g,e[23]=b,e[24]=v):v=e[24],v},J=a=>{const e=F.c(13),{href:s,title:r,subtitle:i}=a;let l;e[0]!==r?(l=t.jsx("h3",{className:"font-display text-xl",children:r}),e[0]=r,e[1]=l):l=e[1];let n;e[2]!==i?(n=t.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:i}),e[2]=i,e[3]=n):n=e[3];let h;e[4]!==l||e[5]!==n?(h=t.jsxs("div",{children:[l,n]}),e[4]=l,e[5]=n,e[6]=h):h=e[6];let m;e[7]===Symbol.for("react.memo_cache_sentinel")?(m=t.jsx(E,{as:"span",className:"bg-white/80 text-[#1c1a17] dark:bg-white/10 dark:text-white",children:"Открыть период"}),e[7]=m):m=e[7];let o;e[8]!==h?(o=t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h,m]}),e[8]=h,e[9]=o):o=e[9];let c;return e[10]!==s||e[11]!==o?(c=t.jsx(K,{href:s,prefetch:!0,className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10",children:o}),e[10]=s,e[11]=o,e[12]=c):c=e[12],c},G=a=>{const e=F.c(4),{items:s}=a;let r;e[0]!==s?(r=s.map(Q),e[0]=s,e[1]=r):r=e[1];let i;return e[2]!==r?(i=t.jsx("div",{className:"grid gap-4",children:r}),e[2]=r,e[3]=i):i=e[3],i};function Q(a){return t.jsx(J,{href:`/periods/${a.id}`,title:a.title,subtitle:a.subtitle},a.id)}const Z=`
## Приложение обновилось!
___
## Что нового?

- добавилось это окошко, теперь после обновлений будет информация о том, что поменялось
- кнопка ежедневных трат стала более заметной
- авторизованные пользователи сразу переходят на дашборд (главную)
- на дашборде для мобилки поменялся вид ввода дат
- доработан интерфейс периода на мобилке

___
version: 0.1
`,ee="Круто!",$=a=>a.split("**").map((s,r)=>r%2===1?t.jsx("strong",{children:s},r):s),te=a=>{const e=a.trim().split(`
`),s=[];let r=[];const i=()=>{r.length&&(s.push(t.jsx("ul",{className:"list-disc pl-5",children:r.map((l,n)=>t.jsx("li",{children:$(l)},n))},`list-${s.length}`)),r=[])};return e.forEach(l=>{const n=l.trim();if(!n){i();return}if(n.startsWith("- ")){r.push(n.slice(2));return}if(i(),n.startsWith("### ")){s.push(t.jsx("h4",{className:"text-lg font-semibold",children:$(n.slice(4))},`h4-${s.length}`));return}if(n.startsWith("## ")){s.push(t.jsx("h3",{className:"text-xl font-semibold",children:$(n.slice(3))},`h3-${s.length}`));return}if(n.startsWith("# ")){s.push(t.jsx("h2",{className:"text-2xl font-semibold",children:$(n.slice(2))},`h2-${s.length}`));return}s.push(t.jsx("p",{className:"text-sm text-[#6a5d52] dark:text-white/70",children:$(n)},`p-${s.length}`))}),i(),s},se=a=>{const e=F.c(4),{onConfirm:s,confirmDisabled:r}=a,i=r===void 0?!1:r;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("div",{className:"space-y-4",children:te(Z)}),e[0]=l):l=e[0];let n;return e[1]!==i||e[2]!==s?(n=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[l,t.jsx("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:t.jsx(E,{type:"button",onClick:s,className:"border-transparent bg-[#d87a4a] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] disabled:cursor-not-allowed disabled:opacity-70",disabled:i,children:ee})})]})}),e[1]=i,e[2]=s,e[3]=n):n=e[3],n},ae=[{title:"Dashboard",href:V().url}],R=a=>({"--delay":`${a}ms`}),Y=a=>{const e=a?.trim()??"";return e?e.includes("T")?e.slice(0,10):e:""},j=a=>{const e=Y(a);if(!e)return new Date("invalid");const[s,r,i]=e.split("-").map(Number);return new Date(s,(r??1)-1,i??1)},S=a=>{const e=j(a);return Number.isFinite(e.getTime())},C=a=>{const e=Y(a);return e?Number(e.replaceAll("-","")):NaN},P=a=>{const e=j(a),s=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0");return`${s}.${r}`},re=a=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(j(a)),U=(a,e)=>{const s=new Intl.DateTimeFormat("ru-RU",{month:"short"}),r=s.format(j(a)),i=s.format(j(e)),l=j(a).getFullYear(),n=j(e).getFullYear();return l===n?r===i?re(a):`${r}–${i} ${l}`:`${r} ${l} – ${i} ${n}`},z=(a,e)=>{const s=j(a),i=j(e).getTime()-s.getTime(),l=Math.floor(i/(1e3*60*60*24));return Math.max(1,l+1)};function me(){const{auth:a}=B().props,[e,s]=f.useState(""),[r,i]=f.useState(""),[l,n]=f.useState(!1),[h,m]=f.useState(null),[o,c]=f.useState(null),[_,p]=f.useState(!1),[k,y]=f.useState([]),[b,w]=f.useState(!0),[u,g]=f.useState(null),[v,T]=f.useState(a.user?.is_info_shown===!1);f.useEffect(()=>{T(a.user?.is_info_shown===!1)},[a.user]);const W=async()=>{try{const d=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";if(!(await fetch("/api/user/info-shown",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d}})).ok)throw new Error("Не удалось сохранить статус обновлений.");T(!1)}catch(d){console.error(d)}},I=async()=>{w(!0),g(null);try{const d=await fetch("/api/periods");if(!d.ok)throw new Error("Не удалось загрузить периоды.");const x=await d.json();y(x.data??[])}catch(d){g(d instanceof Error?d.message:"Не удалось загрузить периоды.")}finally{w(!1)}};f.useEffect(()=>{I()},[]);const M=async(d=!1)=>{if(!e||!r){m("Укажите даты начала и конца периода.");return}if(!d){const x=C(e),N=C(r),D=k.find(L=>{const O=C(L.start_date),A=C(L.end_date);return!Number.isFinite(x)||!Number.isFinite(N)||!Number.isFinite(O)||!Number.isFinite(A)?!1:x<A&&N>O});if(D){c(D),p(!0);return}}n(!0),m(null);try{const x=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",N=await fetch("/api/periods",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x},body:JSON.stringify({start_date:e,end_date:r,force:!!d})});if(N.status===409){const D=await N.json();if(D.overlap){c(D.overlap),p(!0);return}throw new Error("Период пересекается с существующим.")}if(!N.ok)throw new Error("Не удалось сохранить период.");s(""),i(""),c(null),p(!1),await I()}catch(x){m(x instanceof Error?x.message:"Не удалось сохранить период.")}finally{n(!1)}};return t.jsxs(H,{breadcrumbs:ae,children:[t.jsx(q,{title:"Dashboard"}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsx("section",{className:"relative z-10 flex flex-wrap items-end justify-between gap-6",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Финансовый контур"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:"Периоды учета"}),t.jsx("p",{className:"mt-2 max-w-xl text-sm text-[#6a5d52] dark:text-white/70",children:"Добавьте новый период сверху и управляйте историей ниже. При клике откроется отдельная страница периода."})]})}),t.jsxs("section",{className:"relative z-10 rounded-[28px] border border-black/10 bg-white/85 p-6 shadow-[0_22px_44px_-28px_rgba(28,26,23,0.6)] backdrop-blur animate-reveal dark:border-white/10 dark:bg-white/10",style:R(120),children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Новый период"}),t.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Добавить диапазон дат"})]})}),t.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-[1fr_1fr_1fr]",children:[t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"С"}),t.jsx("input",{type:"date",value:e,onChange:d=>s(d.target.value),className:"date-input w-full rounded-2xl border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white"})]}),t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"По"}),t.jsx("input",{type:"date",value:r,onChange:d=>i(d.target.value),min:e||void 0,className:"date-input w-full rounded-2xl border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white"})]}),t.jsx("div",{className:"flex flex-col justify-end",children:t.jsx("button",{className:"rounded-2xl bg-[#d87a4a] px-4 py-3 text-sm font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] transition hover:-translate-y-0.5 disabled:cursor-not-allowed disabled:opacity-70",type:"button",onClick:()=>M(!1),disabled:l,children:l?"Сохранение...":"Сохранить"})})]}),h&&t.jsx("p",{className:"mt-3 text-xs text-[#b0352b] dark:text-[#ff8b7c]",children:h})]}),t.jsxs("section",{className:"relative z-10 grid gap-4 animate-reveal",style:R(240),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"font-display text-2xl",children:"История периодов"}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"Сначала новые"})]}),t.jsxs("div",{className:"grid gap-4",children:[b&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем периоды..."}),u&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:u}),!b&&!u&&k.length===0&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Периодов пока нет. Создайте первый диапазон выше."}),!b&&!u&&t.jsx(G,{items:k.map(d=>{const x=S(d.start_date)&&S(d.end_date),N=x?z(d.start_date,d.end_date):0;return{id:d.id,title:x?`${P(d.start_date)} — ${P(d.end_date)}`:"Период",subtitle:x?`${N} дней · ${U(d.start_date,d.end_date)}`:"Даты не заданы"}})})]})]}),o&&t.jsx(X,{href:`/periods/${o.id}`,title:S(o.start_date)&&S(o.end_date)?`${P(o.start_date)} — ${P(o.end_date)}`:"Период",subtitle:S(o.start_date)&&S(o.end_date)?`${z(o.start_date,o.end_date)} дней · ${U(o.start_date,o.end_date)}`:"Даты не заданы",onClose:()=>{c(null),p(!1)},onConfirm:()=>M(!0),confirmDisabled:!_||l}),v&&t.jsx(se,{onConfirm:W})]})]})}export{me as default};
