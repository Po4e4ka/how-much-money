import{c as E,j as t,L as q,u as H,r as h,H as V}from"./app-Dzp51NVV.js";import{A as X}from"./app-layout-z44Wcmjn.js";import{d as J}from"./index-CYtoQFCC.js";import{P as U,O as G}from"./overlap-period-modal-C5rVfv0S.js";import{d as F}from"./animation-DULAtfne.js";import{a as M,i as k,c as B,f as K,b as C,d as S}from"./date-C0FYGyP5.js";/* empty css            */import"./app-logo-icon-B6PMVmBd.js";import"./index-CJj_ylFk.js";import"./index-CjX2JUid.js";const Q=a=>{const e=Math.round(a);return e===0?"0 ₽":`${e>0?"+":"−"}${Math.abs(e).toLocaleString("ru-RU")} ₽`},Y=a=>{const e=E.c(21),{href:s,title:r,subtitle:l,isClosed:c,actualRemaining:n}=a,p=c===void 0?!1:c,w=`rounded-[28px] border bg-white/70 p-5 text-left shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:bg-white/10 ${p?"border-[#1e7b4f]/40 dark:border-[#7ce0b3]/40":"border-black/10 dark:border-white/10"}`;let d;e[0]!==r?(d=t.jsx("h3",{className:"font-display text-xl",children:r}),e[0]=r,e[1]=d):d=e[1];let m;e[2]!==l?(m=t.jsx("p",{className:"mt-1 text-xs text-[#6a5d52] dark:text-white/70",children:l}),e[2]=l,e[3]=m):m=e[3];let b;e[4]!==n||e[5]!==p?(b=p&&typeof n=="number"&&t.jsxs("p",{className:"mt-2 text-xs text-[#1e7b4f] dark:text-[#7ce0b3]",children:["Факт. остаток: ",Q(n)]}),e[4]=n,e[5]=p,e[6]=b):b=e[6];let u;e[7]!==d||e[8]!==m||e[9]!==b?(u=t.jsxs("div",{className:"min-w-[180px]",children:[d,m,b]}),e[7]=d,e[8]=m,e[9]=b,e[10]=u):u=e[10];let x;e[11]!==p?(x=p&&t.jsx("div",{className:"flex-1 text-center text-xs uppercase tracking-[0.2em] text-[#1e7b4f] dark:text-[#7ce0b3]",children:"Период закрыт"}),e[11]=p,e[12]=x):x=e[12];let j;e[13]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx(U,{as:"span",className:"bg-white/80 text-[#1c1a17] dark:bg-white/10 dark:text-white",children:"Открыть период"}),e[13]=j):j=e[13];let f;e[14]!==u||e[15]!==x?(f=t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[u,x,j]}),e[14]=u,e[15]=x,e[16]=f):f=e[16];let _;return e[17]!==s||e[18]!==w||e[19]!==f?(_=t.jsx(q,{href:s,prefetch:!0,className:w,children:f}),e[17]=s,e[18]=w,e[19]=f,e[20]=_):_=e[20],_},T=a=>{const e=E.c(4),{items:s}=a;let r;e[0]!==s?(r=s.map(Z),e[0]=s,e[1]=r):r=e[1];let l;return e[2]!==r?(l=t.jsx("div",{className:"grid gap-4",children:r}),e[2]=r,e[3]=l):l=e[3],l};function Z(a){return t.jsx(Y,{href:`/periods/${a.id}`,title:a.title,subtitle:a.subtitle,isClosed:a.isClosed,actualRemaining:a.actualRemaining},a.id)}const ee=`
## Приложение обновилось!
___
## Что нового?

- дабавлена фича закрытия периода
- максимальный диапозон не больше 3-х меяцев
- бновлены иконки

___
version: 0.1.3
`,te="Круто!",v=a=>a.split("**").map((s,r)=>r%2===1?t.jsx("strong",{children:s},r):s),se=a=>{const e=a.trim().split(`
`),s=[];let r=[];const l=()=>{r.length&&(s.push(t.jsx("ul",{className:"list-disc pl-5",children:r.map((c,n)=>t.jsx("li",{children:v(c)},n))},`list-${s.length}`)),r=[])};return e.forEach(c=>{const n=c.trim();if(!n){l();return}if(n.startsWith("- ")){r.push(n.slice(2));return}if(l(),n.startsWith("### ")){s.push(t.jsx("h4",{className:"text-lg font-semibold",children:v(n.slice(4))},`h4-${s.length}`));return}if(n.startsWith("## ")){s.push(t.jsx("h3",{className:"text-xl font-semibold",children:v(n.slice(3))},`h3-${s.length}`));return}if(n.startsWith("# ")){s.push(t.jsx("h2",{className:"text-2xl font-semibold",children:v(n.slice(2))},`h2-${s.length}`));return}s.push(t.jsx("p",{className:"text-sm text-[#6a5d52] dark:text-white/70",children:v(n)},`p-${s.length}`))}),l(),s},ae=a=>{const e=E.c(4),{onConfirm:s,confirmDisabled:r}=a,l=r===void 0?!1:r;let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx("div",{className:"space-y-4",children:se(ee)}),e[0]=c):c=e[0];let n;return e[1]!==l||e[2]!==s?(n=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:t.jsxs("div",{className:"w-full max-w-xl rounded-3xl border border-black/10 bg-white/95 p-6 text-[#1c1a17] shadow-[0_24px_60px_-28px_rgba(0,0,0,0.7)] dark:border-white/10 dark:bg-[#1c1a17] dark:text-white",children:[c,t.jsx("div",{className:"mt-6 flex flex-wrap justify-end gap-3",children:t.jsx(U,{type:"button",onClick:s,className:"border-transparent bg-[#d87a4a] px-4 py-2 text-xs font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] disabled:cursor-not-allowed disabled:opacity-70",disabled:l,children:te})})]})}),e[1]=l,e[2]=s,e[3]=n):n=e[3],n},re=[{title:"Dashboard",href:J().url}],A=a=>{const e=k(a.start_date)&&k(a.end_date),s=e?B(a.start_date,a.end_date):0;return{title:e?`${C(a.start_date)} — ${C(a.end_date)}`:"Период",subtitle:e?`${s} дней · ${K(a.start_date,a.end_date)}`:"Даты не заданы"}};function pe(){const{auth:a}=H().props,[e,s]=h.useState(""),[r,l]=h.useState(""),[c,n]=h.useState(!1),[p,w]=h.useState(null),[d,m]=h.useState(null),[b,u]=h.useState(!1),[x,j]=h.useState([]),[f,_]=h.useState(!0),[y,$]=h.useState(null),[z,D]=h.useState(a.user?.is_info_shown===!1);h.useEffect(()=>{D(a.user?.is_info_shown===!1)},[a.user]);const W=()=>{D(!1);const i=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";fetch("/api/user/info-shown",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i}}).catch(o=>{console.error(o)})},P=async()=>{_(!0),$(null);try{const i=await fetch("/api/periods");if(!i.ok)throw new Error("Не удалось загрузить периоды.");const o=await i.json();j(o.data??[])}catch(i){$(i instanceof Error?i.message:"Не удалось загрузить периоды.")}finally{_(!1)}};h.useEffect(()=>{P()},[]);const I=async(i=!1)=>{if(!e||!r){w("Укажите даты начала и конца периода.");return}if(!i){const o=S(e),g=S(r),N=x.find(L=>{const O=S(L.start_date),R=S(L.end_date);return!Number.isFinite(o)||!Number.isFinite(g)||!Number.isFinite(O)||!Number.isFinite(R)?!1:o<R&&g>O});if(N){m(N),u(!0);return}}n(!0),w(null);try{const o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",g=await fetch("/api/periods",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({start_date:e,end_date:r,force:!!i})});if(g.status===409){const N=await g.json();if(N.overlap){m(N.overlap),u(!0);return}throw new Error("Период пересекается с существующим.")}if(!g.ok)throw new Error("Не удалось сохранить период.");s(""),l(""),m(null),u(!1),await P()}catch(o){w(o instanceof Error?o.message:"Не удалось сохранить период.")}finally{n(!1)}};return t.jsxs(X,{breadcrumbs:re,children:[t.jsx(V,{title:"Dashboard"}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsx("section",{className:"relative z-10 flex flex-wrap items-end justify-between gap-6",children:t.jsxs("div",{children:[t.jsx("h1",{className:"mt-3 font-display text-3xl",children:"Периоды учета"}),t.jsx("p",{className:"mt-2 max-w-xl text-sm text-[#6a5d52] dark:text-white/70",children:"Добавьте новый период сверху и управляйте историей ниже. При клике откроется отдельная страница периода."})]})}),t.jsxs("section",{className:"relative z-10 rounded-[28px] border border-black/10 bg-white/85 p-6 shadow-[0_22px_44px_-28px_rgba(28,26,23,0.6)] backdrop-blur animate-reveal dark:border-white/10 dark:bg-white/10",style:F(120),children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Новый период"}),t.jsx("h2",{className:"mt-2 font-display text-2xl",children:"Добавить диапазон дат"})]})}),t.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-[1fr_1fr_1fr]",children:[t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"С"}),t.jsx("input",{type:"date",value:e,onChange:i=>s(i.target.value),min:r?M(r,-3):void 0,max:r||void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),t.jsxs("label",{className:"grid cursor-pointer grid-cols-[32px_minmax(0,1fr)] items-center gap-3 text-xs text-[#6a5d52] dark:text-white/70",children:[t.jsx("span",{children:"По"}),t.jsx("input",{type:"date",value:r,onChange:i=>l(i.target.value),min:e||void 0,max:e?M(e,3):void 0,className:"date-input ml-auto w-[80%] rounded-lg border border-black/10 bg-white/90 px-4 py-3 text-sm text-[#1c1a17] outline-none transition focus:border-black/30 dark:border-white/10 dark:bg-white/10 dark:text-white sm:ml-0 sm:w-full"})]}),t.jsx("div",{className:"flex flex-col justify-end",children:t.jsx("button",{className:"rounded-2xl bg-[#d87a4a] px-4 py-3 text-sm font-semibold text-white shadow-[0_14px_28px_-18px_rgba(216,122,74,0.8)] transition hover:-translate-y-0.5 disabled:cursor-not-allowed disabled:opacity-70",type:"button",onClick:()=>I(!1),disabled:c,children:c?"Сохранение...":"Сохранить"})})]}),p&&t.jsx("p",{className:"mt-3 text-xs text-[#b0352b] dark:text-[#ff8b7c]",children:p})]}),t.jsxs("section",{className:"relative z-10 grid gap-4 animate-reveal",style:F(240),children:[x.some(i=>i.is_pinned)&&t.jsxs("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Закреплённый период"}),t.jsx("div",{className:"mt-4",children:(()=>{const i=x.find(g=>g.is_pinned);if(!i)return null;const o=A(i);return t.jsx(T,{items:[{id:i.id,title:o.title,subtitle:o.subtitle,isClosed:!!i.is_closed,actualRemaining:i.actual_remaining??null}]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"font-display text-2xl",children:"История периодов"}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"Сначала новые"})]}),t.jsxs("div",{className:"grid gap-4",children:[f&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем периоды..."}),y&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:y}),!f&&!y&&x.length===0&&t.jsx("div",{className:"rounded-[28px] border border-black/10 bg-white/70 p-5 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Периодов пока нет. Создайте первый диапазон выше."}),!f&&!y&&t.jsx(T,{items:x.map(i=>{const o=A(i);return{id:i.id,title:o.title,subtitle:o.subtitle,isClosed:!!i.is_closed,actualRemaining:i.actual_remaining??null}})})]})]}),d&&t.jsx(G,{href:`/periods/${d.id}`,title:k(d.start_date)&&k(d.end_date)?`${C(d.start_date)} — ${C(d.end_date)}`:"Период",subtitle:k(d.start_date)&&k(d.end_date)?`${B(d.start_date,d.end_date)} дней · ${K(d.start_date,d.end_date)}`:"Даты не заданы",onClose:()=>{m(null),u(!1)},onConfirm:()=>I(!0),confirmDisabled:!b||c}),z&&t.jsx(ae,{onConfirm:W})]})]})}export{pe as default};
