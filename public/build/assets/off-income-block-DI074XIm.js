import{c as G,j as l,r as D}from"./app-Co2WJCTd.js";import{T as te,a as se,b as le}from"./app-layout-BWJR1pMz.js";import{b as ne}from"./app-logo-icon-BIJslR1r.js";import{P as Q}from"./pill-button-BF9KXfli.js";import{t as ae,a as re}from"./period-calculations-BXSzTPPy.js";const ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],oe=ne("CircleHelp",ie),Ce=a=>{const e=G.c(3),{children:s,className:u}=a,t=`font-display text-2xl ${u??""}`;let n;return e[0]!==s||e[1]!==t?(n=l.jsx("div",{className:t,children:s}),e[0]=s,e[1]=t,e[2]=n):n=e[2],n};function ce(a){const e=G.c(14),{text:s,ariaLabel:u}=a,[t,n]=D.useState(!1),[m,i]=D.useState(!1);let c,r;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{if(typeof window>"u")return;const N=window.matchMedia("(hover: none) and (pointer: coarse)"),C=()=>n(N.matches);return C(),N.addEventListener("change",C),()=>N.removeEventListener("change",C)},r=[],e[0]=c,e[1]=r):(c=e[0],r=e[1]),D.useEffect(c,r);const x=t?m:void 0,h=u??"Подсказка";let y;e[2]!==t?(y=()=>{t&&i(de)},e[2]=t,e[3]=y):y=e[3];let o;e[4]===Symbol.for("react.memo_cache_sentinel")?(o=l.jsx(oe,{className:"h-4 w-4"}),e[4]=o):o=e[4];let d;e[5]!==h||e[6]!==y?(d=l.jsx(te,{asChild:!0,children:l.jsx("button",{type:"button","aria-label":h,className:"inline-flex h-5 w-5 items-center justify-center rounded-full text-[#6a5d52] transition hover:text-[#1c1a17] dark:text-white/60 dark:hover:text-white",onClick:y,children:o})}),e[5]=h,e[6]=y,e[7]=d):d=e[7];let p;e[8]!==s?(p=l.jsx(se,{className:"max-w-xs text-xs leading-relaxed",children:s}),e[8]=s,e[9]=p):p=e[9];let g;return e[10]!==x||e[11]!==d||e[12]!==p?(g=l.jsxs(le,{open:x,onOpenChange:i,children:[d,p]}),e[10]=x,e[11]=d,e[12]=p,e[13]=g):g=e[13],g}function de(a){return!a}const fe=a=>{const e=G.c(9),{children:s,className:u,tooltipText:t,tooltipAriaLabel:n}=a,m=`text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60 ${u??""}`;let i;e[0]!==s?(i=l.jsx("span",{children:s}),e[0]=s,e[1]=i):i=e[1];let c;e[2]!==n||e[3]!==t?(c=t?l.jsx("span",{className:"ml-2 inline-flex align-middle",children:l.jsx(ce,{text:t,ariaLabel:n??"Дополнительная информация"})}):null,e[2]=n,e[3]=t,e[4]=c):c=e[4];let r;return e[5]!==m||e[6]!==i||e[7]!==c?(r=l.jsxs("div",{className:m,children:[i,c]}),e[5]=m,e[6]=i,e[7]=c,e[8]=r):r=e[8],r},ue=a=>{const e=G.c(49),{value:s,placeholder:u,suggestions:t,disabled:n,onChange:m,onSelect:i,onBlur:c,header:r,className:x,containerClassName:h,inputClassName:y}=a,o=n===void 0?!1:n,d=r===void 0?"Подсказки":r,p=x===void 0?"":x,g=h===void 0?"":h,N=y===void 0?"":y,[C,S]=D.useState(!1),[b,_]=D.useState(0),R=D.useRef(null);let w,$;e[0]!==b||e[1]!==t.length?(w=()=>{b>=t.length&&t.length>0&&_(0)},$=[b,t.length],e[0]=b,e[1]=t.length,e[2]=w,e[3]=$):(w=e[2],$=e[3]),D.useEffect(w,$);let T;e:{if(!s){T="";break e}const f=t[b]??t[0];if(!f){T="";break e}if(!f.toLowerCase().startsWith(s.toLowerCase())){T="";break e}let P;e[4]!==f||e[5]!==s.length?(P=f.slice(s.length),e[4]=f,e[5]=s.length,e[6]=P):P=e[6],T=P}const B=T;let H;e[7]!==i?(H=f=>{i(f),_(0),requestAnimationFrame(()=>R.current?.focus())},e[7]=i,e[8]=H):H=e[8];const E=H;let I;e[9]!==E||e[10]!==b||e[11]!==t?(I=f=>{if(f.key==="Escape"){f.preventDefault(),S(!1),R.current?.blur();return}if(f.key==="Tab"&&t.length>0){f.preventDefault();const Z=f.shiftKey?-1:1,ee=(b+Z+t.length)%t.length;_(ee);return}if(f.key!=="Enter"||(f.preventDefault(),t.length===0))return;const P=t[b]??t[0];P&&E(P)},e[9]=E,e[10]=b,e[11]=t,e[12]=I):I=e[12];const M=I,O=C&&t.length>0&&!o,F=`relative ${p}`;let A;e[13]!==F?(A=F.trim(),e[13]=F,e[14]=A):A=e[14];const j=`relative flex items-center rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs dark:border-white/10 dark:bg-white/10 sm:px-4 sm:text-sm ${g}`;let z;e[15]!==j?(z=j.trim(),e[15]=j,e[16]=z):z=e[16];let K;e[17]!==B||e[18]!==s?(K=B&&l.jsxs("span",{className:"pointer-events-none absolute left-3 top-1/2 z-10 -translate-y-1/2 text-[#6a5d52]/70 dark:text-white/40 sm:left-4",children:[l.jsx("span",{className:"invisible",children:s}),B]}),e[17]=B,e[18]=s,e[19]=K):K=e[19];let k;e[20]!==m?(k=f=>{m(f.target.value),_(0)},e[20]=m,e[21]=k):k=e[21];let v;e[22]===Symbol.for("react.memo_cache_sentinel")?(v=()=>{S(!0),_(0)},e[22]=v):v=e[22];let L;e[23]!==c?(L=()=>{S(!1),c()},e[23]=c,e[24]=L):L=e[24];const q=`relative z-20 w-full bg-transparent text-xs outline-none placeholder:text-[#6a5d52]/60 disabled:cursor-not-allowed disabled:opacity-70 dark:text-white dark:placeholder:text-white/40 sm:text-sm ${N}`;let U;e[25]!==q?(U=q.trim(),e[25]=q,e[26]=U):U=e[26];let V;e[27]!==o||e[28]!==M||e[29]!==u||e[30]!==k||e[31]!==L||e[32]!==U||e[33]!==s?(V=l.jsx("input",{ref:R,type:"text",placeholder:u,value:s,disabled:o,onChange:k,onKeyDown:M,onFocus:v,onBlur:L,className:U}),e[27]=o,e[28]=M,e[29]=u,e[30]=k,e[31]=L,e[32]=U,e[33]=s,e[34]=V):V=e[34];let W;e[35]!==z||e[36]!==K||e[37]!==V?(W=l.jsxs("div",{className:z,children:[K,V]}),e[35]=z,e[36]=K,e[37]=V,e[38]=W):W=e[38];let X;e[39]!==E||e[40]!==d||e[41]!==b||e[42]!==O||e[43]!==t?(X=O&&l.jsx("div",{className:"absolute left-0 right-0 z-30 mt-1",onMouseDown:me,children:l.jsxs("div",{className:"rounded-lg border border-black/10 bg-white/95 p-2 text-xs shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] backdrop-blur dark:border-white/10 dark:bg-[#1f1b17]/95",children:[l.jsx("div",{className:"px-2 py-1 text-[10px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60",children:d}),l.jsx("div",{className:"flex flex-wrap gap-2 px-2 pb-2",children:t.map((f,P)=>l.jsx("button",{type:"button",onClick:()=>E(f),onMouseEnter:()=>_(P),className:["rounded-full border px-3 py-1 text-[11px] font-medium transition",P===b?"border-black/20 bg-black/10 text-[#1c1a17] dark:border-white/30 dark:bg-white/10 dark:text-white":"border-black/10 bg-black/5 text-[#1c1a17] hover:bg-black/10 dark:border-white/10 dark:bg-white/5 dark:text-white dark:hover:bg-white/10"].join(" "),children:f},f))})]})}),e[39]=E,e[40]=d,e[41]=b,e[42]=O,e[43]=t,e[44]=X):X=e[44];let J;return e[45]!==A||e[46]!==W||e[47]!==X?(J=l.jsxs("div",{className:A,children:[W,X]}),e[45]=A,e[46]=W,e[47]=X,e[48]=J):J=e[48],J};function me(a){return a.preventDefault()}const Y=D.createContext(null),Se=({periodId:a,type:e,viewerId:s,children:u})=>{const[t,n]=D.useState({previous:[],all:[]});D.useEffect(()=>{const i=new AbortController;return(async()=>{try{const r=new URLSearchParams({type:e});s&&r.set("viewer_id",s.toString());const x=await fetch(`/api/periods/${a}/expense-suggestions?${r.toString()}`,{signal:i.signal});if(!x.ok)throw new Error("Не удалось загрузить подсказки.");const h=await x.json();n({previous:h.data?.previous??[],all:h.data?.all??[]})}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return}})(),()=>i.abort()},[a,e,s]);const m=D.useMemo(()=>t,[t]);return l.jsx(Y.Provider,{value:m,children:u})},xe=()=>{const a=G.c(2),e=D.useContext(Y);let s;return a[0]!==e?(s=e??{previous:[],all:[]},a[0]=e,a[1]=s):s=a[1],s},he=8,pe=a=>{const e=G.c(18),{value:s,placeholder:u,disabled:t,containerClassName:n,usedNames:m,onChange:i,onBlur:c}=a,r=t===void 0?!1:t;let x;e[0]!==m?(x=m===void 0?[]:m,e[0]=m,e[1]=x):x=e[1];const h=x,{previous:y,all:o}=xe();let d;if(e[2]!==o||e[3]!==y||e[4]!==h||e[5]!==s){e:{const N=s.trim(),C=N.length>0?o:y;let S;e[7]!==h?(S=new Set(h.map(ge).filter(be)),e[7]=h,e[8]=S):S=e[8];const b=S;if(C.length===0){let w;e[9]===Symbol.for("react.memo_cache_sentinel")?(w=[],e[9]=w):w=e[9],d=w;break e}const _=N.toLowerCase();d=C.filter(w=>{const $=w.toLowerCase();return b.has($)?!1:_.length===0?!0:$.startsWith(_)}).slice(0,he)}e[2]=o,e[3]=y,e[4]=h,e[5]=s,e[6]=d}else d=e[6];const p=d;let g;return e[10]!==n||e[11]!==r||e[12]!==c||e[13]!==i||e[14]!==u||e[15]!==p||e[16]!==s?(g=l.jsx(ue,{value:s,placeholder:u,suggestions:p,disabled:r,onChange:i,onSelect:i,onBlur:c,header:"Подсказки",containerClassName:n}),e[10]=n,e[11]=r,e[12]=c,e[13]=i,e[14]=u,e[15]=p,e[16]=s,e[17]=g):g=e[17],g};function ge(a){return a.trim().toLowerCase()}function be(a){return a.length>0}const _e=a=>{const e=G.c(52),{title:s,items:u,setItems:t,showDelete:n,onToggleDelete:m,totalLabel:i,totalAmount:c,idPrefix:r,onBlurField:x,onAfterDelete:h,readOnly:y}=a,o=y===void 0?!1:y;let d;e[0]!==s?(d=l.jsx(fe,{tooltipText:"Эти траты не учитываются в расчётах.",tooltipAriaLabel:"Сторонние траты",children:s}),e[0]=s,e[1]=d):d=e[1];let p;e[2]!==r||e[3]!==t?(p=()=>t(j=>[...j,{id:`${r}${Date.now()}`,name:"",amount:""}]),e[2]=r,e[3]=t,e[4]=p):p=e[4];let g;e[5]!==o||e[6]!==p?(g=l.jsx(Q,{type:"button",onClick:p,disabled:o,children:"+ Строка"}),e[5]=o,e[6]=p,e[7]=g):g=e[7];let N;e[8]!==m||e[9]!==o||e[10]!==n?(N=l.jsx(Q,{type:"button",onClick:m,active:n,activeTone:"danger",disabled:o,children:"− Удаление"}),e[8]=m,e[9]=o,e[10]=n,e[11]=N):N=e[11];let C;e[12]!==g||e[13]!==N?(C=l.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[g,N]}),e[12]=g,e[13]=N,e[14]=C):C=e[14];let S;e[15]!==d||e[16]!==C?(S=l.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[d,C]}),e[15]=d,e[16]=C,e[17]=S):S=e[17];const b=`mt-3 hidden items-center gap-2 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${n?"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.2fr)_minmax(0,0.7fr)]"}`;let _,R;e[18]===Symbol.for("react.memo_cache_sentinel")?(R=l.jsx("span",{children:"Название"}),_=l.jsx("span",{className:"text-right",children:"Сумма"}),e[18]=_,e[19]=R):(_=e[18],R=e[19]);let w;e[20]!==n?(w=n&&l.jsx("span",{className:"text-center",children:"—"}),e[20]=n,e[21]=w):w=e[21];let $;e[22]!==w||e[23]!==b?($=l.jsxs("div",{className:b,children:[R,_,w]}),e[22]=w,e[23]=b,e[24]=$):$=e[24];let T;e[25]!==u||e[26]!==h||e[27]!==x||e[28]!==o||e[29]!==t||e[30]!==n?(T=u.map((j,z)=>{const K=u.filter(k=>k.id!==j.id).map(we);return l.jsxs("div",{className:`grid items-center gap-2 ${n?"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)_auto]":"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)]"}`,children:[l.jsx("div",{className:"min-w-0",children:l.jsx(pe,{value:j.name,placeholder:`Трата ${z+1}`,disabled:o,usedNames:K,onChange:k=>t(v=>v.map(L=>L.id===j.id?{...L,name:k}:L)),onBlur:x})}),l.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",value:j.amount,disabled:o,onChange:k=>{const v=k.target.value;t(L=>L.map(q=>q.id===j.id?{...q,amount:ae(v)}:q))},onFocus:()=>{j.amount===0&&t(k=>k.map(v=>v.id===j.id?{...v,amount:""}:v))},onBlur:()=>{j.amount===""&&t(k=>k.map(v=>v.id===j.id?{...v,amount:0}:v)),x()},className:"no-spin w-full rounded-lg border border-black/10 bg-white/90 px-3 py-2 text-xs text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c] sm:px-4 sm:text-sm"}),n&&l.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&(t(k=>k.filter(v=>v.id!==j.id)),h())},"aria-label":`Удалить трату ${z+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",disabled:o,children:"—"})]},j.id)}),e[25]=u,e[26]=h,e[27]=x,e[28]=o,e[29]=t,e[30]=n,e[31]=T):T=e[31];let B;e[32]!==T?(B=l.jsx("div",{className:"mt-3 grid gap-2",children:T}),e[32]=T,e[33]=B):B=e[33];const H=`mt-3 grid items-center gap-2 rounded-lg border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${n?"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)_auto]":"grid-cols-[minmax(0,1fr)_minmax(92px,0.55fr)]"}`;let E;e[34]!==i?(E=l.jsx("span",{children:i}),e[34]=i,e[35]=E):E=e[35];let I;e[36]!==c?(I=re(c),e[36]=c,e[37]=I):I=e[37];let M;e[38]!==I?(M=l.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:I}),e[38]=I,e[39]=M):M=e[39];let O;e[40]!==n?(O=n&&l.jsx("span",{}),e[40]=n,e[41]=O):O=e[41];let F;e[42]!==H||e[43]!==E||e[44]!==M||e[45]!==O?(F=l.jsxs("div",{className:H,children:[E,M,O]}),e[42]=H,e[43]=E,e[44]=M,e[45]=O,e[46]=F):F=e[46];let A;return e[47]!==$||e[48]!==B||e[49]!==F||e[50]!==S?(A=l.jsxs("div",{className:"w-full min-w-0 overflow-hidden rounded-lg border border-black/10 bg-white/80 px-4 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10 sm:px-5",children:[S,$,B,F]}),e[47]=$,e[48]=B,e[49]=F,e[50]=S,e[51]=A):A=e[51],A};function we(a){return a.name}export{fe as B,Se as E,_e as O,Ce as a,pe as b};
