import{u as xe,r as h,j as t,H as me,L as de,c as ne}from"./app-CmNQe6jq.js";import{A as ue}from"./app-layout-CjKAraN2.js";import{d as le}from"./index-BDqSilVs.js";/* empty css            */import"./app-logo-icon-B_RMia80.js";import"./index-BYw0lCFu.js";import"./index-QJjkEm5Y.js";const be=n=>({"--delay":`${n}ms`}),pe={id:0,startDate:"",endDate:"",incomes:[],expenses:[],offIncomeExpenses:[],dailyExpenses:{}},W=n=>`${Math.max(0,Math.round(n)).toLocaleString("ru-RU")} ₽`,se=n=>{const e=Math.round(n);return e===0?"0 ₽":`${e>0?"+":"−"}${Math.abs(e).toLocaleString("ru-RU")} ₽`},ee=n=>{const[e,x,d]=n.split("-").map(Number);return new Date(e,(x??1)-1,d??1)},ie=n=>{const e=ee(n),x=String(e.getDate()).padStart(2,"0"),d=String(e.getMonth()+1).padStart(2,"0");return`${x}.${d}`},fe=n=>new Intl.DateTimeFormat("ru-RU",{month:"long",year:"numeric"}).format(ee(n)),he=(n,e)=>{const x=new Intl.DateTimeFormat("ru-RU",{month:"short"}),d=x.format(ee(n)),s=x.format(ee(e)),a=ee(n).getFullYear(),j=ee(e).getFullYear();return a===j?d===s?fe(n):`${d}–${s} ${a}`:`${d} ${a} – ${s} ${j}`},ge=(n,e)=>{const x=ee(n),s=ee(e).getTime()-x.getTime(),a=Math.floor(s/(1e3*60*60*24));return Math.max(1,a+1)},we=n=>{const e=ne.c(22),{items:x,setItems:d,totalAmount:s,onAdd:a,onBlurField:j}=n;let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Приход"}),e[0]=c):c=e[0];let _;e[1]!==a?(_=t.jsxs("div",{className:"flex items-center justify-between",children:[c,t.jsx("button",{type:"button",onClick:a,className:"rounded-full border border-black/10 px-3 py-1 text-xs text-[#6a5d52] dark:border-white/10 dark:text-white/70",children:"+ Строка"})]}),e[1]=a,e[2]=_):_=e[2];let A;e[3]===Symbol.for("react.memo_cache_sentinel")?(A=t.jsxs("div",{className:"mt-3 hidden grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)] items-center gap-3 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid",children:[t.jsx("span",{children:"Название"}),t.jsx("span",{className:"text-right",children:"Сумма"})]}),e[3]=A):A=e[3];let b;if(e[4]!==x||e[5]!==j||e[6]!==d){let y;e[8]!==j||e[9]!==d?(y=(m,L)=>t.jsxs("div",{className:"grid items-center gap-3 sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]",children:[t.jsx("input",{type:"text",placeholder:`Приход ${L+1}`,value:m.name,onChange:S=>d(i=>i.map(N=>N.id===m.id?{...N,name:S.target.value}:N)),onBlur:j,className:"rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm dark:border-white/10 dark:bg-white/10"}),t.jsx("input",{type:"number",min:0,value:m.amount,onChange:S=>{const i=S.target.value;d(N=>N.map(D=>D.id===m.id?{...D,amount:i===""?"":Number(i)}:D))},onFocus:()=>{m.amount===0&&d(S=>S.map(i=>i.id===m.id?{...i,amount:""}:i))},onBlur:()=>{m.amount===""&&d(S=>S.map(i=>i.id===m.id?{...i,amount:0}:i)),j()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums dark:border-white/10 dark:bg-white/10"})]},m.id),e[8]=j,e[9]=d,e[10]=y):y=e[10],b=x.map(y),e[4]=x,e[5]=j,e[6]=d,e[7]=b}else b=e[7];let g;e[11]!==b?(g=t.jsx("div",{className:"mt-3 grid gap-2",children:b}),e[11]=b,e[12]=g):g=e[12];let p;e[13]===Symbol.for("react.memo_cache_sentinel")?(p=t.jsx("span",{children:"Итого прихода"}),e[13]=p):p=e[13];let w;e[14]!==s?(w=W(s),e[14]=s,e[15]=w):w=e[15];let f;e[16]!==w?(f=t.jsxs("div",{className:"mt-3 grid items-center gap-3 rounded-2xl border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]",children:[p,t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:w})]}),e[16]=w,e[17]=f):f=e[17];let $;return e[18]!==_||e[19]!==g||e[20]!==f?($=t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[_,A,g,f]}),e[18]=_,e[19]=g,e[20]=f,e[21]=$):$=e[21],$},ke=n=>{const e=ne.c(63),{title:x,items:d,setItems:s,showDelete:a,onToggleDelete:j,totalLabel:c,totalPlanned:_,totalActual:A,totalDifference:b,idPrefix:g,onBlurField:p}=n;let w;e[0]!==x?(w=t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:x}),e[0]=x,e[1]=w):w=e[1];let f;e[2]!==g||e[3]!==s?(f=t.jsx("button",{type:"button",onClick:()=>s(X=>[...X,{id:`${g}${Date.now()}`,name:"",plannedAmount:"",actualAmount:""}]),className:"rounded-full border border-black/10 px-3 py-1 text-xs text-[#6a5d52] dark:border-white/10 dark:text-white/70",children:"+ Строка"}),e[2]=g,e[3]=s,e[4]=f):f=e[4];const $=`rounded-full border px-3 py-1 text-xs transition ${a?"border-[#b0352b]/40 text-[#b0352b] dark:border-[#ff8b7c]/40 dark:text-[#ff8b7c]":"border-black/10 text-[#6a5d52] dark:border-white/10 dark:text-white/70"}`;let y;e[5]!==j||e[6]!==$?(y=t.jsx("button",{type:"button",onClick:j,className:$,children:"− Удаление"}),e[5]=j,e[6]=$,e[7]=y):y=e[7];let m;e[8]!==f||e[9]!==y?(m=t.jsxs("div",{className:"flex items-center gap-2",children:[f,y]}),e[8]=f,e[9]=y,e[10]=m):m=e[10];let L;e[11]!==w||e[12]!==m?(L=t.jsxs("div",{className:"flex items-center justify-between",children:[w,m]}),e[11]=w,e[12]=m,e[13]=L):L=e[13];const S=`mt-3 hidden items-center gap-3 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let i,N,D,R;e[14]===Symbol.for("react.memo_cache_sentinel")?(D=t.jsx("span",{children:"Название"}),R=t.jsx("span",{className:"text-right",children:"План"}),i=t.jsx("span",{className:"text-right",children:"Факт"}),N=t.jsx("span",{className:"text-right",children:"Разница"}),e[14]=i,e[15]=N,e[16]=D,e[17]=R):(i=e[14],N=e[15],D=e[16],R=e[17]);let Y;e[18]!==a?(Y=a&&t.jsx("span",{className:"text-center",children:"—"}),e[18]=a,e[19]=Y):Y=e[19];let F;e[20]!==Y||e[21]!==S?(F=t.jsxs("div",{className:S,children:[D,R,i,N,Y]}),e[20]=Y,e[21]=S,e[22]=F):F=e[22];let B;if(e[23]!==d||e[24]!==p||e[25]!==s||e[26]!==a){let X;e[28]!==p||e[29]!==s||e[30]!==a?(X=(u,re)=>t.jsxs("div",{className:`grid items-center gap-3 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${re+1}`,value:u.name,onChange:I=>s(o=>o.map(G=>G.id===u.id?{...G,name:I.target.value}:G)),onBlur:p,className:"rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm dark:border-white/10 dark:bg-white/10"}),t.jsx("input",{type:"number",min:0,value:u.plannedAmount,onChange:I=>{const o=I.target.value;s(G=>G.map(Q=>Q.id===u.id?{...Q,plannedAmount:o===""?"":Number(o)}:Q))},onFocus:()=>{u.plannedAmount===0&&s(I=>I.map(o=>o.id===u.id?{...o,plannedAmount:""}:o))},onBlur:()=>{u.plannedAmount===""&&s(I=>I.map(o=>o.id===u.id?{...o,plannedAmount:0}:o)),p()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums dark:border-white/10 dark:bg-white/10"}),t.jsx("input",{type:"number",min:0,value:u.actualAmount,onChange:I=>{const o=I.target.value;s(G=>G.map(Q=>Q.id===u.id?{...Q,actualAmount:o===""?"":Number(o)}:Q))},onFocus:()=>{u.actualAmount===0&&s(I=>I.map(o=>o.id===u.id?{...o,actualAmount:""}:o))},onBlur:()=>{u.actualAmount===""&&s(I=>I.map(o=>o.id===u.id?{...o,actualAmount:0}:o)),p()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums dark:border-white/10 dark:bg-white/10"}),t.jsx("div",{className:`flex min-h-[40px] items-center justify-end px-4 py-2 text-sm tabular-nums ${u.plannedAmount-u.actualAmount>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":u.plannedAmount-u.actualAmount<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`,children:se(u.plannedAmount-u.actualAmount)}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&s(I=>I.filter(o=>o.id!==u.id))},"aria-label":`Удалить трату ${re+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},u.id),e[28]=p,e[29]=s,e[30]=a,e[31]=X):X=e[31],B=d.map(X),e[23]=d,e[24]=p,e[25]=s,e[26]=a,e[27]=B}else B=e[27];let T;e[32]!==B?(T=t.jsx("div",{className:"mt-3 grid gap-2",children:B}),e[32]=B,e[33]=T):T=e[33];const z=`mt-3 grid items-center gap-3 rounded-2xl border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_minmax(0,0.7fr)_minmax(0,0.7fr)]"}`;let E;e[34]!==c?(E=t.jsx("span",{children:c}),e[34]=c,e[35]=E):E=e[35];let O;e[36]!==_?(O=W(_),e[36]=_,e[37]=O):O=e[37];let C;e[38]!==O?(C=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:O}),e[38]=O,e[39]=C):C=e[39];let v;e[40]!==A?(v=W(A),e[40]=A,e[41]=v):v=e[41];let H;e[42]!==v?(H=t.jsx("span",{className:"text-right font-display text-sm tabular-nums",children:v}),e[42]=v,e[43]=H):H=e[43];const M=`text-right font-display text-sm tabular-nums ${b>0?"text-[#1e7b4f] dark:text-[#7ce0b3]":b<0?"text-[#b0352b] dark:text-[#ff8b7c]":"text-[#6a5d52] dark:text-white/70"}`;let l;e[44]!==b?(l=se(b),e[44]=b,e[45]=l):l=e[45];let U;e[46]!==M||e[47]!==l?(U=t.jsx("span",{className:M,children:l}),e[46]=M,e[47]=l,e[48]=U):U=e[48];let K;e[49]!==a?(K=a&&t.jsx("span",{}),e[49]=a,e[50]=K):K=e[50];let V;e[51]!==z||e[52]!==E||e[53]!==C||e[54]!==H||e[55]!==U||e[56]!==K?(V=t.jsxs("div",{className:z,children:[E,C,H,U,K]}),e[51]=z,e[52]=E,e[53]=C,e[54]=H,e[55]=U,e[56]=K,e[57]=V):V=e[57];let q;return e[58]!==F||e[59]!==T||e[60]!==V||e[61]!==L?(q=t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[L,F,T,V]}),e[58]=F,e[59]=T,e[60]=V,e[61]=L,e[62]=q):q=e[62],q},je=n=>{const e=ne.c(50),{title:x,items:d,setItems:s,showDelete:a,onToggleDelete:j,totalLabel:c,totalAmount:_,idPrefix:A,onBlurField:b}=n;let g;e[0]!==x?(g=t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:x}),e[0]=x,e[1]=g):g=e[1];let p;e[2]!==A||e[3]!==s?(p=t.jsx("button",{type:"button",onClick:()=>s(C=>[...C,{id:`${A}${Date.now()}`,name:"",amount:""}]),className:"rounded-full border border-black/10 px-3 py-1 text-xs text-[#6a5d52] dark:border-white/10 dark:text-white/70",children:"+ Строка"}),e[2]=A,e[3]=s,e[4]=p):p=e[4];const w=`rounded-full border px-3 py-1 text-xs transition ${a?"border-[#b0352b]/40 text-[#b0352b] dark:border-[#ff8b7c]/40 dark:text-[#ff8b7c]":"border-black/10 text-[#6a5d52] dark:border-white/10 dark:text-white/70"}`;let f;e[5]!==j||e[6]!==w?(f=t.jsx("button",{type:"button",onClick:j,className:w,children:"− Удаление"}),e[5]=j,e[6]=w,e[7]=f):f=e[7];let $;e[8]!==p||e[9]!==f?($=t.jsxs("div",{className:"flex items-center gap-2",children:[p,f]}),e[8]=p,e[9]=f,e[10]=$):$=e[10];let y;e[11]!==g||e[12]!==$?(y=t.jsxs("div",{className:"flex items-center justify-between",children:[g,$]}),e[11]=g,e[12]=$,e[13]=y):y=e[13];const m=`mt-3 hidden items-center gap-3 text-[11px] uppercase tracking-[0.2em] text-[#6a5d52] dark:text-white/60 sm:grid ${a?"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_auto]":"grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]"}`;let L,S;e[14]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx("span",{children:"Название"}),S=t.jsx("span",{className:"text-right",children:"Сумма"}),e[14]=L,e[15]=S):(L=e[14],S=e[15]);let i;e[16]!==a?(i=a&&t.jsx("span",{className:"text-center",children:"—"}),e[16]=a,e[17]=i):i=e[17];let N;e[18]!==i||e[19]!==m?(N=t.jsxs("div",{className:m,children:[L,S,i]}),e[18]=i,e[19]=m,e[20]=N):N=e[20];let D;if(e[21]!==d||e[22]!==b||e[23]!==s||e[24]!==a){let C;e[26]!==b||e[27]!==s||e[28]!==a?(C=(v,H)=>t.jsxs("div",{className:`grid items-center gap-3 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]"}`,children:[t.jsx("input",{type:"text",placeholder:`Трата ${H+1}`,value:v.name,onChange:M=>s(l=>l.map(U=>U.id===v.id?{...U,name:M.target.value}:U)),onBlur:b,className:"rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm dark:border-white/10 dark:bg-white/10"}),t.jsx("input",{type:"number",min:0,value:v.amount,onChange:M=>{const l=M.target.value;s(U=>U.map(K=>K.id===v.id?{...K,amount:l===""?"":Number(l)}:K))},onFocus:()=>{v.amount===0&&s(M=>M.map(l=>l.id===v.id?{...l,amount:""}:l))},onBlur:()=>{v.amount===""&&s(M=>M.map(l=>l.id===v.id?{...l,amount:0}:l)),b()},className:"no-spin rounded-2xl border border-black/10 bg-white/90 px-4 py-2 text-sm text-right tabular-nums text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]"}),a&&t.jsx("button",{type:"button",onClick:()=>{window.confirm("Удалить строку?")&&s(M=>M.filter(l=>l.id!==v.id))},"aria-label":`Удалить трату ${H+1}`,className:"flex h-8 w-8 items-center justify-center rounded-full text-xs text-[#b0352b] transition hover:bg-[#b0352b]/10 dark:text-[#ff8b7c] dark:hover:bg-[#ff8b7c]/15",children:"—"})]},v.id),e[26]=b,e[27]=s,e[28]=a,e[29]=C):C=e[29],D=d.map(C),e[21]=d,e[22]=b,e[23]=s,e[24]=a,e[25]=D}else D=e[25];let R;e[30]!==D?(R=t.jsx("div",{className:"mt-3 grid gap-2",children:D}),e[30]=D,e[31]=R):R=e[31];const Y=`mt-3 grid items-center gap-3 rounded-2xl border border-dashed border-black/10 bg-white/70 px-4 py-2 text-xs dark:border-white/10 dark:bg-white/5 ${a?"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)_auto]":"sm:grid-cols-[minmax(0,1.6fr)_minmax(0,0.7fr)]"}`;let F;e[32]!==c?(F=t.jsx("span",{children:c}),e[32]=c,e[33]=F):F=e[33];let B;e[34]!==_?(B=W(_),e[34]=_,e[35]=B):B=e[35];let T;e[36]!==B?(T=t.jsx("span",{className:"text-right font-display text-sm tabular-nums text-[#b0352b] dark:text-[#ff8b7c]",children:B}),e[36]=B,e[37]=T):T=e[37];let z;e[38]!==a?(z=a&&t.jsx("span",{}),e[38]=a,e[39]=z):z=e[39];let E;e[40]!==Y||e[41]!==F||e[42]!==T||e[43]!==z?(E=t.jsxs("div",{className:Y,children:[F,T,z]}),e[40]=Y,e[41]=F,e[42]=T,e[43]=z,e[44]=E):E=e[44];let O;return e[45]!==N||e[46]!==R||e[47]!==E||e[48]!==y?(O=t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[y,N,R,E]}),e[45]=N,e[46]=R,e[47]=E,e[48]=y,e[49]=O):O=e[49],O};function De(){const{periodId:n}=xe().props,[e,x]=h.useState(pe),[d,s]=h.useState([]),[a,j]=h.useState(""),[c,_]=h.useState(""),[A,b]=h.useState([]),[g,p]=h.useState([]),[w,f]=h.useState({}),[$,y]=h.useState(!1),[m,L]=h.useState(!1),[S,i]=h.useState(!0),[N,D]=h.useState(null),[R,Y]=h.useState(!1),[F,B]=h.useState(null),[T,z]=h.useState(!1),E=h.useRef(!1),O=h.useMemo(()=>`period:${n}`,[n]),C=h.useRef(!1),v=()=>typeof window>"u"?null:window.__periodCache?.[O]??null,H=r=>{if(typeof window>"u")return;const k=window;k.__periodCache||(k.__periodCache={}),k.__periodCache[O]=r},M=(A??[]).reduce((r,k)=>r+(Number(k.plannedAmount)||0),0),l=(A??[]).reduce((r,k)=>r+(Number(k.actualAmount)||0),0),U=M-l,K=(g??[]).reduce((r,k)=>r+(Number(k.amount)||0),0),V=(d??[]).reduce((r,k)=>r+(Number(k.amount)||0),0),q=h.useMemo(()=>!a||!c?0:ge(a,c),[a,c]),X=h.useMemo(()=>Object.values(w).reduce((r,k)=>r+(k||0),0),[w]),u=q>0?X/q:0,re=h.useMemo(()=>!a||!c?"Период":`${ie(a)} — ${ie(c)}`,[a,c]),I=h.useMemo(()=>!a||!c?"":`${q} дней · ${he(a,c)}`,[q,a,c]),o=q>0?(V-l)/q:0,G=[{title:"Dashboard",href:le().url},{title:re,href:`/periods/${n}`}],Q=r=>!!(r&&r.id&&Array.isArray(r.incomes)&&Array.isArray(r.expenses)&&Array.isArray(r.offIncomeExpenses)),oe=async()=>{if(C.current)return;const r=v();if(Q(r)){C.current=!0,x(r),s(r.incomes??[]),j(r.startDate??""),_(r.endDate??""),b(r.expenses??[]),p(r.offIncomeExpenses??[]),f(r.dailyExpenses??{}),i(!1);return}C.current=!0,i(!0),D(null);try{const k=await fetch(`/api/periods/${n}`);if(!k.ok)throw new Error("Не удалось загрузить период.");const ae=(await k.json()).data,Z={id:ae.id,startDate:ae.start_date,endDate:ae.end_date,dailyExpenses:ae.daily_expenses??{},incomes:ae.incomes.map(J=>({id:String(J.id),name:J.name,amount:J.amount})),expenses:ae.expenses.map(J=>({id:String(J.id),name:J.name,plannedAmount:J.planned_amount,actualAmount:J.actual_amount})),offIncomeExpenses:ae.external_expenses.map(J=>({id:String(J.id),name:J.name,amount:J.amount}))};x(Z),s(Z.incomes),j(Z.startDate),_(Z.endDate),b(Z.expenses),p(Z.offIncomeExpenses),f(Z.dailyExpenses),H(Z)}catch(k){D(k instanceof Error?k.message:"Не удалось загрузить период.")}finally{i(!1)}},te=async()=>{if(R){E.current=!0;return}Y(!0),B(null),z(!1);try{const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",k=await fetch(`/api/periods/${n}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r},body:JSON.stringify({start_date:a,end_date:c,daily_expenses:w,incomes:d.map(P=>({id:Number.isFinite(Number(P.id))?Number(P.id):void 0,name:P.name,amount:Number(P.amount)||0})),expenses:A.map(P=>({id:Number.isFinite(Number(P.id))?Number(P.id):void 0,name:P.name,planned_amount:Number(P.plannedAmount)||0,actual_amount:Number(P.actualAmount)||0})),external_expenses:g.map(P=>({id:Number.isFinite(Number(P.id))?Number(P.id):void 0,name:P.name,amount:Number(P.amount)||0}))})});if(k.status===409)throw new Error("Период пересекается с существующим.");if(!k.ok)throw new Error("Не удалось сохранить период.");z(!0),H({id:Number(n),startDate:a,endDate:c,incomes:d,expenses:A,offIncomeExpenses:g,dailyExpenses:w})}catch(r){B(r instanceof Error?r.message:"Не удалось сохранить период.")}finally{Y(!1)}},ce=()=>{s(r=>[...r,{id:`i${Date.now()}`,name:"",amount:""}]),te()};return h.useEffect(()=>{oe()},[n]),h.useEffect(()=>{!R&&E.current&&(E.current=!1,te())},[R]),t.jsxs(ue,{breadcrumbs:G,children:[t.jsx(me,{title:re}),t.jsxs("div",{className:"relative flex flex-1 flex-col gap-8 overflow-x-hidden rounded-xl p-6 font-body text-[#1c1a17] dark:text-[#f7f3ee]",children:[t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-3xl bg-aurora opacity-35 dark:hidden"}),t.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-3xl bg-aurora-night opacity-45 dark:block"}),t.jsxs("section",{className:"relative z-10 flex flex-wrap items-center justify-between gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[#6a5d52] dark:text-white/60",children:"Период"}),t.jsx("h1",{className:"mt-3 font-display text-3xl",children:re}),t.jsx("p",{className:"mt-2 text-sm text-[#6a5d52] dark:text-white/70",children:I})]}),t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:t.jsx(de,{href:le(),prefetch:!0,className:"rounded-full border border-black/10 bg-white/80 px-4 py-2 text-xs text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.6)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"← Ко всем периодам"})})]}),t.jsxs("section",{className:"relative z-10 grid gap-6 lg:grid-cols-[1.1fr_0.9fr] animate-reveal",style:be(120),children:[S&&t.jsx("div",{className:"col-span-full rounded-2xl border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#6a5d52] dark:border-white/10 dark:bg-white/10 dark:text-white/70",children:"Загружаем период..."}),N&&t.jsx("div",{className:"col-span-full rounded-2xl border border-black/10 bg-white/70 px-5 py-4 text-sm text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:N}),t.jsxs("div",{className:"order-2 grid gap-4 lg:order-none",children:[t.jsx(we,{items:d,setItems:s,totalAmount:V,onAdd:ce,onBlurField:te}),t.jsx(ke,{title:"Обязательные траты",items:A,setItems:b,showDelete:$,onToggleDelete:()=>y(r=>!r),totalLabel:"Итого обязательных",totalPlanned:M,totalActual:l,totalDifference:U,idPrefix:"e",onBlurField:te}),t.jsx(je,{title:"Сторонние траты",items:g,setItems:p,showDelete:$,onToggleDelete:()=>y(r=>!r),totalLabel:"Итого сторонних",totalAmount:K,idPrefix:"o",onBlurField:te})]}),t.jsxs("div",{className:"order-1 grid gap-4 lg:order-none",children:[t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-white/80 px-5 py-4 text-sm shadow-[0_20px_40px_-26px_rgba(28,26,23,0.6)] dark:border-white/10 dark:bg-white/10",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-[#6a5d52] dark:text-white/60",children:"Дни периода"}),t.jsx("button",{type:"button",onClick:()=>L(r=>!r),className:`rounded-full border px-3 py-1 text-xs transition ${m?"border-[#1e7b4f]/40 text-[#1e7b4f] dark:border-[#7ce0b3]/40 dark:text-[#7ce0b3]":"border-black/10 text-[#6a5d52] dark:border-white/10 dark:text-white/70"}`,children:m?"Готово":"Редактировать"})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[t.jsx("div",{className:"px-1 text-base font-semibold tabular-nums",children:q}),t.jsx("span",{className:"text-xs text-[#6a5d52] dark:text-white/60",children:"дней"})]}),t.jsx(de,{href:`/periods/${n}/daily`,prefetch:!0,className:"mt-4 block w-full rounded-2xl border border-black/10 bg-white/80 px-4 py-3 text-center text-sm font-semibold text-[#1c1a17] shadow-[0_16px_32px_-24px_rgba(28,26,23,0.5)] transition hover:-translate-y-0.5 dark:border-white/10 dark:bg-white/10 dark:text-white",children:"Ежедневные траты"}),m&&t.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:[t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Начало",t.jsx("input",{type:"date",value:a,onChange:r=>j(r.target.value),onBlur:te,max:c,className:"rounded-2xl border border-black/10 bg-white/90 px-3 py-2 text-sm dark:border-white/10 dark:bg-white/10"})]}),t.jsxs("label",{className:"grid gap-1 text-xs text-[#6a5d52] dark:text-white/60",children:["Конец",t.jsx("input",{type:"date",value:c,onChange:r=>_(r.target.value),onBlur:te,min:a,className:"rounded-2xl border border-black/10 bg-white/90 px-3 py-2 text-sm dark:border-white/10 dark:bg-white/10"})]})]})]}),t.jsxs("div",{className:"rounded-2xl border border-black/10 bg-[#1c1a17] px-5 py-6 text-white shadow-[0_20px_40px_-26px_rgba(0,0,0,0.7)]",children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:"Среднее в день"}),t.jsx("p",{className:"mt-2 text-xs text-white/60",children:"(Приход − обязательные) / дни"}),t.jsx("p",{className:"mt-3 font-display text-2xl",children:W(o)}),t.jsxs("div",{className:"mt-4 grid gap-3 text-xs text-white/70",children:[t.jsx("div",{className:"h-px w-full bg-white/10"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm font-semibold",children:[t.jsx("span",{className:"font-display tabular-nums text-[#7ce0b3]",children:W(V)}),t.jsx("span",{className:"text-white/60",children:"−"}),t.jsx("span",{className:"font-display tabular-nums text-[#ff8b7c]",children:W(l)}),t.jsx("span",{className:"text-white/60",children:"="}),t.jsx("span",{className:`font-display tabular-nums ${V-l>=0?"text-[#7ce0b3]":"text-[#ff8b7c]"}`,children:se(V-l)})]}),t.jsx("div",{className:"text-[11px] uppercase tracking-[0.2em] text-white/60",children:"Приход − траты = сумма в период"}),t.jsx("div",{className:"h-px w-full bg-white/10"}),t.jsx("div",{className:"mt-4 text-xs text-white/60",children:"Остаток"}),t.jsx("div",{className:"mt-2 font-display text-2xl",children:W(V-l-X)}),t.jsx("div",{className:"h-px w-full bg-white/10"}),t.jsx("div",{className:"mt-4 text-xs text-white/60",children:"Факт среднее в день"}),t.jsx("div",{className:"mt-2 font-display text-2xl",children:W(u)})]})]})]})]}),F&&t.jsx("div",{className:"relative z-10 rounded-2xl border border-black/10 bg-white/70 px-5 py-3 text-xs text-[#b0352b] dark:border-white/10 dark:bg-white/10 dark:text-[#ff8b7c]",children:F})]})]})}export{De as default};
